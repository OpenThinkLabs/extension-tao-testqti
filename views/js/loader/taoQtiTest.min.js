function _typeof(obj){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof(obj)}(function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("codemirror/lib/codemirror",factory):(global=global||self,global.CodeMirror=factory())})(this,function(){'use strict';var _StringfromCharCode=String.fromCharCode,_Mathround=Math.round,_Mathabs=Math.abs,_Mathmax=Math.max,_Mathfloor=Math.floor,_Mathceil=Math.ceil,_Mathmin=Math.min;function classTest(cls){return new RegExp("(^|\\s)"+cls+"(?:$|\\s)\\s*")}function removeChildren(e){for(var count=e.childNodes.length;0<count;--count)e.removeChild(e.firstChild);return e}function removeChildrenAndAdd(parent,e){return removeChildren(parent).appendChild(e)}function elt(tag,content,className,style){var e=document.createElement(tag);if(className&&(e.className=className),style&&(e.style.cssText=style),"string"==typeof content)e.appendChild(document.createTextNode(content));else if(content)for(var i=0;i<content.length;++i)e.appendChild(content[i]);return e}function eltP(tag,content,className,style){var e=elt(tag,content,className,style);return e.setAttribute("role","presentation"),e}function contains(parent,child){if(3==child.nodeType&&(child=child.parentNode),parent.contains)return parent.contains(child);do if(11==child.nodeType&&(child=child.host),child==parent)return!0;while(child=child.parentNode)}function activeElt(){var activeElement;try{activeElement=document.activeElement}catch(e){activeElement=document.body||null}for(;activeElement&&activeElement.shadowRoot&&activeElement.shadowRoot.activeElement;)activeElement=activeElement.shadowRoot.activeElement;return activeElement}function addClass(node,cls){var current=node.className;classTest(cls).test(current)||(node.className+=(current?" ":"")+cls)}function joinClasses(a,b){for(var as=a.split(" "),i=0;i<as.length;i++)as[i]&&!classTest(as[i]).test(b)&&(b+=" "+as[i]);return b}function bind(f){var args=Array.prototype.slice.call(arguments,1);return function(){return f.apply(null,args)}}function copyObj(obj,target,overwrite){for(var prop in target||(target={}),obj)obj.hasOwnProperty(prop)&&(!1!==overwrite||!target.hasOwnProperty(prop))&&(target[prop]=obj[prop]);return target}function countColumn(string,end,tabSize,startIndex,startValue){null==end&&(end=string.search(/[^\s\u00a0]/),-1==end&&(end=string.length));for(var i=startIndex||0,n=startValue||0,nextTab;;){if(nextTab=string.indexOf("\t",i),0>nextTab||nextTab>=end)return n+(end-i);n+=nextTab-i,n+=tabSize-n%tabSize,i=nextTab+1}}function indexOf(array,elt){for(var i=0;i<array.length;++i)if(array[i]==elt)return i;return-1}function findColumn(string,goal,tabSize){for(var pos=0,col=0,nextTab;;){nextTab=string.indexOf("\t",pos),-1==nextTab&&(nextTab=string.length);var skipped=nextTab-pos;if(nextTab==string.length||col+skipped>=goal)return pos+_Mathmin(skipped,goal-col);if(col+=nextTab-pos,col+=tabSize-col%tabSize,pos=nextTab+1,col>=goal)return pos}}function spaceStr(n){for(;spaceStrs.length<=n;)spaceStrs.push(lst(spaceStrs)+" ");return spaceStrs[n]}function lst(arr){return arr[arr.length-1]}function map(array,f){for(var out=[],i=0;i<array.length;i++)out[i]=f(array[i],i);return out}function insertSorted(array,value,score){for(var pos=0,priority=score(value);pos<array.length&&score(array[pos])<=priority;)pos++;array.splice(pos,0,value)}function nothing(){}function createObj(base,props){var inst;return Object.create?inst=Object.create(base):(nothing.prototype=base,inst=new nothing),props&&copyObj(props,inst),inst}function isWordCharBasic(ch){return /\w/.test(ch)||"\x80"<ch&&(ch.toUpperCase()!=ch.toLowerCase()||nonASCIISingleCaseWordChar.test(ch))}function isWordChar(ch,helper){return helper?!!(-1<helper.source.indexOf("\\w")&&isWordCharBasic(ch))||helper.test(ch):isWordCharBasic(ch)}function isEmpty(obj){for(var n in obj)if(obj.hasOwnProperty(n)&&obj[n])return!1;return!0}function isExtendingChar(ch){return 768<=ch.charCodeAt(0)&&extendingChars.test(ch)}function skipExtendingChars(str,pos,dir){for(;(0>dir?0<pos:pos<str.length)&&isExtendingChar(str.charAt(pos));)pos+=dir;return pos}function findFirst(pred,from,to){for(var dir=from>to?-1:1;;){if(from==to)return from;var midF=(from+to)/2,mid=0>dir?_Mathceil(midF):_Mathfloor(midF);if(mid==from)return pred(mid)?from:to;pred(mid)?to=mid:from=mid+dir}}function iterateBidiSections(order,from,to,f){if(!order)return f(from,to,"ltr",0);for(var found=!1,i=0,part;i<order.length;++i)part=order[i],(part.from<to&&part.to>from||from==to&&part.to==from)&&(f(_Mathmax(part.from,from),_Mathmin(part.to,to),1==part.level?"rtl":"ltr",i),found=!0);found||f(from,to,"ltr")}function getBidiPartAt(order,ch,sticky){var found;bidiOther=null;for(var i=0,cur;i<order.length;++i){if(cur=order[i],cur.from<ch&&cur.to>ch)return i;cur.to==ch&&(cur.from!=cur.to&&"before"==sticky?found=i:bidiOther=i),cur.from==ch&&(cur.from!=cur.to&&"before"!=sticky?found=i:bidiOther=i)}return null==found?bidiOther:found}function getOrder(line,direction){var order=line.order;return null==order&&(order=line.order=bidiOrdering(line.text,direction)),order}function getHandlers(emitter,type){return emitter._handlers&&emitter._handlers[type]||noHandlers}function off(emitter,type,f){if(emitter.removeEventListener)emitter.removeEventListener(type,f,!1);else if(emitter.detachEvent)emitter.detachEvent("on"+type,f);else{var map=emitter._handlers,arr=map&&map[type];if(arr){var index=indexOf(arr,f);-1<index&&(map[type]=arr.slice(0,index).concat(arr.slice(index+1)))}}}function signal(emitter,type){var handlers=getHandlers(emitter,type);if(handlers.length)for(var args=Array.prototype.slice.call(arguments,2),i=0;i<handlers.length;++i)handlers[i].apply(null,args)}function signalDOMEvent(cm,e,override){return"string"==typeof e&&(e={type:e,preventDefault:function preventDefault(){this.defaultPrevented=!0}}),signal(cm,override||e.type,cm,e),e_defaultPrevented(e)||e.codemirrorIgnore}function signalCursorActivity(cm){var arr=cm._handlers&&cm._handlers.cursorActivity;if(arr)for(var set=cm.curOp.cursorActivityHandlers||(cm.curOp.cursorActivityHandlers=[]),i=0;i<arr.length;++i)-1==indexOf(set,arr[i])&&set.push(arr[i])}function hasHandler(emitter,type){return 0<getHandlers(emitter,type).length}function eventMixin(ctor){ctor.prototype.on=function(type,f){on(this,type,f)},ctor.prototype.off=function(type,f){off(this,type,f)}}function e_preventDefault(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function e_stopPropagation(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function e_defaultPrevented(e){return null==e.defaultPrevented?!1==e.returnValue:e.defaultPrevented}function e_stop(e){e_preventDefault(e),e_stopPropagation(e)}function e_target(e){return e.target||e.srcElement}function e_button(e){var b=e.which;return null==b&&(1&e.button?b=1:2&e.button?b=3:4&e.button&&(b=2)),mac&&e.ctrlKey&&1==b&&(b=3),b}function zeroWidthElement(measure){if(null==zwspSupported){var test=elt("span","\u200B");removeChildrenAndAdd(measure,elt("span",[test,document.createTextNode("x")])),0!=measure.firstChild.offsetHeight&&(zwspSupported=1>=test.offsetWidth&&2<test.offsetHeight&&!(ie&&8>ie_version))}var node=zwspSupported?elt("span","\u200B"):elt("span","\xA0",null,"display: inline-block; width: 1px; margin-right: -1px");return node.setAttribute("cm-text",""),node}function hasBadBidiRects(measure){if(null!=badBidiRects)return badBidiRects;var txt=removeChildrenAndAdd(measure,document.createTextNode("A\u062EA")),r0=range(txt,0,1).getBoundingClientRect(),r1=range(txt,1,2).getBoundingClientRect();return removeChildren(measure),!!(r0&&r0.left!=r0.right)&&(badBidiRects=3>r1.right-r0.right)}function hasBadZoomedRects(measure){if(null!=badZoomedRects)return badZoomedRects;var node=removeChildrenAndAdd(measure,elt("span","x")),normal=node.getBoundingClientRect(),fromRange=range(node,0,1).getBoundingClientRect();return badZoomedRects=1<_Mathabs(normal.left-fromRange.left)}function defineMode(name,mode){2<arguments.length&&(mode.dependencies=Array.prototype.slice.call(arguments,2)),modes[name]=mode}function resolveMode(spec){if("string"==typeof spec&&mimeModes.hasOwnProperty(spec))spec=mimeModes[spec];else if(spec&&"string"==typeof spec.name&&mimeModes.hasOwnProperty(spec.name)){var found=mimeModes[spec.name];"string"==typeof found&&(found={name:found}),spec=createObj(found,spec),spec.name=found.name}else{if("string"==typeof spec&&/^[\w\-]+\/[\w\-]+\+xml$/.test(spec))return resolveMode("application/xml");if("string"==typeof spec&&/^[\w\-]+\/[\w\-]+\+json$/.test(spec))return resolveMode("application/json")}return"string"==typeof spec?{name:spec}:spec||{name:"null"}}function getMode(options,spec){spec=resolveMode(spec);var mfactory=modes[spec.name];if(!mfactory)return getMode(options,"text/plain");var modeObj=mfactory(options,spec);if(modeExtensions.hasOwnProperty(spec.name)){var exts=modeExtensions[spec.name];for(var prop in exts)exts.hasOwnProperty(prop)&&(modeObj.hasOwnProperty(prop)&&(modeObj["_"+prop]=modeObj[prop]),modeObj[prop]=exts[prop])}if(modeObj.name=spec.name,spec.helperType&&(modeObj.helperType=spec.helperType),spec.modeProps)for(var prop$1 in spec.modeProps)modeObj[prop$1]=spec.modeProps[prop$1];return modeObj}function extendMode(mode,properties){var exts=modeExtensions.hasOwnProperty(mode)?modeExtensions[mode]:modeExtensions[mode]={};copyObj(properties,exts)}function copyState(mode,state){if(!0===state)return state;if(mode.copyState)return mode.copyState(state);var nstate={};for(var n in state){var val=state[n];val instanceof Array&&(val=val.concat([])),nstate[n]=val}return nstate}function innerMode(mode,state){for(var info;mode.innerMode&&(info=mode.innerMode(state),info&&info.mode!=mode);)state=info.state,mode=info.mode;return info||{mode:mode,state:state}}function startState(mode,a1,a2){return!mode.startState||mode.startState(a1,a2)}function getLine(doc,n){if(n-=doc.first,0>n||n>=doc.size)throw new Error("There is no line "+(n+doc.first)+" in the document.");for(var chunk=doc;!chunk.lines;)for(var i=0;;++i){var child=chunk.children[i],sz=child.chunkSize();if(n<sz){chunk=child;break}n-=sz}return chunk.lines[n]}function getBetween(doc,start,end){var out=[],n=start.line;return doc.iter(start.line,end.line+1,function(line){var text=line.text;n==end.line&&(text=text.slice(0,end.ch)),n==start.line&&(text=text.slice(start.ch)),out.push(text),++n}),out}function getLines(doc,from,to){var out=[];return doc.iter(from,to,function(line){out.push(line.text)}),out}function updateLineHeight(line,height){var diff=height-line.height;if(diff)for(var n=line;n;n=n.parent)n.height+=diff}function lineNo(line){if(null==line.parent)return null;for(var cur=line.parent,no=indexOf(cur.lines,line),chunk=cur.parent;chunk;cur=chunk,chunk=chunk.parent)for(var i=0;;++i){if(chunk.children[i]==cur)break;no+=chunk.children[i].chunkSize()}return no+cur.first}function _lineAtHeight(chunk,h){var n=chunk.first;outer:do{for(var i$1=0;i$1<chunk.children.length;++i$1){var child=chunk.children[i$1],ch=child.height;if(h<ch){chunk=child;continue outer}h-=ch,n+=child.chunkSize()}return n}while(!chunk.lines);for(var i=0;i<chunk.lines.length;++i){var line=chunk.lines[i],lh=line.height;if(h<lh)break;h-=lh}return n+i}function isLine(doc,l){return l>=doc.first&&l<doc.first+doc.size}function lineNumberFor(options,i){return options.lineNumberFormatter(i+options.firstLineNumber)+""}function Pos(line,ch,sticky){return void 0===sticky&&(sticky=null),this instanceof Pos?void(this.line=line,this.ch=ch,this.sticky=sticky):new Pos(line,ch,sticky)}function cmp(a,b){return a.line-b.line||a.ch-b.ch}function equalCursorPos(a,b){return a.sticky==b.sticky&&0==cmp(a,b)}function copyPos(x){return Pos(x.line,x.ch)}function maxPos(a,b){return 0>cmp(a,b)?b:a}function minPos(a,b){return 0>cmp(a,b)?a:b}function clipLine(doc,n){return _Mathmax(doc.first,_Mathmin(n,doc.first+doc.size-1))}function _clipPos(doc,pos){if(pos.line<doc.first)return Pos(doc.first,0);var last=doc.first+doc.size-1;return pos.line>last?Pos(last,getLine(doc,last).text.length):clipToLen(pos,getLine(doc,pos.line).text.length)}function clipToLen(pos,linelen){var ch=pos.ch;return null==ch||ch>linelen?Pos(pos.line,linelen):0>ch?Pos(pos.line,0):pos}function clipPosArray(doc,array){for(var out=[],i=0;i<array.length;i++)out[i]=_clipPos(doc,array[i]);return out}function highlightLine(cm,line,context,forceToEnd){var st=[cm.state.modeGen],lineClasses={};runMode(cm,line.text,cm.doc.mode,context,function(end,style){return st.push(end,style)},lineClasses,forceToEnd);for(var state=context.state,loop=function(o){context.baseTokens=st;var overlay=cm.state.overlays[o],i=1,at=0;context.state=!0,runMode(cm,line.text,overlay.mode,context,function(end,style){for(var start=i,i_end;at<end;)i_end=st[i],i_end>end&&st.splice(i,1,end,st[i+1],i_end),i+=2,at=_Mathmin(end,i_end);if(style)if(overlay.opaque)st.splice(start,i-start,end,"overlay "+style),i=start+2;else for(;start<i;start+=2){var cur=st[start+1];st[start+1]=(cur?cur+" ":"")+"overlay "+style}},lineClasses),context.state=state,context.baseTokens=null,context.baseTokenPos=1},o=0;o<cm.state.overlays.length;++o)loop(o);return{styles:st,classes:lineClasses.bgClass||lineClasses.textClass?lineClasses:null}}function getLineStyles(cm,line,updateFrontier){if(!line.styles||line.styles[0]!=cm.state.modeGen){var context=getContextBefore(cm,lineNo(line)),resetState=line.text.length>cm.options.maxHighlightLength&&copyState(cm.doc.mode,context.state),result=highlightLine(cm,line,context);resetState&&(context.state=resetState),line.stateAfter=context.save(!resetState),line.styles=result.styles,result.classes?line.styleClasses=result.classes:line.styleClasses&&(line.styleClasses=null),updateFrontier===cm.doc.highlightFrontier&&(cm.doc.modeFrontier=_Mathmax(cm.doc.modeFrontier,++cm.doc.highlightFrontier))}return line.styles}function getContextBefore(cm,n,precise){var doc=cm.doc,display=cm.display;if(!doc.mode.startState)return new Context(doc,!0,n);var start=findStartLine(cm,n,precise),saved=start>doc.first&&getLine(doc,start-1).stateAfter,context=saved?Context.fromSaved(doc,saved,start):new Context(doc,startState(doc.mode),start);return doc.iter(start,n,function(line){processLine(cm,line.text,context);var pos=context.line;line.stateAfter=pos==n-1||0==pos%5||pos>=display.viewFrom&&pos<display.viewTo?context.save():null,context.nextLine()}),precise&&(doc.modeFrontier=context.line),context}function processLine(cm,text,context,startAt){var mode=cm.doc.mode,stream=new StringStream(text,cm.options.tabSize,context);for(stream.start=stream.pos=startAt||0,""==text&&callBlankLine(mode,context.state);!stream.eol();)readToken(mode,stream,context.state),stream.start=stream.pos}function callBlankLine(mode,state){if(mode.blankLine)return mode.blankLine(state);if(mode.innerMode){var inner=innerMode(mode,state);if(inner.mode.blankLine)return inner.mode.blankLine(inner.state)}}function readToken(mode,stream,state,inner){for(var i=0;10>i;i++){inner&&(inner[0]=innerMode(mode,state).mode);var style=mode.token(stream,state);if(stream.pos>stream.start)return style}throw new Error("Mode "+mode.name+" failed to advance stream.")}function takeToken(cm,pos,precise,asArray){var doc=cm.doc,mode=doc.mode,style;pos=_clipPos(doc,pos);var line=getLine(doc,pos.line),context=getContextBefore(cm,pos.line,precise),stream=new StringStream(line.text,cm.options.tabSize,context),tokens;for(asArray&&(tokens=[]);(asArray||stream.pos<pos.ch)&&!stream.eol();)stream.start=stream.pos,style=readToken(mode,stream,context.state),asArray&&tokens.push(new Token(stream,style,copyState(doc.mode,context.state)));return asArray?tokens:new Token(stream,style,context.state)}function extractLineClasses(type,output){if(type)for(;;){var lineClass=type.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!lineClass)break;type=type.slice(0,lineClass.index)+type.slice(lineClass.index+lineClass[0].length);var prop=lineClass[1]?"bgClass":"textClass";null==output[prop]?output[prop]=lineClass[2]:!new RegExp("(?:^|\\s)"+lineClass[2]+"(?:$|\\s)").test(output[prop])&&(output[prop]+=" "+lineClass[2])}return type}function runMode(cm,text,mode,context,f,lineClasses,forceToEnd){var flattenSpans=mode.flattenSpans;null==flattenSpans&&(flattenSpans=cm.options.flattenSpans);var curStart=0,curStyle=null,stream=new StringStream(text,cm.options.tabSize,context),inner=cm.options.addModeClass&&[null],style;for(""==text&&extractLineClasses(callBlankLine(mode,context.state),lineClasses);!stream.eol();){if(stream.pos>cm.options.maxHighlightLength?(flattenSpans=!1,forceToEnd&&processLine(cm,text,context,stream.pos),stream.pos=text.length,style=null):style=extractLineClasses(readToken(mode,stream,context.state,inner),lineClasses),inner){var mName=inner[0].name;mName&&(style="m-"+(style?mName+" "+style:mName))}if(!flattenSpans||curStyle!=style){for(;curStart<stream.start;)curStart=_Mathmin(stream.start,curStart+5e3),f(curStart,curStyle);curStyle=style}stream.start=stream.pos}for(;curStart<stream.pos;){var pos=_Mathmin(stream.pos,curStart+5e3);f(pos,curStyle),curStart=pos}}function findStartLine(cm,n,precise){for(var doc=cm.doc,lim=precise?-1:n-(cm.doc.mode.innerMode?1e3:100),search=n,minindent,minline;search>lim;--search){if(search<=doc.first)return doc.first;var line=getLine(doc,search-1),after=line.stateAfter;if(after&&(!precise||search+(after instanceof SavedContext?after.lookAhead:0)<=doc.modeFrontier))return search;var indented=countColumn(line.text,null,cm.options.tabSize);(null==minline||minindent>indented)&&(minline=search-1,minindent=indented)}return minline}function retreatFrontier(doc,n){if(doc.modeFrontier=_Mathmin(doc.modeFrontier,n),!(doc.highlightFrontier<n-10)){for(var start=doc.first,line=n-1,saved;line>start;line--)if(saved=getLine(doc,line).stateAfter,saved&&(!(saved instanceof SavedContext)||line+saved.lookAhead<n)){start=line+1;break}doc.highlightFrontier=_Mathmin(doc.highlightFrontier,start)}}function seeReadOnlySpans(){sawReadOnlySpans=!0}function seeCollapsedSpans(){sawCollapsedSpans=!0}function MarkedSpan(marker,from,to){this.marker=marker,this.from=from,this.to=to}function getMarkedSpanFor(spans,marker){if(spans)for(var i=0,span;i<spans.length;++i)if(span=spans[i],span.marker==marker)return span}function removeMarkedSpan(spans,span){for(var i=0,r;i<spans.length;++i)spans[i]!=span&&(r||(r=[])).push(spans[i]);return r}function addMarkedSpan(line,span){line.markedSpans=line.markedSpans?line.markedSpans.concat([span]):[span],span.marker.attachLine(line)}function markedSpansBefore(old,startCh,isInsert){var nw;if(old)for(var i=0;i<old.length;++i){var span=old[i],marker=span.marker,startsBefore=null==span.from||(marker.inclusiveLeft?span.from<=startCh:span.from<startCh);if(startsBefore||span.from==startCh&&"bookmark"==marker.type&&(!isInsert||!span.marker.insertLeft)){var endsAfter=null==span.to||(marker.inclusiveRight?span.to>=startCh:span.to>startCh);(nw||(nw=[])).push(new MarkedSpan(marker,span.from,endsAfter?null:span.to))}}return nw}function markedSpansAfter(old,endCh,isInsert){var nw;if(old)for(var i=0;i<old.length;++i){var span=old[i],marker=span.marker,endsAfter=null==span.to||(marker.inclusiveRight?span.to>=endCh:span.to>endCh);if(endsAfter||span.from==endCh&&"bookmark"==marker.type&&(!isInsert||span.marker.insertLeft)){var startsBefore=null==span.from||(marker.inclusiveLeft?span.from<=endCh:span.from<endCh);(nw||(nw=[])).push(new MarkedSpan(marker,startsBefore?null:span.from-endCh,null==span.to?null:span.to-endCh))}}return nw}function stretchSpansOverChange(doc,change){if(change.full)return null;var oldFirst=isLine(doc,change.from.line)&&getLine(doc,change.from.line).markedSpans,oldLast=isLine(doc,change.to.line)&&getLine(doc,change.to.line).markedSpans;if(!oldFirst&&!oldLast)return null;var startCh=change.from.ch,endCh=change.to.ch,isInsert=0==cmp(change.from,change.to),first=markedSpansBefore(oldFirst,startCh,isInsert),last=markedSpansAfter(oldLast,endCh,isInsert),sameLine=1==change.text.length,offset=lst(change.text).length+(sameLine?startCh:0);if(first)for(var i=0,span;i<first.length;++i)if(span=first[i],null==span.to){var found=getMarkedSpanFor(last,span.marker);found?sameLine&&(span.to=null==found.to?null:found.to+offset):span.to=startCh}if(last)for(var i$1=0,span$1;i$1<last.length;++i$1)if(span$1=last[i$1],null!=span$1.to&&(span$1.to+=offset),null==span$1.from){var found$1=getMarkedSpanFor(first,span$1.marker);found$1||(span$1.from=offset,sameLine&&(first||(first=[])).push(span$1))}else span$1.from+=offset,sameLine&&(first||(first=[])).push(span$1);first&&(first=clearEmptySpans(first)),last&&last!=first&&(last=clearEmptySpans(last));var newMarkers=[first];if(!sameLine){var gap=change.text.length-2,gapMarkers;if(0<gap&&first)for(var i$2=0;i$2<first.length;++i$2)null==first[i$2].to&&(gapMarkers||(gapMarkers=[])).push(new MarkedSpan(first[i$2].marker,null,null));for(var i$3=0;i$3<gap;++i$3)newMarkers.push(gapMarkers);newMarkers.push(last)}return newMarkers}function clearEmptySpans(spans){for(var i=0,span;i<spans.length;++i)span=spans[i],null!=span.from&&span.from==span.to&&!1!==span.marker.clearWhenEmpty&&spans.splice(i--,1);return spans.length?spans:null}function removeReadOnlyRanges(doc,from,to){var markers=null;if(doc.iter(from.line,to.line+1,function(line){if(line.markedSpans)for(var i=0,mark;i<line.markedSpans.length;++i)mark=line.markedSpans[i].marker,mark.readOnly&&(!markers||-1==indexOf(markers,mark))&&(markers||(markers=[])).push(mark)}),!markers)return null;for(var parts=[{from:from,to:to}],i=0;i<markers.length;++i)for(var mk=markers[i],m=mk.find(0),j=0,p;j<parts.length;++j)if(p=parts[j],!(0>cmp(p.to,m.from)||0<cmp(p.from,m.to))){var newParts=[j,1],dfrom=cmp(p.from,m.from),dto=cmp(p.to,m.to);!(0>dfrom)&&(mk.inclusiveLeft||dfrom)||newParts.push({from:p.from,to:m.from}),!(0<dto)&&(mk.inclusiveRight||dto)||newParts.push({from:m.to,to:p.to}),parts.splice.apply(parts,newParts),j+=newParts.length-3}return parts}function detachMarkedSpans(line){var spans=line.markedSpans;if(spans){for(var i=0;i<spans.length;++i)spans[i].marker.detachLine(line);line.markedSpans=null}}function attachMarkedSpans(line,spans){if(spans){for(var i=0;i<spans.length;++i)spans[i].marker.attachLine(line);line.markedSpans=spans}}function extraLeft(marker){return marker.inclusiveLeft?-1:0}function extraRight(marker){return marker.inclusiveRight?1:0}function compareCollapsedMarkers(a,b){var lenDiff=a.lines.length-b.lines.length;if(0!=lenDiff)return lenDiff;var aPos=a.find(),bPos=b.find(),fromCmp=cmp(aPos.from,bPos.from)||extraLeft(a)-extraLeft(b);if(fromCmp)return-fromCmp;var toCmp=cmp(aPos.to,bPos.to)||extraRight(a)-extraRight(b);return toCmp?toCmp:b.id-a.id}function collapsedSpanAtSide(line,start){var sps=sawCollapsedSpans&&line.markedSpans,found;if(sps)for(var sp=void 0,i=0;i<sps.length;++i)sp=sps[i],sp.marker.collapsed&&null==(start?sp.from:sp.to)&&(!found||0>compareCollapsedMarkers(found,sp.marker))&&(found=sp.marker);return found}function collapsedSpanAtStart(line){return collapsedSpanAtSide(line,!0)}function collapsedSpanAtEnd(line){return collapsedSpanAtSide(line,!1)}function collapsedSpanAround(line,ch){var sps=sawCollapsedSpans&&line.markedSpans,found;if(sps)for(var i=0,sp;i<sps.length;++i)sp=sps[i],sp.marker.collapsed&&(null==sp.from||sp.from<ch)&&(null==sp.to||sp.to>ch)&&(!found||0>compareCollapsedMarkers(found,sp.marker))&&(found=sp.marker);return found}function conflictingCollapsedRange(doc,lineNo,from,to,marker){var line=getLine(doc,lineNo),sps=sawCollapsedSpans&&line.markedSpans;if(sps)for(var i=0,sp;i<sps.length;++i)if(sp=sps[i],!!sp.marker.collapsed){var found=sp.marker.find(0),fromCmp=cmp(found.from,from)||extraLeft(sp.marker)-extraLeft(marker),toCmp=cmp(found.to,to)||extraRight(sp.marker)-extraRight(marker);if(!(0<=fromCmp&&0>=toCmp||0>=fromCmp&&0<=toCmp)&&(0>=fromCmp&&(sp.marker.inclusiveRight&&marker.inclusiveLeft?0<=cmp(found.to,from):0<cmp(found.to,from))||0<=fromCmp&&(sp.marker.inclusiveRight&&marker.inclusiveLeft?0>=cmp(found.from,to):0>cmp(found.from,to))))return!0}}function visualLine(line){for(var merged;merged=collapsedSpanAtStart(line);)line=merged.find(-1,!0).line;return line}function visualLineEnd(line){for(var merged;merged=collapsedSpanAtEnd(line);)line=merged.find(1,!0).line;return line}function visualLineContinued(line){for(var merged,lines;merged=collapsedSpanAtEnd(line);)line=merged.find(1,!0).line,(lines||(lines=[])).push(line);return lines}function visualLineNo(doc,lineN){var line=getLine(doc,lineN),vis=visualLine(line);return line==vis?lineN:lineNo(vis)}function visualLineEndNo(doc,lineN){if(lineN>doc.lastLine())return lineN;var line=getLine(doc,lineN),merged;if(!lineIsHidden(doc,line))return lineN;for(;merged=collapsedSpanAtEnd(line);)line=merged.find(1,!0).line;return lineNo(line)+1}function lineIsHidden(doc,line){var sps=sawCollapsedSpans&&line.markedSpans;if(sps)for(var sp=void 0,i=0;i<sps.length;++i)if(sp=sps[i],!!sp.marker.collapsed){if(null==sp.from)return!0;if(!sp.marker.widgetNode&&0==sp.from&&sp.marker.inclusiveLeft&&lineIsHiddenInner(doc,line,sp))return!0}}function lineIsHiddenInner(doc,line,span){if(null==span.to){var end=span.marker.find(1,!0);return lineIsHiddenInner(doc,end.line,getMarkedSpanFor(end.line.markedSpans,span.marker))}if(span.marker.inclusiveRight&&span.to==line.text.length)return!0;for(var sp=void 0,i=0;i<line.markedSpans.length;++i)if(sp=line.markedSpans[i],sp.marker.collapsed&&!sp.marker.widgetNode&&sp.from==span.to&&(null==sp.to||sp.to!=span.from)&&(sp.marker.inclusiveLeft||span.marker.inclusiveRight)&&lineIsHiddenInner(doc,line,sp))return!0}function _heightAtLine(lineObj){lineObj=visualLine(lineObj);for(var h=0,chunk=lineObj.parent,i=0,line;i<chunk.lines.length&&(line=chunk.lines[i],line!=lineObj);++i)h+=line.height;for(var p=chunk.parent;p;chunk=p,p=chunk.parent)for(var i$1=0,cur;i$1<p.children.length&&(cur=p.children[i$1],cur!=chunk);++i$1)h+=cur.height;return h}function lineLength(line){if(0==line.height)return 0;for(var len=line.text.length,cur=line,merged,found;merged=collapsedSpanAtStart(cur);)found=merged.find(0,!0),cur=found.from.line,len+=found.from.ch-found.to.ch;for(cur=line;merged=collapsedSpanAtEnd(cur);){var found$1=merged.find(0,!0);len-=cur.text.length-found$1.from.ch,cur=found$1.to.line,len+=cur.text.length-found$1.to.ch}return len}function findMaxLine(cm){var d=cm.display,doc=cm.doc;d.maxLine=getLine(doc,doc.first),d.maxLineLength=lineLength(d.maxLine),d.maxLineChanged=!0,doc.iter(function(line){var len=lineLength(line);len>d.maxLineLength&&(d.maxLineLength=len,d.maxLine=line)})}function updateLine(line,text,markedSpans,estimateHeight){line.text=text,line.stateAfter&&(line.stateAfter=null),line.styles&&(line.styles=null),null!=line.order&&(line.order=null),detachMarkedSpans(line),attachMarkedSpans(line,markedSpans);var estHeight=estimateHeight?estimateHeight(line):1;estHeight!=line.height&&updateLineHeight(line,estHeight)}function cleanUpLine(line){line.parent=null,detachMarkedSpans(line)}function interpretTokenStyle(style,options){if(!style||/^\s*$/.test(style))return null;var cache=options.addModeClass?styleToClassCacheWithMode:styleToClassCache;return cache[style]||(cache[style]=style.replace(/\S+/g,"cm-$&"))}function buildLineContent(cm,lineView){var content=eltP("span",null,null,webkit?"padding-right: .1px":null),builder={pre:eltP("pre",[content],"CodeMirror-line"),content:content,col:0,pos:0,cm:cm,trailingSpace:!1,splitSpaces:cm.getOption("lineWrapping")};lineView.measure={};for(var i=0;i<=(lineView.rest?lineView.rest.length:0);i++){var line=i?lineView.rest[i-1]:lineView.line,order=void 0;builder.pos=0,builder.addToken=buildToken,hasBadBidiRects(cm.display.measure)&&(order=getOrder(line,cm.doc.direction))&&(builder.addToken=buildTokenBadBidi(builder.addToken,order)),builder.map=[];var allowFrontierUpdate=lineView!=cm.display.externalMeasured&&lineNo(line);insertLineContent(line,builder,getLineStyles(cm,line,allowFrontierUpdate)),line.styleClasses&&(line.styleClasses.bgClass&&(builder.bgClass=joinClasses(line.styleClasses.bgClass,builder.bgClass||"")),line.styleClasses.textClass&&(builder.textClass=joinClasses(line.styleClasses.textClass,builder.textClass||""))),0==builder.map.length&&builder.map.push(0,0,builder.content.appendChild(zeroWidthElement(cm.display.measure))),0==i?(lineView.measure.map=builder.map,lineView.measure.cache={}):((lineView.measure.maps||(lineView.measure.maps=[])).push(builder.map),(lineView.measure.caches||(lineView.measure.caches=[])).push({}))}if(webkit){var last=builder.content.lastChild;(/\bcm-tab\b/.test(last.className)||last.querySelector&&last.querySelector(".cm-tab"))&&(builder.content.className="cm-tab-wrap-hack")}return signal(cm,"renderLine",cm,lineView.line,builder.pre),builder.pre.className&&(builder.textClass=joinClasses(builder.pre.className,builder.textClass||"")),builder}function defaultSpecialCharPlaceholder(ch){var token=elt("span","\u2022","cm-invalidchar");return token.title="\\u"+ch.charCodeAt(0).toString(16),token.setAttribute("aria-label",token.title),token}function buildToken(builder,text,style,startStyle,endStyle,css,attributes){if(text){var displayText=builder.splitSpaces?splitSpaces(text,builder.trailingSpace):text,special=builder.cm.state.specialChars,mustWrap=!1,content;if(!special.test(text))builder.col+=text.length,content=document.createTextNode(displayText),builder.map.push(builder.pos,builder.pos+text.length,content),ie&&9>ie_version&&(mustWrap=!0),builder.pos+=text.length;else{content=document.createDocumentFragment();for(var pos=0;;){special.lastIndex=pos;var m=special.exec(text),skipped=m?m.index-pos:text.length-pos;if(skipped){var txt=document.createTextNode(displayText.slice(pos,pos+skipped));ie&&9>ie_version?content.appendChild(elt("span",[txt])):content.appendChild(txt),builder.map.push(builder.pos,builder.pos+skipped,txt),builder.col+=skipped,builder.pos+=skipped}if(!m)break;pos+=skipped+1;var txt$1=void 0;if("\t"==m[0]){var tabSize=builder.cm.options.tabSize,tabWidth=tabSize-builder.col%tabSize;txt$1=content.appendChild(elt("span",spaceStr(tabWidth),"cm-tab")),txt$1.setAttribute("role","presentation"),txt$1.setAttribute("cm-text","\t"),builder.col+=tabWidth}else"\r"==m[0]||"\n"==m[0]?(txt$1=content.appendChild(elt("span","\r"==m[0]?"\u240D":"\u2424","cm-invalidchar")),txt$1.setAttribute("cm-text",m[0]),builder.col+=1):(txt$1=builder.cm.options.specialCharPlaceholder(m[0]),txt$1.setAttribute("cm-text",m[0]),ie&&9>ie_version?content.appendChild(elt("span",[txt$1])):content.appendChild(txt$1),builder.col+=1);builder.map.push(builder.pos,builder.pos+1,txt$1),builder.pos++}}if(builder.trailingSpace=32==displayText.charCodeAt(text.length-1),style||startStyle||endStyle||mustWrap||css){var fullStyle=style||"";startStyle&&(fullStyle+=startStyle),endStyle&&(fullStyle+=endStyle);var token=elt("span",[content],fullStyle,css);if(attributes)for(var attr in attributes)attributes.hasOwnProperty(attr)&&"style"!=attr&&"class"!=attr&&token.setAttribute(attr,attributes[attr]);return builder.content.appendChild(token)}builder.content.appendChild(content)}}function splitSpaces(text,trailingBefore){if(1<text.length&&!/  /.test(text))return text;for(var spaceBefore=trailingBefore,result="",i=0,ch;i<text.length;i++)ch=text.charAt(i)," "==ch&&spaceBefore&&(i==text.length-1||32==text.charCodeAt(i+1))&&(ch="\xA0"),result+=ch,spaceBefore=" "==ch;return result}function buildTokenBadBidi(inner,order){return function(builder,text,style,startStyle,endStyle,css,attributes){style=style?style+" cm-force-border":"cm-force-border";for(var start=builder.pos,end=start+text.length;;){for(var part=void 0,i=0;i<order.length&&(part=order[i],!(part.to>start&&part.from<=start));i++);if(part.to>=end)return inner(builder,text,style,startStyle,endStyle,css,attributes);inner(builder,text.slice(0,part.to-start),style,startStyle,null,css,attributes),startStyle=null,text=text.slice(part.to-start),start=part.to}}}function buildCollapsedSpan(builder,size,marker,ignoreWidget){var widget=!ignoreWidget&&marker.widgetNode;widget&&builder.map.push(builder.pos,builder.pos+size,widget),!ignoreWidget&&builder.cm.display.input.needsContentAttribute&&(!widget&&(widget=builder.content.appendChild(document.createElement("span"))),widget.setAttribute("cm-marker",marker.id)),widget&&(builder.cm.display.input.setUneditable(widget),builder.content.appendChild(widget)),builder.pos+=size,builder.trailingSpace=!1}function insertLineContent(line,builder,styles){var spans=line.markedSpans,allText=line.text,at=0;if(!spans){for(var i$1=1;i$1<styles.length;i$1+=2)builder.addToken(builder,allText.slice(at,at=styles[i$1]),interpretTokenStyle(styles[i$1+1],builder.cm.options));return}for(var len=allText.length,pos=0,i=1,text="",nextChange=0,style,css,spanStyle,spanEndStyle,spanStartStyle,collapsed,attributes;;){if(nextChange==pos){spanStyle=spanEndStyle=spanStartStyle=css="",attributes=null,collapsed=null,nextChange=1/0;for(var foundBookmarks=[],endStyles=void 0,j=0;j<spans.length;++j){var sp=spans[j],m=sp.marker;if("bookmark"==m.type&&sp.from==pos&&m.widgetNode)foundBookmarks.push(m);else if(sp.from<=pos&&(null==sp.to||sp.to>pos||m.collapsed&&sp.to==pos&&sp.from==pos)){if(null!=sp.to&&sp.to!=pos&&nextChange>sp.to&&(nextChange=sp.to,spanEndStyle=""),m.className&&(spanStyle+=" "+m.className),m.css&&(css=(css?css+";":"")+m.css),m.startStyle&&sp.from==pos&&(spanStartStyle+=" "+m.startStyle),m.endStyle&&sp.to==nextChange&&(endStyles||(endStyles=[])).push(m.endStyle,sp.to),m.title&&((attributes||(attributes={})).title=m.title),m.attributes)for(var attr in m.attributes)(attributes||(attributes={}))[attr]=m.attributes[attr];m.collapsed&&(!collapsed||0>compareCollapsedMarkers(collapsed.marker,m))&&(collapsed=sp)}else sp.from>pos&&nextChange>sp.from&&(nextChange=sp.from)}if(endStyles)for(var j$1=0;j$1<endStyles.length;j$1+=2)endStyles[j$1+1]==nextChange&&(spanEndStyle+=" "+endStyles[j$1]);if(!collapsed||collapsed.from==pos)for(var j$2=0;j$2<foundBookmarks.length;++j$2)buildCollapsedSpan(builder,0,foundBookmarks[j$2]);if(collapsed&&(collapsed.from||0)==pos){if(buildCollapsedSpan(builder,(null==collapsed.to?len+1:collapsed.to)-pos,collapsed.marker,null==collapsed.from),null==collapsed.to)return;collapsed.to==pos&&(collapsed=!1)}}if(pos>=len)break;for(var upto=_Mathmin(len,nextChange);;){if(text){var end=pos+text.length;if(!collapsed){var tokenText=end>upto?text.slice(0,upto-pos):text;builder.addToken(builder,tokenText,style?style+spanStyle:spanStyle,spanStartStyle,pos+tokenText.length==nextChange?spanEndStyle:"",css,attributes)}if(end>=upto){text=text.slice(upto-pos),pos=upto;break}pos=end,spanStartStyle=""}text=allText.slice(at,at=styles[i++]),style=interpretTokenStyle(styles[i++],builder.cm.options)}}}function LineView(doc,line,lineN){this.line=line,this.rest=visualLineContinued(line),this.size=this.rest?lineNo(lst(this.rest))-lineN+1:1,this.node=this.text=null,this.hidden=lineIsHidden(doc,line)}function buildViewArray(cm,from,to){for(var array=[],pos=from,nextPos,view;pos<to;pos=nextPos)view=new LineView(cm.doc,getLine(cm.doc,pos),pos),nextPos=pos+view.size,array.push(view);return array}function pushOperation(op){operationGroup?operationGroup.ops.push(op):op.ownsGroup=operationGroup={ops:[op],delayedCallbacks:[]}}function fireCallbacksForOps(group){var callbacks=group.delayedCallbacks,i=0;do{for(;i<callbacks.length;i++)callbacks[i].call(null);for(var j=0,op;j<group.ops.length;j++)if(op=group.ops[j],op.cursorActivityHandlers)for(;op.cursorActivityCalled<op.cursorActivityHandlers.length;)op.cursorActivityHandlers[op.cursorActivityCalled++].call(null,op.cm)}while(i<callbacks.length)}function finishOperation(op,endCb){var group=op.ownsGroup;if(group)try{fireCallbacksForOps(group)}finally{operationGroup=null,endCb(group)}}function signalLater(emitter,type){var arr=getHandlers(emitter,type);if(arr.length){var args=Array.prototype.slice.call(arguments,2),list;operationGroup?list=operationGroup.delayedCallbacks:orphanDelayedCallbacks?list=orphanDelayedCallbacks:(list=orphanDelayedCallbacks=[],setTimeout(fireOrphanDelayed,0));for(var loop=function(i){list.push(function(){return arr[i].apply(null,args)})},i=0;i<arr.length;++i)loop(i)}}function fireOrphanDelayed(){var delayed=orphanDelayedCallbacks;orphanDelayedCallbacks=null;for(var i=0;i<delayed.length;++i)delayed[i]()}function updateLineForChanges(cm,lineView,lineN,dims){for(var j=0,type;j<lineView.changes.length;j++)type=lineView.changes[j],"text"==type?updateLineText(cm,lineView):"gutter"==type?updateLineGutter(cm,lineView,lineN,dims):"class"==type?updateLineClasses(cm,lineView):"widget"==type&&updateLineWidgets(cm,lineView,dims);lineView.changes=null}function ensureLineWrapped(lineView){return lineView.node==lineView.text&&(lineView.node=elt("div",null,null,"position: relative"),lineView.text.parentNode&&lineView.text.parentNode.replaceChild(lineView.node,lineView.text),lineView.node.appendChild(lineView.text),ie&&8>ie_version&&(lineView.node.style.zIndex=2)),lineView.node}function updateLineBackground(cm,lineView){var cls=lineView.bgClass?lineView.bgClass+" "+(lineView.line.bgClass||""):lineView.line.bgClass;if(cls&&(cls+=" CodeMirror-linebackground"),lineView.background)cls?lineView.background.className=cls:(lineView.background.parentNode.removeChild(lineView.background),lineView.background=null);else if(cls){var wrap=ensureLineWrapped(lineView);lineView.background=wrap.insertBefore(elt("div",null,cls),wrap.firstChild),cm.display.input.setUneditable(lineView.background)}}function getLineContent(cm,lineView){var ext=cm.display.externalMeasured;return ext&&ext.line==lineView.line?(cm.display.externalMeasured=null,lineView.measure=ext.measure,ext.built):buildLineContent(cm,lineView)}function updateLineText(cm,lineView){var cls=lineView.text.className,built=getLineContent(cm,lineView);lineView.text==lineView.node&&(lineView.node=built.pre),lineView.text.parentNode.replaceChild(built.pre,lineView.text),lineView.text=built.pre,built.bgClass!=lineView.bgClass||built.textClass!=lineView.textClass?(lineView.bgClass=built.bgClass,lineView.textClass=built.textClass,updateLineClasses(cm,lineView)):cls&&(lineView.text.className=cls)}function updateLineClasses(cm,lineView){updateLineBackground(cm,lineView),lineView.line.wrapClass?ensureLineWrapped(lineView).className=lineView.line.wrapClass:lineView.node!=lineView.text&&(lineView.node.className="");var textClass=lineView.textClass?lineView.textClass+" "+(lineView.line.textClass||""):lineView.line.textClass;lineView.text.className=textClass||""}function updateLineGutter(cm,lineView,lineN,dims){if(lineView.gutter&&(lineView.node.removeChild(lineView.gutter),lineView.gutter=null),lineView.gutterBackground&&(lineView.node.removeChild(lineView.gutterBackground),lineView.gutterBackground=null),lineView.line.gutterClass){var wrap=ensureLineWrapped(lineView);lineView.gutterBackground=elt("div",null,"CodeMirror-gutter-background "+lineView.line.gutterClass,"left: "+(cm.options.fixedGutter?dims.fixedPos:-dims.gutterTotalWidth)+"px; width: "+dims.gutterTotalWidth+"px"),cm.display.input.setUneditable(lineView.gutterBackground),wrap.insertBefore(lineView.gutterBackground,lineView.text)}var markers=lineView.line.gutterMarkers;if(cm.options.lineNumbers||markers){var wrap$1=ensureLineWrapped(lineView),gutterWrap=lineView.gutter=elt("div",null,"CodeMirror-gutter-wrapper","left: "+(cm.options.fixedGutter?dims.fixedPos:-dims.gutterTotalWidth)+"px");if(cm.display.input.setUneditable(gutterWrap),wrap$1.insertBefore(gutterWrap,lineView.text),lineView.line.gutterClass&&(gutterWrap.className+=" "+lineView.line.gutterClass),!cm.options.lineNumbers||markers&&markers["CodeMirror-linenumbers"]||(lineView.lineNumber=gutterWrap.appendChild(elt("div",lineNumberFor(cm.options,lineN),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+dims.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+cm.display.lineNumInnerWidth+"px"))),markers)for(var k=0;k<cm.display.gutterSpecs.length;++k){var id=cm.display.gutterSpecs[k].className,found=markers.hasOwnProperty(id)&&markers[id];found&&gutterWrap.appendChild(elt("div",[found],"CodeMirror-gutter-elt","left: "+dims.gutterLeft[id]+"px; width: "+dims.gutterWidth[id]+"px"))}}}function updateLineWidgets(cm,lineView,dims){lineView.alignable&&(lineView.alignable=null);for(var isWidget=classTest("CodeMirror-linewidget"),node=lineView.node.firstChild,next=void 0;node;node=next)next=node.nextSibling,isWidget.test(node.className)&&lineView.node.removeChild(node);insertLineWidgets(cm,lineView,dims)}function buildLineElement(cm,lineView,lineN,dims){var built=getLineContent(cm,lineView);return lineView.text=lineView.node=built.pre,built.bgClass&&(lineView.bgClass=built.bgClass),built.textClass&&(lineView.textClass=built.textClass),updateLineClasses(cm,lineView),updateLineGutter(cm,lineView,lineN,dims),insertLineWidgets(cm,lineView,dims),lineView.node}function insertLineWidgets(cm,lineView,dims){if(insertLineWidgetsFor(cm,lineView.line,lineView,dims,!0),lineView.rest)for(var i=0;i<lineView.rest.length;i++)insertLineWidgetsFor(cm,lineView.rest[i],lineView,dims,!1)}function insertLineWidgetsFor(cm,line,lineView,dims,allowAbove){if(line.widgets)for(var wrap=ensureLineWrapped(lineView),i=0,ws=line.widgets;i<(void 0).length;++i){var widget=(void 0)[i],node=elt("div",[widget.node],"CodeMirror-linewidget"+(widget.className?" "+widget.className:""));widget.handleMouseEvents||node.setAttribute("cm-ignore-events","true"),positionLineWidget(widget,node,lineView,dims),cm.display.input.setUneditable(node),allowAbove&&widget.above?wrap.insertBefore(node,lineView.gutter||lineView.text):wrap.appendChild(node),signalLater(widget,"redraw")}}function positionLineWidget(widget,node,lineView,dims){if(widget.noHScroll){(lineView.alignable||(lineView.alignable=[])).push(node);var width=dims.wrapperWidth;node.style.left=dims.fixedPos+"px",widget.coverGutter||(width-=dims.gutterTotalWidth,node.style.paddingLeft=dims.gutterTotalWidth+"px"),node.style.width=width+"px"}widget.coverGutter&&(node.style.zIndex=5,node.style.position="relative",!widget.noHScroll&&(node.style.marginLeft=-dims.gutterTotalWidth+"px"))}function widgetHeight(widget){if(null!=widget.height)return widget.height;var cm=widget.doc.cm;if(!cm)return 0;if(!contains(document.body,widget.node)){var parentStyle="position: relative;";widget.coverGutter&&(parentStyle+="margin-left: -"+cm.display.gutters.offsetWidth+"px;"),widget.noHScroll&&(parentStyle+="width: "+cm.display.wrapper.clientWidth+"px;"),removeChildrenAndAdd(cm.display.measure,elt("div",[widget.node],null,parentStyle))}return widget.height=widget.node.parentNode.offsetHeight}function eventInWidget(display,e){for(var n=e_target(e);n!=display.wrapper;n=n.parentNode)if(!n||1==n.nodeType&&"true"==n.getAttribute("cm-ignore-events")||n.parentNode==display.sizer&&n!=display.mover)return!0}function paddingTop(display){return display.lineSpace.offsetTop}function paddingVert(display){return display.mover.offsetHeight-display.lineSpace.offsetHeight}function paddingH(display){if(display.cachedPaddingH)return display.cachedPaddingH;var e=removeChildrenAndAdd(display.measure,elt("pre","x","CodeMirror-line-like")),style=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,data={left:parseInt(style.paddingLeft),right:parseInt(style.paddingRight)};return isNaN(data.left)||isNaN(data.right)||(display.cachedPaddingH=data),data}function scrollGap(cm){return 50-cm.display.nativeBarWidth}function displayWidth(cm){return cm.display.scroller.clientWidth-scrollGap(cm)-cm.display.barWidth}function displayHeight(cm){return cm.display.scroller.clientHeight-scrollGap(cm)-cm.display.barHeight}function ensureLineHeights(cm,lineView,rect){var wrapping=cm.options.lineWrapping,curWidth=wrapping&&displayWidth(cm);if(!lineView.measure.heights||wrapping&&lineView.measure.width!=curWidth){var heights=lineView.measure.heights=[];if(wrapping){lineView.measure.width=curWidth;for(var rects=lineView.text.firstChild.getClientRects(),i=0;i<rects.length-1;i++){var cur=rects[i],next=rects[i+1];2<_Mathabs(cur.bottom-next.bottom)&&heights.push((cur.bottom+next.top)/2-rect.top)}}heights.push(rect.bottom-rect.top)}}function mapFromLineView(lineView,line,lineN){if(lineView.line==line)return{map:lineView.measure.map,cache:lineView.measure.cache};for(var i=0;i<lineView.rest.length;i++)if(lineView.rest[i]==line)return{map:lineView.measure.maps[i],cache:lineView.measure.caches[i]};for(var i$1=0;i$1<lineView.rest.length;i$1++)if(lineNo(lineView.rest[i$1])>lineN)return{map:lineView.measure.maps[i$1],cache:lineView.measure.caches[i$1],before:!0}}function updateExternalMeasurement(cm,line){line=visualLine(line);var lineN=lineNo(line),view=cm.display.externalMeasured=new LineView(cm.doc,line,lineN);view.lineN=lineN;var built=view.built=buildLineContent(cm,view);return view.text=built.pre,removeChildrenAndAdd(cm.display.lineMeasure,built.pre),view}function measureChar(cm,line,ch,bias){return measureCharPrepared(cm,prepareMeasureForLine(cm,line),ch,bias)}function findViewForLine(cm,lineN){if(lineN>=cm.display.viewFrom&&lineN<cm.display.viewTo)return cm.display.view[findViewIndex(cm,lineN)];var ext=cm.display.externalMeasured;if(ext&&lineN>=ext.lineN&&lineN<ext.lineN+ext.size)return ext}function prepareMeasureForLine(cm,line){var lineN=lineNo(line),view=findViewForLine(cm,lineN);view&&!view.text?view=null:view&&view.changes&&(updateLineForChanges(cm,view,lineN,getDimensions(cm)),cm.curOp.forceUpdate=!0),view||(view=updateExternalMeasurement(cm,line));var info=mapFromLineView(view,line,lineN);return{line:line,view:view,rect:null,map:info.map,cache:info.cache,before:info.before,hasHeights:!1}}function measureCharPrepared(cm,prepared,ch,bias,varHeight){prepared.before&&(ch=-1);var key=ch+(bias||""),found;return prepared.cache.hasOwnProperty(key)?found=prepared.cache[key]:(!prepared.rect&&(prepared.rect=prepared.view.text.getBoundingClientRect()),!prepared.hasHeights&&(ensureLineHeights(cm,prepared.view,prepared.rect),prepared.hasHeights=!0),found=measureCharInner(cm,prepared,ch,bias),!found.bogus&&(prepared.cache[key]=found)),{left:found.left,right:found.right,top:varHeight?found.rtop:found.top,bottom:varHeight?found.rbottom:found.bottom}}function nodeAndOffsetInLineMap(map,ch,bias){for(var i=0,node,start,end,collapse,mStart,mEnd;i<map.length;i+=3)if(mStart=map[i],mEnd=map[i+1],ch<mStart?(start=0,end=1,collapse="left"):ch<mEnd?(start=ch-mStart,end=start+1):(i==map.length-3||ch==mEnd&&map[i+3]>ch)&&(end=mEnd-mStart,start=end-1,ch>=mEnd&&(collapse="right")),null!=start){if(node=map[i+2],mStart==mEnd&&bias==(node.insertLeft?"left":"right")&&(collapse=bias),"left"==bias&&0==start)for(;i&&map[i-2]==map[i-3]&&map[i-1].insertLeft;)node=map[(i-=3)+2],collapse="left";if("right"==bias&&start==mEnd-mStart)for(;i<map.length-3&&map[i+3]==map[i+4]&&!map[i+5].insertLeft;)node=map[(i+=3)+2],collapse="right";break}return{node:node,start:start,end:end,collapse:collapse,coverStart:mStart,coverEnd:mEnd}}function getUsefulRect(rects,bias){var rect=nullRect;if("left"==bias)for(var i=0;i<rects.length&&(rect=rects[i]).left==rect.right;i++);else for(var i$1=rects.length-1;0<=i$1&&(rect=rects[i$1]).left==rect.right;i$1--);return rect}function measureCharInner(cm,prepared,ch,bias){var place=nodeAndOffsetInLineMap(prepared.map,ch,bias),node=place.node,start=place.start,end=place.end,collapse=place.collapse,rect;if(3==node.nodeType){for(var i$1=0;4>i$1;i$1++){for(;start&&isExtendingChar(prepared.line.text.charAt(place.coverStart+start));)--start;for(;place.coverStart+end<place.coverEnd&&isExtendingChar(prepared.line.text.charAt(place.coverStart+end));)++end;if(rect=ie&&9>ie_version&&0==start&&end==place.coverEnd-place.coverStart?node.parentNode.getBoundingClientRect():getUsefulRect(range(node,start,end).getClientRects(),bias),rect.left||rect.right||0==start)break;end=start,--start,collapse="right"}ie&&11>ie_version&&(rect=maybeUpdateRectForZooming(cm.display.measure,rect))}else{0<start&&(collapse=bias="right");var rects;rect=cm.options.lineWrapping&&1<(rects=node.getClientRects()).length?rects["right"==bias?rects.length-1:0]:node.getBoundingClientRect()}if(ie&&9>ie_version&&!start&&(!rect||!rect.left&&!rect.right)){var rSpan=node.parentNode.getClientRects()[0];rect=rSpan?{left:rSpan.left,right:rSpan.left+charWidth(cm.display),top:rSpan.top,bottom:rSpan.bottom}:nullRect}for(var rtop=rect.top-prepared.rect.top,rbot=rect.bottom-prepared.rect.top,heights=prepared.view.measure.heights,i=0;i<heights.length-1&&!((rtop+rbot)/2<heights[i]);i++);var top=i?heights[i-1]:0,bot=heights[i],result={left:("right"==collapse?rect.right:rect.left)-prepared.rect.left,right:("left"==collapse?rect.left:rect.right)-prepared.rect.left,top:top,bottom:bot};return rect.left||rect.right||(result.bogus=!0),cm.options.singleCursorHeightPerLine||(result.rtop=rtop,result.rbottom=rbot),result}function maybeUpdateRectForZooming(measure,rect){if(!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI||!hasBadZoomedRects(measure))return rect;var scaleX=screen.logicalXDPI/screen.deviceXDPI,scaleY=screen.logicalYDPI/screen.deviceYDPI;return{left:rect.left*scaleX,right:rect.right*scaleX,top:rect.top*scaleY,bottom:rect.bottom*scaleY}}function clearLineMeasurementCacheFor(lineView){if(lineView.measure&&(lineView.measure.cache={},lineView.measure.heights=null,lineView.rest))for(var i=0;i<lineView.rest.length;i++)lineView.measure.caches[i]={}}function clearLineMeasurementCache(cm){cm.display.externalMeasure=null,removeChildren(cm.display.lineMeasure);for(var i=0;i<cm.display.view.length;i++)clearLineMeasurementCacheFor(cm.display.view[i])}function clearCaches(cm){clearLineMeasurementCache(cm),cm.display.cachedCharWidth=cm.display.cachedTextHeight=cm.display.cachedPaddingH=null,cm.options.lineWrapping||(cm.display.maxLineChanged=!0),cm.display.lineNumChars=null}function pageScrollX(){return chrome&&android?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):window.pageXOffset||(document.documentElement||document.body).scrollLeft}function pageScrollY(){return chrome&&android?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function widgetTopHeight(lineObj){var height=0;if(lineObj.widgets)for(var i=0;i<lineObj.widgets.length;++i)lineObj.widgets[i].above&&(height+=widgetHeight(lineObj.widgets[i]));return height}function intoCoordSystem(cm,lineObj,rect,context,includeWidgets){if(!includeWidgets){var height=widgetTopHeight(lineObj);rect.top+=height,rect.bottom+=height}if("line"==context)return rect;context||(context="local");var yOff=_heightAtLine(lineObj);if("local"==context?yOff+=paddingTop(cm.display):yOff-=cm.display.viewOffset,"page"==context||"window"==context){var lOff=cm.display.lineSpace.getBoundingClientRect();yOff+=lOff.top+("window"==context?0:pageScrollY());var xOff=lOff.left+("window"==context?0:pageScrollX());rect.left+=xOff,rect.right+=xOff}return rect.top+=yOff,rect.bottom+=yOff,rect}function fromCoordSystem(cm,coords,context){if("div"==context)return coords;var left=coords.left,top=coords.top;if("page"==context)left-=pageScrollX(),top-=pageScrollY();else if("local"==context||!context){var localBox=cm.display.sizer.getBoundingClientRect();left+=localBox.left,top+=localBox.top}var lineSpaceBox=cm.display.lineSpace.getBoundingClientRect();return{left:left-lineSpaceBox.left,top:top-lineSpaceBox.top}}function _charCoords(cm,pos,context,lineObj,bias){return lineObj||(lineObj=getLine(cm.doc,pos.line)),intoCoordSystem(cm,lineObj,measureChar(cm,lineObj,pos.ch,bias),context)}function _cursorCoords(cm,pos,context,lineObj,preparedMeasure,varHeight){function get(ch,right){var m=measureCharPrepared(cm,preparedMeasure,ch,right?"right":"left",varHeight);return right?m.left=m.right:m.right=m.left,intoCoordSystem(cm,lineObj,m,context)}function getBidi(ch,partPos,invert){var part=order[partPos],right=1==part.level;return get(invert?ch-1:ch,right!=invert)}lineObj=lineObj||getLine(cm.doc,pos.line),preparedMeasure||(preparedMeasure=prepareMeasureForLine(cm,lineObj));var order=getOrder(lineObj,cm.doc.direction),ch=pos.ch,sticky=pos.sticky;if(ch>=lineObj.text.length?(ch=lineObj.text.length,sticky="before"):0>=ch&&(ch=0,sticky="after"),!order)return get("before"==sticky?ch-1:ch,"before"==sticky);var partPos=getBidiPartAt(order,ch,sticky),other=bidiOther,val=getBidi(ch,partPos,"before"==sticky);return null!=other&&(val.other=getBidi(ch,other,"before"!=sticky)),val}function estimateCoords(cm,pos){var left=0;pos=_clipPos(cm.doc,pos),cm.options.lineWrapping||(left=charWidth(cm.display)*pos.ch);var lineObj=getLine(cm.doc,pos.line),top=_heightAtLine(lineObj)+paddingTop(cm.display);return{left:left,right:left,top:top,bottom:top+lineObj.height}}function PosWithInfo(line,ch,sticky,outside,xRel){var pos=Pos(line,ch,sticky);return pos.xRel=xRel,outside&&(pos.outside=outside),pos}function _coordsChar(cm,x,y){var doc=cm.doc;if(y+=cm.display.viewOffset,0>y)return PosWithInfo(doc.first,0,null,-1,-1);var lineN=_lineAtHeight(doc,y),last=doc.first+doc.size-1;if(lineN>last)return PosWithInfo(doc.first+doc.size-1,getLine(doc,last).text.length,null,1,1);0>x&&(x=0);for(var lineObj=getLine(doc,lineN);;){var found=coordsCharInner(cm,lineObj,lineN,x,y),collapsed=collapsedSpanAround(lineObj,found.ch+(0<found.xRel||0<found.outside?1:0));if(!collapsed)return found;var rangeEnd=collapsed.find(1);if(rangeEnd.line==lineN)return rangeEnd;lineObj=getLine(doc,lineN=rangeEnd.line)}}function wrappedLineExtent(cm,lineObj,preparedMeasure,y){y-=widgetTopHeight(lineObj);var end=lineObj.text.length,begin=findFirst(function(ch){return measureCharPrepared(cm,preparedMeasure,ch-1).bottom<=y},end,0);return end=findFirst(function(ch){return measureCharPrepared(cm,preparedMeasure,ch).top>y},begin,end),{begin:begin,end:end}}function wrappedLineExtentChar(cm,lineObj,preparedMeasure,target){preparedMeasure||(preparedMeasure=prepareMeasureForLine(cm,lineObj));var targetTop=intoCoordSystem(cm,lineObj,measureCharPrepared(cm,preparedMeasure,target),"line").top;return wrappedLineExtent(cm,lineObj,preparedMeasure,targetTop)}function boxIsAfter(box,x,y,left){return!(box.bottom<=y)&&(!!(box.top>y)||(left?box.left:box.right)>x)}function coordsCharInner(cm,lineObj,lineNo,x,y){y-=_heightAtLine(lineObj);var preparedMeasure=prepareMeasureForLine(cm,lineObj),widgetHeight=widgetTopHeight(lineObj),begin=0,end=lineObj.text.length,ltr=!0,order=getOrder(lineObj,cm.doc.direction);if(order){var part=(cm.options.lineWrapping?coordsBidiPartWrapped:coordsBidiPart)(cm,lineObj,lineNo,preparedMeasure,order,x,y);ltr=1!=part.level,begin=ltr?part.from:part.to-1,end=ltr?part.to:part.from-1}var chAround=null,boxAround=null,ch=findFirst(function(ch){var box=measureCharPrepared(cm,preparedMeasure,ch);return(box.top+=widgetHeight,box.bottom+=widgetHeight,!!boxIsAfter(box,x,y,!1))&&(box.top<=y&&box.left<=x&&(chAround=ch,boxAround=box),!0)},begin,end),outside=!1,baseX,sticky;if(boxAround){var atLeft=x-boxAround.left<boxAround.right-x,atStart=atLeft==ltr;ch=chAround+(atStart?0:1),sticky=atStart?"after":"before",baseX=atLeft?boxAround.left:boxAround.right}else{ltr||ch!=end&&ch!=begin||ch++,sticky=0==ch?"after":ch==lineObj.text.length?"before":measureCharPrepared(cm,preparedMeasure,ch-(ltr?1:0)).bottom+widgetHeight<=y==ltr?"after":"before";var coords=_cursorCoords(cm,Pos(lineNo,ch,sticky),"line",lineObj,preparedMeasure);baseX=coords.left,outside=y<coords.top?-1:y>=coords.bottom?1:0}return ch=skipExtendingChars(lineObj.text,ch,1),PosWithInfo(lineNo,ch,sticky,outside,x-baseX)}function coordsBidiPart(cm,lineObj,lineNo,preparedMeasure,order,x,y){var index=findFirst(function(i){var part=order[i],ltr=1!=part.level;return boxIsAfter(_cursorCoords(cm,Pos(lineNo,ltr?part.to:part.from,ltr?"before":"after"),"line",lineObj,preparedMeasure),x,y,!0)},0,order.length-1),part=order[index];if(0<index){var ltr=1!=part.level,start=_cursorCoords(cm,Pos(lineNo,ltr?part.from:part.to,ltr?"after":"before"),"line",lineObj,preparedMeasure);boxIsAfter(start,x,y,!0)&&start.top>y&&(part=order[index-1])}return part}function coordsBidiPartWrapped(cm,lineObj,_lineNo,preparedMeasure,order,x,y){var ref=wrappedLineExtent(cm,lineObj,preparedMeasure,y),begin=ref.begin,end=ref.end;/\s/.test(lineObj.text.charAt(end-1))&&end--;for(var part=null,closestDist=null,i=0,p;i<order.length;i++)if(p=order[i],!(p.from>=end||p.to<=begin)){var ltr=1!=p.level,endX=measureCharPrepared(cm,preparedMeasure,ltr?_Mathmin(end,p.to)-1:_Mathmax(begin,p.from)).right,dist=endX<x?x-endX+1e9:endX-x;(!part||closestDist>dist)&&(part=p,closestDist=dist)}return part||(part=order[order.length-1]),part.from<begin&&(part={from:begin,to:part.to,level:part.level}),part.to>end&&(part={from:part.from,to:end,level:part.level}),part}function textHeight(display){if(null!=display.cachedTextHeight)return display.cachedTextHeight;if(null==measureText){measureText=elt("pre",null,"CodeMirror-line-like");for(var i=0;49>i;++i)measureText.appendChild(document.createTextNode("x")),measureText.appendChild(elt("br"));measureText.appendChild(document.createTextNode("x"))}removeChildrenAndAdd(display.measure,measureText);var height=measureText.offsetHeight/50;return 3<height&&(display.cachedTextHeight=height),removeChildren(display.measure),height||1}function charWidth(display){if(null!=display.cachedCharWidth)return display.cachedCharWidth;var anchor=elt("span","xxxxxxxxxx"),pre=elt("pre",[anchor],"CodeMirror-line-like");removeChildrenAndAdd(display.measure,pre);var rect=anchor.getBoundingClientRect(),width=(rect.right-rect.left)/10;return 2<width&&(display.cachedCharWidth=width),width||10}function getDimensions(cm){for(var d=cm.display,left={},width={},gutterLeft=d.gutters.clientLeft,n=d.gutters.firstChild,i=0,id;n;n=n.nextSibling,++i)id=cm.display.gutterSpecs[i].className,left[id]=n.offsetLeft+n.clientLeft+gutterLeft,width[id]=n.clientWidth;return{fixedPos:compensateForHScroll(d),gutterTotalWidth:d.gutters.offsetWidth,gutterLeft:left,gutterWidth:width,wrapperWidth:d.wrapper.clientWidth}}function compensateForHScroll(display){return display.scroller.getBoundingClientRect().left-display.sizer.getBoundingClientRect().left}function estimateHeight(cm){var th=textHeight(cm.display),wrapping=cm.options.lineWrapping,perLine=wrapping&&_Mathmax(5,cm.display.scroller.clientWidth/charWidth(cm.display)-3);return function(line){if(lineIsHidden(cm.doc,line))return 0;var widgetsHeight=0;if(line.widgets)for(var i=0;i<line.widgets.length;i++)line.widgets[i].height&&(widgetsHeight+=line.widgets[i].height);return wrapping?widgetsHeight+(_Mathceil(line.text.length/perLine)||1)*th:widgetsHeight+th}}function estimateLineHeights(cm){var doc=cm.doc,est=estimateHeight(cm);doc.iter(function(line){var estHeight=est(line);estHeight!=line.height&&updateLineHeight(line,estHeight)})}function posFromMouse(cm,e,liberal,forRect){var display=cm.display;if(!liberal&&"true"==e_target(e).getAttribute("cm-not-content"))return null;var space=display.lineSpace.getBoundingClientRect(),x,y;try{x=e.clientX-space.left,y=e.clientY-space.top}catch(e$1){return null}var coords=_coordsChar(cm,x,y),line;if(forRect&&0<coords.xRel&&(line=getLine(cm.doc,coords.line).text).length==coords.ch){var colDiff=countColumn(line,line.length,cm.options.tabSize)-line.length;coords=Pos(coords.line,_Mathmax(0,_Mathround((x-paddingH(cm.display).left)/charWidth(cm.display))-colDiff))}return coords}function findViewIndex(cm,n){if(n>=cm.display.viewTo)return null;if(n-=cm.display.viewFrom,0>n)return null;for(var view=cm.display.view,i=0;i<view.length;i++)if(n-=view[i].size,0>n)return i}function regChange(cm,from,to,lendiff){null==from&&(from=cm.doc.first),null==to&&(to=cm.doc.first+cm.doc.size),lendiff||(lendiff=0);var display=cm.display;if(lendiff&&to<display.viewTo&&(null==display.updateLineNumbers||display.updateLineNumbers>from)&&(display.updateLineNumbers=from),cm.curOp.viewChanged=!0,from>=display.viewTo)sawCollapsedSpans&&visualLineNo(cm.doc,from)<display.viewTo&&resetView(cm);else if(to<=display.viewFrom)sawCollapsedSpans&&visualLineEndNo(cm.doc,to+lendiff)>display.viewFrom?resetView(cm):(display.viewFrom+=lendiff,display.viewTo+=lendiff);else if(from<=display.viewFrom&&to>=display.viewTo)resetView(cm);else if(from<=display.viewFrom){var cut=viewCuttingPoint(cm,to,to+lendiff,1);cut?(display.view=display.view.slice(cut.index),display.viewFrom=cut.lineN,display.viewTo+=lendiff):resetView(cm)}else if(to>=display.viewTo){var cut$1=viewCuttingPoint(cm,from,from,-1);cut$1?(display.view=display.view.slice(0,cut$1.index),display.viewTo=cut$1.lineN):resetView(cm)}else{var cutTop=viewCuttingPoint(cm,from,from,-1),cutBot=viewCuttingPoint(cm,to,to+lendiff,1);cutTop&&cutBot?(display.view=display.view.slice(0,cutTop.index).concat(buildViewArray(cm,cutTop.lineN,cutBot.lineN)).concat(display.view.slice(cutBot.index)),display.viewTo+=lendiff):resetView(cm)}var ext=display.externalMeasured;ext&&(to<ext.lineN?ext.lineN+=lendiff:from<ext.lineN+ext.size&&(display.externalMeasured=null))}function regLineChange(cm,line,type){cm.curOp.viewChanged=!0;var display=cm.display,ext=cm.display.externalMeasured;if(ext&&line>=ext.lineN&&line<ext.lineN+ext.size&&(display.externalMeasured=null),!(line<display.viewFrom||line>=display.viewTo)){var lineView=display.view[findViewIndex(cm,line)];if(null!=lineView.node){var arr=lineView.changes||(lineView.changes=[]);-1==indexOf(arr,type)&&arr.push(type)}}}function resetView(cm){cm.display.viewFrom=cm.display.viewTo=cm.doc.first,cm.display.view=[],cm.display.viewOffset=0}function viewCuttingPoint(cm,oldN,newN,dir){var index=findViewIndex(cm,oldN),view=cm.display.view,diff;if(!sawCollapsedSpans||newN==cm.doc.first+cm.doc.size)return{index:index,lineN:newN};for(var n=cm.display.viewFrom,i=0;i<index;i++)n+=view[i].size;if(n!=oldN){if(0<dir){if(index==view.length-1)return null;diff=n+view[index].size-oldN,index++}else diff=n-oldN;oldN+=diff,newN+=diff}for(;visualLineNo(cm.doc,newN)!=newN;){if(index==(0>dir?0:view.length-1))return null;newN+=dir*view[index-(0>dir?1:0)].size,index+=dir}return{index:index,lineN:newN}}function adjustView(cm,from,to){var display=cm.display,view=display.view;0==view.length||from>=display.viewTo||to<=display.viewFrom?(display.view=buildViewArray(cm,from,to),display.viewFrom=from):(display.viewFrom>from?display.view=buildViewArray(cm,from,display.viewFrom).concat(display.view):display.viewFrom<from&&(display.view=display.view.slice(findViewIndex(cm,from))),display.viewFrom=from,display.viewTo<to?display.view=display.view.concat(buildViewArray(cm,display.viewTo,to)):display.viewTo>to&&(display.view=display.view.slice(0,findViewIndex(cm,to)))),display.viewTo=to}function countDirtyView(cm){for(var view=cm.display.view,dirty=0,i=0,lineView;i<view.length;i++)lineView=view[i],lineView.hidden||lineView.node&&!lineView.changes||++dirty;return dirty}function updateSelection(cm){cm.display.input.showSelection(cm.display.input.prepareSelection())}function prepareSelection(cm,primary){void 0===primary&&(primary=!0);for(var doc=cm.doc,result={},curFragment=result.cursors=document.createDocumentFragment(),selFragment=result.selection=document.createDocumentFragment(),i=0;i<doc.sel.ranges.length;i++)if(primary||i!=doc.sel.primIndex){var range=doc.sel.ranges[i];if(!(range.from().line>=cm.display.viewTo||range.to().line<cm.display.viewFrom)){var collapsed=range.empty();(collapsed||cm.options.showCursorWhenSelecting)&&drawSelectionCursor(cm,range.head,curFragment),collapsed||drawSelectionRange(cm,range,selFragment)}}return result}function drawSelectionCursor(cm,head,output){var pos=_cursorCoords(cm,head,"div",null,null,!cm.options.singleCursorHeightPerLine),cursor=output.appendChild(elt("div","\xA0","CodeMirror-cursor"));if(cursor.style.left=pos.left+"px",cursor.style.top=pos.top+"px",cursor.style.height=_Mathmax(0,pos.bottom-pos.top)*cm.options.cursorHeight+"px",pos.other){var otherCursor=output.appendChild(elt("div","\xA0","CodeMirror-cursor CodeMirror-secondarycursor"));otherCursor.style.display="",otherCursor.style.left=pos.other.left+"px",otherCursor.style.top=pos.other.top+"px",otherCursor.style.height=.85*(pos.other.bottom-pos.other.top)+"px"}}function cmpCoords(a,b){return a.top-b.top||a.left-b.left}function drawSelectionRange(cm,range,output){function add(left,top,width,bottom){0>top&&(top=0),top=_Mathround(top),bottom=_Mathround(bottom),fragment.appendChild(elt("div",null,"CodeMirror-selected","position: absolute; left: "+left+"px;\n                             top: "+top+"px; width: "+(null==width?rightSide-left:width)+"px;\n                             height: "+(bottom-top)+"px"))}function drawForLine(line,fromArg,toArg){function coords(ch,bias){return _charCoords(cm,Pos(line,ch),"div",lineObj,bias)}function wrapX(pos,dir,side){var extent=wrappedLineExtentChar(cm,lineObj,null,pos),prop="ltr"==dir==("after"==side)?"left":"right",ch="after"==side?extent.begin:extent.end-(/\s/.test(lineObj.text.charAt(extent.end-1))?2:1);return coords(ch,prop)[prop]}var lineObj=getLine(doc,line),lineLen=lineObj.text.length,order=getOrder(lineObj,doc.direction),start,end;return iterateBidiSections(order,fromArg||0,null==toArg?lineLen:toArg,function(from,to,dir,i){var ltr="ltr"==dir,fromPos=coords(from,ltr?"left":"right"),toPos=coords(to-1,ltr?"right":"left"),openStart=null==fromArg&&0==from,openEnd=null==toArg&&to==lineLen,first=0==i,last=!order||i==order.length-1;if(3>=toPos.top-fromPos.top){var openLeft=(docLTR?openStart:openEnd)&&first,openRight=(docLTR?openEnd:openStart)&&last,left=openLeft?leftSide:(ltr?fromPos:toPos).left,right=openRight?rightSide:(ltr?toPos:fromPos).right;add(left,fromPos.top,right-left,fromPos.bottom)}else{var topLeft,topRight,botLeft,botRight;ltr?(topLeft=docLTR&&openStart&&first?leftSide:fromPos.left,topRight=docLTR?rightSide:wrapX(from,dir,"before"),botLeft=docLTR?leftSide:wrapX(to,dir,"after"),botRight=docLTR&&openEnd&&last?rightSide:toPos.right):(topLeft=docLTR?wrapX(from,dir,"before"):leftSide,topRight=!docLTR&&openStart&&first?rightSide:fromPos.right,botLeft=!docLTR&&openEnd&&last?leftSide:toPos.left,botRight=docLTR?wrapX(to,dir,"after"):rightSide),add(topLeft,fromPos.top,topRight-topLeft,fromPos.bottom),fromPos.bottom<toPos.top&&add(leftSide,fromPos.bottom,null,toPos.top),add(botLeft,toPos.top,botRight-botLeft,toPos.bottom)}(!start||0>cmpCoords(fromPos,start))&&(start=fromPos),0>cmpCoords(toPos,start)&&(start=toPos),(!end||0>cmpCoords(fromPos,end))&&(end=fromPos),0>cmpCoords(toPos,end)&&(end=toPos)}),{start:start,end:end}}var display=cm.display,doc=cm.doc,fragment=document.createDocumentFragment(),padding=paddingH(cm.display),leftSide=padding.left,rightSide=_Mathmax(display.sizerWidth,displayWidth(cm)-display.sizer.offsetLeft)-padding.right,docLTR="ltr"==doc.direction,sFrom=range.from(),sTo=range.to();if(sFrom.line==sTo.line)drawForLine(sFrom.line,sFrom.ch,sTo.ch);else{var fromLine=getLine(doc,sFrom.line),toLine=getLine(doc,sTo.line),singleVLine=visualLine(fromLine)==visualLine(toLine),leftEnd=drawForLine(sFrom.line,sFrom.ch,singleVLine?fromLine.text.length+1:null).end,rightStart=drawForLine(sTo.line,singleVLine?0:null,sTo.ch).start;singleVLine&&(leftEnd.top<rightStart.top-2?(add(leftEnd.right,leftEnd.top,null,leftEnd.bottom),add(leftSide,rightStart.top,rightStart.left,rightStart.bottom)):add(leftEnd.right,leftEnd.top,rightStart.left-leftEnd.right,leftEnd.bottom)),leftEnd.bottom<rightStart.top&&add(leftSide,leftEnd.bottom,null,rightStart.top)}output.appendChild(fragment)}function restartBlink(cm){if(cm.state.focused){var display=cm.display;clearInterval(display.blinker);var on=!0;display.cursorDiv.style.visibility="",0<cm.options.cursorBlinkRate?display.blinker=setInterval(function(){return display.cursorDiv.style.visibility=(on=!on)?"":"hidden"},cm.options.cursorBlinkRate):0>cm.options.cursorBlinkRate&&(display.cursorDiv.style.visibility="hidden")}}function ensureFocus(cm){cm.state.focused||(cm.display.input.focus(),onFocus(cm))}function delayBlurEvent(cm){cm.state.delayingBlurEvent=!0,setTimeout(function(){cm.state.delayingBlurEvent&&(cm.state.delayingBlurEvent=!1,onBlur(cm))},100)}function onFocus(cm,e){cm.state.delayingBlurEvent&&(cm.state.delayingBlurEvent=!1),"nocursor"==cm.options.readOnly||(!cm.state.focused&&(signal(cm,"focus",cm,e),cm.state.focused=!0,addClass(cm.display.wrapper,"CodeMirror-focused"),!cm.curOp&&cm.display.selForContextMenu!=cm.doc.sel&&(cm.display.input.reset(),webkit&&setTimeout(function(){return cm.display.input.reset(!0)},20)),cm.display.input.receivedFocus()),restartBlink(cm))}function onBlur(cm,e){cm.state.delayingBlurEvent||(cm.state.focused&&(signal(cm,"blur",cm,e),cm.state.focused=!1,rmClass(cm.display.wrapper,"CodeMirror-focused")),clearInterval(cm.display.blinker),setTimeout(function(){cm.state.focused||(cm.display.shift=!1)},150))}function updateHeightsInViewport(cm){for(var display=cm.display,prevBottom=display.lineDiv.offsetTop,i=0;i<display.view.length;i++){var cur=display.view[i],wrapping=cm.options.lineWrapping,height=void 0,width=0;if(!cur.hidden){if(ie&&8>ie_version){var bot=cur.node.offsetTop+cur.node.offsetHeight;height=bot-prevBottom,prevBottom=bot}else{var box=cur.node.getBoundingClientRect();height=box.bottom-box.top,!wrapping&&cur.text.firstChild&&(width=cur.text.firstChild.getBoundingClientRect().right-box.left-1)}var diff=cur.line.height-height;if((.005<diff||-.005>diff)&&(updateLineHeight(cur.line,height),updateWidgetHeight(cur.line),cur.rest))for(var j=0;j<cur.rest.length;j++)updateWidgetHeight(cur.rest[j]);if(width>cm.display.sizerWidth){var chWidth=_Mathceil(width/charWidth(cm.display));chWidth>cm.display.maxLineLength&&(cm.display.maxLineLength=chWidth,cm.display.maxLine=cur.line,cm.display.maxLineChanged=!0)}}}}function updateWidgetHeight(line){if(line.widgets)for(var i=0;i<line.widgets.length;++i){var w=line.widgets[i],parent=w.node.parentNode;parent&&(w.height=parent.offsetHeight)}}function visibleLines(display,doc,viewport){var top=viewport&&null!=viewport.top?_Mathmax(0,viewport.top):display.scroller.scrollTop;top=_Mathfloor(top-paddingTop(display));var bottom=viewport&&null!=viewport.bottom?viewport.bottom:top+display.wrapper.clientHeight,from=_lineAtHeight(doc,top),to=_lineAtHeight(doc,bottom);if(viewport&&viewport.ensure){var ensureFrom=viewport.ensure.from.line,ensureTo=viewport.ensure.to.line;ensureFrom<from?(from=ensureFrom,to=_lineAtHeight(doc,_heightAtLine(getLine(doc,ensureFrom))+display.wrapper.clientHeight)):_Mathmin(ensureTo,doc.lastLine())>=to&&(from=_lineAtHeight(doc,_heightAtLine(getLine(doc,ensureTo))-display.wrapper.clientHeight),to=ensureTo)}return{from:from,to:_Mathmax(to,from+1)}}function maybeScrollWindow(cm,rect){if(!signalDOMEvent(cm,"scrollCursorIntoView")){var display=cm.display,box=display.sizer.getBoundingClientRect(),doScroll=null;if(0>rect.top+box.top?doScroll=!0:rect.bottom+box.top>(window.innerHeight||document.documentElement.clientHeight)&&(doScroll=!1),null!=doScroll&&!phantom){var scrollNode=elt("div","\u200B",null,"position: absolute;\n                         top: "+(rect.top-display.viewOffset-paddingTop(cm.display))+"px;\n                         height: "+(rect.bottom-rect.top+scrollGap(cm)+display.barHeight)+"px;\n                         left: "+rect.left+"px; width: "+_Mathmax(2,rect.right-rect.left)+"px;");cm.display.lineSpace.appendChild(scrollNode),scrollNode.scrollIntoView(doScroll),cm.display.lineSpace.removeChild(scrollNode)}}}function scrollPosIntoView(cm,pos,end,margin){null==margin&&(margin=0);var rect;cm.options.lineWrapping||pos!=end||(pos=pos.ch?Pos(pos.line,"before"==pos.sticky?pos.ch-1:pos.ch,"after"):pos,end="before"==pos.sticky?Pos(pos.line,pos.ch+1,"before"):pos);for(var limit=0;5>limit;limit++){var changed=!1,coords=_cursorCoords(cm,pos),endCoords=end&&end!=pos?_cursorCoords(cm,end):coords;rect={left:_Mathmin(coords.left,endCoords.left),top:_Mathmin(coords.top,endCoords.top)-margin,right:_Mathmax(coords.left,endCoords.left),bottom:_Mathmax(coords.bottom,endCoords.bottom)+margin};var scrollPos=calculateScrollPos(cm,rect),startTop=cm.doc.scrollTop,startLeft=cm.doc.scrollLeft;if(null!=scrollPos.scrollTop&&(updateScrollTop(cm,scrollPos.scrollTop),1<_Mathabs(cm.doc.scrollTop-startTop)&&(changed=!0)),null!=scrollPos.scrollLeft&&(setScrollLeft(cm,scrollPos.scrollLeft),1<_Mathabs(cm.doc.scrollLeft-startLeft)&&(changed=!0)),!changed)break}return rect}function scrollIntoView(cm,rect){var scrollPos=calculateScrollPos(cm,rect);null!=scrollPos.scrollTop&&updateScrollTop(cm,scrollPos.scrollTop),null!=scrollPos.scrollLeft&&setScrollLeft(cm,scrollPos.scrollLeft)}function calculateScrollPos(cm,rect){var display=cm.display,snapMargin=textHeight(cm.display);0>rect.top&&(rect.top=0);var screentop=cm.curOp&&null!=cm.curOp.scrollTop?cm.curOp.scrollTop:display.scroller.scrollTop,screen=displayHeight(cm),result={};rect.bottom-rect.top>screen&&(rect.bottom=rect.top+screen);var docBottom=cm.doc.height+paddingVert(display),atTop=rect.top<snapMargin,atBottom=rect.bottom>docBottom-snapMargin;if(rect.top<screentop)result.scrollTop=atTop?0:rect.top;else if(rect.bottom>screentop+screen){var newTop=_Mathmin(rect.top,(atBottom?docBottom:rect.bottom)-screen);newTop!=screentop&&(result.scrollTop=newTop)}var screenleft=cm.curOp&&null!=cm.curOp.scrollLeft?cm.curOp.scrollLeft:display.scroller.scrollLeft,screenw=displayWidth(cm)-(cm.options.fixedGutter?display.gutters.offsetWidth:0),tooWide=rect.right-rect.left>screenw;return tooWide&&(rect.right=rect.left+screenw),10>rect.left?result.scrollLeft=0:rect.left<screenleft?result.scrollLeft=_Mathmax(0,rect.left-(tooWide?0:10)):rect.right>screenw+screenleft-3&&(result.scrollLeft=rect.right+(tooWide?0:10)-screenw),result}function addToScrollTop(cm,top){null==top||(resolveScrollToPos(cm),cm.curOp.scrollTop=(null==cm.curOp.scrollTop?cm.doc.scrollTop:cm.curOp.scrollTop)+top)}function ensureCursorVisible(cm){resolveScrollToPos(cm);var cur=cm.getCursor();cm.curOp.scrollToPos={from:cur,to:cur,margin:cm.options.cursorScrollMargin}}function scrollToCoords(cm,x,y){(null!=x||null!=y)&&resolveScrollToPos(cm),null!=x&&(cm.curOp.scrollLeft=x),null!=y&&(cm.curOp.scrollTop=y)}function scrollToRange(cm,range){resolveScrollToPos(cm),cm.curOp.scrollToPos=range}function resolveScrollToPos(cm){var range=cm.curOp.scrollToPos;if(range){cm.curOp.scrollToPos=null;var from=estimateCoords(cm,range.from),to=estimateCoords(cm,range.to);scrollToCoordsRange(cm,from,to,range.margin)}}function scrollToCoordsRange(cm,from,to,margin){var sPos=calculateScrollPos(cm,{left:_Mathmin(from.left,to.left),top:_Mathmin(from.top,to.top)-margin,right:_Mathmax(from.right,to.right),bottom:_Mathmax(from.bottom,to.bottom)+margin});scrollToCoords(cm,sPos.scrollLeft,sPos.scrollTop)}function updateScrollTop(cm,val){2>_Mathabs(cm.doc.scrollTop-val)||(!gecko&&updateDisplaySimple(cm,{top:val}),setScrollTop(cm,val,!0),gecko&&updateDisplaySimple(cm),startWorker(cm,100))}function setScrollTop(cm,val,forceScroll){val=_Mathmax(0,_Mathmin(cm.display.scroller.scrollHeight-cm.display.scroller.clientHeight,val)),(cm.display.scroller.scrollTop!=val||forceScroll)&&(cm.doc.scrollTop=val,cm.display.scrollbars.setScrollTop(val),cm.display.scroller.scrollTop!=val&&(cm.display.scroller.scrollTop=val))}function setScrollLeft(cm,val,isScroller,forceScroll){val=_Mathmax(0,_Mathmin(val,cm.display.scroller.scrollWidth-cm.display.scroller.clientWidth)),(isScroller?val==cm.doc.scrollLeft:2>_Mathabs(cm.doc.scrollLeft-val))&&!forceScroll||(cm.doc.scrollLeft=val,alignHorizontally(cm),cm.display.scroller.scrollLeft!=val&&(cm.display.scroller.scrollLeft=val),cm.display.scrollbars.setScrollLeft(val))}function measureForScrollbars(cm){var d=cm.display,gutterW=d.gutters.offsetWidth,docH=_Mathround(cm.doc.height+paddingVert(cm.display));return{clientHeight:d.scroller.clientHeight,viewHeight:d.wrapper.clientHeight,scrollWidth:d.scroller.scrollWidth,clientWidth:d.scroller.clientWidth,viewWidth:d.wrapper.clientWidth,barLeft:cm.options.fixedGutter?gutterW:0,docHeight:docH,scrollHeight:docH+scrollGap(cm)+d.barHeight,nativeBarWidth:d.nativeBarWidth,gutterWidth:gutterW}}function updateScrollbars(cm,measure){measure||(measure=measureForScrollbars(cm));var startWidth=cm.display.barWidth,startHeight=cm.display.barHeight;updateScrollbarsInner(cm,measure);for(var i=0;4>i&&startWidth!=cm.display.barWidth||startHeight!=cm.display.barHeight;i++)startWidth!=cm.display.barWidth&&cm.options.lineWrapping&&updateHeightsInViewport(cm),updateScrollbarsInner(cm,measureForScrollbars(cm)),startWidth=cm.display.barWidth,startHeight=cm.display.barHeight}function updateScrollbarsInner(cm,measure){var d=cm.display,sizes=d.scrollbars.update(measure);d.sizer.style.paddingRight=(d.barWidth=sizes.right)+"px",d.sizer.style.paddingBottom=(d.barHeight=sizes.bottom)+"px",d.heightForcer.style.borderBottom=sizes.bottom+"px solid transparent",sizes.right&&sizes.bottom?(d.scrollbarFiller.style.display="block",d.scrollbarFiller.style.height=sizes.bottom+"px",d.scrollbarFiller.style.width=sizes.right+"px"):d.scrollbarFiller.style.display="",sizes.bottom&&cm.options.coverGutterNextToScrollbar&&cm.options.fixedGutter?(d.gutterFiller.style.display="block",d.gutterFiller.style.height=sizes.bottom+"px",d.gutterFiller.style.width=measure.gutterWidth+"px"):d.gutterFiller.style.display=""}function initScrollbars(cm){cm.display.scrollbars&&(cm.display.scrollbars.clear(),cm.display.scrollbars.addClass&&rmClass(cm.display.wrapper,cm.display.scrollbars.addClass)),cm.display.scrollbars=new scrollbarModel[cm.options.scrollbarStyle](function(node){cm.display.wrapper.insertBefore(node,cm.display.scrollbarFiller),on(node,"mousedown",function(){cm.state.focused&&setTimeout(function(){return cm.display.input.focus()},0)}),node.setAttribute("cm-not-content","true")},function(pos,axis){"horizontal"==axis?setScrollLeft(cm,pos):updateScrollTop(cm,pos)},cm),cm.display.scrollbars.addClass&&addClass(cm.display.wrapper,cm.display.scrollbars.addClass)}function _startOperation(cm){cm.curOp={cm:cm,viewChanged:!1,startHeight:cm.doc.height,forceUpdate:!1,updateInput:0,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++nextOpId},pushOperation(cm.curOp)}function _endOperation(cm){var op=cm.curOp;op&&finishOperation(op,function(group){for(var i=0;i<group.ops.length;i++)group.ops[i].cm.curOp=null;endOperations(group)})}function endOperations(group){for(var ops=group.ops,i=0;i<ops.length;i++)endOperation_R1(ops[i]);for(var i$1=0;i$1<ops.length;i$1++)endOperation_W1(ops[i$1]);for(var i$2=0;i$2<ops.length;i$2++)endOperation_R2(ops[i$2]);for(var i$3=0;i$3<ops.length;i$3++)endOperation_W2(ops[i$3]);for(var i$4=0;i$4<ops.length;i$4++)endOperation_finish(ops[i$4])}function endOperation_R1(op){var cm=op.cm,display=cm.display;maybeClipScrollbars(cm),op.updateMaxLine&&findMaxLine(cm),op.mustUpdate=op.viewChanged||op.forceUpdate||null!=op.scrollTop||op.scrollToPos&&(op.scrollToPos.from.line<display.viewFrom||op.scrollToPos.to.line>=display.viewTo)||display.maxLineChanged&&cm.options.lineWrapping,op.update=op.mustUpdate&&new DisplayUpdate(cm,op.mustUpdate&&{top:op.scrollTop,ensure:op.scrollToPos},op.forceUpdate)}function endOperation_W1(op){op.updatedDisplay=op.mustUpdate&&updateDisplayIfNeeded(op.cm,op.update)}function endOperation_R2(op){var cm=op.cm,display=cm.display;op.updatedDisplay&&updateHeightsInViewport(cm),op.barMeasure=measureForScrollbars(cm),display.maxLineChanged&&!cm.options.lineWrapping&&(op.adjustWidthTo=measureChar(cm,display.maxLine,display.maxLine.text.length).left+3,cm.display.sizerWidth=op.adjustWidthTo,op.barMeasure.scrollWidth=_Mathmax(display.scroller.clientWidth,display.sizer.offsetLeft+op.adjustWidthTo+scrollGap(cm)+cm.display.barWidth),op.maxScrollLeft=_Mathmax(0,display.sizer.offsetLeft+op.adjustWidthTo-displayWidth(cm))),(op.updatedDisplay||op.selectionChanged)&&(op.preparedSelection=display.input.prepareSelection())}function endOperation_W2(op){var cm=op.cm;null!=op.adjustWidthTo&&(cm.display.sizer.style.minWidth=op.adjustWidthTo+"px",op.maxScrollLeft<cm.doc.scrollLeft&&setScrollLeft(cm,_Mathmin(cm.display.scroller.scrollLeft,op.maxScrollLeft),!0),cm.display.maxLineChanged=!1);var takeFocus=op.focus&&op.focus==activeElt();op.preparedSelection&&cm.display.input.showSelection(op.preparedSelection,takeFocus),(op.updatedDisplay||op.startHeight!=cm.doc.height)&&updateScrollbars(cm,op.barMeasure),op.updatedDisplay&&setDocumentHeight(cm,op.barMeasure),op.selectionChanged&&restartBlink(cm),cm.state.focused&&op.updateInput&&cm.display.input.reset(op.typing),takeFocus&&ensureFocus(op.cm)}function endOperation_finish(op){var cm=op.cm,display=cm.display,doc=cm.doc;if(op.updatedDisplay&&postUpdateDisplay(cm,op.update),null!=display.wheelStartX&&(null!=op.scrollTop||null!=op.scrollLeft||op.scrollToPos)&&(display.wheelStartX=display.wheelStartY=null),null!=op.scrollTop&&setScrollTop(cm,op.scrollTop,op.forceScroll),null!=op.scrollLeft&&setScrollLeft(cm,op.scrollLeft,!0,!0),op.scrollToPos){var rect=scrollPosIntoView(cm,_clipPos(doc,op.scrollToPos.from),_clipPos(doc,op.scrollToPos.to),op.scrollToPos.margin);maybeScrollWindow(cm,rect)}var hidden=op.maybeHiddenMarkers,unhidden=op.maybeUnhiddenMarkers;if(hidden)for(var i=0;i<hidden.length;++i)hidden[i].lines.length||signal(hidden[i],"hide");if(unhidden)for(var i$1=0;i$1<unhidden.length;++i$1)unhidden[i$1].lines.length&&signal(unhidden[i$1],"unhide");display.wrapper.offsetHeight&&(doc.scrollTop=cm.display.scroller.scrollTop),op.changeObjs&&signal(cm,"changes",cm,op.changeObjs),op.update&&op.update.finish()}function runInOp(cm,f){if(cm.curOp)return f();_startOperation(cm);try{return f()}finally{_endOperation(cm)}}function operation(cm,f){return function(){if(cm.curOp)return f.apply(cm,arguments);_startOperation(cm);try{return f.apply(cm,arguments)}finally{_endOperation(cm)}}}function methodOp(f){return function(){if(this.curOp)return f.apply(this,arguments);_startOperation(this);try{return f.apply(this,arguments)}finally{_endOperation(this)}}}function docMethodOp(f){return function(){var cm=this.cm;if(!cm||cm.curOp)return f.apply(this,arguments);_startOperation(cm);try{return f.apply(this,arguments)}finally{_endOperation(cm)}}}function startWorker(cm,time){cm.doc.highlightFrontier<cm.display.viewTo&&cm.state.highlight.set(time,bind(highlightWorker,cm))}function highlightWorker(cm){var doc=cm.doc;if(!(doc.highlightFrontier>=cm.display.viewTo)){var end=+new Date+cm.options.workTime,context=getContextBefore(cm,doc.highlightFrontier),changedLines=[];doc.iter(context.line,_Mathmin(doc.first+doc.size,cm.display.viewTo+500),function(line){if(context.line>=cm.display.viewFrom){var oldStyles=line.styles,resetState=line.text.length>cm.options.maxHighlightLength?copyState(doc.mode,context.state):null,highlighted=highlightLine(cm,line,context,!0);resetState&&(context.state=resetState),line.styles=highlighted.styles;var oldCls=line.styleClasses,newCls=highlighted.classes;newCls?line.styleClasses=newCls:oldCls&&(line.styleClasses=null);for(var ischange=!oldStyles||oldStyles.length!=line.styles.length||oldCls!=newCls&&(!oldCls||!newCls||oldCls.bgClass!=newCls.bgClass||oldCls.textClass!=newCls.textClass),i=0;!ischange&&i<oldStyles.length;++i)ischange=oldStyles[i]!=line.styles[i];ischange&&changedLines.push(context.line),line.stateAfter=context.save(),context.nextLine()}else line.text.length<=cm.options.maxHighlightLength&&processLine(cm,line.text,context),line.stateAfter=0==context.line%5?context.save():null,context.nextLine();return+new Date>end?(startWorker(cm,cm.options.workDelay),!0):void 0}),doc.highlightFrontier=context.line,doc.modeFrontier=_Mathmax(doc.modeFrontier,context.line),changedLines.length&&runInOp(cm,function(){for(var i=0;i<changedLines.length;i++)regLineChange(cm,changedLines[i],"text")})}}function maybeClipScrollbars(cm){var display=cm.display;!display.scrollbarsClipped&&display.scroller.offsetWidth&&(display.nativeBarWidth=display.scroller.offsetWidth-display.scroller.clientWidth,display.heightForcer.style.height=scrollGap(cm)+"px",display.sizer.style.marginBottom=-display.nativeBarWidth+"px",display.sizer.style.borderRightWidth=scrollGap(cm)+"px",display.scrollbarsClipped=!0)}function selectionSnapshot(cm){if(cm.hasFocus())return null;var active=activeElt();if(!active||!contains(cm.display.lineDiv,active))return null;var result={activeElt:active};if(window.getSelection){var sel=window.getSelection();sel.anchorNode&&sel.extend&&contains(cm.display.lineDiv,sel.anchorNode)&&(result.anchorNode=sel.anchorNode,result.anchorOffset=sel.anchorOffset,result.focusNode=sel.focusNode,result.focusOffset=sel.focusOffset)}return result}function restoreSelection(snapshot){if(snapshot&&snapshot.activeElt&&snapshot.activeElt!=activeElt()&&(snapshot.activeElt.focus(),!/^(INPUT|TEXTAREA)$/.test(snapshot.activeElt.nodeName)&&snapshot.anchorNode&&contains(document.body,snapshot.anchorNode)&&contains(document.body,snapshot.focusNode))){var sel=window.getSelection(),range=document.createRange();range.setEnd(snapshot.anchorNode,snapshot.anchorOffset),range.collapse(!1),sel.removeAllRanges(),sel.addRange(range),sel.extend(snapshot.focusNode,snapshot.focusOffset)}}function updateDisplayIfNeeded(cm,update){var display=cm.display,doc=cm.doc;if(update.editorIsHidden)return resetView(cm),!1;if(!update.force&&update.visible.from>=display.viewFrom&&update.visible.to<=display.viewTo&&(null==display.updateLineNumbers||display.updateLineNumbers>=display.viewTo)&&display.renderedView==display.view&&0==countDirtyView(cm))return!1;maybeUpdateLineNumberWidth(cm)&&(resetView(cm),update.dims=getDimensions(cm));var end=doc.first+doc.size,from=_Mathmax(update.visible.from-cm.options.viewportMargin,doc.first),to=_Mathmin(end,update.visible.to+cm.options.viewportMargin);display.viewFrom<from&&20>from-display.viewFrom&&(from=_Mathmax(doc.first,display.viewFrom)),display.viewTo>to&&20>display.viewTo-to&&(to=_Mathmin(end,display.viewTo)),sawCollapsedSpans&&(from=visualLineNo(cm.doc,from),to=visualLineEndNo(cm.doc,to));var different=from!=display.viewFrom||to!=display.viewTo||display.lastWrapHeight!=update.wrapperHeight||display.lastWrapWidth!=update.wrapperWidth;adjustView(cm,from,to),display.viewOffset=_heightAtLine(getLine(cm.doc,display.viewFrom)),cm.display.mover.style.top=display.viewOffset+"px";var toUpdate=countDirtyView(cm);if(!different&&0==toUpdate&&!update.force&&display.renderedView==display.view&&(null==display.updateLineNumbers||display.updateLineNumbers>=display.viewTo))return!1;var selSnapshot=selectionSnapshot(cm);return 4<toUpdate&&(display.lineDiv.style.display="none"),patchDisplay(cm,display.updateLineNumbers,update.dims),4<toUpdate&&(display.lineDiv.style.display=""),display.renderedView=display.view,restoreSelection(selSnapshot),removeChildren(display.cursorDiv),removeChildren(display.selectionDiv),display.gutters.style.height=display.sizer.style.minHeight=0,different&&(display.lastWrapHeight=update.wrapperHeight,display.lastWrapWidth=update.wrapperWidth,startWorker(cm,400)),display.updateLineNumbers=null,!0}function postUpdateDisplay(cm,update){for(var viewport=update.viewport,first=!0;;first=!1){if(first&&cm.options.lineWrapping&&update.oldDisplayWidth!=displayWidth(cm))first&&(update.visible=visibleLines(cm.display,cm.doc,viewport));else if(viewport&&null!=viewport.top&&(viewport={top:_Mathmin(cm.doc.height+paddingVert(cm.display)-displayHeight(cm),viewport.top)}),update.visible=visibleLines(cm.display,cm.doc,viewport),update.visible.from>=cm.display.viewFrom&&update.visible.to<=cm.display.viewTo)break;if(!updateDisplayIfNeeded(cm,update))break;updateHeightsInViewport(cm);var barMeasure=measureForScrollbars(cm);updateSelection(cm),updateScrollbars(cm,barMeasure),setDocumentHeight(cm,barMeasure),update.force=!1}update.signal(cm,"update",cm),(cm.display.viewFrom!=cm.display.reportedViewFrom||cm.display.viewTo!=cm.display.reportedViewTo)&&(update.signal(cm,"viewportChange",cm,cm.display.viewFrom,cm.display.viewTo),cm.display.reportedViewFrom=cm.display.viewFrom,cm.display.reportedViewTo=cm.display.viewTo)}function updateDisplaySimple(cm,viewport){var update=new DisplayUpdate(cm,viewport);if(updateDisplayIfNeeded(cm,update)){updateHeightsInViewport(cm),postUpdateDisplay(cm,update);var barMeasure=measureForScrollbars(cm);updateSelection(cm),updateScrollbars(cm,barMeasure),setDocumentHeight(cm,barMeasure),update.finish()}}function patchDisplay(cm,updateNumbersFrom,dims){function rm(node){var next=node.nextSibling;return webkit&&mac&&cm.display.currentWheelTarget==node?node.style.display="none":node.parentNode.removeChild(node),next}for(var display=cm.display,lineNumbers=cm.options.lineNumbers,container=display.lineDiv,cur=container.firstChild,view=display.view,lineN=display.viewFrom,i=0,lineView;i<view.length;i++){if(lineView=view[i],lineView.hidden);else if(!lineView.node||lineView.node.parentNode!=container){var node=buildLineElement(cm,lineView,lineN,dims);container.insertBefore(node,cur)}else{for(;cur!=lineView.node;)cur=rm(cur);var updateNumber=lineNumbers&&null!=updateNumbersFrom&&updateNumbersFrom<=lineN&&lineView.lineNumber;lineView.changes&&(-1<indexOf(lineView.changes,"gutter")&&(updateNumber=!1),updateLineForChanges(cm,lineView,lineN,dims)),updateNumber&&(removeChildren(lineView.lineNumber),lineView.lineNumber.appendChild(document.createTextNode(lineNumberFor(cm.options,lineN)))),cur=lineView.node.nextSibling}lineN+=lineView.size}for(;cur;)cur=rm(cur)}function updateGutterSpace(display){var width=display.gutters.offsetWidth;display.sizer.style.marginLeft=width+"px"}function setDocumentHeight(cm,measure){cm.display.sizer.style.minHeight=measure.docHeight+"px",cm.display.heightForcer.style.top=measure.docHeight+"px",cm.display.gutters.style.height=measure.docHeight+cm.display.barHeight+scrollGap(cm)+"px"}function alignHorizontally(cm){var display=cm.display,view=display.view;if(display.alignWidgets||display.gutters.firstChild&&cm.options.fixedGutter){for(var comp=compensateForHScroll(display)-display.scroller.scrollLeft+cm.doc.scrollLeft,gutterW=display.gutters.offsetWidth,left=comp+"px",i=0;i<view.length;i++)if(!view[i].hidden){cm.options.fixedGutter&&(view[i].gutter&&(view[i].gutter.style.left=left),view[i].gutterBackground&&(view[i].gutterBackground.style.left=left));var align=view[i].alignable;if(align)for(var j=0;j<align.length;j++)align[j].style.left=left}cm.options.fixedGutter&&(display.gutters.style.left=comp+gutterW+"px")}}function maybeUpdateLineNumberWidth(cm){if(!cm.options.lineNumbers)return!1;var doc=cm.doc,last=lineNumberFor(cm.options,doc.first+doc.size-1),display=cm.display;if(last.length!=display.lineNumChars){var test=display.measure.appendChild(elt("div",[elt("div",last)],"CodeMirror-linenumber CodeMirror-gutter-elt")),innerW=test.firstChild.offsetWidth,padding=test.offsetWidth-innerW;return display.lineGutter.style.width="",display.lineNumInnerWidth=_Mathmax(innerW,display.lineGutter.offsetWidth-padding)+1,display.lineNumWidth=display.lineNumInnerWidth+padding,display.lineNumChars=display.lineNumInnerWidth?last.length:-1,display.lineGutter.style.width=display.lineNumWidth+"px",updateGutterSpace(cm.display),!0}return!1}function getGutters(gutters,lineNumbers){for(var result=[],sawLineNumbers=!1,i=0;i<gutters.length;i++){var name=gutters[i],style=null;if("string"!=typeof name&&(style=name.style,name=name.className),"CodeMirror-linenumbers"==name)if(!lineNumbers)continue;else sawLineNumbers=!0;result.push({className:name,style:style})}return lineNumbers&&!sawLineNumbers&&result.push({className:"CodeMirror-linenumbers",style:null}),result}function renderGutters(display){var gutters=display.gutters,specs=display.gutterSpecs;removeChildren(gutters),display.lineGutter=null;for(var i=0;i<specs.length;++i){var ref=specs[i],className=ref.className,style=ref.style,gElt=gutters.appendChild(elt("div",null,"CodeMirror-gutter "+className));style&&(gElt.style.cssText=style),"CodeMirror-linenumbers"==className&&(display.lineGutter=gElt,gElt.style.width=(display.lineNumWidth||1)+"px")}gutters.style.display=specs.length?"":"none",updateGutterSpace(display)}function updateGutters(cm){renderGutters(cm.display),regChange(cm),alignHorizontally(cm)}function Display(place,doc,input,options){var d=this;this.input=input,d.scrollbarFiller=elt("div",null,"CodeMirror-scrollbar-filler"),d.scrollbarFiller.setAttribute("cm-not-content","true"),d.gutterFiller=elt("div",null,"CodeMirror-gutter-filler"),d.gutterFiller.setAttribute("cm-not-content","true"),d.lineDiv=eltP("div",null,"CodeMirror-code"),d.selectionDiv=elt("div",null,null,"position: relative; z-index: 1"),d.cursorDiv=elt("div",null,"CodeMirror-cursors"),d.measure=elt("div",null,"CodeMirror-measure"),d.lineMeasure=elt("div",null,"CodeMirror-measure"),d.lineSpace=eltP("div",[d.measure,d.lineMeasure,d.selectionDiv,d.cursorDiv,d.lineDiv],null,"position: relative; outline: none");var lines=eltP("div",[d.lineSpace],"CodeMirror-lines");d.mover=elt("div",[lines],null,"position: relative"),d.sizer=elt("div",[d.mover],"CodeMirror-sizer"),d.sizerWidth=null,d.heightForcer=elt("div",null,null,"position: absolute; height: 50px; width: 1px;"),d.gutters=elt("div",null,"CodeMirror-gutters"),d.lineGutter=null,d.scroller=elt("div",[d.sizer,d.heightForcer,d.gutters],"CodeMirror-scroll"),d.scroller.setAttribute("tabIndex","-1"),d.wrapper=elt("div",[d.scrollbarFiller,d.gutterFiller,d.scroller],"CodeMirror"),ie&&8>ie_version&&(d.gutters.style.zIndex=-1,d.scroller.style.paddingRight=0),webkit||gecko&&mobile||(d.scroller.draggable=!0),place&&(place.appendChild?place.appendChild(d.wrapper):place(d.wrapper)),d.viewFrom=d.viewTo=doc.first,d.reportedViewFrom=d.reportedViewTo=doc.first,d.view=[],d.renderedView=null,d.externalMeasured=null,d.viewOffset=0,d.lastWrapHeight=d.lastWrapWidth=0,d.updateLineNumbers=null,d.nativeBarWidth=d.barHeight=d.barWidth=0,d.scrollbarsClipped=!1,d.lineNumWidth=d.lineNumInnerWidth=d.lineNumChars=null,d.alignWidgets=!1,d.cachedCharWidth=d.cachedTextHeight=d.cachedPaddingH=null,d.maxLine=null,d.maxLineLength=0,d.maxLineChanged=!1,d.wheelDX=d.wheelDY=d.wheelStartX=d.wheelStartY=null,d.shift=!1,d.selForContextMenu=null,d.activeTouch=null,d.gutterSpecs=getGutters(options.gutters,options.lineNumbers),renderGutters(d),input.init(d)}function wheelEventDelta(e){var dx=e.wheelDeltaX,dy=e.wheelDeltaY;return null==dx&&e.detail&&e.axis==e.HORIZONTAL_AXIS&&(dx=e.detail),null==dy&&e.detail&&e.axis==e.VERTICAL_AXIS?dy=e.detail:null==dy&&(dy=e.wheelDelta),{x:dx,y:dy}}function wheelEventPixels(e){var delta=wheelEventDelta(e);return delta.x*=wheelPixelsPerUnit,delta.y*=wheelPixelsPerUnit,delta}function onScrollWheel(cm,e){var delta=wheelEventDelta(e),dx=delta.x,dy=delta.y,display=cm.display,scroll=display.scroller,canScrollX=scroll.scrollWidth>scroll.clientWidth,canScrollY=scroll.scrollHeight>scroll.clientHeight;if(dx&&canScrollX||dy&&canScrollY){if(dy&&mac&&webkit)outer:for(var cur=e.target,view=display.view;cur!=scroll;cur=cur.parentNode)for(var i=0;i<view.length;i++)if(view[i].node==cur){cm.display.currentWheelTarget=cur;break outer}if(dx&&!gecko&&!presto&&null!=wheelPixelsPerUnit)return dy&&canScrollY&&updateScrollTop(cm,_Mathmax(0,scroll.scrollTop+dy*wheelPixelsPerUnit)),setScrollLeft(cm,_Mathmax(0,scroll.scrollLeft+dx*wheelPixelsPerUnit)),(!dy||dy&&canScrollY)&&e_preventDefault(e),void(display.wheelStartX=null);if(dy&&null!=wheelPixelsPerUnit){var pixels=dy*wheelPixelsPerUnit,top=cm.doc.scrollTop,bot=top+display.wrapper.clientHeight;0>pixels?top=_Mathmax(0,top+pixels-50):bot=_Mathmin(cm.doc.height,bot+pixels+50),updateDisplaySimple(cm,{top:top,bottom:bot})}20>wheelSamples&&(null==display.wheelStartX?(display.wheelStartX=scroll.scrollLeft,display.wheelStartY=scroll.scrollTop,display.wheelDX=dx,display.wheelDY=dy,setTimeout(function(){if(null!=display.wheelStartX){var movedX=scroll.scrollLeft-display.wheelStartX,movedY=scroll.scrollTop-display.wheelStartY,sample=movedY&&display.wheelDY&&movedY/display.wheelDY||movedX&&display.wheelDX&&movedX/display.wheelDX;display.wheelStartX=display.wheelStartY=null,sample&&(wheelPixelsPerUnit=(wheelPixelsPerUnit*wheelSamples+sample)/(wheelSamples+1),++wheelSamples)}},200)):(display.wheelDX+=dx,display.wheelDY+=dy))}}function normalizeSelection(cm,ranges,primIndex){var mayTouch=cm&&cm.options.selectionsMayTouch,prim=ranges[primIndex];ranges.sort(function(a,b){return cmp(a.from(),b.from())}),primIndex=indexOf(ranges,prim);for(var i=1;i<ranges.length;i++){var cur=ranges[i],prev=ranges[i-1],diff=cmp(prev.to(),cur.from());if(mayTouch&&!cur.empty()?0<diff:0<=diff){var from=minPos(prev.from(),cur.from()),to=maxPos(prev.to(),cur.to()),inv=prev.empty()?cur.from()==cur.head:prev.from()==prev.head;i<=primIndex&&--primIndex,ranges.splice(--i,2,new Range(inv?to:from,inv?from:to))}}return new Selection(ranges,primIndex)}function simpleSelection(anchor,head){return new Selection([new Range(anchor,head||anchor)],0)}function changeEnd(change){return change.text?Pos(change.from.line+change.text.length-1,lst(change.text).length+(1==change.text.length?change.from.ch:0)):change.to}function adjustForChange(pos,change){if(0>cmp(pos,change.from))return pos;if(0>=cmp(pos,change.to))return changeEnd(change);var line=pos.line+change.text.length-(change.to.line-change.from.line)-1,ch=pos.ch;return pos.line==change.to.line&&(ch+=changeEnd(change).ch-change.to.ch),Pos(line,ch)}function computeSelAfterChange(doc,change){for(var out=[],i=0,range;i<doc.sel.ranges.length;i++)range=doc.sel.ranges[i],out.push(new Range(adjustForChange(range.anchor,change),adjustForChange(range.head,change)));return normalizeSelection(doc.cm,out,doc.sel.primIndex)}function offsetPos(pos,old,nw){return pos.line==old.line?Pos(nw.line,pos.ch-old.ch+nw.ch):Pos(nw.line+(pos.line-old.line),pos.ch)}function computeReplacedSel(doc,changes,hint){for(var out=[],oldPrev=Pos(doc.first,0),newPrev=oldPrev,i=0;i<changes.length;i++){var change=changes[i],from=offsetPos(change.from,oldPrev,newPrev),to=offsetPos(changeEnd(change),oldPrev,newPrev);if(oldPrev=change.to,newPrev=to,"around"==hint){var range=doc.sel.ranges[i],inv=0>cmp(range.head,range.anchor);out[i]=new Range(inv?to:from,inv?from:to)}else out[i]=new Range(from,from)}return new Selection(out,doc.sel.primIndex)}function loadMode(cm){cm.doc.mode=getMode(cm.options,cm.doc.modeOption),resetModeState(cm)}function resetModeState(cm){cm.doc.iter(function(line){line.stateAfter&&(line.stateAfter=null),line.styles&&(line.styles=null)}),cm.doc.modeFrontier=cm.doc.highlightFrontier=cm.doc.first,startWorker(cm,100),cm.state.modeGen++,cm.curOp&&regChange(cm)}function isWholeLineUpdate(doc,change){return 0==change.from.ch&&0==change.to.ch&&""==lst(change.text)&&(!doc.cm||doc.cm.options.wholeLineUpdateBefore)}function updateDoc(doc,change,markedSpans,estimateHeight){function spansFor(n){return markedSpans?markedSpans[n]:null}function update(line,text,spans){updateLine(line,text,spans,estimateHeight),signalLater(line,"change",line,change)}function linesFor(start,end){for(var result=[],i=start;i<end;++i)result.push(new Line(text[i],spansFor(i),estimateHeight));return result}var from=change.from,to=change.to,text=change.text,firstLine=getLine(doc,from.line),lastLine=getLine(doc,to.line),lastText=lst(text),lastSpans=spansFor(text.length-1),nlines=to.line-from.line;if(change.full)doc.insert(0,linesFor(0,text.length)),doc.remove(text.length,doc.size-text.length);else if(isWholeLineUpdate(doc,change)){var added=linesFor(0,text.length-1);update(lastLine,lastLine.text,lastSpans),nlines&&doc.remove(from.line,nlines),added.length&&doc.insert(from.line,added)}else if(firstLine==lastLine){if(1==text.length)update(firstLine,firstLine.text.slice(0,from.ch)+lastText+firstLine.text.slice(to.ch),lastSpans);else{var added$1=linesFor(1,text.length-1);added$1.push(new Line(lastText+firstLine.text.slice(to.ch),lastSpans,estimateHeight)),update(firstLine,firstLine.text.slice(0,from.ch)+text[0],spansFor(0)),doc.insert(from.line+1,added$1)}}else if(1==text.length)update(firstLine,firstLine.text.slice(0,from.ch)+text[0]+lastLine.text.slice(to.ch),spansFor(0)),doc.remove(from.line+1,nlines);else{update(firstLine,firstLine.text.slice(0,from.ch)+text[0],spansFor(0)),update(lastLine,lastText+lastLine.text.slice(to.ch),lastSpans);var added$2=linesFor(1,text.length-1);1<nlines&&doc.remove(from.line+1,nlines-1),doc.insert(from.line+1,added$2)}signalLater(doc,"change",doc,change)}function linkedDocs(doc,f,sharedHistOnly){function propagate(doc,skip,sharedHist){if(doc.linked)for(var i=0,rel;i<doc.linked.length;++i)if(rel=doc.linked[i],rel.doc!=skip){var shared=sharedHist&&rel.sharedHist;(!sharedHistOnly||shared)&&(f(rel.doc,shared),propagate(rel.doc,doc,shared))}}propagate(doc,null,!0)}function attachDoc(cm,doc){if(doc.cm)throw new Error("This document is already in use.");cm.doc=doc,doc.cm=cm,estimateLineHeights(cm),loadMode(cm),setDirectionClass(cm),cm.options.lineWrapping||findMaxLine(cm),cm.options.mode=doc.modeOption,regChange(cm)}function setDirectionClass(cm){("rtl"==cm.doc.direction?addClass:rmClass)(cm.display.lineDiv,"CodeMirror-rtl")}function directionChanged(cm){runInOp(cm,function(){setDirectionClass(cm),regChange(cm)})}function History(startGen){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=this.lastSelOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=startGen||1}function historyChangeFromChange(doc,change){var histChange={from:copyPos(change.from),to:changeEnd(change),text:getBetween(doc,change.from,change.to)};return attachLocalSpans(doc,histChange,change.from.line,change.to.line+1),linkedDocs(doc,function(doc){return attachLocalSpans(doc,histChange,change.from.line,change.to.line+1)},!0),histChange}function clearSelectionEvents(array){for(;array.length;){var last=lst(array);if(last.ranges)array.pop();else break}}function lastChangeEvent(hist,force){return force?(clearSelectionEvents(hist.done),lst(hist.done)):hist.done.length&&!lst(hist.done).ranges?lst(hist.done):1<hist.done.length&&!hist.done[hist.done.length-2].ranges?(hist.done.pop(),lst(hist.done)):void 0}function addChangeToHistory(doc,change,selAfter,opId){var hist=doc.history;hist.undone.length=0;var time=+new Date,cur,last;if((hist.lastOp==opId||hist.lastOrigin==change.origin&&change.origin&&("+"==change.origin.charAt(0)&&hist.lastModTime>time-(doc.cm?doc.cm.options.historyEventDelay:500)||"*"==change.origin.charAt(0)))&&(cur=lastChangeEvent(hist,hist.lastOp==opId)))last=lst(cur.changes),0==cmp(change.from,change.to)&&0==cmp(change.from,last.to)?last.to=changeEnd(change):cur.changes.push(historyChangeFromChange(doc,change));else{var before=lst(hist.done);for(before&&before.ranges||pushSelectionToHistory(doc.sel,hist.done),cur={changes:[historyChangeFromChange(doc,change)],generation:hist.generation},hist.done.push(cur);hist.done.length>hist.undoDepth;)hist.done.shift(),hist.done[0].ranges||hist.done.shift()}hist.done.push(selAfter),hist.generation=++hist.maxGeneration,hist.lastModTime=hist.lastSelTime=time,hist.lastOp=hist.lastSelOp=opId,hist.lastOrigin=hist.lastSelOrigin=change.origin,last||signal(doc,"historyAdded")}function selectionEventCanBeMerged(doc,origin,prev,sel){var ch=origin.charAt(0);return"*"==ch||"+"==ch&&prev.ranges.length==sel.ranges.length&&prev.somethingSelected()==sel.somethingSelected()&&new Date-doc.history.lastSelTime<=(doc.cm?doc.cm.options.historyEventDelay:500)}function addSelectionToHistory(doc,sel,opId,options){var hist=doc.history,origin=options&&options.origin;opId==hist.lastSelOp||origin&&hist.lastSelOrigin==origin&&(hist.lastModTime==hist.lastSelTime&&hist.lastOrigin==origin||selectionEventCanBeMerged(doc,origin,lst(hist.done),sel))?hist.done[hist.done.length-1]=sel:pushSelectionToHistory(sel,hist.done),hist.lastSelTime=+new Date,hist.lastSelOrigin=origin,hist.lastSelOp=opId,options&&!1!==options.clearRedo&&clearSelectionEvents(hist.undone)}function pushSelectionToHistory(sel,dest){var top=lst(dest);top&&top.ranges&&top.equals(sel)||dest.push(sel)}function attachLocalSpans(doc,change,from,to){var existing=change["spans_"+doc.id],n=0;doc.iter(_Mathmax(doc.first,from),_Mathmin(doc.first+doc.size,to),function(line){line.markedSpans&&((existing||(existing=change["spans_"+doc.id]={}))[n]=line.markedSpans),++n})}function removeClearedSpans(spans){if(!spans)return null;for(var i=0,out;i<spans.length;++i)spans[i].marker.explicitlyCleared?out||(out=spans.slice(0,i)):out&&out.push(spans[i]);return out?out.length?out:null:spans}function getOldSpans(doc,change){var found=change["spans_"+doc.id];if(!found)return null;for(var nw=[],i=0;i<change.text.length;++i)nw.push(removeClearedSpans(found[i]));return nw}function mergeOldSpans(doc,change){var old=getOldSpans(doc,change),stretched=stretchSpansOverChange(doc,change);if(!old)return stretched;if(!stretched)return old;for(var i=0;i<old.length;++i){var oldCur=old[i],stretchCur=stretched[i];if(oldCur&&stretchCur)spans:for(var j=0,span;j<stretchCur.length;++j){span=stretchCur[j];for(var k=0;k<oldCur.length;++k)if(oldCur[k].marker==span.marker)continue spans;oldCur.push(span)}else stretchCur&&(old[i]=stretchCur)}return old}function copyHistoryArray(events,newGroup,instantiateSel){for(var copy=[],i=0,event;i<events.length;++i){if(event=events[i],event.ranges){copy.push(instantiateSel?Selection.prototype.deepCopy.call(event):event);continue}var changes=event.changes,newChanges=[];copy.push({changes:newChanges});for(var j=0;j<changes.length;++j){var change=changes[j],m=void 0;if(newChanges.push({from:change.from,to:change.to,text:change.text}),newGroup)for(var prop in change)(m=prop.match(/^spans_(\d+)$/))&&-1<indexOf(newGroup,+m[1])&&(lst(newChanges)[prop]=change[prop],delete change[prop])}}return copy}function extendRange(range,head,other,extend){if(extend){var anchor=range.anchor;if(other){var posBefore=0>cmp(head,anchor);posBefore==0>cmp(other,anchor)?posBefore!=0>cmp(head,other)&&(head=other):(anchor=head,head=other)}return new Range(anchor,head)}return new Range(other||head,head)}function extendSelection(doc,head,other,options,extend){null==extend&&(extend=doc.cm&&(doc.cm.display.shift||doc.extend)),setSelection(doc,new Selection([extendRange(doc.sel.primary(),head,other,extend)],0),options)}function extendSelections(doc,heads,options){for(var out=[],extend=doc.cm&&(doc.cm.display.shift||doc.extend),i=0;i<doc.sel.ranges.length;i++)out[i]=extendRange(doc.sel.ranges[i],heads[i],null,extend);var newSel=normalizeSelection(doc.cm,out,doc.sel.primIndex);setSelection(doc,newSel,options)}function replaceOneSelection(doc,i,range,options){var ranges=doc.sel.ranges.slice(0);ranges[i]=range,setSelection(doc,normalizeSelection(doc.cm,ranges,doc.sel.primIndex),options)}function setSimpleSelection(doc,anchor,head,options){setSelection(doc,simpleSelection(anchor,head),options)}function filterSelectionChange(doc,sel,options){var obj={ranges:sel.ranges,update:function update(ranges){this.ranges=[];for(var i=0;i<ranges.length;i++)this.ranges[i]=new Range(_clipPos(doc,ranges[i].anchor),_clipPos(doc,ranges[i].head))},origin:options&&options.origin};return signal(doc,"beforeSelectionChange",doc,obj),doc.cm&&signal(doc.cm,"beforeSelectionChange",doc.cm,obj),obj.ranges==sel.ranges?sel:normalizeSelection(doc.cm,obj.ranges,obj.ranges.length-1)}function setSelectionReplaceHistory(doc,sel,options){var done=doc.history.done,last=lst(done);last&&last.ranges?(done[done.length-1]=sel,setSelectionNoUndo(doc,sel,options)):setSelection(doc,sel,options)}function setSelection(doc,sel,options){setSelectionNoUndo(doc,sel,options),addSelectionToHistory(doc,doc.sel,doc.cm?doc.cm.curOp.id:NaN,options)}function setSelectionNoUndo(doc,sel,options){(hasHandler(doc,"beforeSelectionChange")||doc.cm&&hasHandler(doc.cm,"beforeSelectionChange"))&&(sel=filterSelectionChange(doc,sel,options));var bias=options&&options.bias||(0>cmp(sel.primary().head,doc.sel.primary().head)?-1:1);setSelectionInner(doc,skipAtomicInSelection(doc,sel,bias,!0)),!(options&&!1===options.scroll)&&doc.cm&&ensureCursorVisible(doc.cm)}function setSelectionInner(doc,sel){sel.equals(doc.sel)||(doc.sel=sel,doc.cm&&(doc.cm.curOp.updateInput=1,doc.cm.curOp.selectionChanged=!0,signalCursorActivity(doc.cm)),signalLater(doc,"cursorActivity",doc))}function reCheckSelection(doc){setSelectionInner(doc,skipAtomicInSelection(doc,doc.sel,null,!1))}function skipAtomicInSelection(doc,sel,bias,mayClear){for(var i=0,out;i<sel.ranges.length;i++){var range=sel.ranges[i],old=sel.ranges.length==doc.sel.ranges.length&&doc.sel.ranges[i],newAnchor=skipAtomic(doc,range.anchor,old&&old.anchor,bias,mayClear),newHead=skipAtomic(doc,range.head,old&&old.head,bias,mayClear);(out||newAnchor!=range.anchor||newHead!=range.head)&&(!out&&(out=sel.ranges.slice(0,i)),out[i]=new Range(newAnchor,newHead))}return out?normalizeSelection(doc.cm,out,sel.primIndex):sel}function skipAtomicInner(doc,pos,oldPos,dir,mayClear){var line=getLine(doc,pos.line);if(line.markedSpans)for(var i=0;i<line.markedSpans.length;++i){var sp=line.markedSpans[i],m=sp.marker,preventCursorLeft="selectLeft"in m?!m.selectLeft:m.inclusiveLeft,preventCursorRight="selectRight"in m?!m.selectRight:m.inclusiveRight;if((null==sp.from||(preventCursorLeft?sp.from<=pos.ch:sp.from<pos.ch))&&(null==sp.to||(preventCursorRight?sp.to>=pos.ch:sp.to>pos.ch))){if(mayClear&&(signal(m,"beforeCursorEnter"),m.explicitlyCleared))if(!line.markedSpans)break;else{--i;continue}if(!m.atomic)continue;if(oldPos){var near=m.find(0>dir?1:-1),diff=void 0;if((0>dir?preventCursorRight:preventCursorLeft)&&(near=movePos(doc,near,-dir,near&&near.line==pos.line?line:null)),near&&near.line==pos.line&&(diff=cmp(near,oldPos))&&(0>dir?0>diff:0<diff))return skipAtomicInner(doc,near,pos,dir,mayClear)}var far=m.find(0>dir?-1:1);return(0>dir?preventCursorLeft:preventCursorRight)&&(far=movePos(doc,far,dir,far.line==pos.line?line:null)),far?skipAtomicInner(doc,far,pos,dir,mayClear):null}}return pos}function skipAtomic(doc,pos,oldPos,bias,mayClear){var dir=bias||1,found=skipAtomicInner(doc,pos,oldPos,dir,mayClear)||!mayClear&&skipAtomicInner(doc,pos,oldPos,dir,!0)||skipAtomicInner(doc,pos,oldPos,-dir,mayClear)||!mayClear&&skipAtomicInner(doc,pos,oldPos,-dir,!0);return found?found:(doc.cantEdit=!0,Pos(doc.first,0))}function movePos(doc,pos,dir,line){return 0>dir&&0==pos.ch?pos.line>doc.first?_clipPos(doc,Pos(pos.line-1)):null:0<dir&&pos.ch==(line||getLine(doc,pos.line)).text.length?pos.line<doc.first+doc.size-1?Pos(pos.line+1,0):null:new Pos(pos.line,pos.ch+dir)}function selectAll(cm){cm.setSelection(Pos(cm.firstLine(),0),Pos(cm.lastLine()),sel_dontScroll)}function filterChange(doc,change,update){var obj={canceled:!1,from:change.from,to:change.to,text:change.text,origin:change.origin,cancel:function cancel(){return obj.canceled=!0}};return update&&(obj.update=function(from,to,text,origin){from&&(obj.from=_clipPos(doc,from)),to&&(obj.to=_clipPos(doc,to)),text&&(obj.text=text),void 0!==origin&&(obj.origin=origin)}),signal(doc,"beforeChange",doc,obj),doc.cm&&signal(doc.cm,"beforeChange",doc.cm,obj),obj.canceled?(doc.cm&&(doc.cm.curOp.updateInput=2),null):{from:obj.from,to:obj.to,text:obj.text,origin:obj.origin}}function makeChange(doc,change,ignoreReadOnly){if(doc.cm){if(!doc.cm.curOp)return operation(doc.cm,makeChange)(doc,change,ignoreReadOnly);if(doc.cm.state.suppressEdits)return}if(!((hasHandler(doc,"beforeChange")||doc.cm&&hasHandler(doc.cm,"beforeChange"))&&(change=filterChange(doc,change,!0),!change))){var split=sawReadOnlySpans&&!ignoreReadOnly&&removeReadOnlyRanges(doc,change.from,change.to);if(split)for(var i=split.length-1;0<=i;--i)makeChangeInner(doc,{from:split[i].from,to:split[i].to,text:i?[""]:change.text,origin:change.origin});else makeChangeInner(doc,change)}}function makeChangeInner(doc,change){if(1!=change.text.length||""!=change.text[0]||0!=cmp(change.from,change.to)){var selAfter=computeSelAfterChange(doc,change);addChangeToHistory(doc,change,selAfter,doc.cm?doc.cm.curOp.id:NaN),makeChangeSingleDoc(doc,change,selAfter,stretchSpansOverChange(doc,change));var rebased=[];linkedDocs(doc,function(doc,sharedHist){sharedHist||-1!=indexOf(rebased,doc.history)||(rebaseHist(doc.history,change),rebased.push(doc.history)),makeChangeSingleDoc(doc,change,null,stretchSpansOverChange(doc,change))})}}function makeChangeFromHistory(doc,type,allowSelectionOnly){var suppress=doc.cm&&doc.cm.state.suppressEdits;if(!suppress||allowSelectionOnly){for(var hist=doc.history,selAfter=doc.sel,source="undo"==type?hist.done:hist.undone,dest="undo"==type?hist.undone:hist.done,i=0,event;i<source.length&&(event=source[i],allowSelectionOnly?!event.ranges||event.equals(doc.sel):!!event.ranges);i++);if(i!=source.length){for(hist.lastOrigin=hist.lastSelOrigin=null;;)if(event=source.pop(),event.ranges){if(pushSelectionToHistory(event,dest),allowSelectionOnly&&!event.equals(doc.sel))return void setSelection(doc,event,{clearRedo:!1});selAfter=event}else{if(suppress)return void source.push(event);break}var antiChanges=[];pushSelectionToHistory(selAfter,dest),dest.push({changes:antiChanges,generation:hist.generation}),hist.generation=event.generation||++hist.maxGeneration;for(var filter=hasHandler(doc,"beforeChange")||doc.cm&&hasHandler(doc.cm,"beforeChange"),loop=function(i){var change=event.changes[i];if(change.origin=type,filter&&!filterChange(doc,change,!1))return source.length=0,{};antiChanges.push(historyChangeFromChange(doc,change));var after=i?computeSelAfterChange(doc,change):lst(source);makeChangeSingleDoc(doc,change,after,mergeOldSpans(doc,change)),!i&&doc.cm&&doc.cm.scrollIntoView({from:change.from,to:changeEnd(change)});var rebased=[];linkedDocs(doc,function(doc,sharedHist){sharedHist||-1!=indexOf(rebased,doc.history)||(rebaseHist(doc.history,change),rebased.push(doc.history)),makeChangeSingleDoc(doc,change,null,mergeOldSpans(doc,change))})},i$1=event.changes.length-1,returned;0<=i$1;--i$1)if(returned=loop(i$1),returned)return returned.v}}}function shiftDoc(doc,distance){if(0!=distance&&(doc.first+=distance,doc.sel=new Selection(map(doc.sel.ranges,function(range){return new Range(Pos(range.anchor.line+distance,range.anchor.ch),Pos(range.head.line+distance,range.head.ch))}),doc.sel.primIndex),doc.cm)){regChange(doc.cm,doc.first,doc.first-distance,distance);for(var d=doc.cm.display,l=d.viewFrom;l<d.viewTo;l++)regLineChange(doc.cm,l,"gutter")}}function makeChangeSingleDoc(doc,change,selAfter,spans){if(doc.cm&&!doc.cm.curOp)return operation(doc.cm,makeChangeSingleDoc)(doc,change,selAfter,spans);if(change.to.line<doc.first)return void shiftDoc(doc,change.text.length-1-(change.to.line-change.from.line));if(!(change.from.line>doc.lastLine())){if(change.from.line<doc.first){var shift=change.text.length-1-(doc.first-change.from.line);shiftDoc(doc,shift),change={from:Pos(doc.first,0),to:Pos(change.to.line+shift,change.to.ch),text:[lst(change.text)],origin:change.origin}}var last=doc.lastLine();change.to.line>last&&(change={from:change.from,to:Pos(last,getLine(doc,last).text.length),text:[change.text[0]],origin:change.origin}),change.removed=getBetween(doc,change.from,change.to),selAfter||(selAfter=computeSelAfterChange(doc,change)),doc.cm?makeChangeSingleDocInEditor(doc.cm,change,spans):updateDoc(doc,change,spans),setSelectionNoUndo(doc,selAfter,sel_dontScroll),doc.cantEdit&&skipAtomic(doc,Pos(doc.firstLine(),0))&&(doc.cantEdit=!1)}}function makeChangeSingleDocInEditor(cm,change,spans){var doc=cm.doc,display=cm.display,from=change.from,to=change.to,recomputeMaxLength=!1,checkWidthStart=from.line;cm.options.lineWrapping||(checkWidthStart=lineNo(visualLine(getLine(doc,from.line))),doc.iter(checkWidthStart,to.line+1,function(line){if(line==display.maxLine)return recomputeMaxLength=!0,!0})),-1<doc.sel.contains(change.from,change.to)&&signalCursorActivity(cm),updateDoc(doc,change,spans,estimateHeight(cm)),cm.options.lineWrapping||(doc.iter(checkWidthStart,from.line+change.text.length,function(line){var len=lineLength(line);len>display.maxLineLength&&(display.maxLine=line,display.maxLineLength=len,display.maxLineChanged=!0,recomputeMaxLength=!1)}),recomputeMaxLength&&(cm.curOp.updateMaxLine=!0)),retreatFrontier(doc,from.line),startWorker(cm,400);var lendiff=change.text.length-(to.line-from.line)-1;change.full?regChange(cm):from.line!=to.line||1!=change.text.length||isWholeLineUpdate(cm.doc,change)?regChange(cm,from.line,to.line+1,lendiff):regLineChange(cm,from.line,"text");var changesHandler=hasHandler(cm,"changes"),changeHandler=hasHandler(cm,"change");if(changeHandler||changesHandler){var obj={from:from,to:to,text:change.text,removed:change.removed,origin:change.origin};changeHandler&&signalLater(cm,"change",cm,obj),changesHandler&&(cm.curOp.changeObjs||(cm.curOp.changeObjs=[])).push(obj)}cm.display.selForContextMenu=null}function _replaceRange(doc,code,from,to,origin){var assign;to||(to=from),0>cmp(to,from)&&(assign=[to,from],from=assign[0],to=assign[1]),"string"==typeof code&&(code=doc.splitLines(code)),makeChange(doc,{from:from,to:to,text:code,origin:origin})}function rebaseHistSelSingle(pos,from,to,diff){to<pos.line?pos.line+=diff:from<pos.line&&(pos.line=from,pos.ch=0)}function rebaseHistArray(array,from,to,diff){for(var i=0;i<array.length;++i){var sub=array[i],ok=!0;if(sub.ranges){sub.copied||(sub=array[i]=sub.deepCopy(),sub.copied=!0);for(var j=0;j<sub.ranges.length;j++)rebaseHistSelSingle(sub.ranges[j].anchor,from,to,diff),rebaseHistSelSingle(sub.ranges[j].head,from,to,diff);continue}for(var j$1=0,cur;j$1<sub.changes.length;++j$1)if(cur=sub.changes[j$1],to<cur.from.line)cur.from=Pos(cur.from.line+diff,cur.from.ch),cur.to=Pos(cur.to.line+diff,cur.to.ch);else if(from<=cur.to.line){ok=!1;break}ok||(array.splice(0,i+1),i=0)}}function rebaseHist(hist,change){var from=change.from.line,to=change.to.line,diff=change.text.length-(to-from)-1;rebaseHistArray(hist.done,from,to,diff),rebaseHistArray(hist.undone,from,to,diff)}function changeLine(doc,handle,changeType,op){var no=handle,line=handle;return("number"==typeof handle?line=getLine(doc,clipLine(doc,handle)):no=lineNo(handle),null==no)?null:(op(line,no)&&doc.cm&&regLineChange(doc.cm,no,changeType),line)}function LeafChunk(lines){this.lines=lines,this.parent=null;for(var height=0,i=0;i<lines.length;++i)lines[i].parent=this,height+=lines[i].height;this.height=height}function BranchChunk(children){this.children=children;for(var size=0,height=0,i=0,ch;i<children.length;++i)ch=children[i],size+=ch.chunkSize(),height+=ch.height,ch.parent=this;this.size=size,this.height=height,this.parent=null}function adjustScrollWhenAboveVisible(cm,line,diff){_heightAtLine(line)<(cm.curOp&&cm.curOp.scrollTop||cm.doc.scrollTop)&&addToScrollTop(cm,diff)}function addLineWidget(doc,handle,node,options){var widget=new LineWidget(doc,node,options),cm=doc.cm;return cm&&widget.noHScroll&&(cm.display.alignWidgets=!0),changeLine(doc,handle,"widget",function(line){var widgets=line.widgets||(line.widgets=[]);if(null==widget.insertAt?widgets.push(widget):widgets.splice(_Mathmin(widgets.length-1,_Mathmax(0,widget.insertAt)),0,widget),widget.line=line,cm&&!lineIsHidden(doc,line)){var aboveVisible=_heightAtLine(line)<doc.scrollTop;updateLineHeight(line,line.height+widgetHeight(widget)),aboveVisible&&addToScrollTop(cm,widget.height),cm.curOp.forceUpdate=!0}return!0}),cm&&signalLater(cm,"lineWidgetAdded",cm,widget,"number"==typeof handle?handle:lineNo(handle)),widget}function _markText(doc,from,to,options,type){if(options&&options.shared)return markTextShared(doc,from,to,options,type);if(doc.cm&&!doc.cm.curOp)return operation(doc.cm,_markText)(doc,from,to,options,type);var marker=new TextMarker(doc,type),diff=cmp(from,to);if(options&&copyObj(options,marker,!1),0<diff||0==diff&&!1!==marker.clearWhenEmpty)return marker;if(marker.replacedWith&&(marker.collapsed=!0,marker.widgetNode=eltP("span",[marker.replacedWith],"CodeMirror-widget"),!options.handleMouseEvents&&marker.widgetNode.setAttribute("cm-ignore-events","true"),options.insertLeft&&(marker.widgetNode.insertLeft=!0)),marker.collapsed){if(conflictingCollapsedRange(doc,from.line,from,to,marker)||from.line!=to.line&&conflictingCollapsedRange(doc,to.line,from,to,marker))throw new Error("Inserting collapsed marker partially overlapping an existing one");seeCollapsedSpans()}marker.addToHistory&&addChangeToHistory(doc,{from:from,to:to,origin:"markText"},doc.sel,NaN);var curLine=from.line,cm=doc.cm,updateMaxLine;if(doc.iter(curLine,to.line+1,function(line){cm&&marker.collapsed&&!cm.options.lineWrapping&&visualLine(line)==cm.display.maxLine&&(updateMaxLine=!0),marker.collapsed&&curLine!=from.line&&updateLineHeight(line,0),addMarkedSpan(line,new MarkedSpan(marker,curLine==from.line?from.ch:null,curLine==to.line?to.ch:null)),++curLine}),marker.collapsed&&doc.iter(from.line,to.line+1,function(line){lineIsHidden(doc,line)&&updateLineHeight(line,0)}),marker.clearOnEnter&&on(marker,"beforeCursorEnter",function(){return marker.clear()}),marker.readOnly&&(seeReadOnlySpans(),(doc.history.done.length||doc.history.undone.length)&&doc.clearHistory()),marker.collapsed&&(marker.id=++nextMarkerId,marker.atomic=!0),cm){if(updateMaxLine&&(cm.curOp.updateMaxLine=!0),marker.collapsed)regChange(cm,from.line,to.line+1);else if(marker.className||marker.startStyle||marker.endStyle||marker.css||marker.attributes||marker.title)for(var i=from.line;i<=to.line;i++)regLineChange(cm,i,"text");marker.atomic&&reCheckSelection(cm.doc),signalLater(cm,"markerAdded",cm,marker)}return marker}function markTextShared(doc,from,to,options,type){options=copyObj(options),options.shared=!1;var markers=[_markText(doc,from,to,options,type)],primary=markers[0],widget=options.widgetNode;return linkedDocs(doc,function(doc){widget&&(options.widgetNode=widget.cloneNode(!0)),markers.push(_markText(doc,_clipPos(doc,from),_clipPos(doc,to),options,type));for(var i=0;i<doc.linked.length;++i)if(doc.linked[i].isParent)return;primary=lst(markers)}),new SharedTextMarker(markers,primary)}function findSharedMarkers(doc){return doc.findMarks(Pos(doc.first,0),doc.clipPos(Pos(doc.lastLine())),function(m){return m.parent})}function copySharedMarkers(doc,markers){for(var i=0;i<markers.length;i++){var marker=markers[i],pos=marker.find(),mFrom=doc.clipPos(pos.from),mTo=doc.clipPos(pos.to);if(cmp(mFrom,mTo)){var subMark=_markText(doc,mFrom,mTo,marker.primary,marker.primary.type);marker.markers.push(subMark),subMark.parent=marker}}}function detachSharedMarkers(markers){for(var loop=function(i){var marker=markers[i],linked=[marker.primary.doc];linkedDocs(marker.primary.doc,function(d){return linked.push(d)});for(var j=0,subMarker;j<marker.markers.length;j++)subMarker=marker.markers[j],-1==indexOf(linked,subMarker.doc)&&(subMarker.parent=null,marker.markers.splice(j--,1))},i=0;i<markers.length;i++)loop(i)}function onDrop(e){var cm=this;if(clearDragCursor(cm),!(signalDOMEvent(cm,e)||eventInWidget(cm.display,e))){e_preventDefault(e),ie&&(lastDrop=+new Date);var pos=posFromMouse(cm,e,!0),files=e.dataTransfer.files;if(pos&&!cm.isReadOnly())if(files&&files.length&&window.FileReader&&window.File)for(var n=files.length,text=Array(n),read=0,markAsReadAndPasteIfAllFilesAreRead=function(){++read==n&&operation(cm,function(){pos=_clipPos(cm.doc,pos);var change={from:pos,to:pos,text:cm.doc.splitLines(text.filter(function(t){return null!=t}).join(cm.doc.lineSeparator())),origin:"paste"};makeChange(cm.doc,change),setSelectionReplaceHistory(cm.doc,simpleSelection(_clipPos(cm.doc,pos),_clipPos(cm.doc,changeEnd(change))))})()},readTextFromFile=function(file,i){if(cm.options.allowDropFileTypes&&-1==indexOf(cm.options.allowDropFileTypes,file.type))return void markAsReadAndPasteIfAllFilesAreRead();var reader=new FileReader;reader.onerror=function(){return markAsReadAndPasteIfAllFilesAreRead()},reader.onload=function(){var content=reader.result;return /[\x00-\x08\x0e-\x1f]{2}/.test(content)?void markAsReadAndPasteIfAllFilesAreRead():void(text[i]=content,markAsReadAndPasteIfAllFilesAreRead())},reader.readAsText(file)},i=0;i<files.length;i++)readTextFromFile(files[i],i);else{if(cm.state.draggingText&&-1<cm.doc.sel.contains(pos))return cm.state.draggingText(e),void setTimeout(function(){return cm.display.input.focus()},20);try{var text$1=e.dataTransfer.getData("Text");if(text$1){var selected;if(cm.state.draggingText&&!cm.state.draggingText.copy&&(selected=cm.listSelections()),setSelectionNoUndo(cm.doc,simpleSelection(pos,pos)),selected)for(var i$1=0;i$1<selected.length;++i$1)_replaceRange(cm.doc,"",selected[i$1].anchor,selected[i$1].head,"drag");cm.replaceSelection(text$1,"around","paste"),cm.display.input.focus()}}catch(e$1){}}}}function onDragStart(cm,e){if(ie&&(!cm.state.draggingText||100>+new Date-lastDrop))return void e_stop(e);if(!(signalDOMEvent(cm,e)||eventInWidget(cm.display,e))&&(e.dataTransfer.setData("Text",cm.getSelection()),e.dataTransfer.effectAllowed="copyMove",e.dataTransfer.setDragImage&&!safari)){var img=elt("img",null,null,"position: fixed; left: 0; top: 0;");img.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",presto&&(img.width=img.height=1,cm.display.wrapper.appendChild(img),img._top=img.offsetTop),e.dataTransfer.setDragImage(img,0,0),presto&&img.parentNode.removeChild(img)}}function onDragOver(cm,e){var pos=posFromMouse(cm,e);if(pos){var frag=document.createDocumentFragment();drawSelectionCursor(cm,pos,frag),cm.display.dragCursor||(cm.display.dragCursor=elt("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),cm.display.lineSpace.insertBefore(cm.display.dragCursor,cm.display.cursorDiv)),removeChildrenAndAdd(cm.display.dragCursor,frag)}}function clearDragCursor(cm){cm.display.dragCursor&&(cm.display.lineSpace.removeChild(cm.display.dragCursor),cm.display.dragCursor=null)}function forEachCodeMirror(f){if(document.getElementsByClassName){for(var byClass=document.getElementsByClassName("CodeMirror"),editors=[],i=0,cm;i<byClass.length;i++)cm=byClass[i].CodeMirror,cm&&editors.push(cm);editors.length&&editors[0].operation(function(){for(var i=0;i<editors.length;i++)f(editors[i])})}}function ensureGlobalHandlers(){globalsRegistered||(registerGlobalHandlers(),globalsRegistered=!0)}function registerGlobalHandlers(){var resizeTimer;on(window,"resize",function(){null==resizeTimer&&(resizeTimer=setTimeout(function(){resizeTimer=null,forEachCodeMirror(onResize)},100))}),on(window,"blur",function(){return forEachCodeMirror(onBlur)})}function onResize(cm){var d=cm.display;d.cachedCharWidth=d.cachedTextHeight=d.cachedPaddingH=null,d.scrollbarsClipped=!1,cm.setSize()}function normalizeKeyName(name){var parts=name.split(/-(?!$)/);name=parts[parts.length-1];for(var i=0,alt,ctrl,shift,cmd,mod;i<parts.length-1;i++)if(mod=parts[i],/^(cmd|meta|m)$/i.test(mod))cmd=!0;else if(/^a(lt)?$/i.test(mod))alt=!0;else if(/^(c|ctrl|control)$/i.test(mod))ctrl=!0;else if(/^s(hift)?$/i.test(mod))shift=!0;else throw new Error("Unrecognized modifier name: "+mod);return alt&&(name="Alt-"+name),ctrl&&(name="Ctrl-"+name),cmd&&(name="Cmd-"+name),shift&&(name="Shift-"+name),name}function normalizeKeyMap(keymap){var copy={};for(var keyname in keymap)if(keymap.hasOwnProperty(keyname)){var value=keymap[keyname];if(/^(name|fallthrough|(de|at)tach)$/.test(keyname))continue;if("..."==value){delete keymap[keyname];continue}for(var keys=map(keyname.split(" "),normalizeKeyName),i=0;i<keys.length;i++){var val=void 0,name=void 0;i==keys.length-1?(name=keys.join(" "),val=value):(name=keys.slice(0,i+1).join(" "),val="...");var prev=copy[name];if(!prev)copy[name]=val;else if(prev!=val)throw new Error("Inconsistent bindings for "+name)}delete keymap[keyname]}for(var prop in copy)keymap[prop]=copy[prop];return keymap}function lookupKey(key,map,handle,context){map=getKeyMap(map);var found=map.call?map.call(key,context):map[key];if(!1===found)return"nothing";if("..."===found)return"multi";if(null!=found&&handle(found))return"handled";if(map.fallthrough){if("[object Array]"!=Object.prototype.toString.call(map.fallthrough))return lookupKey(key,map.fallthrough,handle,context);for(var i=0,result;i<map.fallthrough.length;i++)if(result=lookupKey(key,map.fallthrough[i],handle,context),result)return result}}function isModifierKey(value){var name="string"==typeof value?value:keyNames[value.keyCode];return"Ctrl"==name||"Alt"==name||"Shift"==name||"Mod"==name}function addModifierNames(name,event,noShift){var base=name;return event.altKey&&"Alt"!=base&&(name="Alt-"+name),(flipCtrlCmd?event.metaKey:event.ctrlKey)&&"Ctrl"!=base&&(name="Ctrl-"+name),(flipCtrlCmd?event.ctrlKey:event.metaKey)&&"Cmd"!=base&&(name="Cmd-"+name),!noShift&&event.shiftKey&&"Shift"!=base&&(name="Shift-"+name),name}function keyName(event,noShift){if(presto&&34==event.keyCode&&event.char)return!1;var name=keyNames[event.keyCode];return!(null==name||event.altGraphKey)&&(3==event.keyCode&&event.code&&(name=event.code),addModifierNames(name,event,noShift))}function getKeyMap(val){return"string"==typeof val?keyMap[val]:val}function deleteNearSelection(cm,compute){for(var ranges=cm.doc.sel.ranges,kill=[],i=0,toKill;i<ranges.length;i++){for(toKill=compute(ranges[i]);kill.length&&0>=cmp(toKill.from,lst(kill).to);){var replaced=kill.pop();if(0>cmp(replaced.from,toKill.from)){toKill.from=replaced.from;break}}kill.push(toKill)}runInOp(cm,function(){for(var i=kill.length-1;0<=i;i--)_replaceRange(cm.doc,"",kill[i].from,kill[i].to,"+delete");ensureCursorVisible(cm)})}function moveCharLogically(line,ch,dir){var target=skipExtendingChars(line.text,ch+dir,dir);return 0>target||target>line.text.length?null:target}function moveLogically(line,start,dir){var ch=moveCharLogically(line,start.ch,dir);return null==ch?null:new Pos(start.line,ch,0>dir?"after":"before")}function endOfLine(visually,cm,lineObj,lineNo,dir){if(visually){"rtl"==cm.doc.direction&&(dir=-dir);var order=getOrder(lineObj,cm.doc.direction);if(order){var part=0>dir?lst(order):order[0],moveInStorageOrder=0>dir==(1==part.level),sticky=moveInStorageOrder?"after":"before",ch;if(0<part.level||"rtl"==cm.doc.direction){var prep=prepareMeasureForLine(cm,lineObj);ch=0>dir?lineObj.text.length-1:0;var targetTop=measureCharPrepared(cm,prep,ch).top;ch=findFirst(function(ch){return measureCharPrepared(cm,prep,ch).top==targetTop},0>dir==(1==part.level)?part.from:part.to-1,ch),"before"==sticky&&(ch=moveCharLogically(lineObj,ch,1))}else ch=0>dir?part.to:part.from;return new Pos(lineNo,ch,sticky)}}return new Pos(lineNo,0>dir?lineObj.text.length:0,0>dir?"before":"after")}function moveVisually(cm,line,start,dir){var bidi=getOrder(line,cm.doc.direction);if(!bidi)return moveLogically(line,start,dir);start.ch>=line.text.length?(start.ch=line.text.length,start.sticky="before"):0>=start.ch&&(start.ch=0,start.sticky="after");var partPos=getBidiPartAt(bidi,start.ch,start.sticky),part=bidi[partPos];if("ltr"==cm.doc.direction&&0==part.level%2&&(0<dir?part.to>start.ch:part.from<start.ch))return moveLogically(line,start,dir);var mv=function(pos,dir){return moveCharLogically(line,pos instanceof Pos?pos.ch:pos,dir)},getWrappedLineExtent=function(ch){return cm.options.lineWrapping?(prep=prep||prepareMeasureForLine(cm,line),wrappedLineExtentChar(cm,line,prep,ch)):{begin:0,end:line.text.length}},wrappedLineExtent=getWrappedLineExtent("before"==start.sticky?mv(start,-1):start.ch),prep;if("rtl"==cm.doc.direction||1==part.level){var moveInStorageOrder=1==part.level==0>dir,ch=mv(start,moveInStorageOrder?1:-1);if(null!=ch&&(moveInStorageOrder?ch<=part.to&&ch<=wrappedLineExtent.end:ch>=part.from&&ch>=wrappedLineExtent.begin)){var sticky=moveInStorageOrder?"before":"after";return new Pos(start.line,ch,sticky)}}var searchInVisualLine=function(partPos,dir,wrappedLineExtent){for(var getRes=function(ch,moveInStorageOrder){return moveInStorageOrder?new Pos(start.line,mv(ch,1),"before"):new Pos(start.line,ch,"after")};0<=partPos&&partPos<bidi.length;partPos+=dir){var part=bidi[partPos],moveInStorageOrder=0<dir==(1!=part.level),ch=moveInStorageOrder?wrappedLineExtent.begin:mv(wrappedLineExtent.end,-1);if(part.from<=ch&&ch<part.to)return getRes(ch,moveInStorageOrder);if(ch=moveInStorageOrder?part.from:mv(part.to,-1),wrappedLineExtent.begin<=ch&&ch<wrappedLineExtent.end)return getRes(ch,moveInStorageOrder)}},res=searchInVisualLine(partPos+dir,dir,wrappedLineExtent);if(res)return res;var nextCh=0<dir?wrappedLineExtent.end:mv(wrappedLineExtent.begin,-1);return null!=nextCh&&!(0<dir&&nextCh==line.text.length)&&(res=searchInVisualLine(0<dir?0:bidi.length-1,dir,getWrappedLineExtent(nextCh)),res)?res:null}function lineStart(cm,lineN){var line=getLine(cm.doc,lineN),visual=visualLine(line);return visual!=line&&(lineN=lineNo(visual)),endOfLine(!0,cm,visual,lineN,1)}function lineEnd(cm,lineN){var line=getLine(cm.doc,lineN),visual=visualLineEnd(line);return visual!=line&&(lineN=lineNo(visual)),endOfLine(!0,cm,line,lineN,-1)}function lineStartSmart(cm,pos){var start=lineStart(cm,pos.line),line=getLine(cm.doc,start.line),order=getOrder(line,cm.doc.direction);if(!order||0==order[0].level){var firstNonWS=_Mathmax(start.ch,line.text.search(/\S/)),inWS=pos.line==start.line&&pos.ch<=firstNonWS&&pos.ch;return Pos(start.line,inWS?0:firstNonWS,start.sticky)}return start}function doHandleBinding(cm,bound,dropShift){if("string"==typeof bound&&(bound=commands[bound],!bound))return!1;cm.display.input.ensurePolled();var prevShift=cm.display.shift,done=!1;try{cm.isReadOnly()&&(cm.state.suppressEdits=!0),dropShift&&(cm.display.shift=!1),done=bound(cm)!=Pass}finally{cm.display.shift=prevShift,cm.state.suppressEdits=!1}return done}function lookupKeyForEditor(cm,name,handle){for(var i=0,result;i<cm.state.keyMaps.length;i++)if(result=lookupKey(name,cm.state.keyMaps[i],handle,cm),result)return result;return cm.options.extraKeys&&lookupKey(name,cm.options.extraKeys,handle,cm)||lookupKey(name,cm.options.keyMap,handle,cm)}function dispatchKey(cm,name,e,handle){var seq=cm.state.keySeq;if(seq){if(isModifierKey(name))return"handled";if(/\'$/.test(name)?cm.state.keySeq=null:stopSeq.set(50,function(){cm.state.keySeq==seq&&(cm.state.keySeq=null,cm.display.input.reset())}),dispatchKeyInner(cm,seq+" "+name,e,handle))return!0}return dispatchKeyInner(cm,name,e,handle)}function dispatchKeyInner(cm,name,e,handle){var result=lookupKeyForEditor(cm,name,handle);return"multi"==result&&(cm.state.keySeq=name),"handled"==result&&signalLater(cm,"keyHandled",cm,name,e),("handled"==result||"multi"==result)&&(e_preventDefault(e),restartBlink(cm)),!!result}function handleKeyBinding(cm,e){var name=keyName(e,!0);return!!name&&(e.shiftKey&&!cm.state.keySeq?dispatchKey(cm,"Shift-"+name,e,function(b){return doHandleBinding(cm,b,!0)})||dispatchKey(cm,name,e,function(b){if("string"==typeof b?/^go[A-Z]/.test(b):b.motion)return doHandleBinding(cm,b)}):dispatchKey(cm,name,e,function(b){return doHandleBinding(cm,b)}))}function handleCharBinding(cm,e,ch){return dispatchKey(cm,"'"+ch+"'",e,function(b){return doHandleBinding(cm,b,!0)})}function onKeyDown(e){var cm=this;if(!(e.target&&e.target!=cm.display.input.getField())&&(cm.curOp.focus=activeElt(),!signalDOMEvent(cm,e))){ie&&11>ie_version&&27==e.keyCode&&(e.returnValue=!1);var code=e.keyCode;cm.display.shift=16==code||e.shiftKey;var handled=handleKeyBinding(cm,e);presto&&(lastStoppedKey=handled?code:null,!handled&&88==code&&!hasCopyEvent&&(mac?e.metaKey:e.ctrlKey)&&cm.replaceSelection("",null,"cut")),gecko&&!mac&&!handled&&46==code&&e.shiftKey&&!e.ctrlKey&&document.execCommand&&document.execCommand("cut"),18!=code||/\bCodeMirror-crosshair\b/.test(cm.display.lineDiv.className)||showCrossHair(cm)}}function showCrossHair(cm){function up(e){18!=e.keyCode&&e.altKey||(rmClass(lineDiv,"CodeMirror-crosshair"),off(document,"keyup",up),off(document,"mouseover",up))}var lineDiv=cm.display.lineDiv;addClass(lineDiv,"CodeMirror-crosshair"),on(document,"keyup",up),on(document,"mouseover",up)}function onKeyUp(e){16==e.keyCode&&(this.doc.sel.shift=!1),signalDOMEvent(this,e)}function onKeyPress(e){var cm=this;if(!(e.target&&e.target!=cm.display.input.getField())&&!(eventInWidget(cm.display,e)||signalDOMEvent(cm,e)||e.ctrlKey&&!e.altKey||mac&&e.metaKey)){var keyCode=e.keyCode,charCode=e.charCode;if(presto&&keyCode==lastStoppedKey)return lastStoppedKey=null,void e_preventDefault(e);if(!(presto&&(!e.which||10>e.which)&&handleKeyBinding(cm,e))){var ch=_StringfromCharCode(null==charCode?keyCode:charCode);"\b"==ch||handleCharBinding(cm,e,ch)||cm.display.input.onKeyPress(e)}}}function clickRepeat(pos,button){var now=+new Date;return lastDoubleClick&&lastDoubleClick.compare(now,pos,button)?(lastClick=lastDoubleClick=null,"triple"):lastClick&&lastClick.compare(now,pos,button)?(lastDoubleClick=new PastClick(now,pos,button),lastClick=null,"double"):(lastClick=new PastClick(now,pos,button),lastDoubleClick=null,"single")}function onMouseDown(e){var cm=this,display=cm.display;if(!(signalDOMEvent(cm,e)||display.activeTouch&&display.input.supportsTouch())){if(display.input.ensurePolled(),display.shift=e.shiftKey,eventInWidget(display,e))return void(webkit||(display.scroller.draggable=!1,setTimeout(function(){return display.scroller.draggable=!0},100)));if(!clickInGutter(cm,e)){var pos=posFromMouse(cm,e),button=e_button(e),repeat=pos?clickRepeat(pos,button):"single";window.focus(),1==button&&cm.state.selectingText&&cm.state.selectingText(e),pos&&handleMappedButton(cm,button,pos,repeat,e)||(1==button?pos?leftButtonDown(cm,pos,repeat,e):e_target(e)==display.scroller&&e_preventDefault(e):2==button?(pos&&extendSelection(cm.doc,pos),setTimeout(function(){return display.input.focus()},20)):3==button&&(captureRightClick?cm.display.input.onContextMenu(e):delayBlurEvent(cm)))}}}function handleMappedButton(cm,button,pos,repeat,event){var name="Click";return"double"==repeat?name="Double"+name:"triple"==repeat&&(name="Triple"+name),name=(1==button?"Left":2==button?"Middle":"Right")+name,dispatchKey(cm,addModifierNames(name,event),event,function(bound){if("string"==typeof bound&&(bound=commands[bound]),!bound)return!1;var done=!1;try{cm.isReadOnly()&&(cm.state.suppressEdits=!0),done=bound(cm,pos)!=Pass}finally{cm.state.suppressEdits=!1}return done})}function configureMouse(cm,repeat,event){var option=cm.getOption("configureMouse"),value=option?option(cm,repeat,event):{};if(null==value.unit){var rect=chromeOS?event.shiftKey&&event.metaKey:event.altKey;value.unit=rect?"rectangle":"single"==repeat?"char":"double"==repeat?"word":"line"}return(null==value.extend||cm.doc.extend)&&(value.extend=cm.doc.extend||event.shiftKey),null==value.addNew&&(value.addNew=mac?event.metaKey:event.ctrlKey),null==value.moveOnDrag&&(value.moveOnDrag=mac?!event.altKey:!event.ctrlKey),value}function leftButtonDown(cm,pos,repeat,event){ie?setTimeout(bind(ensureFocus,cm),0):cm.curOp.focus=activeElt();var behavior=configureMouse(cm,repeat,event),sel=cm.doc.sel,contained;cm.options.dragDrop&&dragAndDrop&&!cm.isReadOnly()&&"single"==repeat&&-1<(contained=sel.contains(pos))&&(0>cmp((contained=sel.ranges[contained]).from(),pos)||0<pos.xRel)&&(0<cmp(contained.to(),pos)||0>pos.xRel)?leftButtonStartDrag(cm,event,pos,behavior):leftButtonSelect(cm,event,pos,behavior)}function leftButtonStartDrag(cm,event,pos,behavior){var display=cm.display,moved=!1,dragEnd=operation(cm,function(e){webkit&&(display.scroller.draggable=!1),cm.state.draggingText=!1,off(display.wrapper.ownerDocument,"mouseup",dragEnd),off(display.wrapper.ownerDocument,"mousemove",mouseMove),off(display.scroller,"dragstart",dragStart),off(display.scroller,"drop",dragEnd),moved||(e_preventDefault(e),!behavior.addNew&&extendSelection(cm.doc,pos,null,null,behavior.extend),webkit&&!safari||ie&&9==ie_version?setTimeout(function(){display.wrapper.ownerDocument.body.focus({preventScroll:!0}),display.input.focus()},20):display.input.focus())}),mouseMove=function(e2){moved=moved||10<=_Mathabs(event.clientX-e2.clientX)+_Mathabs(event.clientY-e2.clientY)},dragStart=function(){return moved=!0};webkit&&(display.scroller.draggable=!0),cm.state.draggingText=dragEnd,dragEnd.copy=!behavior.moveOnDrag,display.scroller.dragDrop&&display.scroller.dragDrop(),on(display.wrapper.ownerDocument,"mouseup",dragEnd),on(display.wrapper.ownerDocument,"mousemove",mouseMove),on(display.scroller,"dragstart",dragStart),on(display.scroller,"drop",dragEnd),delayBlurEvent(cm),setTimeout(function(){return display.input.focus()},20)}function rangeForUnit(cm,pos,unit){if("char"==unit)return new Range(pos,pos);if("word"==unit)return cm.findWordAt(pos);if("line"==unit)return new Range(Pos(pos.line,0),_clipPos(cm.doc,Pos(pos.line+1,0)));var result=unit(cm,pos);return new Range(result.from,result.to)}function leftButtonSelect(cm,event,start,behavior){function extendTo(pos){if(0!=cmp(lastPos,pos))if(lastPos=pos,"rectangle"==behavior.unit){for(var ranges=[],tabSize=cm.options.tabSize,startCol=countColumn(getLine(doc,start.line).text,start.ch,tabSize),posCol=countColumn(getLine(doc,pos.line).text,pos.ch,tabSize),left=_Mathmin(startCol,posCol),right=_Mathmax(startCol,posCol),line=_Mathmin(start.line,pos.line),end=_Mathmin(cm.lastLine(),_Mathmax(start.line,pos.line));line<=end;line++){var text=getLine(doc,line).text,leftPos=findColumn(text,left,tabSize);left==right?ranges.push(new Range(Pos(line,leftPos),Pos(line,leftPos))):text.length>leftPos&&ranges.push(new Range(Pos(line,leftPos),Pos(line,findColumn(text,right,tabSize))))}ranges.length||ranges.push(new Range(start,start)),setSelection(doc,normalizeSelection(cm,startSel.ranges.slice(0,ourIndex).concat(ranges),ourIndex),{origin:"*mouse",scroll:!1}),cm.scrollIntoView(pos)}else{var oldRange=ourRange,range=rangeForUnit(cm,pos,behavior.unit),anchor=oldRange.anchor,head;0<cmp(range.anchor,anchor)?(head=range.head,anchor=minPos(oldRange.from(),range.anchor)):(head=range.anchor,anchor=maxPos(oldRange.to(),range.head));var ranges$1=startSel.ranges.slice(0);ranges$1[ourIndex]=bidiSimplify(cm,new Range(_clipPos(doc,anchor),head)),setSelection(doc,normalizeSelection(cm,ranges$1,ourIndex),sel_mouse)}}function extend(e){var curCount=++counter,cur=posFromMouse(cm,e,!0,"rectangle"==behavior.unit);if(cur)if(0!=cmp(cur,lastPos)){cm.curOp.focus=activeElt(),extendTo(cur);var visible=visibleLines(display,doc);(cur.line>=visible.to||cur.line<visible.from)&&setTimeout(operation(cm,function(){counter==curCount&&extend(e)}),150)}else{var outside=e.clientY<editorSize.top?-20:e.clientY>editorSize.bottom?20:0;outside&&setTimeout(operation(cm,function(){counter!=curCount||(display.scroller.scrollTop+=outside,extend(e))}),50)}}function done(e){cm.state.selectingText=!1,counter=1/0,e&&(e_preventDefault(e),display.input.focus()),off(display.wrapper.ownerDocument,"mousemove",move),off(display.wrapper.ownerDocument,"mouseup",up),doc.history.lastSelOrigin=null}var display=cm.display,doc=cm.doc;e_preventDefault(event);var startSel=doc.sel,ranges=startSel.ranges,ourRange,ourIndex;if(behavior.addNew&&!behavior.extend?(ourIndex=doc.sel.contains(start),ourRange=-1<ourIndex?ranges[ourIndex]:new Range(start,start)):(ourRange=doc.sel.primary(),ourIndex=doc.sel.primIndex),"rectangle"==behavior.unit)behavior.addNew||(ourRange=new Range(start,start)),start=posFromMouse(cm,event,!0,!0),ourIndex=-1;else{var range=rangeForUnit(cm,start,behavior.unit);ourRange=behavior.extend?extendRange(ourRange,range.anchor,range.head,behavior.extend):range}behavior.addNew?-1==ourIndex?(ourIndex=ranges.length,setSelection(doc,normalizeSelection(cm,ranges.concat([ourRange]),ourIndex),{scroll:!1,origin:"*mouse"})):1<ranges.length&&ranges[ourIndex].empty()&&"char"==behavior.unit&&!behavior.extend?(setSelection(doc,normalizeSelection(cm,ranges.slice(0,ourIndex).concat(ranges.slice(ourIndex+1)),0),{scroll:!1,origin:"*mouse"}),startSel=doc.sel):replaceOneSelection(doc,ourIndex,ourRange,sel_mouse):(ourIndex=0,setSelection(doc,new Selection([ourRange],0),sel_mouse),startSel=doc.sel);var lastPos=start,editorSize=display.wrapper.getBoundingClientRect(),counter=0,move=operation(cm,function(e){0!==e.buttons&&e_button(e)?extend(e):done(e)}),up=operation(cm,done);cm.state.selectingText=up,on(display.wrapper.ownerDocument,"mousemove",move),on(display.wrapper.ownerDocument,"mouseup",up)}function bidiSimplify(cm,range){var anchor=range.anchor,head=range.head,anchorLine=getLine(cm.doc,anchor.line);if(0==cmp(anchor,head)&&anchor.sticky==head.sticky)return range;var order=getOrder(anchorLine);if(!order)return range;var index=getBidiPartAt(order,anchor.ch,anchor.sticky),part=order[index];if(part.from!=anchor.ch&&part.to!=anchor.ch)return range;var boundary=index+(part.from==anchor.ch==(1!=part.level)?0:1);if(0==boundary||boundary==order.length)return range;var leftSide;if(head.line!=anchor.line)leftSide=0<(head.line-anchor.line)*("ltr"==cm.doc.direction?1:-1);else{var headIndex=getBidiPartAt(order,head.ch,head.sticky),dir=headIndex-index||(head.ch-anchor.ch)*(1==part.level?-1:1);leftSide=headIndex==boundary-1||headIndex==boundary?0>dir:0<dir}var usePart=order[boundary+(leftSide?-1:0)],from=leftSide==(1==usePart.level),ch=from?usePart.from:usePart.to,sticky=from?"after":"before";return anchor.ch==ch&&anchor.sticky==sticky?range:new Range(new Pos(anchor.line,ch,sticky),head)}function gutterEvent(cm,e,type,prevent){var mX,mY;if(e.touches)mX=e.touches[0].clientX,mY=e.touches[0].clientY;else try{mX=e.clientX,mY=e.clientY}catch(e$1){return!1}if(mX>=_Mathfloor(cm.display.gutters.getBoundingClientRect().right))return!1;prevent&&e_preventDefault(e);var display=cm.display,lineBox=display.lineDiv.getBoundingClientRect();if(mY>lineBox.bottom||!hasHandler(cm,type))return e_defaultPrevented(e);mY-=lineBox.top-display.viewOffset;for(var i=0,g;i<cm.display.gutterSpecs.length;++i)if(g=display.gutters.childNodes[i],g&&g.getBoundingClientRect().right>=mX){var line=_lineAtHeight(cm.doc,mY),gutter=cm.display.gutterSpecs[i];return signal(cm,type,cm,line,gutter.className,e),e_defaultPrevented(e)}}function clickInGutter(cm,e){return gutterEvent(cm,e,"gutterClick",!0)}function onContextMenu(cm,e){eventInWidget(cm.display,e)||contextMenuInGutter(cm,e)||signalDOMEvent(cm,e,"contextmenu")||!captureRightClick&&cm.display.input.onContextMenu(e)}function contextMenuInGutter(cm,e){return!!hasHandler(cm,"gutterContextMenu")&&gutterEvent(cm,e,"gutterContextMenu",!1)}function themeChanged(cm){cm.display.wrapper.className=cm.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+cm.options.theme.replace(/(^|\s)\s*/g," cm-s-"),clearCaches(cm)}function dragDropChanged(cm,value,old){if(!value!=!(old&&old!=Init)){var funcs=cm.display.dragFunctions,toggle=value?on:off;toggle(cm.display.scroller,"dragstart",funcs.start),toggle(cm.display.scroller,"dragenter",funcs.enter),toggle(cm.display.scroller,"dragover",funcs.over),toggle(cm.display.scroller,"dragleave",funcs.leave),toggle(cm.display.scroller,"drop",funcs.drop)}}function wrappingChanged(cm){cm.options.lineWrapping?(addClass(cm.display.wrapper,"CodeMirror-wrap"),cm.display.sizer.style.minWidth="",cm.display.sizerWidth=null):(rmClass(cm.display.wrapper,"CodeMirror-wrap"),findMaxLine(cm)),estimateLineHeights(cm),regChange(cm),clearCaches(cm),setTimeout(function(){return updateScrollbars(cm)},100)}function CodeMirror(place,options){var this$1=this;if(!(this instanceof CodeMirror))return new CodeMirror(place,options);this.options=options=options?copyObj(options):{},copyObj(defaults,options,!1);var doc=options.value;"string"==typeof doc?doc=new Doc(doc,options.mode,null,options.lineSeparator,options.direction):options.mode&&(doc.modeOption=options.mode),this.doc=doc;var input=new CodeMirror.inputStyles[options.inputStyle](this),display=this.display=new Display(place,doc,input,options);for(var opt in display.wrapper.CodeMirror=this,themeChanged(this),options.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),initScrollbars(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:-1,cutIncoming:-1,selectingText:!1,draggingText:!1,highlight:new Delayed,keySeq:null,specialChars:null},options.autofocus&&!mobile&&display.input.focus(),ie&&11>ie_version&&setTimeout(function(){return this$1.display.input.reset(!0)},20),registerEventHandlers(this),ensureGlobalHandlers(),_startOperation(this),this.curOp.forceUpdate=!0,attachDoc(this,doc),options.autofocus&&!mobile||this.hasFocus()?setTimeout(bind(onFocus,this),20):onBlur(this),optionHandlers)optionHandlers.hasOwnProperty(opt)&&optionHandlers[opt](this,options[opt],Init);maybeUpdateLineNumberWidth(this),options.finishInit&&options.finishInit(this);for(var i=0;i<initHooks.length;++i)initHooks[i](this);_endOperation(this),webkit&&options.lineWrapping&&"optimizelegibility"==getComputedStyle(display.lineDiv).textRendering&&(display.lineDiv.style.textRendering="auto")}function registerEventHandlers(cm){function finishTouch(){d.activeTouch&&(touchFinished=setTimeout(function(){return d.activeTouch=null},1e3),prevTouch=d.activeTouch,prevTouch.end=+new Date)}function isMouseLikeTouchEvent(e){if(1!=e.touches.length)return!1;var touch=e.touches[0];return 1>=touch.radiusX&&1>=touch.radiusY}function farAway(touch,other){if(null==other.left)return!0;var dx=other.left-touch.left,dy=other.top-touch.top;return 400<dx*dx+dy*dy}var d=cm.display;on(d.scroller,"mousedown",operation(cm,onMouseDown)),ie&&11>ie_version?on(d.scroller,"dblclick",operation(cm,function(e){if(!signalDOMEvent(cm,e)){var pos=posFromMouse(cm,e);if(!(!pos||clickInGutter(cm,e)||eventInWidget(cm.display,e))){e_preventDefault(e);var word=cm.findWordAt(pos);extendSelection(cm.doc,word.anchor,word.head)}}})):on(d.scroller,"dblclick",function(e){return signalDOMEvent(cm,e)||e_preventDefault(e)}),on(d.scroller,"contextmenu",function(e){return onContextMenu(cm,e)}),on(d.input.getField(),"contextmenu",function(e){d.scroller.contains(e.target)||onContextMenu(cm,e)});var prevTouch={end:0},touchFinished;on(d.scroller,"touchstart",function(e){if(!signalDOMEvent(cm,e)&&!isMouseLikeTouchEvent(e)&&!clickInGutter(cm,e)){d.input.ensurePolled(),clearTimeout(touchFinished);var now=+new Date;d.activeTouch={start:now,moved:!1,prev:300>=now-prevTouch.end?prevTouch:null},1==e.touches.length&&(d.activeTouch.left=e.touches[0].pageX,d.activeTouch.top=e.touches[0].pageY)}}),on(d.scroller,"touchmove",function(){d.activeTouch&&(d.activeTouch.moved=!0)}),on(d.scroller,"touchend",function(e){var touch=d.activeTouch;if(touch&&!eventInWidget(d,e)&&null!=touch.left&&!touch.moved&&300>new Date-touch.start){var pos=cm.coordsChar(d.activeTouch,"page"),range;range=!touch.prev||farAway(touch,touch.prev)?new Range(pos,pos):!touch.prev.prev||farAway(touch,touch.prev.prev)?cm.findWordAt(pos):new Range(Pos(pos.line,0),_clipPos(cm.doc,Pos(pos.line+1,0))),cm.setSelection(range.anchor,range.head),cm.focus(),e_preventDefault(e)}finishTouch()}),on(d.scroller,"touchcancel",finishTouch),on(d.scroller,"scroll",function(){d.scroller.clientHeight&&(updateScrollTop(cm,d.scroller.scrollTop),setScrollLeft(cm,d.scroller.scrollLeft,!0),signal(cm,"scroll",cm))}),on(d.scroller,"mousewheel",function(e){return onScrollWheel(cm,e)}),on(d.scroller,"DOMMouseScroll",function(e){return onScrollWheel(cm,e)}),on(d.wrapper,"scroll",function(){return d.wrapper.scrollTop=d.wrapper.scrollLeft=0}),d.dragFunctions={enter:function enter(e){signalDOMEvent(cm,e)||e_stop(e)},over:function over(e){signalDOMEvent(cm,e)||(onDragOver(cm,e),e_stop(e))},start:function start(e){return onDragStart(cm,e)},drop:operation(cm,onDrop),leave:function leave(e){signalDOMEvent(cm,e)||clearDragCursor(cm)}};var inp=d.input.getField();on(inp,"keyup",function(e){return onKeyUp.call(cm,e)}),on(inp,"keydown",operation(cm,onKeyDown)),on(inp,"keypress",operation(cm,onKeyPress)),on(inp,"focus",function(e){return onFocus(cm,e)}),on(inp,"blur",function(e){return onBlur(cm,e)})}function indentLine(cm,n,how,aggressive){var doc=cm.doc,state;null==how&&(how="add"),"smart"==how&&(doc.mode.indent?state=getContextBefore(cm,n).state:how="prev");var tabSize=cm.options.tabSize,line=getLine(doc,n),curSpace=countColumn(line.text,null,tabSize);line.stateAfter&&(line.stateAfter=null);var curSpaceString=line.text.match(/^\s*/)[0],indentation;if(!aggressive&&!/\S/.test(line.text))indentation=0,how="not";else if("smart"==how&&(indentation=doc.mode.indent(state,line.text.slice(curSpaceString.length),line.text),indentation==Pass||150<indentation)){if(!aggressive)return;how="prev"}"prev"==how?n>doc.first?indentation=countColumn(getLine(doc,n-1).text,null,tabSize):indentation=0:"add"==how?indentation=curSpace+cm.options.indentUnit:"subtract"==how?indentation=curSpace-cm.options.indentUnit:"number"==typeof how&&(indentation=curSpace+how),indentation=_Mathmax(0,indentation);var indentString="",pos=0;if(cm.options.indentWithTabs)for(var i=_Mathfloor(indentation/tabSize);i;--i)pos+=tabSize,indentString+="\t";if(pos<indentation&&(indentString+=spaceStr(indentation-pos)),indentString!=curSpaceString)return _replaceRange(doc,indentString,Pos(n,0),Pos(n,curSpaceString.length),"+input"),line.stateAfter=null,!0;for(var i$1=0,range;i$1<doc.sel.ranges.length;i$1++)if(range=doc.sel.ranges[i$1],range.head.line==n&&range.head.ch<curSpaceString.length){var pos$1=Pos(n,curSpaceString.length);replaceOneSelection(doc,i$1,new Range(pos$1,pos$1));break}}function setLastCopied(newLastCopied){lastCopied=newLastCopied}function applyTextInput(cm,inserted,deleted,sel,origin){var doc=cm.doc;cm.display.shift=!1,sel||(sel=doc.sel);var recent=+new Date-200,paste="paste"==origin||cm.state.pasteIncoming>recent,textLines=splitLinesAuto(inserted),multiPaste=null;if(paste&&1<sel.ranges.length)if(!(lastCopied&&lastCopied.text.join("\n")==inserted))textLines.length==sel.ranges.length&&cm.options.pasteLinesPerSelection&&(multiPaste=map(textLines,function(l){return[l]}));else if(0==sel.ranges.length%lastCopied.text.length){multiPaste=[];for(var i=0;i<lastCopied.text.length;i++)multiPaste.push(doc.splitLines(lastCopied.text[i]))}for(var updateInput=cm.curOp.updateInput,i$1=sel.ranges.length-1;0<=i$1;i$1--){var range=sel.ranges[i$1],from=range.from(),to=range.to();range.empty()&&(deleted&&0<deleted?from=Pos(from.line,from.ch-deleted):cm.state.overwrite&&!paste?to=Pos(to.line,_Mathmin(getLine(doc,to.line).text.length,to.ch+lst(textLines).length)):paste&&lastCopied&&lastCopied.lineWise&&lastCopied.text.join("\n")==inserted&&(from=to=Pos(from.line,0)));var changeEvent={from:from,to:to,text:multiPaste?multiPaste[i$1%multiPaste.length]:textLines,origin:origin||(paste?"paste":cm.state.cutIncoming>recent?"cut":"+input")};makeChange(cm.doc,changeEvent),signalLater(cm,"inputRead",cm,changeEvent)}inserted&&!paste&&triggerElectric(cm,inserted),ensureCursorVisible(cm),2>cm.curOp.updateInput&&(cm.curOp.updateInput=updateInput),cm.curOp.typing=!0,cm.state.pasteIncoming=cm.state.cutIncoming=-1}function handlePaste(e,cm){var pasted=e.clipboardData&&e.clipboardData.getData("Text");if(pasted)return e.preventDefault(),cm.isReadOnly()||cm.options.disableInput||runInOp(cm,function(){return applyTextInput(cm,pasted,0,null,"paste")}),!0}function triggerElectric(cm,inserted){if(cm.options.electricChars&&cm.options.smartIndent)for(var sel=cm.doc.sel,i=sel.ranges.length-1,range;0<=i;i--)if(range=sel.ranges[i],!(100<range.head.ch||i&&sel.ranges[i-1].head.line==range.head.line)){var mode=cm.getModeAt(range.head),indented=!1;if(mode.electricChars){for(var j=0;j<mode.electricChars.length;j++)if(-1<inserted.indexOf(mode.electricChars.charAt(j))){indented=indentLine(cm,range.head.line,"smart");break}}else mode.electricInput&&mode.electricInput.test(getLine(cm.doc,range.head.line).text.slice(0,range.head.ch))&&(indented=indentLine(cm,range.head.line,"smart"));indented&&signalLater(cm,"electricInput",cm,range.head.line)}}function copyableRanges(cm){for(var text=[],ranges=[],i=0;i<cm.doc.sel.ranges.length;i++){var line=cm.doc.sel.ranges[i].head.line,lineRange={anchor:Pos(line,0),head:Pos(line+1,0)};ranges.push(lineRange),text.push(cm.getRange(lineRange.anchor,lineRange.head))}return{text:text,ranges:ranges}}function disableBrowserMagic(field,spellcheck,autocorrect,autocapitalize){field.setAttribute("autocorrect",autocorrect?"":"off"),field.setAttribute("autocapitalize",autocapitalize?"":"off"),field.setAttribute("spellcheck",!!spellcheck)}function hiddenTextarea(){var te=elt("textarea",null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),div=elt("div",[te],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");return webkit?te.style.width="1000px":te.setAttribute("wrap","off"),ios&&(te.style.border="1px solid black"),disableBrowserMagic(te),div}function _findPosH(doc,pos,dir,unit,visually){function findNextLine(){var l=pos.line+lineDir;return!(l<doc.first||l>=doc.first+doc.size)&&(pos=new Pos(l,pos.ch,pos.sticky),lineObj=getLine(doc,l))}function moveOnce(boundToLine){var next;if(next=visually?moveVisually(doc.cm,lineObj,pos,dir):moveLogically(lineObj,pos,dir),null!=next)pos=next;else if(!boundToLine&&findNextLine())pos=endOfLine(visually,doc.cm,lineObj,pos.line,lineDir);else return!1;return!0}var oldPos=pos,origDir=dir,lineObj=getLine(doc,pos.line),lineDir=visually&&"rtl"==doc.direction?-dir:dir;if("char"==unit)moveOnce();else if("column"==unit)moveOnce(!0);else if("word"==unit||"group"==unit)for(var sawType=null,group="group"==unit,helper=doc.cm&&doc.cm.getHelper(pos,"wordChars"),first=!0;;first=!1){if(0>dir&&!moveOnce(!first))break;var cur=lineObj.text.charAt(pos.ch)||"\n",type=isWordChar(cur,helper)?"w":group&&"\n"==cur?"n":!group||/\s/.test(cur)?null:"p";if(!group||first||type||(type="s"),sawType&&sawType!=type){0>dir&&(dir=1,moveOnce(),pos.sticky="after");break}if(type&&(sawType=type),0<dir&&!moveOnce(!first))break}var result=skipAtomic(doc,pos,oldPos,origDir,!0);return equalCursorPos(oldPos,result)&&(result.hitSide=!0),result}function _findPosV(cm,pos,dir,unit){var doc=cm.doc,x=pos.left,y;if("page"==unit){var pageSize=_Mathmin(cm.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight),moveAmount=_Mathmax(pageSize-.5*textHeight(cm.display),3);y=(0<dir?pos.bottom:pos.top)+dir*moveAmount}else"line"==unit&&(y=0<dir?pos.bottom+3:pos.top-3);for(var target;;){if(target=_coordsChar(cm,x,y),!target.outside)break;if(0>dir?0>=y:y>=doc.height){target.hitSide=!0;break}y+=5*dir}return target}function posToDOM(cm,pos){var view=findViewForLine(cm,pos.line);if(!view||view.hidden)return null;var line=getLine(cm.doc,pos.line),info=mapFromLineView(view,line,pos.line),order=getOrder(line,cm.doc.direction),side="left";if(order){var partPos=getBidiPartAt(order,pos.ch);side=partPos%2?"right":"left"}var result=nodeAndOffsetInLineMap(info.map,pos.ch,side);return result.offset="right"==result.collapse?result.end:result.start,result}function isInGutter(node){for(var scan=node;scan;scan=scan.parentNode)if(/CodeMirror-gutter-wrapper/.test(scan.className))return!0;return!1}function badPos(pos,bad){return bad&&(pos.bad=!0),pos}function domTextBetween(cm,from,to,fromLine,toLine){function recognizeMarker(id){return function(marker){return marker.id==id}}function close(){closing&&(text+=lineSep,extraLinebreak&&(text+=lineSep),closing=extraLinebreak=!1)}function addText(str){str&&(close(),text+=str)}function walk(node){if(1==node.nodeType){var cmText=node.getAttribute("cm-text");if(cmText)return void addText(cmText);var markerID=node.getAttribute("cm-marker"),range;if(markerID){var found=cm.findMarks(Pos(fromLine,0),Pos(toLine+1,0),recognizeMarker(+markerID));return void(found.length&&(range=found[0].find(0))&&addText(getBetween(cm.doc,range.from,range.to).join(lineSep)))}if("false"==node.getAttribute("contenteditable"))return;var isBlock=/^(pre|div|p|li|table|br)$/i.test(node.nodeName);if(!/^br$/i.test(node.nodeName)&&0==node.textContent.length)return;isBlock&&close();for(var i=0;i<node.childNodes.length;i++)walk(node.childNodes[i]);/^(pre|p)$/i.test(node.nodeName)&&(extraLinebreak=!0),isBlock&&(closing=!0)}else 3==node.nodeType&&addText(node.nodeValue.replace(/\u200b/g,"").replace(/\u00a0/g," "))}for(var text="",closing=!1,lineSep=cm.doc.lineSeparator(),extraLinebreak=!1;;){if(walk(from),from==to)break;from=from.nextSibling,extraLinebreak=!1}return text}function domToPos(cm,node,offset){var lineNode;if(node==cm.display.lineDiv){if(lineNode=cm.display.lineDiv.childNodes[offset],!lineNode)return badPos(cm.clipPos(Pos(cm.display.viewTo-1)),!0);node=null,offset=0}else for(lineNode=node;;lineNode=lineNode.parentNode){if(!lineNode||lineNode==cm.display.lineDiv)return null;if(lineNode.parentNode&&lineNode.parentNode==cm.display.lineDiv)break}for(var i=0,lineView;i<cm.display.view.length;i++)if(lineView=cm.display.view[i],lineView.node==lineNode)return locateNodeInLineView(lineView,node,offset)}function locateNodeInLineView(lineView,node,offset){function find(textNode,topNode,offset){for(var i=-1,map;i<(maps?maps.length:0);i++){map=0>i?measure.map:maps[i];for(var j=0,curNode;j<map.length;j+=3)if(curNode=map[j+2],curNode==textNode||curNode==topNode){var line=lineNo(0>i?lineView.line:lineView.rest[i]),ch=map[j]+offset;return(0>offset||curNode!=textNode)&&(ch=map[j+(offset?1:0)]),Pos(line,ch)}}}var wrapper=lineView.text.firstChild,bad=!1;if(!node||!contains(wrapper,node))return badPos(Pos(lineNo(lineView.line),0),!0);if(node==wrapper&&(bad=!0,node=wrapper.childNodes[offset],offset=0,!node)){var line=lineView.rest?lst(lineView.rest):lineView.line;return badPos(Pos(lineNo(line),line.text.length),bad)}var textNode=3==node.nodeType?node:null,topNode=node;for(textNode||1!=node.childNodes.length||3!=node.firstChild.nodeType||(textNode=node.firstChild,offset&&(offset=textNode.nodeValue.length));topNode.parentNode!=wrapper;)topNode=topNode.parentNode;var measure=lineView.measure,maps=measure.maps,found=find(textNode,topNode,offset);if(found)return badPos(found,bad);for(var after=topNode.nextSibling,dist=textNode?textNode.nodeValue.length-offset:0;after;after=after.nextSibling){if(found=find(after,after.firstChild,0),found)return badPos(Pos(found.line,found.ch-dist),bad);dist+=after.textContent.length}for(var before=topNode.previousSibling,dist$1=offset;before;before=before.previousSibling){if(found=find(before,before.firstChild,-1),found)return badPos(Pos(found.line,found.ch+dist$1),bad);dist$1+=before.textContent.length}}var userAgent=navigator.userAgent,platform=navigator.platform,gecko=/gecko\/\d/i.test(userAgent),ie_upto10=/MSIE \d/.test(userAgent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(userAgent),edge=/Edge\/(\d+)/.exec(userAgent),ie=ie_upto10||ie_11up||edge,ie_version=ie&&(ie_upto10?document.documentMode||6:+(edge||ie_11up)[1]),webkit=!edge&&/WebKit\//.test(userAgent),qtwebkit=webkit&&/Qt\/\d+\.\d+/.test(userAgent),chrome=!edge&&/Chrome\//.test(userAgent),presto=/Opera\//.test(userAgent),safari=/Apple Computer/.test(navigator.vendor),mac_geMountainLion=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(userAgent),phantom=/PhantomJS/.test(userAgent),ios=!edge&&/AppleWebKit/.test(userAgent)&&/Mobile\/\w+/.test(userAgent),android=/Android/.test(userAgent),mobile=ios||android||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(userAgent),mac=ios||/Mac/.test(platform),chromeOS=/\bCrOS\b/.test(userAgent),windows=/win/i.test(platform),presto_version=presto&&userAgent.match(/Version\/(\d*\.\d*)/);presto_version&&(presto_version=+presto_version[1]),presto_version&&15<=presto_version&&(presto=!1,webkit=!0);var flipCtrlCmd=mac&&(qtwebkit||presto&&(null==presto_version||12.11>presto_version)),captureRightClick=gecko||ie&&9<=ie_version,rmClass=function(node,cls){var current=node.className,match=classTest(cls).exec(current);if(match){var after=current.slice(match.index+match[0].length);node.className=current.slice(0,match.index)+(after?match[1]+after:"")}},range;range=document.createRange?function(node,start,end,endNode){var r=document.createRange();return r.setEnd(endNode||node,end),r.setStart(node,start),r}:function(node,start,end){var r=document.body.createTextRange();try{r.moveToElementText(node.parentNode)}catch(e){return r}return r.collapse(!0),r.moveEnd("character",end),r.moveStart("character",start),r};var selectInput=function(node){node.select()};ios?selectInput=function(node){node.selectionStart=0,node.selectionEnd=node.value.length}:ie&&(selectInput=function(node){try{node.select()}catch(_e){}});var Delayed=function(){this.id=null,this.f=null,this.time=0,this.handler=bind(this.onTimeout,this)};Delayed.prototype.onTimeout=function(self){self.id=0,self.time<=+new Date?self.f():setTimeout(self.handler,self.time-+new Date)},Delayed.prototype.set=function(ms,f){this.f=f;var time=+new Date+ms;(!this.id||time<this.time)&&(clearTimeout(this.id),this.id=setTimeout(this.handler,ms),this.time=time)};var Pass={toString:function toString(){return"CodeMirror.Pass"}},sel_dontScroll={scroll:!1},sel_mouse={origin:"*mouse"},sel_move={origin:"+move"},spaceStrs=[""],nonASCIISingleCaseWordChar=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,extendingChars=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,bidiOther=null,bidiOrdering=function(){function charType(code){return 247>=code?"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(code):1424<=code&&1524>=code?"R":1536<=code&&1785>=code?"nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111".charAt(code-1536):1774<=code&&2220>=code?"r":8192<=code&&8203>=code?"w":8204==code?"b":"L"}function BidiSpan(level,from,to){this.level=level,this.from=from,this.to=to}var isNeutral=/[stwN]/,isStrong=/[LRr]/,countsAsLeft=/[Lb1n]/,countsAsNum=/[1n]/;return function(str,direction){var outerType="ltr"==direction?"L":"R";if(0==str.length||"ltr"==direction&&!/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/.test(str))return!1;for(var len=str.length,types=[],i=0;i<len;++i)types.push(charType(str.charCodeAt(i)));for(var i$1=0,prev=outerType,type;i$1<len;++i$1)type=types[i$1],"m"==type?types[i$1]=prev:prev=type;for(var i$2=0,cur=outerType,type$1;i$2<len;++i$2)type$1=types[i$2],"1"==type$1&&"r"==cur?types[i$2]="n":isStrong.test(type$1)&&(cur=type$1,"r"==type$1&&(types[i$2]="R"));for(var i$3=1,prev$1=types[0],type$2;i$3<len-1;++i$3)type$2=types[i$3],"+"==type$2&&"1"==prev$1&&"1"==types[i$3+1]?types[i$3]="1":","==type$2&&prev$1==types[i$3+1]&&("1"==prev$1||"n"==prev$1)&&(types[i$3]=prev$1),prev$1=type$2;for(var i$4=0,type$3;i$4<len;++i$4)if(type$3=types[i$4],","==type$3)types[i$4]="N";else if("%"==type$3){var end=void 0;for(end=i$4+1;end<len&&"%"==types[end];++end);for(var replace=i$4&&"!"==types[i$4-1]||end<len&&"1"==types[end]?"1":"N",j=i$4;j<end;++j)types[j]=replace;i$4=end-1}for(var i$5=0,cur$1=outerType,type$4;i$5<len;++i$5)type$4=types[i$5],"L"==cur$1&&"1"==type$4?types[i$5]="L":isStrong.test(type$4)&&(cur$1=type$4);for(var i$6=0;i$6<len;++i$6)if(isNeutral.test(types[i$6])){var end$1=void 0;for(end$1=i$6+1;end$1<len&&isNeutral.test(types[end$1]);++end$1);for(var before="L"==(i$6?types[i$6-1]:outerType),after="L"==(end$1<len?types[end$1]:outerType),replace$1=before==after?before?"L":"R":outerType,j$1=i$6;j$1<end$1;++j$1)types[j$1]=replace$1;i$6=end$1-1}for(var order=[],i$7=0,m;i$7<len;)if(countsAsLeft.test(types[i$7])){var start=i$7;for(++i$7;i$7<len&&countsAsLeft.test(types[i$7]);++i$7);order.push(new BidiSpan(0,start,i$7))}else{var pos=i$7,at=order.length,isRTL="rtl"==direction?1:0;for(++i$7;i$7<len&&"L"!=types[i$7];++i$7);for(var j$2=pos;j$2<i$7;)if(countsAsNum.test(types[j$2])){pos<j$2&&(order.splice(at,0,new BidiSpan(1,pos,j$2)),at+=isRTL);var nstart=j$2;for(++j$2;j$2<i$7&&countsAsNum.test(types[j$2]);++j$2);order.splice(at,0,new BidiSpan(2,nstart,j$2)),at+=isRTL,pos=j$2}else++j$2;pos<i$7&&order.splice(at,0,new BidiSpan(1,pos,i$7))}return"ltr"==direction&&(1==order[0].level&&(m=str.match(/^\s+/))&&(order[0].from=m[0].length,order.unshift(new BidiSpan(0,0,m[0].length))),1==lst(order).level&&(m=str.match(/\s+$/))&&(lst(order).to-=m[0].length,order.push(new BidiSpan(0,len-m[0].length,len)))),"rtl"==direction?order.reverse():order}}(),noHandlers=[],on=function(emitter,type,f){if(emitter.addEventListener)emitter.addEventListener(type,f,!1);else if(emitter.attachEvent)emitter.attachEvent("on"+type,f);else{var map=emitter._handlers||(emitter._handlers={});map[type]=(map[type]||noHandlers).concat(f)}},dragAndDrop=function(){if(ie&&9>ie_version)return!1;var div=elt("div");return"draggable"in div||"dragDrop"in div}(),splitLinesAuto=3=="\n\nb".split(/\n/).length?function(string){return string.split(/\r\n?|\n/)}:function(string){for(var pos=0,result=[],l=string.length,nl;pos<=l;){nl=string.indexOf("\n",pos),-1==nl&&(nl=string.length);var line=string.slice(pos,"\r"==string.charAt(nl-1)?nl-1:nl),rt=line.indexOf("\r");-1==rt?(result.push(line),pos=nl+1):(result.push(line.slice(0,rt)),pos+=rt+1)}return result},hasSelection=window.getSelection?function(te){try{return te.selectionStart!=te.selectionEnd}catch(e){return!1}}:function(te){var range;try{range=te.ownerDocument.selection.createRange()}catch(e){}return!!(range&&range.parentElement()==te)&&0!=range.compareEndPoints("StartToEnd",range)},hasCopyEvent=function(){var e=elt("div");return!!("oncopy"in e)||(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy)}(),badZoomedRects=null,modes={},mimeModes={},modeExtensions={},StringStream=function(string,tabSize,lineOracle){this.pos=this.start=0,this.string=string,this.tabSize=tabSize||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=lineOracle},zwspSupported,badBidiRects;StringStream.prototype.eol=function(){return this.pos>=this.string.length},StringStream.prototype.sol=function(){return this.pos==this.lineStart},StringStream.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},StringStream.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},StringStream.prototype.eat=function(match){var ch=this.string.charAt(this.pos),ok;if(ok="string"==typeof match?ch==match:ch&&(match.test?match.test(ch):match(ch)),ok)return++this.pos,ch},StringStream.prototype.eatWhile=function(match){for(var start=this.pos;this.eat(match););return this.pos>start},StringStream.prototype.eatSpace=function(){for(var start=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>start},StringStream.prototype.skipToEnd=function(){this.pos=this.string.length},StringStream.prototype.skipTo=function(ch){var found=this.string.indexOf(ch,this.pos);if(-1<found)return this.pos=found,!0},StringStream.prototype.backUp=function(n){this.pos-=n},StringStream.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=countColumn(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)},StringStream.prototype.indentation=function(){return countColumn(this.string,null,this.tabSize)-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)},StringStream.prototype.match=function(pattern,consume,caseInsensitive){if("string"==typeof pattern){var cased=function(str){return caseInsensitive?str.toLowerCase():str},substr=this.string.substr(this.pos,pattern.length);if(cased(substr)==cased(pattern))return!1!==consume&&(this.pos+=pattern.length),!0}else{var match=this.string.slice(this.pos).match(pattern);return match&&0<match.index?null:(match&&!1!==consume&&(this.pos+=match[0].length),match)}},StringStream.prototype.current=function(){return this.string.slice(this.start,this.pos)},StringStream.prototype.hideFirstChars=function(n,inner){this.lineStart+=n;try{return inner()}finally{this.lineStart-=n}},StringStream.prototype.lookAhead=function(n){var oracle=this.lineOracle;return oracle&&oracle.lookAhead(n)},StringStream.prototype.baseToken=function(){var oracle=this.lineOracle;return oracle&&oracle.baseToken(this.pos)};var SavedContext=function(state,lookAhead){this.state=state,this.lookAhead=lookAhead},Context=function(doc,state,line,lookAhead){this.state=state,this.doc=doc,this.line=line,this.maxLookAhead=lookAhead||0,this.baseTokens=null,this.baseTokenPos=1};Context.prototype.lookAhead=function(n){var line=this.doc.getLine(this.line+n);return null!=line&&n>this.maxLookAhead&&(this.maxLookAhead=n),line},Context.prototype.baseToken=function(n){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=n;)this.baseTokenPos+=2;var type=this.baseTokens[this.baseTokenPos+1];return{type:type&&type.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-n}},Context.prototype.nextLine=function(){this.line++,0<this.maxLookAhead&&this.maxLookAhead--},Context.fromSaved=function(doc,saved,line){return saved instanceof SavedContext?new Context(doc,copyState(doc.mode,saved.state),line,saved.lookAhead):new Context(doc,copyState(doc.mode,saved),line)},Context.prototype.save=function(copy){var state=!1===copy?this.state:copyState(this.doc.mode,this.state);return 0<this.maxLookAhead?new SavedContext(state,this.maxLookAhead):state};var Token=function(stream,type,state){this.start=stream.start,this.end=stream.pos,this.string=stream.current(),this.type=type||null,this.state=state},sawReadOnlySpans=!1,sawCollapsedSpans=!1,Line=function(text,markedSpans,estimateHeight){this.text=text,attachMarkedSpans(this,markedSpans),this.height=estimateHeight?estimateHeight(this):1};Line.prototype.lineNo=function(){return lineNo(this)},eventMixin(Line);var styleToClassCache={},styleToClassCacheWithMode={},operationGroup=null,orphanDelayedCallbacks=null,nullRect={left:0,right:0,top:0,bottom:0},NativeScrollbars=function(place,scroll,cm){this.cm=cm;var vert=this.vert=elt("div",[elt("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),horiz=this.horiz=elt("div",[elt("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");vert.tabIndex=horiz.tabIndex=-1,place(vert),place(horiz),on(vert,"scroll",function(){vert.clientHeight&&scroll(vert.scrollTop,"vertical")}),on(horiz,"scroll",function(){horiz.clientWidth&&scroll(horiz.scrollLeft,"horizontal")}),this.checkedZeroWidth=!1,ie&&8>ie_version&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")},measureText;NativeScrollbars.prototype.update=function(measure){var needsH=measure.scrollWidth>measure.clientWidth+1,needsV=measure.scrollHeight>measure.clientHeight+1,sWidth=measure.nativeBarWidth;if(needsV){this.vert.style.display="block",this.vert.style.bottom=needsH?sWidth+"px":"0";var totalHeight=measure.viewHeight-(needsH?sWidth:0);this.vert.firstChild.style.height=_Mathmax(0,measure.scrollHeight-measure.clientHeight+totalHeight)+"px"}else this.vert.style.display="",this.vert.firstChild.style.height="0";if(needsH){this.horiz.style.display="block",this.horiz.style.right=needsV?sWidth+"px":"0",this.horiz.style.left=measure.barLeft+"px";var totalWidth=measure.viewWidth-measure.barLeft-(needsV?sWidth:0);this.horiz.firstChild.style.width=_Mathmax(0,measure.scrollWidth-measure.clientWidth+totalWidth)+"px"}else this.horiz.style.display="",this.horiz.firstChild.style.width="0";return!this.checkedZeroWidth&&0<measure.clientHeight&&(0==sWidth&&this.zeroWidthHack(),this.checkedZeroWidth=!0),{right:needsV?sWidth:0,bottom:needsH?sWidth:0}},NativeScrollbars.prototype.setScrollLeft=function(pos){this.horiz.scrollLeft!=pos&&(this.horiz.scrollLeft=pos),this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")},NativeScrollbars.prototype.setScrollTop=function(pos){this.vert.scrollTop!=pos&&(this.vert.scrollTop=pos),this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")},NativeScrollbars.prototype.zeroWidthHack=function(){var w=mac&&!mac_geMountainLion?"12px":"18px";this.horiz.style.height=this.vert.style.width=w,this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none",this.disableHoriz=new Delayed,this.disableVert=new Delayed},NativeScrollbars.prototype.enableZeroWidthBar=function(bar,delay,type){function maybeDisable(){var box=bar.getBoundingClientRect(),elt="vert"==type?document.elementFromPoint(box.right-1,(box.top+box.bottom)/2):document.elementFromPoint((box.right+box.left)/2,box.bottom-1);elt==bar?delay.set(1e3,maybeDisable):bar.style.pointerEvents="none"}bar.style.pointerEvents="auto",delay.set(1e3,maybeDisable)},NativeScrollbars.prototype.clear=function(){var parent=this.horiz.parentNode;parent.removeChild(this.horiz),parent.removeChild(this.vert)};var NullScrollbars=function(){};NullScrollbars.prototype.update=function(){return{bottom:0,right:0}},NullScrollbars.prototype.setScrollLeft=function(){},NullScrollbars.prototype.setScrollTop=function(){},NullScrollbars.prototype.clear=function(){};var scrollbarModel={native:NativeScrollbars,null:NullScrollbars},nextOpId=0,DisplayUpdate=function(cm,viewport,force){var display=cm.display;this.viewport=viewport,this.visible=visibleLines(display,cm.doc,viewport),this.editorIsHidden=!display.wrapper.offsetWidth,this.wrapperHeight=display.wrapper.clientHeight,this.wrapperWidth=display.wrapper.clientWidth,this.oldDisplayWidth=displayWidth(cm),this.force=force,this.dims=getDimensions(cm),this.events=[]};DisplayUpdate.prototype.signal=function(emitter,type){hasHandler(emitter,type)&&this.events.push(arguments)},DisplayUpdate.prototype.finish=function(){for(var i=0;i<this.events.length;i++)signal.apply(null,this.events[i])};var wheelSamples=0,wheelPixelsPerUnit=null;ie?wheelPixelsPerUnit=-.53:gecko?wheelPixelsPerUnit=15:chrome?wheelPixelsPerUnit=-.7:safari&&(wheelPixelsPerUnit=-1/3);var Selection=function(ranges,primIndex){this.ranges=ranges,this.primIndex=primIndex};Selection.prototype.primary=function(){return this.ranges[this.primIndex]},Selection.prototype.equals=function(other){if(other==this)return!0;if(other.primIndex!=this.primIndex||other.ranges.length!=this.ranges.length)return!1;for(var i=0;i<this.ranges.length;i++){var here=this.ranges[i],there=other.ranges[i];if(!equalCursorPos(here.anchor,there.anchor)||!equalCursorPos(here.head,there.head))return!1}return!0},Selection.prototype.deepCopy=function(){for(var out=[],i=0;i<this.ranges.length;i++)out[i]=new Range(copyPos(this.ranges[i].anchor),copyPos(this.ranges[i].head));return new Selection(out,this.primIndex)},Selection.prototype.somethingSelected=function(){for(var i=0;i<this.ranges.length;i++)if(!this.ranges[i].empty())return!0;return!1},Selection.prototype.contains=function(pos,end){end||(end=pos);for(var i=0,range;i<this.ranges.length;i++)if(range=this.ranges[i],0<=cmp(end,range.from())&&0>=cmp(pos,range.to()))return i;return-1};var Range=function(anchor,head){this.anchor=anchor,this.head=head};Range.prototype.from=function(){return minPos(this.anchor,this.head)},Range.prototype.to=function(){return maxPos(this.anchor,this.head)},Range.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch},LeafChunk.prototype={chunkSize:function chunkSize(){return this.lines.length},removeInner:function removeInner(at,n){for(var i=at,line;i<at+n;++i)line=this.lines[i],this.height-=line.height,cleanUpLine(line),signalLater(line,"delete");this.lines.splice(at,n)},collapse:function collapse(lines){lines.push.apply(lines,this.lines)},insertInner:function insertInner(at,lines,height){this.height+=height,this.lines=this.lines.slice(0,at).concat(lines).concat(this.lines.slice(at));for(var i=0;i<lines.length;++i)lines[i].parent=this},iterN:function iterN(at,n,op){for(var e=at+n;at<e;++at)if(op(this.lines[at]))return!0}},BranchChunk.prototype={chunkSize:function chunkSize(){return this.size},removeInner:function removeInner(at,n){this.size-=n;for(var i=0;i<this.children.length;++i){var child=this.children[i],sz=child.chunkSize();if(at<sz){var rm=_Mathmin(n,sz-at),oldHeight=child.height;if(child.removeInner(at,rm),this.height-=oldHeight-child.height,sz==rm&&(this.children.splice(i--,1),child.parent=null),0==(n-=rm))break;at=0}else at-=sz}if(25>this.size-n&&(1<this.children.length||!(this.children[0]instanceof LeafChunk))){var lines=[];this.collapse(lines),this.children=[new LeafChunk(lines)],this.children[0].parent=this}},collapse:function collapse(lines){for(var i=0;i<this.children.length;++i)this.children[i].collapse(lines)},insertInner:function insertInner(at,lines,height){this.size+=lines.length,this.height+=height;for(var i=0;i<this.children.length;++i){var child=this.children[i],sz=child.chunkSize();if(at<=sz){if(child.insertInner(at,lines,height),child.lines&&50<child.lines.length){for(var remaining=child.lines.length%25+25,pos=remaining,leaf;pos<child.lines.length;)leaf=new LeafChunk(child.lines.slice(pos,pos+=25)),child.height-=leaf.height,this.children.splice(++i,0,leaf),leaf.parent=this;child.lines=child.lines.slice(0,remaining),this.maybeSpill()}break}at-=sz}},maybeSpill:function maybeSpill(){if(!(10>=this.children.length)){var me=this;do{var spilled=me.children.splice(me.children.length-5,5),sibling=new BranchChunk(spilled);if(!me.parent){var copy=new BranchChunk(me.children);copy.parent=me,me.children=[copy,sibling],me=copy}else{me.size-=sibling.size,me.height-=sibling.height;var myIndex=indexOf(me.parent.children,me);me.parent.children.splice(myIndex+1,0,sibling)}sibling.parent=me.parent}while(10<me.children.length);me.parent.maybeSpill()}},iterN:function iterN(at,n,op){for(var i=0;i<this.children.length;++i){var child=this.children[i],sz=child.chunkSize();if(at<sz){var used=_Mathmin(n,sz-at);if(child.iterN(at,used,op))return!0;if(0==(n-=used))break;at=0}else at-=sz}}};var LineWidget=function(doc,node,options){if(options)for(var opt in options)options.hasOwnProperty(opt)&&(this[opt]=options[opt]);this.doc=doc,this.node=node};LineWidget.prototype.clear=function(){var cm=this.doc.cm,ws=this.line.widgets,line=this.line,no=lineNo(line);if(null!=no&&ws){for(var i=0;i<ws.length;++i)ws[i]==this&&ws.splice(i--,1);ws.length||(line.widgets=null);var height=widgetHeight(this);updateLineHeight(line,_Mathmax(0,line.height-height)),cm&&(runInOp(cm,function(){adjustScrollWhenAboveVisible(cm,line,-height),regLineChange(cm,no,"widget")}),signalLater(cm,"lineWidgetCleared",cm,this,no))}},LineWidget.prototype.changed=function(){var this$1=this,oldH=this.height,cm=this.doc.cm,line=this.line;this.height=null;var diff=widgetHeight(this)-oldH;diff&&(!lineIsHidden(this.doc,line)&&updateLineHeight(line,line.height+diff),cm&&runInOp(cm,function(){cm.curOp.forceUpdate=!0,adjustScrollWhenAboveVisible(cm,line,diff),signalLater(cm,"lineWidgetChanged",cm,this$1,lineNo(line))}))},eventMixin(LineWidget);var nextMarkerId=0,TextMarker=function(doc,type){this.lines=[],this.type=type,this.doc=doc,this.id=++nextMarkerId};TextMarker.prototype.clear=function(){if(!this.explicitlyCleared){var cm=this.doc.cm,withOp=cm&&!cm.curOp;if(withOp&&_startOperation(cm),hasHandler(this,"clear")){var found=this.find();found&&signalLater(this,"clear",found.from,found.to)}for(var min=null,max=null,i=0;i<this.lines.length;++i){var line=this.lines[i],span=getMarkedSpanFor(line.markedSpans,this);cm&&!this.collapsed?regLineChange(cm,lineNo(line),"text"):cm&&(null!=span.to&&(max=lineNo(line)),null!=span.from&&(min=lineNo(line))),line.markedSpans=removeMarkedSpan(line.markedSpans,span),null==span.from&&this.collapsed&&!lineIsHidden(this.doc,line)&&cm&&updateLineHeight(line,textHeight(cm.display))}if(cm&&this.collapsed&&!cm.options.lineWrapping)for(var i$1=0;i$1<this.lines.length;++i$1){var visual=visualLine(this.lines[i$1]),len=lineLength(visual);len>cm.display.maxLineLength&&(cm.display.maxLine=visual,cm.display.maxLineLength=len,cm.display.maxLineChanged=!0)}null!=min&&cm&&this.collapsed&&regChange(cm,min,max+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,cm&&reCheckSelection(cm.doc)),cm&&signalLater(cm,"markerCleared",cm,this,min,max),withOp&&_endOperation(cm),this.parent&&this.parent.clear()}},TextMarker.prototype.find=function(side,lineObj){null==side&&"bookmark"==this.type&&(side=1);for(var i=0,from,to;i<this.lines.length;++i){var line=this.lines[i],span=getMarkedSpanFor(line.markedSpans,this);if(null!=span.from&&(from=Pos(lineObj?line:lineNo(line),span.from),-1==side))return from;if(null!=span.to&&(to=Pos(lineObj?line:lineNo(line),span.to),1==side))return to}return from&&{from:from,to:to}},TextMarker.prototype.changed=function(){var this$1=this,pos=this.find(-1,!0),widget=this,cm=this.doc.cm;pos&&cm&&runInOp(cm,function(){var line=pos.line,lineN=lineNo(pos.line),view=findViewForLine(cm,lineN);if(view&&(clearLineMeasurementCacheFor(view),cm.curOp.selectionChanged=cm.curOp.forceUpdate=!0),cm.curOp.updateMaxLine=!0,!lineIsHidden(widget.doc,line)&&null!=widget.height){var oldHeight=widget.height;widget.height=null;var dHeight=widgetHeight(widget)-oldHeight;dHeight&&updateLineHeight(line,line.height+dHeight)}signalLater(cm,"markerChanged",cm,this$1)})},TextMarker.prototype.attachLine=function(line){if(!this.lines.length&&this.doc.cm){var op=this.doc.cm.curOp;op.maybeHiddenMarkers&&-1!=indexOf(op.maybeHiddenMarkers,this)||(op.maybeUnhiddenMarkers||(op.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(line)},TextMarker.prototype.detachLine=function(line){if(this.lines.splice(indexOf(this.lines,line),1),!this.lines.length&&this.doc.cm){var op=this.doc.cm.curOp;(op.maybeHiddenMarkers||(op.maybeHiddenMarkers=[])).push(this)}},eventMixin(TextMarker);var SharedTextMarker=function(markers,primary){this.markers=markers,this.primary=primary;for(var i=0;i<markers.length;++i)markers[i].parent=this};SharedTextMarker.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var i=0;i<this.markers.length;++i)this.markers[i].clear();signalLater(this,"clear")}},SharedTextMarker.prototype.find=function(side,lineObj){return this.primary.find(side,lineObj)},eventMixin(SharedTextMarker);var nextDocId=0,Doc=function(text,mode,firstLine,lineSep,direction){if(!(this instanceof Doc))return new Doc(text,mode,firstLine,lineSep,direction);null==firstLine&&(firstLine=0),BranchChunk.call(this,[new LeafChunk([new Line("",null)])]),this.first=firstLine,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.modeFrontier=this.highlightFrontier=firstLine;var start=Pos(firstLine,0);this.sel=simpleSelection(start),this.history=new History(null),this.id=++nextDocId,this.modeOption=mode,this.lineSep=lineSep,this.direction="rtl"==direction?"rtl":"ltr",this.extend=!1,"string"==typeof text&&(text=this.splitLines(text)),updateDoc(this,{from:start,to:start,text:text}),setSelection(this,simpleSelection(start),sel_dontScroll)};Doc.prototype=createObj(BranchChunk.prototype,{constructor:Doc,iter:function iter(from,to,op){op?this.iterN(from-this.first,to-from,op):this.iterN(this.first,this.first+this.size,from)},insert:function insert(at,lines){for(var height=0,i=0;i<lines.length;++i)height+=lines[i].height;this.insertInner(at-this.first,lines,height)},remove:function remove(at,n){this.removeInner(at-this.first,n)},getValue:function getValue(lineSep){var lines=getLines(this,this.first,this.first+this.size);return!1===lineSep?lines:lines.join(lineSep||this.lineSeparator())},setValue:docMethodOp(function(code){var top=Pos(this.first,0),last=this.first+this.size-1;makeChange(this,{from:top,to:Pos(last,getLine(this,last).text.length),text:this.splitLines(code),origin:"setValue",full:!0},!0),this.cm&&scrollToCoords(this.cm,0,0),setSelection(this,simpleSelection(top),sel_dontScroll)}),replaceRange:function replaceRange(code,from,to,origin){from=_clipPos(this,from),to=to?_clipPos(this,to):from,_replaceRange(this,code,from,to,origin)},getRange:function getRange(from,to,lineSep){var lines=getBetween(this,_clipPos(this,from),_clipPos(this,to));return!1===lineSep?lines:lines.join(lineSep||this.lineSeparator())},getLine:function(line){var l=this.getLineHandle(line);return l&&l.text},getLineHandle:function getLineHandle(line){if(isLine(this,line))return getLine(this,line)},getLineNumber:function getLineNumber(line){return lineNo(line)},getLineHandleVisualStart:function getLineHandleVisualStart(line){return"number"==typeof line&&(line=getLine(this,line)),visualLine(line)},lineCount:function lineCount(){return this.size},firstLine:function firstLine(){return this.first},lastLine:function lastLine(){return this.first+this.size-1},clipPos:function clipPos(pos){return _clipPos(this,pos)},getCursor:function getCursor(start){var range=this.sel.primary(),pos;return pos=null==start||"head"==start?range.head:"anchor"==start?range.anchor:"end"==start||"to"==start||!1===start?range.to():range.from(),pos},listSelections:function listSelections(){return this.sel.ranges},somethingSelected:function somethingSelected(){return this.sel.somethingSelected()},setCursor:docMethodOp(function(line,ch,options){setSimpleSelection(this,_clipPos(this,"number"==typeof line?Pos(line,ch||0):line),null,options)}),setSelection:docMethodOp(function(anchor,head,options){setSimpleSelection(this,_clipPos(this,anchor),_clipPos(this,head||anchor),options)}),extendSelection:docMethodOp(function(head,other,options){extendSelection(this,_clipPos(this,head),other&&_clipPos(this,other),options)}),extendSelections:docMethodOp(function(heads,options){extendSelections(this,clipPosArray(this,heads),options)}),extendSelectionsBy:docMethodOp(function(f,options){var heads=map(this.sel.ranges,f);extendSelections(this,clipPosArray(this,heads),options)}),setSelections:docMethodOp(function(ranges,primary,options){if(ranges.length){for(var out=[],i=0;i<ranges.length;i++)out[i]=new Range(_clipPos(this,ranges[i].anchor),_clipPos(this,ranges[i].head));null==primary&&(primary=_Mathmin(ranges.length-1,this.sel.primIndex)),setSelection(this,normalizeSelection(this.cm,out,primary),options)}}),addSelection:docMethodOp(function(anchor,head,options){var ranges=this.sel.ranges.slice(0);ranges.push(new Range(_clipPos(this,anchor),_clipPos(this,head||anchor))),setSelection(this,normalizeSelection(this.cm,ranges,ranges.length-1),options)}),getSelection:function getSelection(lineSep){for(var ranges=this.sel.ranges,i=0,lines,sel;i<ranges.length;i++)sel=getBetween(this,ranges[i].from(),ranges[i].to()),lines=lines?lines.concat(sel):sel;return!1===lineSep?lines:lines.join(lineSep||this.lineSeparator())},getSelections:function getSelections(lineSep){for(var parts=[],ranges=this.sel.ranges,i=0,sel;i<ranges.length;i++)sel=getBetween(this,ranges[i].from(),ranges[i].to()),!1!==lineSep&&(sel=sel.join(lineSep||this.lineSeparator())),parts[i]=sel;return parts},replaceSelection:function replaceSelection(code,collapse,origin){for(var dup=[],i=0;i<this.sel.ranges.length;i++)dup[i]=code;this.replaceSelections(dup,collapse,origin||"+input")},replaceSelections:docMethodOp(function(code,collapse,origin){for(var changes=[],sel=this.sel,i=0,range;i<sel.ranges.length;i++)range=sel.ranges[i],changes[i]={from:range.from(),to:range.to(),text:this.splitLines(code[i]),origin:origin};for(var newSel=collapse&&"end"!=collapse&&computeReplacedSel(this,changes,collapse),i$1=changes.length-1;0<=i$1;i$1--)makeChange(this,changes[i$1]);newSel?setSelectionReplaceHistory(this,newSel):this.cm&&ensureCursorVisible(this.cm)}),undo:docMethodOp(function(){makeChangeFromHistory(this,"undo")}),redo:docMethodOp(function(){makeChangeFromHistory(this,"redo")}),undoSelection:docMethodOp(function(){makeChangeFromHistory(this,"undo",!0)}),redoSelection:docMethodOp(function(){makeChangeFromHistory(this,"redo",!0)}),setExtending:function setExtending(val){this.extend=val},getExtending:function getExtending(){return this.extend},historySize:function historySize(){for(var hist=this.history,done=0,undone=0,i=0;i<hist.done.length;i++)hist.done[i].ranges||++done;for(var i$1=0;i$1<hist.undone.length;i$1++)hist.undone[i$1].ranges||++undone;return{undo:done,redo:undone}},clearHistory:function clearHistory(){var this$1=this;this.history=new History(this.history.maxGeneration),linkedDocs(this,function(doc){return doc.history=this$1.history},!0)},markClean:function markClean(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function changeGeneration(forceSplit){return forceSplit&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null),this.history.generation},isClean:function isClean(gen){return this.history.generation==(gen||this.cleanGeneration)},getHistory:function getHistory(){return{done:copyHistoryArray(this.history.done),undone:copyHistoryArray(this.history.undone)}},setHistory:function setHistory(histData){var hist=this.history=new History(this.history.maxGeneration);hist.done=copyHistoryArray(histData.done.slice(0),null,!0),hist.undone=copyHistoryArray(histData.undone.slice(0),null,!0)},setGutterMarker:docMethodOp(function(line,gutterID,value){return changeLine(this,line,"gutter",function(line){var markers=line.gutterMarkers||(line.gutterMarkers={});return markers[gutterID]=value,!value&&isEmpty(markers)&&(line.gutterMarkers=null),!0})}),clearGutter:docMethodOp(function(gutterID){var this$1=this;this.iter(function(line){line.gutterMarkers&&line.gutterMarkers[gutterID]&&changeLine(this$1,line,"gutter",function(){return line.gutterMarkers[gutterID]=null,isEmpty(line.gutterMarkers)&&(line.gutterMarkers=null),!0})})}),lineInfo:function lineInfo(line){var n;if("number"==typeof line){if(!isLine(this,line))return null;if(n=line,line=getLine(this,line),!line)return null}else if(n=lineNo(line),null==n)return null;return{line:n,handle:line,text:line.text,gutterMarkers:line.gutterMarkers,textClass:line.textClass,bgClass:line.bgClass,wrapClass:line.wrapClass,widgets:line.widgets}},addLineClass:docMethodOp(function(handle,where,cls){return changeLine(this,handle,"gutter"==where?"gutter":"class",function(line){var prop="text"==where?"textClass":"background"==where?"bgClass":"gutter"==where?"gutterClass":"wrapClass";if(!line[prop])line[prop]=cls;else{if(classTest(cls).test(line[prop]))return!1;line[prop]+=" "+cls}return!0})}),removeLineClass:docMethodOp(function(handle,where,cls){return changeLine(this,handle,"gutter"==where?"gutter":"class",function(line){var prop="text"==where?"textClass":"background"==where?"bgClass":"gutter"==where?"gutterClass":"wrapClass",cur=line[prop];if(!cur)return!1;if(null==cls)line[prop]=null;else{var found=cur.match(classTest(cls));if(!found)return!1;var end=found.index+found[0].length;line[prop]=cur.slice(0,found.index)+(found.index&&end!=cur.length?" ":"")+cur.slice(end)||null}return!0})}),addLineWidget:docMethodOp(function(handle,node,options){return addLineWidget(this,handle,node,options)}),removeLineWidget:function removeLineWidget(widget){widget.clear()},markText:function markText(from,to,options){return _markText(this,_clipPos(this,from),_clipPos(this,to),options,options&&options.type||"range")},setBookmark:function setBookmark(pos,options){var realOpts={replacedWith:options&&(null==options.nodeType?options.widget:options),insertLeft:options&&options.insertLeft,clearWhenEmpty:!1,shared:options&&options.shared,handleMouseEvents:options&&options.handleMouseEvents};return pos=_clipPos(this,pos),_markText(this,pos,pos,realOpts,"bookmark")},findMarksAt:function findMarksAt(pos){pos=_clipPos(this,pos);var markers=[],spans=getLine(this,pos.line).markedSpans;if(spans)for(var i=0,span;i<spans.length;++i)span=spans[i],(null==span.from||span.from<=pos.ch)&&(null==span.to||span.to>=pos.ch)&&markers.push(span.marker.parent||span.marker);return markers},findMarks:function findMarks(from,to,filter){from=_clipPos(this,from),to=_clipPos(this,to);var found=[],lineNo=from.line;return this.iter(from.line,to.line+1,function(line){var spans=line.markedSpans;if(spans)for(var i=0,span;i<spans.length;i++)span=spans[i],null!=span.to&&lineNo==from.line&&from.ch>=span.to||null==span.from&&lineNo!=from.line||null!=span.from&&lineNo==to.line&&span.from>=to.ch||filter&&!filter(span.marker)||found.push(span.marker.parent||span.marker);++lineNo}),found},getAllMarks:function getAllMarks(){var markers=[];return this.iter(function(line){var sps=line.markedSpans;if(sps)for(var i=0;i<sps.length;++i)null!=sps[i].from&&markers.push(sps[i].marker)}),markers},posFromIndex:function posFromIndex(off){var lineNo=this.first,sepSize=this.lineSeparator().length,ch;return this.iter(function(line){var sz=line.text.length+sepSize;return sz>off?(ch=off,!0):void(off-=sz,++lineNo)}),_clipPos(this,Pos(lineNo,ch))},indexFromPos:function indexFromPos(coords){coords=_clipPos(this,coords);var index=coords.ch;if(coords.line<this.first||0>coords.ch)return 0;var sepSize=this.lineSeparator().length;return this.iter(this.first,coords.line,function(line){index+=line.text.length+sepSize}),index},copy:function copy(copyHistory){var doc=new Doc(getLines(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);return doc.scrollTop=this.scrollTop,doc.scrollLeft=this.scrollLeft,doc.sel=this.sel,doc.extend=!1,copyHistory&&(doc.history.undoDepth=this.history.undoDepth,doc.setHistory(this.getHistory())),doc},linkedDoc:function linkedDoc(options){options||(options={});var from=this.first,to=this.first+this.size;null!=options.from&&options.from>from&&(from=options.from),null!=options.to&&options.to<to&&(to=options.to);var copy=new Doc(getLines(this,from,to),options.mode||this.modeOption,from,this.lineSep,this.direction);return options.sharedHist&&(copy.history=this.history),(this.linked||(this.linked=[])).push({doc:copy,sharedHist:options.sharedHist}),copy.linked=[{doc:this,isParent:!0,sharedHist:options.sharedHist}],copySharedMarkers(copy,findSharedMarkers(this)),copy},unlinkDoc:function unlinkDoc(other){if(other instanceof CodeMirror&&(other=other.doc),this.linked)for(var i=0,link;i<this.linked.length;++i)if(link=this.linked[i],link.doc==other){this.linked.splice(i,1),other.unlinkDoc(this),detachSharedMarkers(findSharedMarkers(this));break}if(other.history==this.history){var splitIds=[other.id];linkedDocs(other,function(doc){return splitIds.push(doc.id)},!0),other.history=new History(null),other.history.done=copyHistoryArray(this.history.done,splitIds),other.history.undone=copyHistoryArray(this.history.undone,splitIds)}},iterLinkedDocs:function iterLinkedDocs(f){linkedDocs(this,f)},getMode:function(){return this.mode},getEditor:function getEditor(){return this.cm},splitLines:function splitLines(str){return this.lineSep?str.split(this.lineSep):splitLinesAuto(str)},lineSeparator:function lineSeparator(){return this.lineSep||"\n"},setDirection:docMethodOp(function(dir){"rtl"!=dir&&(dir="ltr"),dir==this.direction||(this.direction=dir,this.iter(function(line){return line.order=null}),this.cm&&directionChanged(this.cm))})}),Doc.prototype.eachLine=Doc.prototype.iter;for(var lastDrop=0,globalsRegistered=!1,keyNames={3:"Pause",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",145:"ScrollLock",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},i=0;10>i;i++)keyNames[i+48]=keyNames[i+96]=i+"";for(var i$1=65;90>=i$1;i$1++)keyNames[i$1]=_StringfromCharCode(i$1);for(var i$2=1;12>=i$2;i$2++)keyNames[i$2+111]=keyNames[i$2+63235]="F"+i$2;var keyMap={};keyMap.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},keyMap.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},keyMap.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},keyMap.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft","Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]},keyMap["default"]=mac?keyMap.macDefault:keyMap.pcDefault;var commands={selectAll:selectAll,singleSelection:function singleSelection(cm){return cm.setSelection(cm.getCursor("anchor"),cm.getCursor("head"),sel_dontScroll)},killLine:function killLine(cm){return deleteNearSelection(cm,function(range){if(range.empty()){var len=getLine(cm.doc,range.head.line).text.length;return range.head.ch==len&&range.head.line<cm.lastLine()?{from:range.head,to:Pos(range.head.line+1,0)}:{from:range.head,to:Pos(range.head.line,len)}}return{from:range.from(),to:range.to()}})},deleteLine:function deleteLine(cm){return deleteNearSelection(cm,function(range){return{from:Pos(range.from().line,0),to:_clipPos(cm.doc,Pos(range.to().line+1,0))}})},delLineLeft:function delLineLeft(cm){return deleteNearSelection(cm,function(range){return{from:Pos(range.from().line,0),to:range.from()}})},delWrappedLineLeft:function delWrappedLineLeft(cm){return deleteNearSelection(cm,function(range){var top=cm.charCoords(range.head,"div").top+5,leftPos=cm.coordsChar({left:0,top:top},"div");return{from:leftPos,to:range.from()}})},delWrappedLineRight:function delWrappedLineRight(cm){return deleteNearSelection(cm,function(range){var top=cm.charCoords(range.head,"div").top+5,rightPos=cm.coordsChar({left:cm.display.lineDiv.offsetWidth+100,top:top},"div");return{from:range.from(),to:rightPos}})},undo:function undo(cm){return cm.undo()},redo:function redo(cm){return cm.redo()},undoSelection:function undoSelection(cm){return cm.undoSelection()},redoSelection:function redoSelection(cm){return cm.redoSelection()},goDocStart:function goDocStart(cm){return cm.extendSelection(Pos(cm.firstLine(),0))},goDocEnd:function goDocEnd(cm){return cm.extendSelection(Pos(cm.lastLine()))},goLineStart:function goLineStart(cm){return cm.extendSelectionsBy(function(range){return lineStart(cm,range.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function goLineStartSmart(cm){return cm.extendSelectionsBy(function(range){return lineStartSmart(cm,range.head)},{origin:"+move",bias:1})},goLineEnd:function goLineEnd(cm){return cm.extendSelectionsBy(function(range){return lineEnd(cm,range.head.line)},{origin:"+move",bias:-1})},goLineRight:function goLineRight(cm){return cm.extendSelectionsBy(function(range){var top=cm.cursorCoords(range.head,"div").top+5;return cm.coordsChar({left:cm.display.lineDiv.offsetWidth+100,top:top},"div")},sel_move)},goLineLeft:function goLineLeft(cm){return cm.extendSelectionsBy(function(range){var top=cm.cursorCoords(range.head,"div").top+5;return cm.coordsChar({left:0,top:top},"div")},sel_move)},goLineLeftSmart:function goLineLeftSmart(cm){return cm.extendSelectionsBy(function(range){var top=cm.cursorCoords(range.head,"div").top+5,pos=cm.coordsChar({left:0,top:top},"div");return pos.ch<cm.getLine(pos.line).search(/\S/)?lineStartSmart(cm,range.head):pos},sel_move)},goLineUp:function goLineUp(cm){return cm.moveV(-1,"line")},goLineDown:function goLineDown(cm){return cm.moveV(1,"line")},goPageUp:function goPageUp(cm){return cm.moveV(-1,"page")},goPageDown:function goPageDown(cm){return cm.moveV(1,"page")},goCharLeft:function goCharLeft(cm){return cm.moveH(-1,"char")},goCharRight:function goCharRight(cm){return cm.moveH(1,"char")},goColumnLeft:function goColumnLeft(cm){return cm.moveH(-1,"column")},goColumnRight:function goColumnRight(cm){return cm.moveH(1,"column")},goWordLeft:function goWordLeft(cm){return cm.moveH(-1,"word")},goGroupRight:function goGroupRight(cm){return cm.moveH(1,"group")},goGroupLeft:function goGroupLeft(cm){return cm.moveH(-1,"group")},goWordRight:function goWordRight(cm){return cm.moveH(1,"word")},delCharBefore:function delCharBefore(cm){return cm.deleteH(-1,"char")},delCharAfter:function delCharAfter(cm){return cm.deleteH(1,"char")},delWordBefore:function delWordBefore(cm){return cm.deleteH(-1,"word")},delWordAfter:function delWordAfter(cm){return cm.deleteH(1,"word")},delGroupBefore:function delGroupBefore(cm){return cm.deleteH(-1,"group")},delGroupAfter:function delGroupAfter(cm){return cm.deleteH(1,"group")},indentAuto:function indentAuto(cm){return cm.indentSelection("smart")},indentMore:function indentMore(cm){return cm.indentSelection("add")},indentLess:function indentLess(cm){return cm.indentSelection("subtract")},insertTab:function insertTab(cm){return cm.replaceSelection("\t")},insertSoftTab:function insertSoftTab(cm){for(var spaces=[],ranges=cm.listSelections(),tabSize=cm.options.tabSize,i=0;i<ranges.length;i++){var pos=ranges[i].from(),col=countColumn(cm.getLine(pos.line),pos.ch,tabSize);spaces.push(spaceStr(tabSize-col%tabSize))}cm.replaceSelections(spaces)},defaultTab:function defaultTab(cm){cm.somethingSelected()?cm.indentSelection("add"):cm.execCommand("insertTab")},transposeChars:function transposeChars(cm){return runInOp(cm,function(){for(var ranges=cm.listSelections(),newSel=[],i=0;i<ranges.length;i++)if(ranges[i].empty()){var cur=ranges[i].head,line=getLine(cm.doc,cur.line).text;if(line)if(cur.ch==line.length&&(cur=new Pos(cur.line,cur.ch-1)),0<cur.ch)cur=new Pos(cur.line,cur.ch+1),cm.replaceRange(line.charAt(cur.ch-1)+line.charAt(cur.ch-2),Pos(cur.line,cur.ch-2),cur,"+transpose");else if(cur.line>cm.doc.first){var prev=getLine(cm.doc,cur.line-1).text;prev&&(cur=new Pos(cur.line,1),cm.replaceRange(line.charAt(0)+cm.doc.lineSeparator()+prev.charAt(prev.length-1),Pos(cur.line-1,prev.length-1),cur,"+transpose"))}newSel.push(new Range(cur,cur))}cm.setSelections(newSel)})},newlineAndIndent:function newlineAndIndent(cm){return runInOp(cm,function(){for(var sels=cm.listSelections(),i=sels.length-1;0<=i;i--)cm.replaceRange(cm.doc.lineSeparator(),sels[i].anchor,sels[i].head,"+input");sels=cm.listSelections();for(var i$1=0;i$1<sels.length;i$1++)cm.indentLine(sels[i$1].from().line,null,!0);ensureCursorVisible(cm)})},openLine:function openLine(cm){return cm.replaceSelection("\n","start")},toggleOverwrite:function toggleOverwrite(cm){return cm.toggleOverwrite()}},stopSeq=new Delayed,lastStoppedKey=null,PastClick=function(time,pos,button){this.time=time,this.pos=pos,this.button=button};PastClick.prototype.compare=function(time,pos,button){return this.time+400>time&&0==cmp(pos,this.pos)&&button==this.button};var Init={toString:function toString(){return"CodeMirror.Init"}},defaults={},optionHandlers={},lastClick,lastDoubleClick;CodeMirror.defaults=defaults,CodeMirror.optionHandlers=optionHandlers;var initHooks=[];CodeMirror.defineInitHook=function(f){return initHooks.push(f)};var lastCopied=null,ContentEditableInput=function(cm){this.cm=cm,this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null,this.polling=new Delayed,this.composing=null,this.gracePeriod=!1,this.readDOMTimeout=null};ContentEditableInput.prototype.init=function(display){function belongsToInput(e){for(var t=e.target;t;t=t.parentNode){if(t==div)return!0;if(/\bCodeMirror-(?:line)?widget\b/.test(t.className))break}return!1}function onCopyCut(e){if(belongsToInput(e)&&!signalDOMEvent(cm,e)){if(cm.somethingSelected())setLastCopied({lineWise:!1,text:cm.getSelections()}),"cut"==e.type&&cm.replaceSelection("",null,"cut");else{if(!cm.options.lineWiseCopyCut)return;var ranges=copyableRanges(cm);setLastCopied({lineWise:!0,text:ranges.text}),"cut"==e.type&&cm.operation(function(){cm.setSelections(ranges.ranges,0,sel_dontScroll),cm.replaceSelection("",null,"cut")})}if(e.clipboardData){e.clipboardData.clearData();var content=lastCopied.text.join("\n");if(e.clipboardData.setData("Text",content),e.clipboardData.getData("Text")==content)return void e.preventDefault()}var kludge=hiddenTextarea(),te=kludge.firstChild;cm.display.lineSpace.insertBefore(kludge,cm.display.lineSpace.firstChild),te.value=lastCopied.text.join("\n");var hadFocus=document.activeElement;selectInput(te),setTimeout(function(){cm.display.lineSpace.removeChild(kludge),hadFocus.focus(),hadFocus==div&&input.showPrimarySelection()},50)}}var this$1=this,input=this,cm=input.cm,div=input.div=display.lineDiv;disableBrowserMagic(div,cm.options.spellcheck,cm.options.autocorrect,cm.options.autocapitalize),on(div,"paste",function(e){!belongsToInput(e)||signalDOMEvent(cm,e)||handlePaste(e,cm)||11>=ie_version&&setTimeout(operation(cm,function(){return this$1.updateFromDOM()}),20)}),on(div,"compositionstart",function(e){this$1.composing={data:e.data,done:!1}}),on(div,"compositionupdate",function(e){this$1.composing||(this$1.composing={data:e.data,done:!1})}),on(div,"compositionend",function(e){this$1.composing&&(e.data!=this$1.composing.data&&this$1.readFromDOMSoon(),this$1.composing.done=!0)}),on(div,"touchstart",function(){return input.forceCompositionEnd()}),on(div,"input",function(){this$1.composing||this$1.readFromDOMSoon()}),on(div,"copy",onCopyCut),on(div,"cut",onCopyCut)},ContentEditableInput.prototype.screenReaderLabelChanged=function(label){label?this.div.setAttribute("aria-label",label):this.div.removeAttribute("aria-label")},ContentEditableInput.prototype.prepareSelection=function(){var result=prepareSelection(this.cm,!1);return result.focus=document.activeElement==this.div,result},ContentEditableInput.prototype.showSelection=function(info,takeFocus){info&&this.cm.display.view.length&&((info.focus||takeFocus)&&this.showPrimarySelection(),this.showMultipleSelections(info))},ContentEditableInput.prototype.getSelection=function(){return this.cm.display.wrapper.ownerDocument.getSelection()},ContentEditableInput.prototype.showPrimarySelection=function(){var sel=this.getSelection(),cm=this.cm,prim=cm.doc.sel.primary(),from=prim.from(),to=prim.to();if(cm.display.viewTo==cm.display.viewFrom||from.line>=cm.display.viewTo||to.line<cm.display.viewFrom)return void sel.removeAllRanges();var curAnchor=domToPos(cm,sel.anchorNode,sel.anchorOffset),curFocus=domToPos(cm,sel.focusNode,sel.focusOffset);if(!curAnchor||curAnchor.bad||!curFocus||curFocus.bad||0!=cmp(minPos(curAnchor,curFocus),from)||0!=cmp(maxPos(curAnchor,curFocus),to)){var view=cm.display.view,start=from.line>=cm.display.viewFrom&&posToDOM(cm,from)||{node:view[0].measure.map[2],offset:0},end=to.line<cm.display.viewTo&&posToDOM(cm,to);if(!end){var measure=view[view.length-1].measure,map=measure.maps?measure.maps[measure.maps.length-1]:measure.map;end={node:map[map.length-1],offset:map[map.length-2]-map[map.length-3]}}if(!start||!end)return void sel.removeAllRanges();var old=sel.rangeCount&&sel.getRangeAt(0),rng;try{rng=range(start.node,start.offset,end.offset,end.node)}catch(e){}rng&&(!gecko&&cm.state.focused?(sel.collapse(start.node,start.offset),!rng.collapsed&&(sel.removeAllRanges(),sel.addRange(rng))):(sel.removeAllRanges(),sel.addRange(rng)),old&&null==sel.anchorNode?sel.addRange(old):gecko&&this.startGracePeriod()),this.rememberSelection()}},ContentEditableInput.prototype.startGracePeriod=function(){var this$1=this;clearTimeout(this.gracePeriod),this.gracePeriod=setTimeout(function(){this$1.gracePeriod=!1,this$1.selectionChanged()&&this$1.cm.operation(function(){return this$1.cm.curOp.selectionChanged=!0})},20)},ContentEditableInput.prototype.showMultipleSelections=function(info){removeChildrenAndAdd(this.cm.display.cursorDiv,info.cursors),removeChildrenAndAdd(this.cm.display.selectionDiv,info.selection)},ContentEditableInput.prototype.rememberSelection=function(){var sel=this.getSelection();this.lastAnchorNode=sel.anchorNode,this.lastAnchorOffset=sel.anchorOffset,this.lastFocusNode=sel.focusNode,this.lastFocusOffset=sel.focusOffset},ContentEditableInput.prototype.selectionInEditor=function(){var sel=this.getSelection();if(!sel.rangeCount)return!1;var node=sel.getRangeAt(0).commonAncestorContainer;return contains(this.div,node)},ContentEditableInput.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&((!this.selectionInEditor()||document.activeElement!=this.div)&&this.showSelection(this.prepareSelection(),!0),this.div.focus())},ContentEditableInput.prototype.blur=function(){this.div.blur()},ContentEditableInput.prototype.getField=function(){return this.div},ContentEditableInput.prototype.supportsTouch=function(){return!0},ContentEditableInput.prototype.receivedFocus=function(){function poll(){input.cm.state.focused&&(input.pollSelection(),input.polling.set(input.cm.options.pollInterval,poll))}var input=this;this.selectionInEditor()?this.pollSelection():runInOp(this.cm,function(){return input.cm.curOp.selectionChanged=!0}),this.polling.set(this.cm.options.pollInterval,poll)},ContentEditableInput.prototype.selectionChanged=function(){var sel=this.getSelection();return sel.anchorNode!=this.lastAnchorNode||sel.anchorOffset!=this.lastAnchorOffset||sel.focusNode!=this.lastFocusNode||sel.focusOffset!=this.lastFocusOffset},ContentEditableInput.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var sel=this.getSelection(),cm=this.cm;if(android&&chrome&&this.cm.display.gutterSpecs.length&&isInGutter(sel.anchorNode))return this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:_Mathabs}),this.blur(),void this.focus();if(!this.composing){this.rememberSelection();var anchor=domToPos(cm,sel.anchorNode,sel.anchorOffset),head=domToPos(cm,sel.focusNode,sel.focusOffset);anchor&&head&&runInOp(cm,function(){setSelection(cm.doc,simpleSelection(anchor,head),sel_dontScroll),(anchor.bad||head.bad)&&(cm.curOp.selectionChanged=!0)})}}},ContentEditableInput.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=null);var cm=this.cm,display=cm.display,sel=cm.doc.sel.primary(),from=sel.from(),to=sel.to();if(0==from.ch&&from.line>cm.firstLine()&&(from=Pos(from.line-1,getLine(cm.doc,from.line-1).length)),to.ch==getLine(cm.doc,to.line).text.length&&to.line<cm.lastLine()&&(to=Pos(to.line+1,0)),from.line<display.viewFrom||to.line>display.viewTo-1)return!1;var fromIndex,fromLine,fromNode;from.line==display.viewFrom||0==(fromIndex=findViewIndex(cm,from.line))?(fromLine=lineNo(display.view[0].line),fromNode=display.view[0].node):(fromLine=lineNo(display.view[fromIndex].line),fromNode=display.view[fromIndex-1].node.nextSibling);var toIndex=findViewIndex(cm,to.line),toLine,toNode;if(toIndex==display.view.length-1?(toLine=display.viewTo-1,toNode=display.lineDiv.lastChild):(toLine=lineNo(display.view[toIndex+1].line)-1,toNode=display.view[toIndex+1].node.previousSibling),!fromNode)return!1;for(var newText=cm.doc.splitLines(domTextBetween(cm,fromNode,toNode,fromLine,toLine)),oldText=getBetween(cm.doc,Pos(fromLine,0),Pos(toLine,getLine(cm.doc,toLine).text.length));1<newText.length&&1<oldText.length;)if(lst(newText)==lst(oldText))newText.pop(),oldText.pop(),toLine--;else if(newText[0]==oldText[0])newText.shift(),oldText.shift(),fromLine++;else break;for(var cutFront=0,cutEnd=0,newTop=newText[0],oldTop=oldText[0],maxCutFront=_Mathmin(newTop.length,oldTop.length);cutFront<maxCutFront&&newTop.charCodeAt(cutFront)==oldTop.charCodeAt(cutFront);)++cutFront;for(var newBot=lst(newText),oldBot=lst(oldText),maxCutEnd=_Mathmin(newBot.length-(1==newText.length?cutFront:0),oldBot.length-(1==oldText.length?cutFront:0));cutEnd<maxCutEnd&&newBot.charCodeAt(newBot.length-cutEnd-1)==oldBot.charCodeAt(oldBot.length-cutEnd-1);)++cutEnd;if(1==newText.length&&1==oldText.length&&fromLine==from.line)for(;cutFront&&cutFront>from.ch&&newBot.charCodeAt(newBot.length-cutEnd-1)==oldBot.charCodeAt(oldBot.length-cutEnd-1);)cutFront--,cutEnd++;newText[newText.length-1]=newBot.slice(0,newBot.length-cutEnd).replace(/^\u200b+/,""),newText[0]=newText[0].slice(cutFront).replace(/\u200b+$/,"");var chFrom=Pos(fromLine,cutFront),chTo=Pos(toLine,oldText.length?lst(oldText).length-cutEnd:0);if(1<newText.length||newText[0]||cmp(chFrom,chTo))return _replaceRange(cm.doc,newText,chFrom,chTo,"+input"),!0},ContentEditableInput.prototype.ensurePolled=function(){this.forceCompositionEnd()},ContentEditableInput.prototype.reset=function(){this.forceCompositionEnd()},ContentEditableInput.prototype.forceCompositionEnd=function(){this.composing&&(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())},ContentEditableInput.prototype.readFromDOMSoon=function(){var this$1=this;null!=this.readDOMTimeout||(this.readDOMTimeout=setTimeout(function(){if(this$1.readDOMTimeout=null,this$1.composing)if(this$1.composing.done)this$1.composing=null;else return;this$1.updateFromDOM()},80))},ContentEditableInput.prototype.updateFromDOM=function(){var this$1=this;(this.cm.isReadOnly()||!this.pollContent())&&runInOp(this.cm,function(){return regChange(this$1.cm)})},ContentEditableInput.prototype.setUneditable=function(node){node.contentEditable="false"},ContentEditableInput.prototype.onKeyPress=function(e){0==e.charCode||this.composing||(e.preventDefault(),!this.cm.isReadOnly()&&operation(this.cm,applyTextInput)(this.cm,_StringfromCharCode(null==e.charCode?e.keyCode:e.charCode),0))},ContentEditableInput.prototype.readOnlyChanged=function(val){this.div.contentEditable=("nocursor"!=val)+""},ContentEditableInput.prototype.onContextMenu=function(){},ContentEditableInput.prototype.resetPosition=function(){},ContentEditableInput.prototype.needsContentAttribute=!0;var TextareaInput=function(cm){this.cm=cm,this.prevInput="",this.pollingFast=!1,this.polling=new Delayed,this.hasSelection=!1,this.composing=null};TextareaInput.prototype.init=function(display){function prepareCopyCut(e){if(!signalDOMEvent(cm,e)){if(cm.somethingSelected())setLastCopied({lineWise:!1,text:cm.getSelections()});else{if(!cm.options.lineWiseCopyCut)return;var ranges=copyableRanges(cm);setLastCopied({lineWise:!0,text:ranges.text}),"cut"==e.type?cm.setSelections(ranges.ranges,null,sel_dontScroll):(input.prevInput="",te.value=ranges.text.join("\n"),selectInput(te))}"cut"==e.type&&(cm.state.cutIncoming=+new Date)}}var this$1=this,input=this,cm=this.cm;this.createField(display);var te=this.textarea;display.wrapper.insertBefore(this.wrapper,display.wrapper.firstChild),ios&&(te.style.width="0px"),on(te,"input",function(){ie&&9<=ie_version&&this$1.hasSelection&&(this$1.hasSelection=null),input.poll()}),on(te,"paste",function(e){signalDOMEvent(cm,e)||handlePaste(e,cm)||(cm.state.pasteIncoming=+new Date,input.fastPoll())}),on(te,"cut",prepareCopyCut),on(te,"copy",prepareCopyCut),on(display.scroller,"paste",function(e){if(!(eventInWidget(display,e)||signalDOMEvent(cm,e))){if(!te.dispatchEvent)return cm.state.pasteIncoming=+new Date,void input.focus();var event=new Event("paste");event.clipboardData=e.clipboardData,te.dispatchEvent(event)}}),on(display.lineSpace,"selectstart",function(e){eventInWidget(display,e)||e_preventDefault(e)}),on(te,"compositionstart",function(){var start=cm.getCursor("from");input.composing&&input.composing.range.clear(),input.composing={start:start,range:cm.markText(start,cm.getCursor("to"),{className:"CodeMirror-composing"})}}),on(te,"compositionend",function(){input.composing&&(input.poll(),input.composing.range.clear(),input.composing=null)})},TextareaInput.prototype.createField=function(){this.wrapper=hiddenTextarea(),this.textarea=this.wrapper.firstChild},TextareaInput.prototype.screenReaderLabelChanged=function(label){label?this.textarea.setAttribute("aria-label",label):this.textarea.removeAttribute("aria-label")},TextareaInput.prototype.prepareSelection=function(){var cm=this.cm,display=cm.display,doc=cm.doc,result=prepareSelection(cm);if(cm.options.moveInputWithCursor){var headPos=_cursorCoords(cm,doc.sel.primary().head,"div"),wrapOff=display.wrapper.getBoundingClientRect(),lineOff=display.lineDiv.getBoundingClientRect();result.teTop=_Mathmax(0,_Mathmin(display.wrapper.clientHeight-10,headPos.top+lineOff.top-wrapOff.top)),result.teLeft=_Mathmax(0,_Mathmin(display.wrapper.clientWidth-10,headPos.left+lineOff.left-wrapOff.left))}return result},TextareaInput.prototype.showSelection=function(drawn){var cm=this.cm,display=cm.display;removeChildrenAndAdd(display.cursorDiv,drawn.cursors),removeChildrenAndAdd(display.selectionDiv,drawn.selection),null!=drawn.teTop&&(this.wrapper.style.top=drawn.teTop+"px",this.wrapper.style.left=drawn.teLeft+"px")},TextareaInput.prototype.reset=function(typing){if(!(this.contextMenuPending||this.composing)){var cm=this.cm;if(cm.somethingSelected()){this.prevInput="";var content=cm.getSelection();this.textarea.value=content,cm.state.focused&&selectInput(this.textarea),ie&&9<=ie_version&&(this.hasSelection=content)}else typing||(this.prevInput=this.textarea.value="",ie&&9<=ie_version&&(this.hasSelection=null))}},TextareaInput.prototype.getField=function(){return this.textarea},TextareaInput.prototype.supportsTouch=function(){return!1},TextareaInput.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!mobile||activeElt()!=this.textarea))try{this.textarea.focus()}catch(e){}},TextareaInput.prototype.blur=function(){this.textarea.blur()},TextareaInput.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0},TextareaInput.prototype.receivedFocus=function(){this.slowPoll()},TextareaInput.prototype.slowPoll=function(){var this$1=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,function(){this$1.poll(),this$1.cm.state.focused&&this$1.slowPoll()})},TextareaInput.prototype.fastPoll=function(){function p(){var changed=input.poll();changed||missed?(input.pollingFast=!1,input.slowPoll()):(missed=!0,input.polling.set(60,p))}var missed=!1,input=this;input.pollingFast=!0,input.polling.set(20,p)},TextareaInput.prototype.poll=function(){var this$1=this,cm=this.cm,input=this.textarea,prevInput=this.prevInput;if(this.contextMenuPending||!cm.state.focused||hasSelection(input)&&!prevInput&&!this.composing||cm.isReadOnly()||cm.options.disableInput||cm.state.keySeq)return!1;var text=input.value;if(text==prevInput&&!cm.somethingSelected())return!1;if(ie&&9<=ie_version&&this.hasSelection===text||mac&&/[\uf700-\uf7ff]/.test(text))return cm.display.input.reset(),!1;if(cm.doc.sel==cm.display.selForContextMenu){var first=text.charCodeAt(0);if(8203!=first||prevInput||(prevInput="\u200B"),8666==first)return this.reset(),this.cm.execCommand("undo")}for(var same=0,l=_Mathmin(prevInput.length,text.length);same<l&&prevInput.charCodeAt(same)==text.charCodeAt(same);)++same;return runInOp(cm,function(){applyTextInput(cm,text.slice(same),prevInput.length-same,null,this$1.composing?"*compose":null),1e3<text.length||-1<text.indexOf("\n")?input.value=this$1.prevInput="":this$1.prevInput=text,this$1.composing&&(this$1.composing.range.clear(),this$1.composing.range=cm.markText(this$1.composing.start,cm.getCursor("to"),{className:"CodeMirror-composing"}))}),!0},TextareaInput.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)},TextareaInput.prototype.onKeyPress=function(){ie&&9<=ie_version&&(this.hasSelection=null),this.fastPoll()},TextareaInput.prototype.onContextMenu=function(e){function prepareSelectAllHack(){if(null!=te.selectionStart){var selected=cm.somethingSelected(),extval="\u200B"+(selected?te.value:"");te.value="\u21DA",te.value=extval,input.prevInput=selected?"":"\u200B",te.selectionStart=1,te.selectionEnd=extval.length,display.selForContextMenu=cm.doc.sel}}function rehide(){if(input.contextMenuPending==rehide&&(input.contextMenuPending=!1,input.wrapper.style.cssText=oldWrapperCSS,te.style.cssText=oldCSS,ie&&9>ie_version&&display.scrollbars.setScrollTop(display.scroller.scrollTop=scrollPos),null!=te.selectionStart)){(!ie||ie&&9>ie_version)&&prepareSelectAllHack();var i=0,poll=function(){display.selForContextMenu==cm.doc.sel&&0==te.selectionStart&&0<te.selectionEnd&&"\u200B"==input.prevInput?operation(cm,selectAll)(cm):10>i++?display.detectingSelectAll=setTimeout(poll,500):(display.selForContextMenu=null,display.input.reset())};display.detectingSelectAll=setTimeout(poll,200)}}var input=this,cm=input.cm,display=cm.display,te=input.textarea;input.contextMenuPending&&input.contextMenuPending();var pos=posFromMouse(cm,e),scrollPos=display.scroller.scrollTop;if(pos&&!presto){var reset=cm.options.resetSelectionOnContextMenu;reset&&-1==cm.doc.sel.contains(pos)&&operation(cm,setSelection)(cm.doc,simpleSelection(pos),sel_dontScroll);var oldCSS=te.style.cssText,oldWrapperCSS=input.wrapper.style.cssText,wrapperBox=input.wrapper.offsetParent.getBoundingClientRect();input.wrapper.style.cssText="position: static",te.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(e.clientY-wrapperBox.top-5)+"px; left: "+(e.clientX-wrapperBox.left-5)+"px;\n      z-index: 1000; background: "+(ie?"rgba(255, 255, 255, .05)":"transparent")+";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";var oldScrollY;if(webkit&&(oldScrollY=window.scrollY),display.input.focus(),webkit&&window.scrollTo(null,oldScrollY),display.input.reset(),cm.somethingSelected()||(te.value=input.prevInput=" "),input.contextMenuPending=rehide,display.selForContextMenu=cm.doc.sel,clearTimeout(display.detectingSelectAll),ie&&9<=ie_version&&prepareSelectAllHack(),captureRightClick){e_stop(e);var mouseup=function(){off(window,"mouseup",mouseup),setTimeout(rehide,20)};on(window,"mouseup",mouseup)}else setTimeout(rehide,50)}},TextareaInput.prototype.readOnlyChanged=function(val){val||this.reset(),this.textarea.disabled="nocursor"==val},TextareaInput.prototype.setUneditable=function(){},TextareaInput.prototype.needsContentAttribute=!1,function(CodeMirror){function option(name,deflt,handle,notOnInit){CodeMirror.defaults[name]=deflt,handle&&(optionHandlers[name]=notOnInit?function(cm,val,old){old!=Init&&handle(cm,val,old)}:handle)}var optionHandlers=CodeMirror.optionHandlers;CodeMirror.defineOption=option,CodeMirror.Init=Init,option("value","",function(cm,val){return cm.setValue(val)},!0),option("mode",null,function(cm,val){cm.doc.modeOption=val,loadMode(cm)},!0),option("indentUnit",2,loadMode,!0),option("indentWithTabs",!1),option("smartIndent",!0),option("tabSize",4,function(cm){resetModeState(cm),clearCaches(cm),regChange(cm)},!0),option("lineSeparator",null,function(cm,val){if(cm.doc.lineSep=val,!!val){var newBreaks=[],lineNo=cm.doc.first;cm.doc.iter(function(line){for(var pos=0,found;;){if(found=line.text.indexOf(val,pos),-1==found)break;pos=found+val.length,newBreaks.push(Pos(lineNo,found))}lineNo++});for(var i=newBreaks.length-1;0<=i;i--)_replaceRange(cm.doc,val,newBreaks[i],Pos(newBreaks[i].line,newBreaks[i].ch+val.length))}}),option("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200c\u200e\u200f\u2028\u2029\ufeff\ufff9-\ufffc]/g,function(cm,val,old){cm.state.specialChars=new RegExp(val.source+(val.test("\t")?"":"|\t"),"g"),old!=Init&&cm.refresh()}),option("specialCharPlaceholder",defaultSpecialCharPlaceholder,function(cm){return cm.refresh()},!0),option("electricChars",!0),option("inputStyle",mobile?"contenteditable":"textarea",function(){throw new Error("inputStyle can not (yet) be changed in a running editor")},!0),option("spellcheck",!1,function(cm,val){return cm.getInputField().spellcheck=val},!0),option("autocorrect",!1,function(cm,val){return cm.getInputField().autocorrect=val},!0),option("autocapitalize",!1,function(cm,val){return cm.getInputField().autocapitalize=val},!0),option("rtlMoveVisually",!windows),option("wholeLineUpdateBefore",!0),option("theme","default",function(cm){themeChanged(cm),updateGutters(cm)},!0),option("keyMap","default",function(cm,val,old){var next=getKeyMap(val),prev=old!=Init&&getKeyMap(old);prev&&prev.detach&&prev.detach(cm,next),next.attach&&next.attach(cm,prev||null)}),option("extraKeys",null),option("configureMouse",null),option("lineWrapping",!1,wrappingChanged,!0),option("gutters",[],function(cm,val){cm.display.gutterSpecs=getGutters(val,cm.options.lineNumbers),updateGutters(cm)},!0),option("fixedGutter",!0,function(cm,val){cm.display.gutters.style.left=val?compensateForHScroll(cm.display)+"px":"0",cm.refresh()},!0),option("coverGutterNextToScrollbar",!1,function(cm){return updateScrollbars(cm)},!0),option("scrollbarStyle","native",function(cm){initScrollbars(cm),updateScrollbars(cm),cm.display.scrollbars.setScrollTop(cm.doc.scrollTop),cm.display.scrollbars.setScrollLeft(cm.doc.scrollLeft)},!0),option("lineNumbers",!1,function(cm,val){cm.display.gutterSpecs=getGutters(cm.options.gutters,val),updateGutters(cm)},!0),option("firstLineNumber",1,updateGutters,!0),option("lineNumberFormatter",function(integer){return integer},updateGutters,!0),option("showCursorWhenSelecting",!1,updateSelection,!0),option("resetSelectionOnContextMenu",!0),option("lineWiseCopyCut",!0),option("pasteLinesPerSelection",!0),option("selectionsMayTouch",!1),option("readOnly",!1,function(cm,val){"nocursor"==val&&(onBlur(cm),cm.display.input.blur()),cm.display.input.readOnlyChanged(val)}),option("screenReaderLabel",null,function(cm,val){val=""===val?null:val,cm.display.input.screenReaderLabelChanged(val)}),option("disableInput",!1,function(cm,val){val||cm.display.input.reset()},!0),option("dragDrop",!0,dragDropChanged),option("allowDropFileTypes",null),option("cursorBlinkRate",530),option("cursorScrollMargin",0),option("cursorHeight",1,updateSelection,!0),option("singleCursorHeightPerLine",!0,updateSelection,!0),option("workTime",100),option("workDelay",100),option("flattenSpans",!0,resetModeState,!0),option("addModeClass",!1,resetModeState,!0),option("pollInterval",100),option("undoDepth",200,function(cm,val){return cm.doc.history.undoDepth=val}),option("historyEventDelay",1250),option("viewportMargin",10,function(cm){return cm.refresh()},!0),option("maxHighlightLength",1e4,resetModeState,!0),option("moveInputWithCursor",!0,function(cm,val){val||cm.display.input.resetPosition()}),option("tabindex",null,function(cm,val){return cm.display.input.getField().tabIndex=val||""}),option("autofocus",null),option("direction","ltr",function(cm,val){return cm.doc.setDirection(val)},!0),option("phrases",null)}(CodeMirror),function(CodeMirror){var optionHandlers=CodeMirror.optionHandlers,helpers=CodeMirror.helpers={};CodeMirror.prototype={constructor:CodeMirror,focus:function focus(){window.focus(),this.display.input.focus()},setOption:function setOption(option,value){var options=this.options,old=options[option];options[option]==value&&"mode"!=option||(options[option]=value,optionHandlers.hasOwnProperty(option)&&operation(this,optionHandlers[option])(this,value,old),signal(this,"optionChange",this,option))},getOption:function getOption(option){return this.options[option]},getDoc:function getDoc(){return this.doc},addKeyMap:function addKeyMap(map,bottom){this.state.keyMaps[bottom?"push":"unshift"](getKeyMap(map))},removeKeyMap:function removeKeyMap(map){for(var maps=this.state.keyMaps,i=0;i<maps.length;++i)if(maps[i]==map||maps[i].name==map)return maps.splice(i,1),!0},addOverlay:methodOp(function(spec,options){var mode=spec.token?spec:CodeMirror.getMode(this.options,spec);if(mode.startState)throw new Error("Overlays may not be stateful.");insertSorted(this.state.overlays,{mode:mode,modeSpec:spec,opaque:options&&options.opaque,priority:options&&options.priority||0},function(overlay){return overlay.priority}),this.state.modeGen++,regChange(this)}),removeOverlay:methodOp(function(spec){for(var overlays=this.state.overlays,i=0,cur;i<overlays.length;++i)if(cur=overlays[i].modeSpec,cur==spec||"string"==typeof spec&&cur.name==spec)return overlays.splice(i,1),this.state.modeGen++,void regChange(this)}),indentLine:methodOp(function(n,dir,aggressive){"string"!=typeof dir&&"number"!=typeof dir&&(null==dir?dir=this.options.smartIndent?"smart":"prev":dir=dir?"add":"subtract"),isLine(this.doc,n)&&indentLine(this,n,dir,aggressive)}),indentSelection:methodOp(function(how){for(var ranges=this.doc.sel.ranges,end=-1,i=0,range;i<ranges.length;i++)if(range=ranges[i],!range.empty()){var from=range.from(),to=range.to(),start=_Mathmax(end,from.line);end=_Mathmin(this.lastLine(),to.line-(to.ch?0:1))+1;for(var j=start;j<end;++j)indentLine(this,j,how);var newRanges=this.doc.sel.ranges;0==from.ch&&ranges.length==newRanges.length&&0<newRanges[i].from().ch&&replaceOneSelection(this.doc,i,new Range(from,newRanges[i].to()),sel_dontScroll)}else range.head.line>end&&(indentLine(this,range.head.line,how,!0),end=range.head.line,i==this.doc.sel.primIndex&&ensureCursorVisible(this))}),getTokenAt:function getTokenAt(pos,precise){return takeToken(this,pos,precise)},getLineTokens:function getLineTokens(line,precise){return takeToken(this,Pos(line),precise,!0)},getTokenTypeAt:function getTokenTypeAt(pos){pos=_clipPos(this.doc,pos);var styles=getLineStyles(this,getLine(this.doc,pos.line)),before=0,after=(styles.length-1)/2,ch=pos.ch,type;if(0==ch)type=styles[2];else for(;;){var mid=before+after>>1;if((mid?styles[2*mid-1]:0)>=ch)after=mid;else if(styles[2*mid+1]<ch)before=mid+1;else{type=styles[2*mid+2];break}}var cut=type?type.indexOf("overlay "):-1;return 0>cut?type:0==cut?null:type.slice(0,cut-1)},getModeAt:function getModeAt(pos){var mode=this.doc.mode;return mode.innerMode?CodeMirror.innerMode(mode,this.getTokenAt(pos).state).mode:mode},getHelper:function getHelper(pos,type){return this.getHelpers(pos,type)[0]},getHelpers:function getHelpers(pos,type){var found=[];if(!helpers.hasOwnProperty(type))return found;var help=helpers[type],mode=this.getModeAt(pos);if("string"==typeof mode[type])help[mode[type]]&&found.push(help[mode[type]]);else if(mode[type])for(var i=0,val;i<mode[type].length;i++)val=help[mode[type][i]],val&&found.push(val);else mode.helperType&&help[mode.helperType]?found.push(help[mode.helperType]):help[mode.name]&&found.push(help[mode.name]);for(var i$1=0,cur;i$1<help._global.length;i$1++)cur=help._global[i$1],cur.pred(mode,this)&&-1==indexOf(found,cur.val)&&found.push(cur.val);return found},getStateAfter:function getStateAfter(line,precise){var doc=this.doc;return line=clipLine(doc,null==line?doc.first+doc.size-1:line),getContextBefore(this,line+1,precise).state},cursorCoords:function cursorCoords(start,mode){var range=this.doc.sel.primary(),pos;return pos=null==start?range.head:"object"==_typeof(start)?_clipPos(this.doc,start):start?range.from():range.to(),_cursorCoords(this,pos,mode||"page")},charCoords:function charCoords(pos,mode){return _charCoords(this,_clipPos(this.doc,pos),mode||"page")},coordsChar:function coordsChar(coords,mode){return coords=fromCoordSystem(this,coords,mode||"page"),_coordsChar(this,coords.left,coords.top)},lineAtHeight:function lineAtHeight(height,mode){return height=fromCoordSystem(this,{top:height,left:0},mode||"page").top,_lineAtHeight(this.doc,height+this.display.viewOffset)},heightAtLine:function heightAtLine(line,mode,includeWidgets){var end=!1,lineObj;if("number"==typeof line){var last=this.doc.first+this.doc.size-1;line<this.doc.first?line=this.doc.first:line>last&&(line=last,end=!0),lineObj=getLine(this.doc,line)}else lineObj=line;return intoCoordSystem(this,lineObj,{top:0,left:0},mode||"page",includeWidgets||end).top+(end?this.doc.height-_heightAtLine(lineObj):0)},defaultTextHeight:function defaultTextHeight(){return textHeight(this.display)},defaultCharWidth:function defaultCharWidth(){return charWidth(this.display)},getViewport:function getViewport(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function addWidget(pos,node,scroll,vert,horiz){var display=this.display;pos=_cursorCoords(this,_clipPos(this.doc,pos));var top=pos.bottom,left=pos.left;if(node.style.position="absolute",node.setAttribute("cm-ignore-events","true"),this.display.input.setUneditable(node),display.sizer.appendChild(node),"over"==vert)top=pos.top;else if("above"==vert||"near"==vert){var vspace=_Mathmax(display.wrapper.clientHeight,this.doc.height),hspace=_Mathmax(display.sizer.clientWidth,display.lineSpace.clientWidth);("above"==vert||pos.bottom+node.offsetHeight>vspace)&&pos.top>node.offsetHeight?top=pos.top-node.offsetHeight:pos.bottom+node.offsetHeight<=vspace&&(top=pos.bottom),left+node.offsetWidth>hspace&&(left=hspace-node.offsetWidth)}node.style.top=top+"px",node.style.left=node.style.right="","right"==horiz?(left=display.sizer.clientWidth-node.offsetWidth,node.style.right="0px"):("left"==horiz?left=0:"middle"==horiz&&(left=(display.sizer.clientWidth-node.offsetWidth)/2),node.style.left=left+"px"),scroll&&scrollIntoView(this,{left:left,top:top,right:left+node.offsetWidth,bottom:top+node.offsetHeight})},triggerOnKeyDown:methodOp(onKeyDown),triggerOnKeyPress:methodOp(onKeyPress),triggerOnKeyUp:onKeyUp,triggerOnMouseDown:methodOp(onMouseDown),execCommand:function execCommand(cmd){if(commands.hasOwnProperty(cmd))return commands[cmd].call(null,this)},triggerElectric:methodOp(function(text){triggerElectric(this,text)}),findPosH:function findPosH(from,amount,unit,visually){var dir=1;0>amount&&(dir=-1,amount=-amount);for(var cur=_clipPos(this.doc,from),i=0;i<amount&&(cur=_findPosH(this.doc,cur,dir,unit,visually),!cur.hitSide);++i);return cur},moveH:methodOp(function(dir,unit){var this$1=this;this.extendSelectionsBy(function(range){return this$1.display.shift||this$1.doc.extend||range.empty()?_findPosH(this$1.doc,range.head,dir,unit,this$1.options.rtlMoveVisually):0>dir?range.from():range.to()},sel_move)}),deleteH:methodOp(function(dir,unit){var sel=this.doc.sel,doc=this.doc;sel.somethingSelected()?doc.replaceSelection("",null,"+delete"):deleteNearSelection(this,function(range){var other=_findPosH(doc,range.head,dir,unit,!1);return 0>dir?{from:other,to:range.head}:{from:range.head,to:other}})}),findPosV:function findPosV(from,amount,unit,goalColumn){var dir=1,x=goalColumn;0>amount&&(dir=-1,amount=-amount);for(var cur=_clipPos(this.doc,from),i=0,coords;i<amount&&(coords=_cursorCoords(this,cur,"div"),null==x?x=coords.left:coords.left=x,cur=_findPosV(this,coords,dir,unit),!cur.hitSide);++i);return cur},moveV:methodOp(function(dir,unit){var this$1=this,doc=this.doc,goals=[],collapse=!this.display.shift&&!doc.extend&&doc.sel.somethingSelected();if(doc.extendSelectionsBy(function(range){if(collapse)return 0>dir?range.from():range.to();var headPos=_cursorCoords(this$1,range.head,"div");null!=range.goalColumn&&(headPos.left=range.goalColumn),goals.push(headPos.left);var pos=_findPosV(this$1,headPos,dir,unit);return"page"==unit&&range==doc.sel.primary()&&addToScrollTop(this$1,_charCoords(this$1,pos,"div").top-headPos.top),pos},sel_move),goals.length)for(var i=0;i<doc.sel.ranges.length;i++)doc.sel.ranges[i].goalColumn=goals[i]}),findWordAt:function findWordAt(pos){var doc=this.doc,line=getLine(doc,pos.line).text,start=pos.ch,end=pos.ch;if(line){var helper=this.getHelper(pos,"wordChars");("before"==pos.sticky||end==line.length)&&start?--start:++end;for(var startChar=line.charAt(start),check=isWordChar(startChar,helper)?function(ch){return isWordChar(ch,helper)}:/\s/.test(startChar)?function(ch){return /\s/.test(ch)}:function(ch){return!/\s/.test(ch)&&!isWordChar(ch)};0<start&&check(line.charAt(start-1));)--start;for(;end<line.length&&check(line.charAt(end));)++end}return new Range(Pos(pos.line,start),Pos(pos.line,end))},toggleOverwrite:function toggleOverwrite(value){null!=value&&value==this.state.overwrite||((this.state.overwrite=!this.state.overwrite)?addClass(this.display.cursorDiv,"CodeMirror-overwrite"):rmClass(this.display.cursorDiv,"CodeMirror-overwrite"),signal(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function hasFocus(){return this.display.input.getField()==activeElt()},isReadOnly:function isReadOnly(){return!!(this.options.readOnly||this.doc.cantEdit)},scrollTo:methodOp(function(x,y){scrollToCoords(this,x,y)}),getScrollInfo:function getScrollInfo(){var scroller=this.display.scroller;return{left:scroller.scrollLeft,top:scroller.scrollTop,height:scroller.scrollHeight-scrollGap(this)-this.display.barHeight,width:scroller.scrollWidth-scrollGap(this)-this.display.barWidth,clientHeight:displayHeight(this),clientWidth:displayWidth(this)}},scrollIntoView:methodOp(function(range,margin){null==range?(range={from:this.doc.sel.primary().head,to:null},null==margin&&(margin=this.options.cursorScrollMargin)):"number"==typeof range?range={from:Pos(range,0),to:null}:null==range.from&&(range={from:range,to:null}),range.to||(range.to=range.from),range.margin=margin||0,null==range.from.line?scrollToCoordsRange(this,range.from,range.to,range.margin):scrollToRange(this,range)}),setSize:methodOp(function(width,height){var this$1=this,interpret=function(val){return"number"==typeof val||/^\d+$/.test(val+"")?val+"px":val};null!=width&&(this.display.wrapper.style.width=interpret(width)),null!=height&&(this.display.wrapper.style.height=interpret(height)),this.options.lineWrapping&&clearLineMeasurementCache(this);var lineNo=this.display.viewFrom;this.doc.iter(lineNo,this.display.viewTo,function(line){if(line.widgets)for(var i=0;i<line.widgets.length;i++)if(line.widgets[i].noHScroll){regLineChange(this$1,lineNo,"widget");break}++lineNo}),this.curOp.forceUpdate=!0,signal(this,"refresh",this)}),operation:function(f){return runInOp(this,f)},startOperation:function startOperation(){return _startOperation(this)},endOperation:function endOperation(){return _endOperation(this)},refresh:methodOp(function(){var oldHeight=this.display.cachedTextHeight;regChange(this),this.curOp.forceUpdate=!0,clearCaches(this),scrollToCoords(this,this.doc.scrollLeft,this.doc.scrollTop),updateGutterSpace(this.display),(null==oldHeight||.5<_Mathabs(oldHeight-textHeight(this.display))||this.options.lineWrapping)&&estimateLineHeights(this),signal(this,"refresh",this)}),swapDoc:methodOp(function(doc){var old=this.doc;return old.cm=null,this.state.selectingText&&this.state.selectingText(),attachDoc(this,doc),clearCaches(this),this.display.input.reset(),scrollToCoords(this,doc.scrollLeft,doc.scrollTop),this.curOp.forceScroll=!0,signalLater(this,"swapDoc",this,old),old}),phrase:function phrase(phraseText){var phrases=this.options.phrases;return phrases&&Object.prototype.hasOwnProperty.call(phrases,phraseText)?phrases[phraseText]:phraseText},getInputField:function getInputField(){return this.display.input.getField()},getWrapperElement:function getWrapperElement(){return this.display.wrapper},getScrollerElement:function getScrollerElement(){return this.display.scroller},getGutterElement:function getGutterElement(){return this.display.gutters}},eventMixin(CodeMirror),CodeMirror.registerHelper=function(type,name,value){helpers.hasOwnProperty(type)||(helpers[type]=CodeMirror[type]={_global:[]}),helpers[type][name]=value},CodeMirror.registerGlobalHelper=function(type,name,predicate,value){CodeMirror.registerHelper(type,name,value),helpers[type]._global.push({pred:predicate,val:value})}}(CodeMirror);var dontDelegate=["iter","insert","remove","copy","getEditor","constructor"];for(var prop in Doc.prototype)Doc.prototype.hasOwnProperty(prop)&&0>indexOf(dontDelegate,prop)&&(CodeMirror.prototype[prop]=function(method){return function(){return method.apply(this.doc,arguments)}}(Doc.prototype[prop]));return eventMixin(Doc),CodeMirror.inputStyles={textarea:TextareaInput,contenteditable:ContentEditableInput},CodeMirror.defineMode=function(name){CodeMirror.defaults.mode||"null"==name||(CodeMirror.defaults.mode=name),defineMode.apply(this,arguments)},CodeMirror.defineMIME=function(mime,spec){mimeModes[mime]=spec},CodeMirror.defineMode("null",function(){return{token:function token(stream){return stream.skipToEnd()}}}),CodeMirror.defineMIME("text/plain","null"),CodeMirror.defineExtension=function(name,func){CodeMirror.prototype[name]=func},CodeMirror.defineDocExtension=function(name,func){Doc.prototype[name]=func},CodeMirror.fromTextArea=function(textarea,options){function save(){textarea.value=cm.getValue()}if(options=options?copyObj(options):{},options.value=textarea.value,!options.tabindex&&textarea.tabIndex&&(options.tabindex=textarea.tabIndex),!options.placeholder&&textarea.placeholder&&(options.placeholder=textarea.placeholder),null==options.autofocus){var hasFocus=activeElt();options.autofocus=hasFocus==textarea||null!=textarea.getAttribute("autofocus")&&hasFocus==document.body}var realSubmit;if(textarea.form&&(on(textarea.form,"submit",save),!options.leaveSubmitMethodAlone)){var form=textarea.form;realSubmit=form.submit;try{var wrappedSubmit=form.submit=function(){save(),form.submit=realSubmit,form.submit(),form.submit=wrappedSubmit}}catch(e){}}options.finishInit=function(cm){cm.save=save,cm.getTextArea=function(){return textarea},cm.toTextArea=function(){cm.toTextArea=isNaN,save(),textarea.parentNode.removeChild(cm.getWrapperElement()),textarea.style.display="",textarea.form&&(off(textarea.form,"submit",save),!options.leaveSubmitMethodAlone&&"function"==typeof textarea.form.submit&&(textarea.form.submit=realSubmit))}},textarea.style.display="none";var cm=CodeMirror(function(node){return textarea.parentNode.insertBefore(node,textarea.nextSibling)},options);return cm},function(CodeMirror){CodeMirror.off=off,CodeMirror.on=on,CodeMirror.wheelEventPixels=wheelEventPixels,CodeMirror.Doc=Doc,CodeMirror.splitLines=splitLinesAuto,CodeMirror.countColumn=countColumn,CodeMirror.findColumn=findColumn,CodeMirror.isWordChar=isWordCharBasic,CodeMirror.Pass=Pass,CodeMirror.signal=signal,CodeMirror.Line=Line,CodeMirror.changeEnd=changeEnd,CodeMirror.scrollbarModel=scrollbarModel,CodeMirror.Pos=Pos,CodeMirror.cmpPos=cmp,CodeMirror.modes=modes,CodeMirror.mimeModes=mimeModes,CodeMirror.resolveMode=resolveMode,CodeMirror.getMode=getMode,CodeMirror.modeExtensions=modeExtensions,CodeMirror.extendMode=extendMode,CodeMirror.copyState=copyState,CodeMirror.startState=startState,CodeMirror.innerMode=innerMode,CodeMirror.commands=commands,CodeMirror.keyMap=keyMap,CodeMirror.keyName=keyName,CodeMirror.isModifierKey=isModifierKey,CodeMirror.lookupKey=lookupKey,CodeMirror.normalizeKeyMap=normalizeKeyMap,CodeMirror.StringStream=StringStream,CodeMirror.SharedTextMarker=SharedTextMarker,CodeMirror.TextMarker=TextMarker,CodeMirror.LineWidget=LineWidget,CodeMirror.e_preventDefault=e_preventDefault,CodeMirror.e_stopPropagation=e_stopPropagation,CodeMirror.e_stop=e_stop,CodeMirror.addClass=addClass,CodeMirror.contains=contains,CodeMirror.rmClass=rmClass,CodeMirror.keyNames=keyNames}(CodeMirror),CodeMirror.version="5.55.0",CodeMirror}),define("codemirror",["codemirror/lib/codemirror"],function(main){return main}),define("css!codemirror/lib/codemirror",[],function(){}),function(mod){"object"==("undefined"==typeof exports?"undefined":_typeof(exports))&&"object"==("undefined"==typeof module?"undefined":_typeof(module))?mod(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("codemirror/mode/xml/xml",["../../lib/codemirror"],mod):mod(CodeMirror)}(function(CodeMirror){"use strict";var htmlConfig={autoSelfClosers:{area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,frame:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0,menuitem:!0},implicitlyClosed:{dd:!0,li:!0,optgroup:!0,option:!0,p:!0,rp:!0,rt:!0,tbody:!0,td:!0,tfoot:!0,th:!0,tr:!0},contextGrabbers:{dd:{dd:!0,dt:!0},dt:{dd:!0,dt:!0},li:{li:!0},option:{option:!0,optgroup:!0},optgroup:{optgroup:!0},p:{address:!0,article:!0,aside:!0,blockquote:!0,dir:!0,div:!0,dl:!0,fieldset:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,menu:!0,nav:!0,ol:!0,p:!0,pre:!0,section:!0,table:!0,ul:!0},rp:{rp:!0,rt:!0},rt:{rp:!0,rt:!0},tbody:{tbody:!0,tfoot:!0},td:{td:!0,th:!0},tfoot:{tbody:!0},th:{td:!0,th:!0},thead:{tbody:!0,tfoot:!0},tr:{tr:!0}},doNotIndent:{pre:!0},allowUnquoted:!0,allowMissing:!0,caseFold:!0},xmlConfig={autoSelfClosers:{},implicitlyClosed:{},contextGrabbers:{},doNotIndent:{},allowUnquoted:!1,allowMissing:!1,allowMissingTagName:!1,caseFold:!1};CodeMirror.defineMode("xml",function(editorConf,config_){function inText(stream,state){function chain(parser){return state.tokenize=parser,parser(stream,state)}var ch=stream.next();if("<"==ch)return stream.eat("!")?stream.eat("[")?stream.match("CDATA[")?chain(inBlock("atom","]]>")):null:stream.match("--")?chain(inBlock("comment","-->")):stream.match("DOCTYPE",!0,!0)?(stream.eatWhile(/[\w\._\-]/),chain(doctype(1))):null:stream.eat("?")?(stream.eatWhile(/[\w\._\-]/),state.tokenize=inBlock("meta","?>"),"meta"):(type=stream.eat("/")?"closeTag":"openTag",state.tokenize=inTag,"tag bracket");if("&"==ch){var ok;return ok=stream.eat("#")?stream.eat("x")?stream.eatWhile(/[a-fA-F\d]/)&&stream.eat(";"):stream.eatWhile(/[\d]/)&&stream.eat(";"):stream.eatWhile(/[\w\.\-:]/)&&stream.eat(";"),ok?"atom":"error"}return stream.eatWhile(/[^&<]/),null}function inTag(stream,state){var ch=stream.next();if(">"==ch||"/"==ch&&stream.eat(">"))return state.tokenize=inText,type=">"==ch?"endTag":"selfcloseTag","tag bracket";if("="==ch)return type="equals",null;if("<"==ch){state.tokenize=inText,state.state=baseState,state.tagName=state.tagStart=null;var next=state.tokenize(stream,state);return next?next+" tag error":"tag error"}return /[\'\"]/.test(ch)?(state.tokenize=inAttribute(ch),state.stringStartCol=stream.column(),state.tokenize(stream,state)):(stream.match(/^[^\s\u00a0=<>\"\']*[^\s\u00a0=<>\"\'\/]/),"word")}function inAttribute(quote){var closure=function(stream,state){for(;!stream.eol();)if(stream.next()==quote){state.tokenize=inTag;break}return"string"};return closure.isInAttribute=!0,closure}function inBlock(style,terminator){return function(stream,state){for(;!stream.eol();){if(stream.match(terminator)){state.tokenize=inText;break}stream.next()}return style}}function doctype(depth){return function(stream,state){for(var ch;null!=(ch=stream.next());){if("<"==ch)return state.tokenize=doctype(depth+1),state.tokenize(stream,state);if(">"==ch)if(1==depth){state.tokenize=inText;break}else return state.tokenize=doctype(depth-1),state.tokenize(stream,state)}return"meta"}}function Context(state,tagName,startOfLine){this.prev=state.context,this.tagName=tagName,this.indent=state.indented,this.startOfLine=startOfLine,(config.doNotIndent.hasOwnProperty(tagName)||state.context&&state.context.noIndent)&&(this.noIndent=!0)}function popContext(state){state.context&&(state.context=state.context.prev)}function maybePopContext(state,nextTagName){for(var parentTagName;;){if(!state.context)return;if(parentTagName=state.context.tagName,!config.contextGrabbers.hasOwnProperty(parentTagName)||!config.contextGrabbers[parentTagName].hasOwnProperty(nextTagName))return;popContext(state)}}function baseState(type,stream,state){return"openTag"==type?(state.tagStart=stream.column(),tagNameState):"closeTag"==type?closeTagNameState:baseState}function tagNameState(type,stream,state){return"word"==type?(state.tagName=stream.current(),setStyle="tag",attrState):config.allowMissingTagName&&"endTag"==type?(setStyle="tag bracket",attrState(type,stream,state)):(setStyle="error",tagNameState)}function closeTagNameState(type,stream,state){if("word"==type){var tagName=stream.current();return state.context&&state.context.tagName!=tagName&&config.implicitlyClosed.hasOwnProperty(state.context.tagName)&&popContext(state),state.context&&state.context.tagName==tagName||!1===config.matchClosing?(setStyle="tag",closeState):(setStyle="tag error",closeStateErr)}return config.allowMissingTagName&&"endTag"==type?(setStyle="tag bracket",closeState(type,stream,state)):(setStyle="error",closeStateErr)}function closeState(type,_stream,state){return"endTag"==type?(popContext(state),baseState):(setStyle="error",closeState)}function closeStateErr(type,stream,state){return setStyle="error",closeState(type,stream,state)}function attrState(type,_stream,state){if("word"==type)return setStyle="attribute",attrEqState;if("endTag"==type||"selfcloseTag"==type){var tagName=state.tagName,tagStart=state.tagStart;return state.tagName=state.tagStart=null,"selfcloseTag"==type||config.autoSelfClosers.hasOwnProperty(tagName)?maybePopContext(state,tagName):(maybePopContext(state,tagName),state.context=new Context(state,tagName,tagStart==state.indented)),baseState}return setStyle="error",attrState}function attrEqState(type,stream,state){return"equals"==type?attrValueState:(config.allowMissing||(setStyle="error"),attrState(type,stream,state))}function attrValueState(type,stream,state){return"string"==type?attrContinuedState:"word"==type&&config.allowUnquoted?(setStyle="string",attrState):(setStyle="error",attrState(type,stream,state))}function attrContinuedState(type,stream,state){return"string"==type?attrContinuedState:attrState(type,stream,state)}var indentUnit=editorConf.indentUnit,config={},defaults=config_.htmlMode?htmlConfig:xmlConfig;for(var prop in defaults)config[prop]=defaults[prop];for(var prop in config_)config[prop]=config_[prop];var type,setStyle;return inText.isInText=!0,{startState:function startState(baseIndent){var state={tokenize:inText,state:baseState,indented:baseIndent||0,tagName:null,tagStart:null,context:null};return null!=baseIndent&&(state.baseIndent=baseIndent),state},token:function token(stream,state){if(!state.tagName&&stream.sol()&&(state.indented=stream.indentation()),stream.eatSpace())return null;type=null;var style=state.tokenize(stream,state);return(style||type)&&"comment"!=style&&(setStyle=null,state.state=state.state(type||style,stream,state),setStyle&&(style="error"==setStyle?style+" error":setStyle)),style},indent:function indent(state,textAfter,fullLine){var context=state.context;if(state.tokenize.isInAttribute)return state.tagStart==state.indented?state.stringStartCol+1:state.indented+indentUnit;if(context&&context.noIndent)return CodeMirror.Pass;if(state.tokenize!=inTag&&state.tokenize!=inText)return fullLine?fullLine.match(/^(\s*)/)[0].length:0;if(state.tagName)return!1===config.multilineTagIndentPastTag?state.tagStart+indentUnit*(config.multilineTagIndentFactor||1):state.tagStart+state.tagName.length+2;if(config.alignCDATA&&/<!\[CDATA\[/.test(textAfter))return 0;var tagAfter=textAfter&&/^<(\/)?([\w_:\.-]*)/.exec(textAfter);if(tagAfter&&tagAfter[1]){for(;context;)if(context.tagName==tagAfter[2]){context=context.prev;break}else if(config.implicitlyClosed.hasOwnProperty(context.tagName))context=context.prev;else break;}else if(tagAfter)for(;context;){var grabbers=config.contextGrabbers[context.tagName];if(grabbers&&grabbers.hasOwnProperty(tagAfter[2]))context=context.prev;else break}for(;context&&context.prev&&!context.startOfLine;)context=context.prev;return context?context.indent+indentUnit:state.baseIndent||0},electricInput:/<\/[\s\w:]+>$/,blockCommentStart:"<!--",blockCommentEnd:"-->",configuration:config.htmlMode?"html":"xml",helperType:config.htmlMode?"html":"xml",skipAttribute:function skipAttribute(state){state.state==attrValueState&&(state.state=attrState)},xmlCurrentTag:function xmlCurrentTag(state){return state.tagName?{name:state.tagName,close:"closeTag"==state.type}:null},xmlCurrentContext:function xmlCurrentContext(state){for(var context=[],cx=state.context;cx;cx=cx.prev)cx.tagName&&context.push(cx.tagName);return context.reverse()}}}),CodeMirror.defineMIME("text/xml","xml"),CodeMirror.defineMIME("application/xml","xml"),CodeMirror.mimeModes.hasOwnProperty("text/html")||CodeMirror.defineMIME("text/html",{name:"xml",htmlMode:!0})}),define("taoQtiTest/controller/content/edit",["lodash","codemirror","css!codemirror/lib/codemirror","codemirror/mode/xml/xml"],function(_,CodeMirror){'use strict';return{start:function start(){var textAreaComponent=document.getElementById("xmlString");if(null!==textAreaComponent){var testEditor=CodeMirror.fromTextArea(textAreaComponent,{mode:"xml",lineNumbers:!0});testEditor.setSize(720,420),testEditor.on("change",function(cMirror){textAreaComponent.value=cMirror.getValue()})}}}}),define("taoQtiTest/controller/creator/areaBroker",["lodash","ui/areaBroker"],function(_,areaBroker){'use strict';return _.partial(areaBroker,["creator","itemSelectorPanel","contentCreatorPanel","propertyPanel","elementPropertyPanel"])}),define("taoQtiTest/controller/creator/helpers/baseType",["lodash"],function(_){'use strict';var baseTypeEnum={IDENTIFIER:0,BOOLEAN:1,INTEGER:2,FLOAT:3,STRING:4,POINT:5,PAIR:6,DIRECTED_PAIR:7,DURATION:8,FILE:9,URI:10,INT_OR_IDENTIFIER:11,COORDS:12,ANY:12,SAME:13},baseTypeHelper=_({asArray:function(){return baseTypeEnum},getValid:function(type,defaultType){return _.isFinite(type)?!baseTypeHelper.getNameByConstant(type)&&(type=!1):type=baseTypeHelper.getConstantByName(type),!1===type&&(_.isUndefined(defaultType)||-1===defaultType?type=-1:type=baseTypeHelper.getValid(defaultType,-1)),type},getValue:function(type,value){switch(_.isString(type)&&(type=baseTypeHelper.getConstantByName(type)),type){case baseTypeEnum.URI:case baseTypeEnum.STRING:case baseTypeEnum.IDENTIFIER:return value+"";case baseTypeEnum.BOOLEAN:if(_.isString(value))switch(value.toLowerCase()){case"true":return!0;case"false":return!1;}return!!value;case baseTypeEnum.INTEGER:return parseInt(value,10)||0;case baseTypeEnum.FLOAT:return parseFloat(value)||0;case baseTypeEnum.INT_OR_IDENTIFIER:return _.isNaN(parseInt(value,10))?""+value:parseInt(value,10)||0;}return value},getConstantByName:function(name){switch((name+"").trim().toLowerCase()){case"identifier":return baseTypeEnum.IDENTIFIER;case"boolean":return baseTypeEnum.BOOLEAN;case"integer":return baseTypeEnum.INTEGER;case"float":return baseTypeEnum.FLOAT;case"string":return baseTypeEnum.STRING;case"point":return baseTypeEnum.POINT;case"pair":return baseTypeEnum.PAIR;case"directedpair":return baseTypeEnum.DIRECTED_PAIR;case"duration":return baseTypeEnum.DURATION;case"file":return baseTypeEnum.FILE;case"uri":return baseTypeEnum.URI;case"intoridentifier":return baseTypeEnum.INT_OR_IDENTIFIER;case"coords":return baseTypeEnum.COORDS;case"any":return baseTypeEnum.ANY;case"same":return baseTypeEnum.SAME;default:return!1;}},getNameByConstant:function(constant,operator){return constant===baseTypeEnum.IDENTIFIER?"identifier":constant===baseTypeEnum.BOOLEAN?"boolean":constant===baseTypeEnum.INTEGER?"integer":constant===baseTypeEnum.FLOAT?"float":constant===baseTypeEnum.STRING?"string":constant===baseTypeEnum.POINT?"point":constant===baseTypeEnum.PAIR?"pair":constant===baseTypeEnum.DIRECTED_PAIR?"directedPair":constant===baseTypeEnum.DURATION?"duration":constant===baseTypeEnum.FILE?"file":constant===baseTypeEnum.URI?"uri":constant===baseTypeEnum.INT_OR_IDENTIFIER?"intOrIdentifier":constant===baseTypeEnum.COORDS||constant===baseTypeEnum.ANY?operator?"any":"coords":!(constant!==baseTypeEnum.SAME)&&"same"}}).assign(baseTypeEnum).value();return baseTypeHelper}),define("taoQtiTest/controller/creator/helpers/cardinality",["lodash"],function(_){'use strict';var cardinalityEnum={SINGLE:0,MULTIPLE:1,ORDERED:2,RECORD:3,SAME:4,ANY:5},cardinalityHelper=_({asArray:function(){return cardinalityEnum},getValid:function(cardinality,defaultCardinality){return _.isFinite(cardinality)?!cardinalityHelper.getNameByConstant(cardinality)&&(cardinality=!1):cardinality=cardinalityHelper.getConstantByName(cardinality),!1===cardinality&&(_.isUndefined(defaultCardinality)||defaultCardinality===cardinalityEnum.SINGLE?cardinality=cardinalityEnum.SINGLE:cardinality=cardinalityHelper.getValid(defaultCardinality,cardinalityEnum.SINGLE)),cardinality},getConstantByName:function(name){switch((name+"").trim().toLowerCase()){case"single":return cardinalityEnum.SINGLE;case"multiple":return cardinalityEnum.MULTIPLE;case"ordered":return cardinalityEnum.ORDERED;case"record":return cardinalityEnum.RECORD;case"same":return cardinalityEnum.SAME;case"any":return cardinalityEnum.ANY;default:return!1;}},getNameByConstant:function(constant){return constant===cardinalityEnum.SINGLE?"single":constant===cardinalityEnum.MULTIPLE?"multiple":constant===cardinalityEnum.ORDERED?"ordered":constant===cardinalityEnum.RECORD?"record":constant===cardinalityEnum.SAME?"same":!(constant!==cardinalityEnum.ANY)&&"any"}}).assign(cardinalityEnum).value();return cardinalityHelper}),define("taoQtiTest/controller/creator/helpers/outcomeValidator",["lodash"],function(_){'use strict';function validateIdentifier(identifier){return!!(identifier&&_.isString(identifier)&&identifierValidator.test(identifier))}function validateOutcome(outcome,checkIdentifier,allowedTypes){var validOutcome=_.isPlainObject(outcome)&&validateIdentifier(outcome["qti-type"]),validIdentifier=!checkIdentifier||outcome&&validateIdentifier(outcome.identifier);return allowedTypes&&(allowedTypes=_.isArray(allowedTypes)?allowedTypes:[allowedTypes],validOutcome=validOutcome&&0<=_.indexOf(allowedTypes,outcome["qti-type"])),!!(validOutcome&&validIdentifier)}var identifierValidator=/^[a-zA-Z_][a-zA-Z0-9_\.-]*$/;return{validateIdentifier:validateIdentifier,validateOutcomes:function(outcomes,checkIdentifier,allowedTypes){var valid=_.isArray(outcomes);return _.forEach(outcomes,function(outcome){if(!validateOutcome(outcome,checkIdentifier,allowedTypes))return valid=!1,!1}),valid},validateOutcome:validateOutcome}}),define("taoQtiTest/controller/creator/helpers/qtiElement",["lodash","taoQtiTest/controller/creator/helpers/outcomeValidator"],function(_,outcomeValidator){'use strict';function forceArray(value){return value||(value=[]),_.isArray(value)||(value=[value]),value}var qtiElementHelper={create:function(type,identifier,properties){var element={"qti-type":type};if(!outcomeValidator.validateIdentifier(type))throw new TypeError("You must provide a valid QTI type!");if(_.isPlainObject(identifier)&&(properties=identifier,identifier=null),identifier){if(!outcomeValidator.validateIdentifier(identifier))throw new TypeError("You must provide a valid identifier!");element.identifier=identifier}return _.assign(element,properties||{})},find:function(collection,type){function checkType(qtiElement){if(0<=types.indexOf(qtiElement["qti-type"]))return found=qtiElement,!1}var found=null,types=forceArray(type);return _.isArray(collection)?_.forEach(collection,checkType):collection&&checkType(collection),found},lookupElement:function(tree,path,nodeName){for(var steps=_.isArray(path)?path:path.split("."),nodeNames=forceArray(nodeName),len=steps.length,i=0,key;tree&&i<len;)tree=qtiElementHelper.find(tree,steps[i++]),tree&&i<len&&(key=_.find(nodeNames,_.partial(_.has,tree)),tree=key&&tree[key]);return tree||null},lookupProperty:function(tree,path,nodeName){var result=null,steps=_.isArray(path)?path:path.split("."),propertyName=steps.pop(),element=qtiElementHelper.lookupElement(tree,steps,nodeName);return element&&element[propertyName]&&(result=element[propertyName]),result}};return qtiElementHelper}),define("taoQtiTest/controller/creator/helpers/outcome",["lodash","taoQtiTest/controller/creator/helpers/outcomeValidator","taoQtiTest/controller/creator/helpers/qtiElement","taoQtiTest/controller/creator/helpers/baseType","taoQtiTest/controller/creator/helpers/cardinality"],function(_,outcomeValidator,qtiElementHelper,baseTypeHelper,cardinalityHelper){'use strict';var outcomeHelper={getProcessingRuleExpression:function(outcomeRule,path){return qtiElementHelper.lookupElement(outcomeRule,path,["expression","expressions"])},getProcessingRuleProperty:function(outcomeRule,path){return qtiElementHelper.lookupProperty(outcomeRule,path,["expression","expressions"])},getOutcomeIdentifier:function(outcome){return(_.isObject(outcome)?outcome.identifier:outcome)+""},getOutcomeDeclarations:function(testModel){var outcomes=testModel&&testModel.outcomeDeclarations;return outcomes||[]},getOutcomeProcessingRules:function(testModel){var rules=testModel&&testModel.outcomeProcessing&&testModel.outcomeProcessing.outcomeRules;return rules||[]},eachOutcomeDeclarations:function(testModel,cb){_.forEach(outcomeHelper.getOutcomeDeclarations(testModel),cb)},eachOutcomeProcessingRules:function(testModel,cb){_.forEach(outcomeHelper.getOutcomeProcessingRules(testModel),cb)},eachOutcomeProcessingRuleExpressions:function(testModel,cb){function browseExpressions(processingRule){_.isArray(processingRule)?_.forEach(processingRule,browseExpressions):processingRule&&(cb(processingRule),processingRule.expression?browseExpressions(processingRule.expression):processingRule.expressions&&browseExpressions(processingRule.expressions))}browseExpressions(outcomeHelper.getOutcomeProcessingRules(testModel))},listOutcomes:function(testModel,cb){var outcomes=[];return _.isFunction(cb)||(cb=null),outcomeHelper.eachOutcomeDeclarations(testModel,function(outcome){(!cb||cb(outcome))&&outcomes.push(outcomeHelper.getOutcomeIdentifier(outcome))}),outcomes},removeOutcomes:function(testModel,outcomes){var declarations=outcomeHelper.getOutcomeDeclarations(testModel),rules=outcomeHelper.getOutcomeProcessingRules(testModel),check;_.isFunction(outcomes)?check=outcomes:(outcomes=_.indexBy(_.isArray(outcomes)?outcomes:[outcomes],function(outcome){return outcome}),check=function(outcome){return!!outcomes[outcomeHelper.getOutcomeIdentifier(outcome)]}),declarations&&_.remove(declarations,check),rules&&_.remove(rules,check)},createOutcome:function(identifier,type,cardinality){if(!outcomeValidator.validateIdentifier(identifier))throw new TypeError("You must provide a valid identifier!");return qtiElementHelper.create("outcomeDeclaration",identifier,{views:[],interpretation:"",longInterpretation:"",normalMaximum:!1,normalMinimum:!1,masteryValue:!1,cardinality:cardinalityHelper.getValid(cardinality,cardinalityHelper.SINGLE),baseType:baseTypeHelper.getValid(type,baseTypeHelper.FLOAT)})},addOutcomeProcessing:function(testModel,processingRule){var outcomeProcessing=testModel.outcomeProcessing;if(!outcomeValidator.validateOutcome(processingRule))throw new TypeError("You must provide a valid outcome processing rule!");return outcomeProcessing?!outcomeProcessing.outcomeRules&&(outcomeProcessing.outcomeRules=[]):(outcomeProcessing=qtiElementHelper.create("outcomeProcessing",{outcomeRules:[]}),testModel.outcomeProcessing=outcomeProcessing),outcomeProcessing.outcomeRules.push(processingRule),processingRule},addOutcome:function(testModel,outcome,processingRule){var declarations=testModel.outcomeDeclarations;if(!outcomeValidator.validateOutcome(outcome,!0,"outcomeDeclaration"))throw new TypeError("You must provide a valid outcome!");if(processingRule){if(!outcomeValidator.validateOutcome(processingRule)||processingRule.identifier!==outcome.identifier)throw new TypeError("You must provide a valid outcome processing rule!");outcomeHelper.addOutcomeProcessing(testModel,processingRule)}return declarations||(declarations=[],testModel.outcomeDeclarations=declarations),declarations.push(outcome),outcome},replaceOutcomes:function(testModel,outcomes){if(_.isPlainObject(outcomes)){if(_.isArray(outcomes.outcomeDeclarations)){if(!outcomeValidator.validateOutcomes(outcomes.outcomeDeclarations,!0,"outcomeDeclaration"))throw new TypeError("You must provide valid outcomes!");testModel.outcomeDeclarations=[].concat(outcomes.outcomeDeclarations)}if(outcomes.outcomeProcessing&&_.isArray(outcomes.outcomeProcessing.outcomeRules)){if(!outcomeValidator.validateOutcomes(outcomes.outcomeProcessing.outcomeRules))throw new TypeError("You must provide valid processing rules!");testModel.outcomeProcessing||(testModel.outcomeProcessing=qtiElementHelper.create("outcomeProcessing")),testModel.outcomeProcessing.outcomeRules=[].concat(outcomes.outcomeProcessing.outcomeRules)}}}};return outcomeHelper}),define("taoQtiTest/controller/creator/helpers/category",["lodash"],function(_){'use strict';function isCategoryOption(category){return category&&0===category.indexOf("x-tao-")}function eachCategories(testModel,cb){_.forEach(testModel.testParts,function(testPart){_.forEach(testPart.assessmentSections,function(assessmentSection){_.forEach(assessmentSection.sectionParts,function(itemRef){_.forEach(itemRef.categories,function(category){cb(category,itemRef)})})})})}return{eachCategories:eachCategories,listCategories:function(testModel){var categories={};return eachCategories(testModel,function(category){isCategoryOption(category)||(categories[category]=!0)}),_.keys(categories)},listOptions:function(testModel){var options={};return eachCategories(testModel,function(category){isCategoryOption(category)&&(options[category]=!0)}),_.keys(options)}}}),define("taoQtiTest/controller/creator/modelOverseer",["lodash","core/eventifier","core/statifier","taoQtiTest/controller/creator/helpers/baseType","taoQtiTest/controller/creator/helpers/cardinality","taoQtiTest/controller/creator/helpers/outcome","taoQtiTest/controller/creator/helpers/category"],function(_,eventifier,statifier,baseTypeHelper,cardinalityHelper,outcomeHelper,categoryHelper){'use strict';return function(model,config){var modelOverseer={getModel:function(){return model},setModel:function(newModel){return model=newModel,modelOverseer.trigger("setmodel",model),this},getConfig:function(){return config},getOutcomesList:function(){return _.map(outcomeHelper.getOutcomeDeclarations(model),function(declaration){return{name:declaration.identifier,type:baseTypeHelper.getNameByConstant(declaration.baseType),cardinality:cardinalityHelper.getNameByConstant(declaration.cardinality)}})},getOutcomesNames:function(){return _.map(outcomeHelper.getOutcomeDeclarations(model),function(declaration){return declaration.identifier})},getCategories:function(){return categoryHelper.listCategories(model)},getOptions:function(){return categoryHelper.listOptions(model)}};return config=_.isPlainObject(config)?config:_.assign({},config),statifier(eventifier(modelOverseer))}}),define("taoQtiTest/controller/creator/qtiTestCreator",["jquery","core/eventifier","taoQtiTest/controller/creator/areaBroker","taoQtiTest/controller/creator/modelOverseer"],function($,eventifier,areaBrokerFactory,modelOverseerFactory){'use strict';return function($creatorContainer,config){function loadModelOverseer(){return!modelOverseer&&model&&(modelOverseer=modelOverseerFactory(model,config)),modelOverseer}function loadAreaBroker(){return areaBroker||(areaBroker=areaBrokerFactory($container,{creator:$container,itemSelectorPanel:$container.find(".test-creator-items"),contentCreatorPanel:$container.find(".test-creator-content"),propertyPanel:$container.find(".test-creator-props"),elementPropertyPanel:$container.find(".qti-widget-properties")})),areaBroker}var testCreator,$container,model,areaBroker,modelOverseer;if(!($creatorContainer instanceof $))throw new TypeError("a valid $container must be given");return $container=$creatorContainer,testCreator={setTestModel:function(m){model=m},getAreaBroker:function(){return loadAreaBroker()},getModelOverseer:function(){return loadModelOverseer()}},eventifier(testCreator)}}),define("taoQtiTest/provider/testItems",["lodash","i18n","util/url","core/dataProvider/request"],function(_,__,urlUtil,request){'use strict';var defaultConfig={getItemClasses:{url:urlUtil.route("getItemClasses","Items","taoQtiTest")},getItems:{url:urlUtil.route("getItems","Items","taoQtiTest")},getItemClassProperties:{url:urlUtil.route("create","RestFormItem","taoItems")}};return function(config){return config=_.defaults(config||{},defaultConfig),{getItemClasses:function(){return request(config.getItemClasses.url)},getItems:function(params){return request(config.getItems.url,params)},getItemClassProperties:function(classUri){return request(config.getItemClassProperties.url,{classUri:classUri})}}}}),define("taoQtiTest/controller/creator/views/item",["jquery","i18n","core/logger","taoQtiTest/provider/testItems","ui/resource/selector","ui/feedback"],function($,__,loggerFactory,testItemProviderFactory,resourceSelectorFactory,feedback){'use strict';var logger=loggerFactory("taoQtiTest/creator/views/item"),testItemProvider=testItemProviderFactory(),onError=function(err){logger.error(err),feedback.error(err.message||__("An error occured while retrieving items"))},ITEM_URI="http://www.tao.lu/Ontologies/TAOItem.rdf#Item";return function($container){var selectorConfig={type:__("items"),selectionMode:resourceSelectorFactory.selectionModes.multiple,selectAllPolicy:resourceSelectorFactory.selectAllPolicies.visible,classUri:ITEM_URI,classes:[{label:"Item",uri:ITEM_URI,type:"class"}]},resourceSelector=resourceSelectorFactory($container,selectorConfig).on("render",function(){var _this=this;$container.on("itemselected.creator",function(){_this.clearSelection()})}).on("query",function(params){var _this2=this;testItemProvider.getItems(params).then(function(items){_this2.update(items,params)}).catch(onError)}).on("classchange",function(classUri){var _this3=this;testItemProvider.getItemClassProperties(classUri).then(function(filters){_this3.updateFilters(filters)}).catch(onError)}).on("change",function(values){$container.trigger("itemselect.creator",[values])});testItemProvider.getItemClasses().then(function(classes){selectorConfig.classes=classes,selectorConfig.classUri=classes[0].uri}).then(function(){return testItemProvider.getItemClassProperties(selectorConfig.classUri)}).then(function(filters){selectorConfig.filters=filters}).then(function(){selectorConfig.classes[0].children.forEach(function(node){resourceSelector.addClassNode(node,selectorConfig.classUri)}),resourceSelector.updateFilters(selectorConfig.filters)}).catch(onError)}}),define("tpl!taoQtiTest/controller/creator/templates/testpart",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function main(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},helper;return"<div id=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"identifier")||(null==depth0?depth0:lookupProperty(depth0,"identifier")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"identifier",hash:{},data:data,loc:{start:{line:1,column:9},end:{line:1,column:23}}}):helper))+"\" class=\"testpart clearfix\">\n\n   <h1><span data-bind=\"identifier\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"identifier")||(null==depth0?depth0:lookupProperty(depth0,"identifier")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"identifier",hash:{},data:data,loc:{start:{line:3,column:36},end:{line:3,column:50}}}):helper))+"</span>\n        <div class=\"actions\">\n            <div class=\"tlb\">\n                <div class=\"tlb-top\">\n                    <span class=\"tlb-box\">\n                        <span class=\"tlb-bar\">\n                            <span class=\"tlb-start\"></span>\n                            <span class=\"tlb-group\">\n                                <a href=\"#\" class=\"tlb-button-off property-toggler\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Test Part Properties",{name:"__",hash:{},data:data,loc:{start:{line:11,column:91},end:{line:11,column:120}}}))+"\"><span class=\"icon-settings\"></span></a>\n                                <span class=\"tlb-separator\"></span>\n                                <a href=\"#\" class=\"tlb-button-off move-up\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Move Up",{name:"__",hash:{},data:data,loc:{start:{line:13,column:82},end:{line:13,column:98}}}))+"\"><span class=\"icon-up\"></span></a>\n                                <a href=\"#\" class=\"tlb-button-off move-down\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Move Down",{name:"__",hash:{},data:data,loc:{start:{line:14,column:84},end:{line:14,column:102}}}))+"\"><span class=\"icon-down\"></span></a>\n                                <span class=\"tlb-separator\"></span>\n                                <a href=\"#\" class=\"tlb-button-off\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Remove Test Part",{name:"__",hash:{},data:data,loc:{start:{line:16,column:74},end:{line:16,column:99}}}))+"\" data-delete=\"#"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"identifier")||(null==depth0?depth0:lookupProperty(depth0,"identifier")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"identifier",hash:{},data:data,loc:{start:{line:16,column:115},end:{line:16,column:129}}}):helper))+"\"><span class=\"icon-bin\"></span></a>\n                            </span>\n                            <span class=\"tlb-end\"></span>\n                        </span>\n                    </span>\n                </div>\n            </div>\n        </div>\n        <a href=\"#\" class=\"toggler opened\" data-toggle=\"#testpart-content-"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"identifier")||(null==depth0?depth0:lookupProperty(depth0,"identifier")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"identifier",hash:{},data:data,loc:{start:{line:24,column:74},end:{line:24,column:88}}}):helper))+"\"></a>\n    </h1>\n    <div id=\"testpart-content-"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"identifier")||(null==depth0?depth0:lookupProperty(depth0,"identifier")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"identifier",hash:{},data:data,loc:{start:{line:26,column:30},end:{line:26,column:44}}}):helper))+"\" class=\"testpart-content\">\n\n       <!-- assessmentTest/testPart/assessmentSections -->\n       <div class=\"sections\" data-bind-each=\"assessmentSections\" data-bind-tmpl=\"section\" data-bind-filter=\"isSection\"></div>\n\n        <button class=\"btn-info small section-adder\">\n            <span class=\"icon-add\"></span>\n            "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"New section",{name:"__",hash:{},data:data,loc:{start:{line:33,column:12},end:{line:33,column:32}}}))+"\n        </button>\n    </div>\n</div>"},useData:!0})}),define("tpl!taoQtiTest/controller/creator/templates/section",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function main(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},helper;return"<div id=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"identifier")||(null==depth0?depth0:lookupProperty(depth0,"identifier")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"identifier",hash:{},data:data,loc:{start:{line:1,column:9},end:{line:1,column:23}}}):helper))+"\" class=\"section\">\n\n<!-- assessmentTest/testPart/assessmentSection/title -->\n    <h2><span data-bind=\"title\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"title")||(null==depth0?depth0:lookupProperty(depth0,"title")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"title",hash:{},data:data,loc:{start:{line:4,column:32},end:{line:4,column:41}}}):helper))+"</span>\n        <div class=\"actions\">\n            <div class=\"tlb\">\n                <div class=\"tlb-top\">\n                    <span class=\"tlb-box\">\n                        <span class=\"tlb-bar\">\n                            <span class=\"tlb-start\"></span>\n                            <span class=\"tlb-group\">\n                                <a href=\"#\" class=\"tlb-button-off rub-toggler\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Manage Rubric Blocks",{name:"__",hash:{},data:data,loc:{start:{line:12,column:86},end:{line:12,column:115}}}))+"\" data-toggle=\"#rublocks-"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"identifier")||(null==depth0?depth0:lookupProperty(depth0,"identifier")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"identifier",hash:{},data:data,loc:{start:{line:12,column:140},end:{line:12,column:154}}}):helper))+"\" ><span class=\"icon-rubric\"></span></a>\n                                <span class=\"tlb-separator\"></span>\n                                <a href=\"#\" class=\"tlb-button-off property-toggler\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Section Properties",{name:"__",hash:{},data:data,loc:{start:{line:14,column:91},end:{line:14,column:118}}}))+"\"><span class=\"icon-settings\"></span></a>\n                                <span class=\"tlb-separator\"></span>\n                                <a href=\"#\" class=\"tlb-button-off move-up disabled\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Move Up",{name:"__",hash:{},data:data,loc:{start:{line:16,column:91},end:{line:16,column:107}}}))+"\"><span class=\"icon-up\"></span></a>\n                                <a href=\"#\" class=\"tlb-button-off move-down disabled\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Move Down",{name:"__",hash:{},data:data,loc:{start:{line:17,column:93},end:{line:17,column:111}}}))+"\"><span class=\"icon-down\"></span></a>\n                                <span class=\"tlb-separator\"></span>\n                                <a href=\"#\" class=\"tlb-button-off disabled\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Remove Section",{name:"__",hash:{},data:data,loc:{start:{line:19,column:83},end:{line:19,column:106}}}))+"\" data-delete=\":parent .section\"><span class=\"icon-bin\"></span></a>\n                            </span>\n                            <span class=\"tlb-end\"></span>\n                        </span>\n                    </span>\n                </div>\n            </div>\n        </div>\n    </h2>\n\n    <div id=\"rublocks-"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"identifier")||(null==depth0?depth0:lookupProperty(depth0,"identifier")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"identifier",hash:{},data:data,loc:{start:{line:29,column:22},end:{line:29,column:36}}}):helper))+"\" class=\"rublocks clearfix toggled\">\n        <h3>\n            <span class=\"title\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Rubric Blocks",{name:"__",hash:{},data:data,loc:{start:{line:31,column:32},end:{line:31,column:54}}}))+"</span>\n        </h3>\n        <ol class=\"rubricblocks decimal\" data-bind-each=\"rubricBlocks\" data-bind-tmpl=\"rubricblock\"></ol>\n        <button class=\"btn-info small rublock-adder\">\n            <span class=\"icon-add\"></span>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"New Rubric Block",{name:"__",hash:{},data:data,loc:{start:{line:35,column:42},end:{line:35,column:67}}}))+"\n        </button>\n    </div>\n    <div class=\"itemrefs-wrapper\">\n        <h3>\n            <span class=\"title\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Items",{name:"__",hash:{},data:data,loc:{start:{line:40,column:32},end:{line:40,column:46}}}))+"</span>\n        </h3>\n        <ol class=\"itemrefs decimal clearfix\" data-bind-each=\"sectionParts\" data-bind-tmpl=\"itemref\" data-bind-filter=\"isItemRef\" data-msg=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Add selected item(s) here.",{name:"__",hash:{},data:data,loc:{start:{line:42,column:140},end:{line:42,column:175}}}))+"\"></ol>\n        <div class=\"itemref-placeholder\">\n            "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Add selected item(s) here.",{name:"__",hash:{},data:data,loc:{start:{line:44,column:12},end:{line:44,column:47}}}))+"\n        </div>\n    </div>\n</div>"},useData:!0})}),define("tpl!taoQtiTest/controller/creator/templates/rubricblock",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function main(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"<li class=\"rubricblock\">\n    <div class=\"actions\">\n       <div class=\"tlb\">\n            <div class=\"tlb-top\">\n                <span class=\"tlb-box\">\n                    <span class=\"tlb-bar\">\n                        <span class=\"tlb-start\"></span>\n                        <span class=\"tlb-group\">\n                            <a href=\"#\" class=\"tlb-button-off property-toggler\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Rubric Block Properties",{name:"__",hash:{},data:data,loc:{start:{line:9,column:87},end:{line:9,column:119}}}))+"\"><span class=\"icon-settings\"></span></a>\n                            <span class=\"tlb-separator\"></span>\n                            <a href=\"#\" class=\"tlb-button-off\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Remove Rubric Block",{name:"__",hash:{},data:data,loc:{start:{line:11,column:70},end:{line:11,column:98}}}))+"\" data-delete=\":parent .rubricblock\"><span class=\"icon-bin\"></span></a>\n                        </span>\n                        <span class=\"tlb-end\"></span>\n                    </span>\n                </span>\n            </div>\n        </div>\n    </div>\n    <div class=\"rubricblock-content\"></div>\n</li>"},useData:!0})}),define("tpl!taoQtiTest/controller/creator/templates/itemref",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function main(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1,helper;return"<li id='"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"identifier")||(null==depth0?depth0:lookupProperty(depth0,"identifier")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"identifier",hash:{},data:data,loc:{start:{line:1,column:8},end:{line:1,column:22}}}):helper))+"' data-uri='"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"href")||(null==depth0?depth0:lookupProperty(depth0,"href")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"href",hash:{},data:data,loc:{start:{line:1,column:34},end:{line:1,column:42}}}):helper))+"' class='itemref'>\n    <span class='title truncate'>"+(null==(stack1=(lookupProperty(helpers,"dompurify")||depth0&&lookupProperty(depth0,"dompurify")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"label"),{name:"dompurify",hash:{},data:data,loc:{start:{line:2,column:33},end:{line:2,column:54}}}))?"":stack1)+"</span>\n    <div class=\"actions\">\n        <div class=\"tlb\">\n            <div class=\"tlb-top\">\n                <span class=\"tlb-box\">\n                    <span class=\"tlb-bar\">\n                        <span class=\"tlb-start\"></span>\n                        <span class=\"tlb-group\">\n                            <a href=\"#\" class=\"tlb-button-off property-toggler\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Item Reference Properties",{name:"__",hash:{},data:data,loc:{start:{line:10,column:87},end:{line:10,column:121}}}))+"\"><span class=\"icon-settings\"></span></a>\n                            <span class=\"tlb-separator\"></span>\n                            <a href=\"#\" class=\"tlb-button-off move-up\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Move Up",{name:"__",hash:{},data:data,loc:{start:{line:12,column:78},end:{line:12,column:94}}}))+"\"><span class=\"icon-up\"></span></a>\n                            <a href=\"#\" class=\"tlb-button-off move-down\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Move Down",{name:"__",hash:{},data:data,loc:{start:{line:13,column:80},end:{line:13,column:98}}}))+"\"><span class=\"icon-down\"></span></a>\n                            <span class=\"tlb-separator\"></span>\n                            <a href=\"#\" class=\"tlb-button-off\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Remove Item Reference",{name:"__",hash:{},data:data,loc:{start:{line:15,column:70},end:{line:15,column:100}}}))+"\" data-delete=\":parent .itemref\"><span class=\"icon-bin\"></span></a>\n                        </span>\n                        <span class=\"tlb-end\"></span>\n                    </span>\n                </span>\n            </div>\n        </div>\n    </div>\n</li>"},useData:!0})}),define("tpl!taoQtiTest/controller/creator/templates/outcomes",["handlebars"],function(hb){return hb.template({1:function _(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1;return null==(stack1=lookupProperty(helpers,"each").call(null==depth0?container.nullContext||{}:depth0,depth0,{name:"each",hash:{},fn:container.program(2,data,0),inverse:container.noop,data:data,loc:{start:{line:7,column:4},end:{line:13,column:13}}}))?"":stack1},2:function _(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},helper;return"    <div class=\"grid-row\">\n        <div class=\"col-6 line\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"name")||(null==depth0?depth0:lookupProperty(depth0,"name")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"name",hash:{},data:data,loc:{start:{line:9,column:32},end:{line:9,column:40}}}):helper))+"</div>\n        <div class=\"col-3 line\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"type")||(null==depth0?depth0:lookupProperty(depth0,"type")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"type",hash:{},data:data,loc:{start:{line:10,column:32},end:{line:10,column:40}}}):helper))+"</div>\n        <div class=\"col-3 line\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"cardinality")||(null==depth0?depth0:lookupProperty(depth0,"cardinality")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"cardinality",hash:{},data:data,loc:{start:{line:11,column:32},end:{line:11,column:47}}}):helper))+"</div>\n    </div>\n"},4:function _(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"    <div class=\"grid-row\">\n        <div class=\"col-12 line\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"no outcome declaration found",{name:"__",hash:{},data:data,loc:{start:{line:16,column:33},end:{line:16,column:70}}}))+"</div>\n    </div>\n"},compiler:[8,">= 4.3.0"],main:function main(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1;return"<div class=\"grid-row\">\n        <div class=\"col-6 header\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Identifier",{name:"__",hash:{},data:data,loc:{start:{line:2,column:34},end:{line:2,column:53}}}))+"</div>\n        <div class=\"col-3 header\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Type",{name:"__",hash:{},data:data,loc:{start:{line:3,column:34},end:{line:3,column:47}}}))+"</div>\n        <div class=\"col-3 header\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Cardinality",{name:"__",hash:{},data:data,loc:{start:{line:4,column:34},end:{line:4,column:54}}}))+"</div>\n    </div>\n"+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,depth0,{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.program(4,data,0),data:data,loc:{start:{line:6,column:0},end:{line:18,column:7}}}))?"":stack1)},useData:!0})}),define("tpl!taoQtiTest/controller/creator/templates/test-props",["handlebars"],function(hb){return hb.template({1:function _(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1;return"    <div class=\"test-scoring toggled\">\n\n<!-- assessmentTest/scoring/outcomeProcessing -->\n        <div class=\"grid-row\">\n            <div class=\"col-5\">\n                <label for=\"test-outcome-processing\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Outcome processing",{name:"__",hash:{},data:data,loc:{start:{line:106,column:53},end:{line:106,column:80}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <select name=\"test-outcome-processing\" class=\"select2\" data-bind=\"scoring.outcomeProcessing\" data-bind-encoder=\"string\" data-has-search=\"false\">\n"+(null==(stack1=lookupProperty(helpers,"each").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"modes"),{name:"each",hash:{},fn:container.program(2,data,0),inverse:container.noop,data:data,loc:{start:{line:110,column:16},end:{line:112,column:25}}}))?"":stack1)+"                </select>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Select the way the responses of your test should be processed",{name:"__",hash:{},data:data,loc:{start:{line:118,column:20},end:{line:118,column:90}}}))+"\n                </div>\n            </div>\n        </div>\n\n<!-- assessmentTest/scoring/categoryScore -->\n        <div class=\"grid-row test-category-score\">\n            <div class=\"col-5\">\n                <label for=\"test-category-score\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Category score",{name:"__",hash:{},data:data,loc:{start:{line:126,column:49},end:{line:126,column:72}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <label>\n                    <input type=\"checkbox\" name=\"test-category-score\" value=\"true\" data-bind=\"scoring.categoryScore\" data-bind-encoder=\"boolean\" />\n                    <span class=\"icon-checkbox\"></span>\n                </label>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Also compute the score per categories",{name:"__",hash:{},data:data,loc:{start:{line:137,column:20},end:{line:137,column:66}}}))+"\n                </div>\n            </div>\n        </div>\n\n<!-- assessmentTest/scoring/cutScore -->\n        <div class=\"grid-row test-cut-score\">\n            <div class=\"col-5\">\n                <label for=\"test-cut-score\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Cut score (pass ratio)",{name:"__",hash:{},data:data,loc:{start:{line:145,column:44},end:{line:145,column:75}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <input type=\"text\" name=\"test-cut-score\" value=\"0\" data-bind=\"scoring.cutScore\" data-bind-encoder=\"float\" data-validate=\"$numeric;\" />\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Set the cut score (or pass score ratio) associated to the test. It must be a float between 0 and 1.",{name:"__",hash:{},data:data,loc:{start:{line:153,column:20},end:{line:153,column:128}}}))+"\n                </div>\n            </div>\n        </div>\n\n<!-- assessmentTest/scoring/weightIdentifier -->\n        <div class=\"grid-row test-weight-identifier\">\n            <div class=\"col-5\">\n                <label for=\"test-weight-identifier\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Weight",{name:"__",hash:{},data:data,loc:{start:{line:161,column:52},end:{line:161,column:67}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <input type=\"text\" name=\"test-weight-identifier\" data-bind=\"scoring.weightIdentifier\" data-validate=\"$pattern(pattern=^([a-zA-Z_][a-zA-Z0-9_\\.-]*)?$);\" />\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Set the weight identifier used to process the score",{name:"__",hash:{},data:data,loc:{start:{line:169,column:20},end:{line:169,column:80}}}))+"\n                </div>\n            </div>\n        </div>\n\n<!-- assessmentTest/scoring/description -->\n        <div class=\"grid-row\">\n            <div class=\"col-12\">\n"+(null==(stack1=lookupProperty(helpers,"each").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"modes"),{name:"each",hash:{},fn:container.program(5,data,0),inverse:container.noop,data:data,loc:{start:{line:177,column:16},end:{line:182,column:25}}}))?"":stack1)+"            </div>\n        </div>\n    </div>\n"},2:function _(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1,helper;return"                    <option value=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"key")||(null==depth0?depth0:lookupProperty(depth0,"key")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"key",hash:{},data:data,loc:{start:{line:111,column:35},end:{line:111,column:42}}}):helper))+"\" "+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"selected"),{name:"if",hash:{},fn:container.program(3,data,0),inverse:container.noop,data:data,loc:{start:{line:111,column:44},end:{line:111,column:86}}}))?"":stack1)+">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:111,column:87},end:{line:111,column:96}}}):helper))+"</option>\n"},3:function _(){return"selected=\"selected\""},5:function _(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},helper;return"                <div class=\"feedback-info test-outcome-processing-description\" data-key=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"key")||(null==depth0?depth0:lookupProperty(depth0,"key")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"key",hash:{},data:data,loc:{start:{line:178,column:89},end:{line:178,column:96}}}):helper))+"\">\n                    <span class=\"icon-info\"></span>\n                    "+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"description")||(null==depth0?depth0:lookupProperty(depth0,"description")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"description",hash:{},data:data,loc:{start:{line:180,column:20},end:{line:180,column:35}}}):helper))+"\n                </div>\n"},compiler:[8,">= 4.3.0"],main:function main(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1;return"<div class=\"test-props props clearfix\">\n\n    <!-- test properties -->\n    <h3 data-bind=\"title\"></h3>\n\n<!-- assessmentTest/identifier -->\n    <div class=\"grid-row\">\n        <div class=\"col-5\">\n            <label for=\"test-identifier\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Identifier",{name:"__",hash:{},data:data,loc:{start:{line:9,column:41},end:{line:9,column:60}}}))+" <abbr title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Required field",{name:"__",hash:{},data:data,loc:{start:{line:9,column:74},end:{line:9,column:97}}}))+"\">*</abbr></label>\n        </div>\n        <div class=\"col-6\">\n            <input type=\"text\" name=\"test-identifier\" data-bind=\"identifier\" data-validate=\"$notEmpty; $testIdFormat; $testIdAvailable;\" />\n        </div>\n        <div class=\"col-1 help\">\n            <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n            <div class=\"tooltip-content\">\n            "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"The principle identifier of the test.",{name:"__",hash:{},data:data,loc:{start:{line:17,column:12},end:{line:17,column:58}}}))+"\n            </div>\n        </div>\n    </div>\n\n<!-- assessmentTest/title -->\n    <div class=\"grid-row\">\n        <div class=\"col-5\">\n            <label for=\"test-title\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Title",{name:"__",hash:{},data:data,loc:{start:{line:25,column:36},end:{line:25,column:50}}}))+" <abbr title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Required field",{name:"__",hash:{},data:data,loc:{start:{line:25,column:64},end:{line:25,column:87}}}))+"\">*</abbr></label>\n        </div>\n        <div class=\"col-6\">\n            <input type=\"text\" name=\"test-title\" data-bind=\"title\" data-validate=\"$notEmpty\" />\n        </div>\n        <div class=\"col-1 help\">\n            <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n            <div class=\"tooltip-content\">\n            "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"The test title.",{name:"__",hash:{},data:data,loc:{start:{line:33,column:12},end:{line:33,column:36}}}))+"\n            </div>\n        </div>\n    </div>\n\n    <h4 class=\"toggler closed\" data-toggle=\"~ .test-time-limits\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Time Limits",{name:"__",hash:{},data:data,loc:{start:{line:38,column:65},end:{line:38,column:85}}}))+"</h4>\n\n<!-- assessmentTest/timeLimits -->\n    <div class=\"test-time-limits toggled\">\n\n\n<!-- assessmentTest/timeLimits/maxTime -->\n        <div class=\"grid-row\">\n            <div class=\"col-5\">\n                <label for=\"test-max-time\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Maximum Duration",{name:"__",hash:{},data:data,loc:{start:{line:64,column:43},end:{line:64,column:68}}}))+"</label>\n            </div>\n            <div class=\"col-6 duration-group\">\n                <input type=\"text\" name=\"max-time\" value=\"00:00:00\" data-duration=\"HH:mm:ss\" data-bind=\"timeLimits.maxTime\" data-bind-encoder=\"time\" />\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Maximum duration for the all test.",{name:"__",hash:{},data:data,loc:{start:{line:72,column:16},end:{line:72,column:59}}}))+"\n                </div>\n            </div>\n        </div>\n\n<!-- assessmentTest/timeLimits/allowLateSubmission -->\n        <div class=\"grid-row pseudo-label-box\">\n            <div class=\"col-5\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Late submission allowed",{name:"__",hash:{},data:data,loc:{start:{line:80,column:16},end:{line:80,column:48}}}))+"\n            </div>\n            <div class=\"col-6\">\n                <label>\n                    <input type=\"checkbox\" name=\"test-allow-late-submission\" value=\"true\" data-bind=\"timeLimits.allowLateSubmission\" data-bind-encoder=\"boolean\" />\n                    <span class=\"icon-checkbox\"></span>\n                </label>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Whether a candidate's response that is beyond the maximum duration should still be accepted.",{name:"__",hash:{},data:data,loc:{start:{line:91,column:16},end:{line:91,column:117}}}))+"\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <h4 class=\"toggler closed\" data-toggle=\"~ .test-scoring\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Scoring",{name:"__",hash:{},data:data,loc:{start:{line:97,column:61},end:{line:97,column:77}}}))+"</h4>\n\n<!-- assessmentTest/scoring -->\n"+(null==(stack1=lookupProperty(helpers,"with").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"scoring"),{name:"with",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:100,column:0},end:{line:186,column:9}}}))?"":stack1)+"\n    <h4 class=\"toggler closed\" data-toggle=\"~ .test-outcome-declarations\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Outcome declarations",{name:"__",hash:{},data:data,loc:{start:{line:188,column:74},end:{line:188,column:103}}}))+"</h4>\n\n    <!-- assessmentTest/outcomeDeclarations -->\n    <div class=\"test-outcome-declarations panel toggled\">\n        <div class=\"grid-row test-outcomes-generate\">\n            <div class=\"col-12 align-right\">\n                <button class=\"btn-info small\" data-action=\"generate-outcomes\"><span class=\"icon icon-reset\"></span>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Regenerate",{name:"__",hash:{},data:data,loc:{start:{line:194,column:116},end:{line:194,column:135}}}))+"</button>\n            </div>\n        </div>\n        <div class=\"outcome-declarations\"></div>\n    </div>\n\n</div>"},useData:!0})}),define("tpl!taoQtiTest/controller/creator/templates/testpart-props",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function main(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},helper;return"<div id=\"testpart-props-"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"identifier")||(null==depth0?depth0:lookupProperty(depth0,"identifier")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"identifier",hash:{},data:data,loc:{start:{line:1,column:24},end:{line:1,column:38}}}):helper))+"\" class=\"testpart-props props clearfix\">\n    <h3>"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"identifier")||(null==depth0?depth0:lookupProperty(depth0,"identifier")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"identifier",hash:{},data:data,loc:{start:{line:2,column:8},end:{line:2,column:22}}}):helper))+"</h3>\n\n    <form autocomplete=\"off\">\n\n<!-- assessmentTest/testPart/identifier -->\n        <div class=\"grid-row\">\n            <div class=\"col-5\">\n                <label for=\"testpart-identifier\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Identifier",{name:"__",hash:{},data:data,loc:{start:{line:9,column:49},end:{line:9,column:68}}}))+" <abbr title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Required field",{name:"__",hash:{},data:data,loc:{start:{line:9,column:82},end:{line:9,column:105}}}))+"\">*</abbr></label>\n            </div>\n            <div class=\"col-6\">\n                <input type=\"text\" name=\"testpart-identifier\" data-bind=\"identifier\" data-validate=\"$notEmpty; $idFormat; $testIdAvailable;\" />\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"The test part identifier.",{name:"__",hash:{},data:data,loc:{start:{line:17,column:16},end:{line:17,column:50}}}))+"\n                </div>\n            </div>\n        </div>\n\n<!-- assessmentTest/testPart/navigationMode -->\n        <div class=\"grid-row pseudo-label-box\">\n            <div class=\"col-5\">\n               "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Navigation",{name:"__",hash:{},data:data,loc:{start:{line:25,column:15},end:{line:25,column:34}}}))+" <abbr title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Required field",{name:"__",hash:{},data:data,loc:{start:{line:25,column:48},end:{line:25,column:71}}}))+"\">*</abbr>\n            </div>\n            <div class=\"col-6\">\n                <label>\n                    <input type=\"radio\" name=\"testpart-navigation-mode\" value=\"0\" checked=\"checked\" data-bind=\"navigationMode\" data-bind-encoder=\"number\" />\n                    <span class=\"icon-radio\"></span>\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Linear",{name:"__",hash:{},data:data,loc:{start:{line:31,column:20},end:{line:31,column:35}}}))+"\n                </label>\n                <label>\n                    <input type=\"radio\" name=\"testpart-navigation-mode\" value=\"1\"  />\n                    <span class=\"icon-radio\"></span>\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Non Linear",{name:"__",hash:{},data:data,loc:{start:{line:36,column:20},end:{line:36,column:39}}}))+"\n                </label>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"The navigation mode determines the general paths that the candidate may take. A linear mode restricts the candidate to attempt each item in turn. Non Linear removes this restriction.",{name:"__",hash:{},data:data,loc:{start:{line:42,column:16},end:{line:42,column:207}}}))+"\n                </div>\n            </div>\n        </div>\n\n<!-- assessmentTest/testPart/submissionMode -->\n        <div class=\"grid-row pseudo-label-box\">\n            <div class=\"col-5\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Submission",{name:"__",hash:{},data:data,loc:{start:{line:50,column:16},end:{line:50,column:35}}}))+" <abbr title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Required field",{name:"__",hash:{},data:data,loc:{start:{line:50,column:49},end:{line:50,column:72}}}))+"\">*</abbr>\n            </div>\n            <div class=\"col-6\">\n                <label>\n                    <input type=\"radio\" name=\"testpart-submission-mode\" value=\"0\" checked=\"checked\" data-bind=\"submissionMode\" data-bind-encoder=\"number\" />\n                    <span class=\"icon-radio\"></span>\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Individual",{name:"__",hash:{},data:data,loc:{start:{line:56,column:20},end:{line:56,column:39}}}))+"\n                </label>\n                <label>\n                    <input type=\"radio\" name=\"testpart-submission-mode\" value=\"1\"  />\n                    <span class=\"icon-radio\"></span>\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Simultaneous",{name:"__",hash:{},data:data,loc:{start:{line:61,column:20},end:{line:61,column:41}}}))+"\n                </label>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"The submission mode determines when the candidate's responses are submitted for response processing. A testPart in individual mode requires the candidate to submit their responses on an item-by-item basis. In simultaneous mode the candidate's responses are all submitted together at the end of the testPart.",{name:"__",hash:{},data:data,loc:{start:{line:67,column:16},end:{line:67,column:332}}}))+"\n                </div>\n            </div>\n        </div>\n\n        <h4 class=\"toggler closed\" data-toggle=\"~ .testpart-item-session-control\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Item Session Control",{name:"__",hash:{},data:data,loc:{start:{line:72,column:82},end:{line:72,column:111}}}))+"</h4>\n\n\n<!-- assessmentTest/testPart/itemSessionControl -->\n        <div class=\"testpart-item-session-control toggled\">\n\n<!-- assessmentTest/testPart/itemSessionControl/maxAttempts -->\n            <div class=\"grid-row\">\n                <div class=\"col-5\">\n                    <label for=\"testpart-max-attempts\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Max Attempts",{name:"__",hash:{},data:data,loc:{start:{line:81,column:55},end:{line:81,column:76}}}))+"</label>\n                </div>\n                <div class=\"col-6\">\n                    <input name=\"testpart-max-attempts\" type=\"text\" data-increment=\"1\" data-min=\"0\" value=\"1\" data-bind=\"itemSessionControl.maxAttempts\" data-bind-encoder=\"number\" />\n                </div>\n                <div class=\"col-1 help\">\n                    <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                    <div class=\"tooltip-content\">\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Controls the maximum number of attempts allowed. 0 means unlimited.",{name:"__",hash:{},data:data,loc:{start:{line:89,column:20},end:{line:89,column:96}}}))+"\n                    </div>\n                </div>\n            </div>\n\n<!-- assessmentTest/testPart/itemSessionControl/showFeedback -->\n            <div class=\"grid-row pseudo-label-box\">\n                <div class=\"col-5\">\n                    <label for=\"testpart-show-feedback\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Show Feedback",{name:"__",hash:{},data:data,loc:{start:{line:97,column:56},end:{line:97,column:78}}}))+"</label>\n                </div>\n                <div class=\"col-6\">\n                    <label>\n                        <input type=\"checkbox\" name=\"testpart-show-feedback\" value=\"true\" data-bind=\"itemSessionControl.showFeedback\" data-bind-encoder=\"boolean\" />\n                        <span class=\"icon-checkbox\" />\n                    </label>\n                </div>\n                <div class=\"col-1 help\">\n                    <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                    <div class=\"tooltip-content\">\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"This constraint affects the visibility of feedback after the end of the last attempt.",{name:"__",hash:{},data:data,loc:{start:{line:108,column:20},end:{line:108,column:114}}}))+"\n                    </div>\n                </div>\n            </div>\n\n\n\n<!-- assessmentTest/testPart/itemSessionControl/allowComment -->\n            <div class=\"grid-row pseudo-label-box\">\n                <div class=\"col-5\">\n                    <label for=\"testpart-allow-comment\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Allow Comment",{name:"__",hash:{},data:data,loc:{start:{line:158,column:56},end:{line:158,column:78}}}))+"</label>\n                </div>\n                <div class=\"col-6\">\n                    <label>\n                        <input type=\"checkbox\" name=\"testpart-allow-comment\" value=\"true\" data-bind=\"itemSessionControl.allowComment\" data-bind-encoder=\"boolean\" />\n                        <span class=\"icon-checkbox\" />\n                    </label>\n                </div>\n                <div class=\"col-1 help\">\n                    <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                    <div class=\"tooltip-content\">\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"This constraint controls whether or not the candidate is allowed to provide a comment on the item during the session. Comments are not part of the assessed responses.",{name:"__",hash:{},data:data,loc:{start:{line:169,column:20},end:{line:169,column:195}}}))+"\n                    </div>\n                </div>\n            </div>\n\n<!-- assessmentTest/testPart/itemSessionControl/allowSkipping -->\n            <div class=\"grid-row pseudo-label-box\">\n                <div class=\"col-5\">\n                    <label for=\"testpart-allow-skipping\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Allow Skipping",{name:"__",hash:{},data:data,loc:{start:{line:177,column:57},end:{line:177,column:80}}}))+"</label>\n                </div>\n                <div class=\"col-6\">\n                    <label>\n                        <input type=\"checkbox\" name=\"testpart-allow-skipping\" value=\"true\" checked=\"checked\"  data-bind=\"itemSessionControl.allowSkipping\" data-bind-encoder=\"boolean\"   />\n                        <span class=\"icon-checkbox\" />\n                    </label>\n                </div>\n                <div class=\"col-1 help\">\n                    <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                    <div class=\"tooltip-content\">\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"If the candidate can skip the item, without submitting a response (default is true).",{name:"__",hash:{},data:data,loc:{start:{line:188,column:20},end:{line:188,column:113}}}))+"\n                    </div>\n                </div>\n            </div>\n\n<!-- assessmentTest/testPart/itemSessionControl/validateResponses -->\n            <div class=\"grid-row pseudo-label-box\">\n                <div class=\"col-5\">\n                    <label for=\"testpart-validate-responses\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Validate Responses",{name:"__",hash:{},data:data,loc:{start:{line:196,column:61},end:{line:196,column:88}}}))+"</label>\n                </div>\n                <div class=\"col-6\">\n                    <label>\n                        <input type=\"checkbox\" name=\"testpart-validate-responses\" value=\"true\"  data-bind=\"itemSessionControl.validateResponses\" data-bind-encoder=\"boolean\"  />\n                        <span class=\"icon-checkbox\" />\n                    </label>\n                </div>\n                <div class=\"col-1 help\">\n                    <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                    <div class=\"tooltip-content\">\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"The candidate is not allowed to submit invalid responses.",{name:"__",hash:{},data:data,loc:{start:{line:207,column:20},end:{line:207,column:86}}}))+"\n                    </div>\n                </div>\n            </div>\n\n        </div>\n\n        <h4 class=\"toggler closed\" data-toggle=\"~ .testpart-time-limits\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Time Limits",{name:"__",hash:{},data:data,loc:{start:{line:214,column:73},end:{line:214,column:93}}}))+"</h4>\n\n<!-- assessmentTest/testPart/timeLimits/minTime -->\n        <div class=\"testpart-time-limits toggled\">\n\n\n<!-- assessmentTest/testPart/timeLimits/maxTime -->\n            <div class=\"grid-row\">\n                <div class=\"col-5\">\n                    <label for=\"testpart-max-time\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Maximum Duration",{name:"__",hash:{},data:data,loc:{start:{line:240,column:51},end:{line:240,column:76}}}))+"</label>\n                </div>\n                <div class=\"col-6 duration-group\">\n                    <input type=\"text\" name=\"max-time\" value=\"00:00:00\" data-duration=\"HH:mm:ss\" data-bind=\"timeLimits.maxTime\" data-bind-encoder=\"time\" />\n                </div>\n                <div class=\"col-1 help\">\n                    <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                    <div class=\"tooltip-content\">\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Maximum duration for this test part.",{name:"__",hash:{},data:data,loc:{start:{line:248,column:20},end:{line:248,column:65}}}))+"\n                    </div>\n                </div>\n            </div>\n\n<!-- assessmentTest/testPart/timeLimits/allowLateSubmission -->\n            <div class=\"grid-row pseudo-label-box\">\n                <div class=\"col-5\">\n                    <label for=\"testpart-allow-late-submission\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Late submission allowed",{name:"__",hash:{},data:data,loc:{start:{line:256,column:64},end:{line:256,column:96}}}))+"</label>\n                </div>\n                <div class=\"col-6\">\n                    <label>\n                        <input type=\"checkbox\" name=\"section-allow-late-submission\" value=\"true\" data-bind=\"timeLimits.allowLateSubmission\" data-bind-encoder=\"boolean\" />\n                        <span class=\"icon-checkbox\" />\n                    </label>\n                </div>\n                <div class=\"col-1 help\">\n                    <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                    <div class=\"tooltip-content\">\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Whether a candidate's response that is beyond the maximum duration of the test part should still be accepted.",{name:"__",hash:{},data:data,loc:{start:{line:267,column:20},end:{line:267,column:138}}}))+"\n                    </div>\n                </div>\n            </div>\n        </div>\n    </form>\n</div>"},useData:!0})}),define("tpl!taoQtiTest/controller/creator/templates/section-props",["handlebars"],function(hb){return hb.template({1:function _(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"    <div class=\"grid-row pseudo-label-box\">\n        <div class=\"col-5\">\n            <label for=\"section-blueprint\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Associate Blueprint",{name:"__",hash:{},data:data,loc:{start:{line:120,column:43},end:{line:120,column:71}}}))+"</label>\n        </div>\n\n        <div class=\"col-6\">\n            <input type=\"text\" name=\"section-blueprint\" />\n        </div>\n        <div class=\"col-1 help\">\n            <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n            <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Associate a blueprint to a section allow you to validate this section against the specified blueprint.",{name:"__",hash:{},data:data,loc:{start:{line:129,column:16},end:{line:129,column:127}}}))+"\n            </div>\n        </div>\n    </div>\n"},compiler:[8,">= 4.3.0"],main:function main(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1,helper;return"<div id=\"section-props-"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"identifier")||(null==depth0?depth0:lookupProperty(depth0,"identifier")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"identifier",hash:{},data:data,loc:{start:{line:1,column:23},end:{line:1,column:37}}}):helper))+"\" class=\"section-props props clearfix\">\n    <h3>"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"title")||(null==depth0?depth0:lookupProperty(depth0,"title")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"title",hash:{},data:data,loc:{start:{line:2,column:8},end:{line:2,column:17}}}):helper))+"</h3>\n\n<!-- assessmentTest/testPart/assessmentSection/identifier -->\n    <div class=\"grid-row\">\n        <div class=\"col-5\">\n            <label for=\"section-identifier\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Identifier",{name:"__",hash:{},data:data,loc:{start:{line:7,column:44},end:{line:7,column:63}}}))+" <abbr title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Required field",{name:"__",hash:{},data:data,loc:{start:{line:7,column:77},end:{line:7,column:100}}}))+"\">*</abbr></label>\n        </div>\n        <div class=\"col-6\">\n            <input type=\"text\" name=\"section-identifier\" data-bind=\"identifier\" data-validate=\"$notEmpty; $idFormat; $testIdAvailable;\" />\n        </div>\n        <div class=\"col-1 help\">\n            <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n            <div class=\"tooltip-content\">\n            "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"The identifier of the section.",{name:"__",hash:{},data:data,loc:{start:{line:15,column:12},end:{line:15,column:51}}}))+"\n            </div>\n        </div>\n    </div>\n\n<!-- assessmentTest/testPart/assessmentSection/title -->\n    <div class=\"grid-row\">\n        <div class=\"col-5\">\n            <label for=\"section-title\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Title",{name:"__",hash:{},data:data,loc:{start:{line:23,column:39},end:{line:23,column:53}}}))+" <abbr title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Required field",{name:"__",hash:{},data:data,loc:{start:{line:23,column:67},end:{line:23,column:90}}}))+"\">*</abbr></label>\n        </div>\n        <div class=\"col-6\">\n            <input type=\"text\" name=\"section-title\" data-bind=\"title\" data-validate=\"$notEmpty\" />\n        </div>\n        <div class=\"col-1 help\">\n            <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n            <div class=\"tooltip-content\">\n            "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"The section title.",{name:"__",hash:{},data:data,loc:{start:{line:31,column:12},end:{line:31,column:39}}}))+"\n            </div>\n        </div>\n    </div>\n\n\n\n<!-- assessmentTest/testPart/assessmentSection/visible -->\n    <div class=\"grid-row pseudo-label-box\">\n        <div class=\"col-5\">\n            <label for=\"section-visible\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Visible",{name:"__",hash:{},data:data,loc:{start:{line:81,column:41},end:{line:81,column:57}}}))+" <abbr title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Required field",{name:"__",hash:{},data:data,loc:{start:{line:81,column:71},end:{line:81,column:94}}}))+"\">*</abbr></label>\n        </div>\n        <div class=\"col-6\">\n            <label>\n                <input type=\"checkbox\" name=\"section-visible\" value=\"true\" checked=\"checked\"  data-bind=\"visible\" data-bind-encoder=\"boolean\" />\n                <span class=\"icon-checkbox\"></span>\n            </label>\n        </div>\n        <div class=\"col-1 help\">\n            <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n            <div class=\"tooltip-content\">\n            "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"A visible section is one that is identifiable by the candidate.",{name:"__",hash:{},data:data,loc:{start:{line:92,column:12},end:{line:92,column:84}}}))+"\n            </div>\n        </div>\n    </div>\n\n<!-- assessmentTest/testPart/assessmentSection/keepTogether -->\n    <div class=\"grid-row pseudo-label-box\">\n        <div class=\"col-5\">\n            <label for=\"section-keep-together\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Keep Together",{name:"__",hash:{},data:data,loc:{start:{line:100,column:47},end:{line:100,column:69}}}))+"</label>\n        </div>\n\n        <div class=\"col-6\">\n            <label>\n                <input type=\"checkbox\" name=\"section-keep-together\" value=\"true\" checked=\"checked\"  data-bind=\"keepTogether\" data-bind-encoder=\"boolean\" />\n                <span class=\"icon-checkbox\"></span>\n            </label>\n        </div>\n        <div class=\"col-1 help\">\n            <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n            <div class=\"tooltip-content\">\n            "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"An invisible section with a parent that is subject to shuffling can specify whether or not its children, which will appear to the candidate as if they were part of the parent, are shuffled as a block or mixed up with the other children of the parent section.",{name:"__",hash:{},data:data,loc:{start:{line:112,column:12},end:{line:112,column:279}}}))+"\n            </div>\n        </div>\n    </div>\n\n"+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"hasBlueprint"),{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:117,column:4},end:{line:133,column:11}}}))?"":stack1)+"\n    <div class=\"categories\">\n        <div class=\"grid-row\">\n            <div class=\"col-5\">\n                <label for=\"category-custom\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Categories",{name:"__",hash:{},data:data,loc:{start:{line:138,column:45},end:{line:138,column:64}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <input type=\"text\" name=\"category-custom\"/>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Section level category enables configuring the categories of its composing items all at once. A category in gray means that all items have that category. A category in white means that only a few items have that category.",{name:"__",hash:{},data:data,loc:{start:{line:146,column:20},end:{line:146,column:250}}}))+"\n                </div>\n            </div>\n        </div>\n\n        <!-- some user features (Test Navigation, Test Taker Tools, etc.) are in fact implemented as categories. They will appear here: -->\n        <div class=\"category-presets\"></div>\n    </div>\n\n    <h4 class=\"toggler closed\" data-toggle=\"~ .section-selection\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Selection",{name:"__",hash:{},data:data,loc:{start:{line:155,column:66},end:{line:155,column:84}}}))+"</h4>\n\n<!-- assessmentTest/testPart/assessmentSection/selection -->\n    <div class=\"section-selection toggled\">\n\n        <div class=\"grid-row pseudo-label-box\">\n            <div class=\"col-5\">\n                <label for=\"section-enable-selection\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Enable selection",{name:"__",hash:{},data:data,loc:{start:{line:162,column:54},end:{line:162,column:79}}}))+"</label>\n            </div>\n\n            <div class=\"col-6\">\n                <label>\n                    <input type=\"checkbox\" name=\"section-enable-selection\"  />\n                    <span class=\"icon-checkbox\"></span>\n                </label>\n            </div>\n        </div>\n\n<!-- assessmentTest/testPart/assessmentSection/selection/select -->\n        <div class=\"grid-row\">\n            <div class=\"col-5\">\n                <label for=\"section-select\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Select",{name:"__",hash:{},data:data,loc:{start:{line:176,column:44},end:{line:176,column:59}}}))+" <abbr title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Required field",{name:"__",hash:{},data:data,loc:{start:{line:176,column:73},end:{line:176,column:96}}}))+"\">*</abbr></label>\n            </div>\n            <div class=\"col-6\">\n                <input name=\"section-select\" type=\"text\" data-increment=\"1\" data-min=\"0\" value=\"0\" data-bind=\"selection.select\"  data-bind-encoder=\"number\" />\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"The number of child elements to be selected.",{name:"__",hash:{},data:data,loc:{start:{line:184,column:16},end:{line:184,column:69}}}))+"\n                </div>\n            </div>\n        </div>\n\n<!-- assessmentTest/testPart/assessmentSection/selection/withReplacement -->\n        <div class=\"grid-row pseudo-label-box\">\n            <div class=\"col-5\">\n                <label for=\"section-with-replacement\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"With Replacement",{name:"__",hash:{},data:data,loc:{start:{line:192,column:54},end:{line:192,column:79}}}))+"</label>\n            </div>\n\n            <div class=\"col-6\">\n                <label>\n                    <input type=\"checkbox\" name=\"section-with-replacement\" value=\"true\" data-bind=\"selection.withReplacement\"  data-bind-encoder=\"boolean\" />\n                    <span class=\"icon-checkbox\"></span>\n                </label>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"When selecting child elements each element is normally eligible for selection once only.",{name:"__",hash:{},data:data,loc:{start:{line:204,column:16},end:{line:204,column:113}}}))+"\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <h4 class=\"toggler closed\" data-toggle=\"~ .section-ordering\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Ordering",{name:"__",hash:{},data:data,loc:{start:{line:210,column:65},end:{line:210,column:82}}}))+"</h4>\n\n<!-- assessmentTest/testPart/assessmentSection/ordering -->\n    <div class=\"section-ordering toggled\">\n<!-- assessmentTest/testPart/assessmentSection/ordering/shuffle -->\n        <div class=\"grid-row pseudo-label-box\">\n            <div class=\"col-5\">\n                <label for=\"section-shuffle\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Shuffle",{name:"__",hash:{},data:data,loc:{start:{line:217,column:45},end:{line:217,column:61}}}))+"</label>\n            </div>\n\n            <div class=\"col-6\">\n                <label>\n                    <input type=\"checkbox\" name=\"section-shuffle\" value=\"true\" data-bind=\"ordering.shuffle\"  data-bind-encoder=\"boolean\"  />\n                    <span class=\"icon-checkbox\"></span>\n                </label>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"If set, it causes the order of the child elements to be randomized, otherwise it uses the order in which the child elements are defined.",{name:"__",hash:{},data:data,loc:{start:{line:229,column:16},end:{line:229,column:161}}}))+"\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <h4 class=\"toggler closed\" data-toggle=\"~ .section-item-session-control\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Item Session Control",{name:"__",hash:{},data:data,loc:{start:{line:235,column:77},end:{line:235,column:106}}}))+"</h4>\n\n<!-- assessmentTest/testPart/assessmentSection/itemSessionControl -->\n    <div class=\"section-item-session-control toggled\">\n<!-- assessmentTest/testPart/assessmentSection/itemSessionControl/maxAttempts -->\n        <div class=\"grid-row\">\n            <div class=\"col-5\">\n                <label for=\"section-max-attempts\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Max Attempts",{name:"__",hash:{},data:data,loc:{start:{line:242,column:50},end:{line:242,column:71}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <input name=\"section-max-attempts\" type=\"text\" data-increment=\"1\" data-min=\"0\" value=\"1\" data-bind=\"itemSessionControl.maxAttempts\" data-bind-encoder=\"number\" />\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Controls the maximum number of attempts allowed. 0 means unlimited.",{name:"__",hash:{},data:data,loc:{start:{line:250,column:16},end:{line:250,column:92}}}))+"\n                </div>\n            </div>\n        </div>\n\n<!-- assessmentTest/testPart/assessmentSection/itemSessionControl/showFeedback -->\n        <div class=\"grid-row pseudo-label-box\">\n            <div class=\"col-5\">\n                <label for=\"section-show-feedback\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Show Feedback",{name:"__",hash:{},data:data,loc:{start:{line:258,column:51},end:{line:258,column:73}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <label>\n                    <input type=\"checkbox\" name=\"section-show-feedback\" value=\"true\" data-bind=\"itemSessionControl.showFeedback\" data-bind-encoder=\"boolean\" />\n                    <span class=\"icon-checkbox\"></span>\n                </label>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"This constraint affects the visibility of feedback after the end of the last attempt.",{name:"__",hash:{},data:data,loc:{start:{line:269,column:16},end:{line:269,column:110}}}))+"\n                </div>\n            </div>\n        </div>\n\n\n\n<!-- assessmentTest/testPart/assessmentSection/itemSessionControl/allowComment -->\n        <div class=\"grid-row pseudo-label-box\">\n            <div class=\"col-5\">\n                <label for=\"section-allow-comment\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Allow Comment",{name:"__",hash:{},data:data,loc:{start:{line:319,column:51},end:{line:319,column:73}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <label>\n                    <input type=\"checkbox\" name=\"section-allow-comment\" value=\"true\"  data-bind=\"itemSessionControl.allowComment\" data-bind-encoder=\"boolean\" />\n                    <span class=\"icon-checkbox\"></span>\n                </label>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"This constraint controls whether or not the candidate is allowed to provide a comment on the item during the session. Comments are not part of the assessed responses.",{name:"__",hash:{},data:data,loc:{start:{line:330,column:16},end:{line:330,column:191}}}))+"\n                </div>\n            </div>\n        </div>\n\n<!-- assessmentTest/testPart/assessmentSection/itemSessionControl/allowSkipping -->\n        <div class=\"grid-row pseudo-label-box\">\n            <div class=\"col-5\">\n                <label for=\"section-allow-skipping\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Allow Skipping",{name:"__",hash:{},data:data,loc:{start:{line:338,column:52},end:{line:338,column:75}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <label>\n                    <input type=\"checkbox\" name=\"section-allow-skipping\" value=\"true\" checked=\"checked\" data-bind=\"itemSessionControl.allowSkipping\" data-bind-encoder=\"boolean\" />\n                    <span class=\"icon-checkbox\"></span>\n                </label>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"If the candidate can skip the item, without submitting a response (default is true).",{name:"__",hash:{},data:data,loc:{start:{line:349,column:16},end:{line:349,column:109}}}))+"\n                </div>\n            </div>\n        </div>\n\n<!-- assessmentTest/testPart/assessmentSection/itemSessionControl/validateResponses -->\n        <div class=\"grid-row pseudo-label-box\">\n            <div class=\"col-5\">\n                <label for=\"section-validate-responses\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Validate Responses",{name:"__",hash:{},data:data,loc:{start:{line:357,column:56},end:{line:357,column:83}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <label>\n                    <input type=\"checkbox\" name=\"section-validate-responses\" value=\"true\" data-bind=\"itemSessionControl.validateResponses\" data-bind-encoder=\"boolean\" />\n                    <span class=\"icon-checkbox\"></span>\n                </label>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"The candidate is not allowed to submit invalid responses.",{name:"__",hash:{},data:data,loc:{start:{line:368,column:16},end:{line:368,column:82}}}))+"\n                </div>\n            </div>\n        </div>\n\n    </div>\n\n    <h4 class=\"toggler closed\" data-toggle=\"~ .section-time-limits\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Time Limits",{name:"__",hash:{},data:data,loc:{start:{line:375,column:68},end:{line:375,column:88}}}))+"</h4>\n\n<!-- assessmentTest/timeLimits -->\n    <div class=\"section-time-limits toggled\">\n\n\n\n<!-- assessmentTest/testPart/assessmentSection/timeLimits/maxTime -->\n        <div class=\"grid-row\">\n            <div class=\"col-5\">\n                <label for=\"section-max-time\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Maximum Duration",{name:"__",hash:{},data:data,loc:{start:{line:402,column:46},end:{line:402,column:71}}}))+"</label>\n            </div>\n            <div class=\"col-6 duration-group\">\n                <input type=\"text\" name=\"max-time\" value=\"00:00:00\" data-duration=\"HH:mm:ss\" data-bind=\"timeLimits.maxTime\" data-bind-encoder=\"time\" />\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Maximum duration for this section.",{name:"__",hash:{},data:data,loc:{start:{line:410,column:16},end:{line:410,column:59}}}))+"\n                </div>\n            </div>\n        </div>\n\n<!-- assessmentTest/testPart/assessmentSection/timeLimits/allowLateSubmission -->\n        <div class=\"grid-row pseudo-label-box\">\n            <div class=\"col-5\">\n                <label for=\"section-allow-late-submission\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Late submission allowed",{name:"__",hash:{},data:data,loc:{start:{line:418,column:59},end:{line:418,column:91}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <label>\n                    <input type=\"checkbox\" name=\"section-allow-late-submission\" value=\"true\" data-bind=\"timeLimits.allowLateSubmission\" data-bind-encoder=\"boolean\" />\n                    <span class=\"icon-checkbox\"></span>\n                </label>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Whether a candidate's response that is beyond the maximum duration of the section should still be accepted.",{name:"__",hash:{},data:data,loc:{start:{line:429,column:16},end:{line:429,column:132}}}))+"\n                </div>\n            </div>\n        </div>\n    </div>\n</div>"},useData:!0})}),define("tpl!taoQtiTest/controller/creator/templates/itemref-props",["handlebars"],function(hb){return hb.template({1:function _(){return"hidden"},compiler:[8,">= 4.3.0"],main:function main(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1,helper;return"<div id=\"itemref-props-"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"identifier")||(null==depth0?depth0:lookupProperty(depth0,"identifier")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"identifier",hash:{},data:data,loc:{start:{line:1,column:23},end:{line:1,column:37}}}):helper))+"\" class=\"itemref-props props clearfix\">\n\n    <h3>"+(null==(stack1=(lookupProperty(helpers,"dompurify")||depth0&&lookupProperty(depth0,"dompurify")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"label"),{name:"dompurify",hash:{},data:data,loc:{start:{line:3,column:8},end:{line:3,column:29}}}))?"":stack1)+"</h3>\n\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/identifier -->\n    <div class=\"grid-row\">\n        <div class=\"col-5\">\n            <label for=\"itemref-identifier\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Identifier",{name:"__",hash:{},data:data,loc:{start:{line:8,column:44},end:{line:8,column:63}}}))+" <abbr title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Required field",{name:"__",hash:{},data:data,loc:{start:{line:8,column:77},end:{line:8,column:100}}}))+"\">*</abbr></label>\n        </div>\n        <div class=\"col-6\">\n            <input type=\"text\" name=\"itemref-identifier\" data-bind=\"identifier\" data-validate=\"$notEmpty; $testIdFormat; $testIdAvailable;\" />\n        </div>\n        <div class=\"col-1 help\">\n            <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n            <div class=\"tooltip-content\">\n            "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"The identifier of the item reference.",{name:"__",hash:{},data:data,loc:{start:{line:16,column:12},end:{line:16,column:58}}}))+"\n            </div>\n        </div>\n    </div>\n\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/href -->\n    <div class=\"grid-row\">\n        <div class=\"col-5\">\n            <label for=\"itemref-href\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Reference",{name:"__",hash:{},data:data,loc:{start:{line:24,column:38},end:{line:24,column:56}}}))+" <abbr title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Required field",{name:"__",hash:{},data:data,loc:{start:{line:24,column:70},end:{line:24,column:93}}}))+"\">*</abbr></label>\n        </div>\n        <div class=\"col-6\">\n            <input type=\"text\" name=\"itemref-href\" data-bind=\"href\" readonly=\"readonly\" />\n        </div>\n        <div class=\"col-1 help\">\n            <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n            <div class=\"tooltip-content\">\n            "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"The reference.",{name:"__",hash:{},data:data,loc:{start:{line:32,column:12},end:{line:32,column:35}}}))+"\n            </div>\n        </div>\n    </div>\n\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/required -->\n    <div class=\"grid-row pseudo-label-box\">\n        <div class=\"col-5\">\n            <label for=\"itemref-required\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Required",{name:"__",hash:{},data:data,loc:{start:{line:40,column:42},end:{line:40,column:59}}}))+"</label>\n        </div>\n        <div class=\"col-6\">\n            <label>\n                <input type=\"checkbox\" name=\"itemref-required\" value=\"true\" data-bind=\"required\" data-bind-encoder=\"boolean\" />\n                <span class=\"icon-checkbox\"></span>\n            </label>\n        </div>\n        <div class=\"col-1 help\">\n            <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n            <div class=\"tooltip-content\">\n            "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"If required it must appear (at least once) in the selection.",{name:"__",hash:{},data:data,loc:{start:{line:51,column:12},end:{line:51,column:81}}}))+"\n            </div>\n        </div>\n    </div>\n\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/fixed -->\n    <div class=\"grid-row pseudo-label-box\">\n        <div class=\"col-5\">\n            <label for=\"itemref-fixed\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Fixed",{name:"__",hash:{},data:data,loc:{start:{line:59,column:39},end:{line:59,column:53}}}))+"</label>\n        </div>\n        <div class=\"col-6\">\n            <label>\n                <input type=\"checkbox\" name=\"itemref-fixed\" value=\"true\" data-bind=\"fixed\" data-bind-encoder=\"boolean\" />\n                <span class=\"icon-checkbox\"></span>\n            </label>\n        </div>\n        <div class=\"col-1 help\">\n            <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n            <div class=\"tooltip-content\">\n            "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Not shuffled, the position remains fixed.",{name:"__",hash:{},data:data,loc:{start:{line:70,column:12},end:{line:70,column:62}}}))+"\n            </div>\n        </div>\n    </div>\n\n    <div class=\"categories\">\n        <div class=\"grid-row\">\n            <div class=\"col-5\">\n                <label for=\"category-custom\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Categories",{name:"__",hash:{},data:data,loc:{start:{line:78,column:45},end:{line:78,column:64}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <input type=\"text\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"custom categories",{name:"__",hash:{},data:data,loc:{start:{line:81,column:42},end:{line:81,column:68}}}))+"\" name=\"category-custom\"/>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Items can optionally be assigned to one or more categories.",{name:"__",hash:{},data:data,loc:{start:{line:86,column:16},end:{line:86,column:84}}}))+"\n                </div>\n            </div>\n        </div>\n\n        <!-- assessmentTest/testPart/assessmentSection/sectionPart/category -->\n        <textarea title=\"categories\" class=\"hidden\" type=\"text\" name=\"itemref-category\" data-bind=\"categories\" data-bind-encoder=\"str2array\"></textarea>\n\n        <!-- some user features (Test Navigation, Test Taker Tools, etc.) are in fact implemented as categories. They will appear here: -->\n        <div class=\"category-presets\"></div>\n    </div>\n\n    <h4 class=\"toggler closed\" data-toggle=\"~ .itemref-weights\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Weights",{name:"__",hash:{},data:data,loc:{start:{line:98,column:64},end:{line:98,column:80}}}))+"</h4>\n\n    <div class=\"itemref-weights toggled\">\n        <div class=\"grid-row \">\n            <div class=\"col-9\">\n                <strong>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Identifier",{name:"__",hash:{},data:data,loc:{start:{line:103,column:24},end:{line:103,column:43}}}))+"</strong>\n            </div>\n            <div class=\"col-2\">\n                <strong>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Value",{name:"__",hash:{},data:data,loc:{start:{line:106,column:24},end:{line:106,column:38}}}))+"</strong>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Controls the contribution of an individual item score to the overall test score.",{name:"__",hash:{},data:data,loc:{start:{line:111,column:20},end:{line:111,column:109}}}))+"\n                </div>\n            </div>\n        </div>\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/weights -->\n        <div data-bind-each=\"weights\" data-bind-tmpl=\"itemrefweight\"></div>\n        <div class=\"grid-row\">\n            <div class=\"col-12\">\n                <a class=\"itemref-weight-add\"><span class=\"icon-add\"></span> "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"add a new weight",{name:"__",hash:{},data:data,loc:{start:{line:119,column:77},end:{line:119,column:102}}}))+"</a>\n            </div>\n        </div>\n    </div>\n\n\n    <h4 class=\"toggler closed\" data-toggle=\"~ .itemref-item-session-control\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Item Session Control",{name:"__",hash:{},data:data,loc:{start:{line:125,column:77},end:{line:125,column:106}}}))+"</h4>\n\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/itemSessionControl -->\n    <div class=\"itemref-item-session-control toggled\">\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/itemSessionControl/maxAttempts -->\n        <div class=\"grid-row\">\n            <div class=\"col-5\">\n                <label for=\"itemref-max-attempts\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Max Attempts",{name:"__",hash:{},data:data,loc:{start:{line:132,column:50},end:{line:132,column:71}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <input name=\"itemref-max-attempts\" type=\"text\" data-increment=\"1\" data-min=\"0\" value=\"1\" data-bind=\"itemSessionControl.maxAttempts\" data-bind-encoder=\"number\" />\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Controls the maximum number of attempts allowed. 0 means unlimited.",{name:"__",hash:{},data:data,loc:{start:{line:140,column:16},end:{line:140,column:92}}}))+"\n                </div>\n            </div>\n        </div>\n\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/itemSessionControl/showFeedback -->\n        <div class=\"grid-row pseudo-label-box\">\n            <div class=\"col-5\">\n                <label for=\"itemref-show-feedback\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Show Feedback",{name:"__",hash:{},data:data,loc:{start:{line:148,column:51},end:{line:148,column:73}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <label>\n                    <input type=\"checkbox\" name=\"itemref-show-feedback\" value=\"true\" data-bind=\"itemSessionControl.showFeedback\" data-bind-encoder=\"boolean\" />\n                    <span class=\"icon-checkbox\"></span>\n                </label>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"This constraint affects the visibility of feedback after the end of the last attempt.",{name:"__",hash:{},data:data,loc:{start:{line:159,column:16},end:{line:159,column:110}}}))+"\n                </div>\n            </div>\n        </div>\n\n\n\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/itemSessionControl/allowComment -->\n        <div class=\"grid-row pseudo-label-box\">\n            <div class=\"col-5\">\n                <label for=\"itemref-allow-comment\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Allow Comment",{name:"__",hash:{},data:data,loc:{start:{line:209,column:51},end:{line:209,column:73}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <label>\n                    <input type=\"checkbox\" name=\"itemref-allow-comment\" value=\"true\"  data-bind=\"itemSessionControl.allowComment\" data-bind-encoder=\"boolean\" />\n                    <span class=\"icon-checkbox\"></span>\n                </label>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"This constraint controls whether or not the candidate is allowed to provide a comment on the item during the session. Comments are not part of the assessed responses.",{name:"__",hash:{},data:data,loc:{start:{line:220,column:16},end:{line:220,column:191}}}))+"\n                </div>\n            </div>\n        </div>\n\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/itemSessionControl/allowSkipping -->\n        <div class=\"grid-row pseudo-label-box\">\n            <div class=\"col-5\">\n                <label for=\"itemref-allow-skipping\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Allow Skipping",{name:"__",hash:{},data:data,loc:{start:{line:228,column:52},end:{line:228,column:75}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <label>\n                    <input type=\"checkbox\" name=\"itemref-allow-skipping\" value=\"true\" checked=\"checked\" data-bind=\"itemSessionControl.allowSkipping\" data-bind-encoder=\"boolean\" />\n                    <span class=\"icon-checkbox\"></span>\n                </label>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"If the candidate can skip the item, without submitting a response (default is true).",{name:"__",hash:{},data:data,loc:{start:{line:239,column:16},end:{line:239,column:109}}}))+"\n                </div>\n            </div>\n        </div>\n\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/itemSessionControl/validateResponses -->\n        <div class=\"grid-row pseudo-label-box\">\n            <div class=\"col-5\">\n                <label for=\"itemref-validate-responses\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Validate Responses",{name:"__",hash:{},data:data,loc:{start:{line:247,column:56},end:{line:247,column:83}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <label>\n                    <input type=\"checkbox\" name=\"itemref-validate-responses\" value=\"true\" data-bind=\"itemSessionControl.validateResponses\" data-bind-encoder=\"boolean\" />\n                    <span class=\"icon-checkbox\"></span>\n                </label>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"The candidate is not allowed to submit invalid responses.",{name:"__",hash:{},data:data,loc:{start:{line:258,column:16},end:{line:258,column:82}}}))+"\n                </div>\n            </div>\n        </div>\n\n    </div>\n\n    <h4 class=\"toggler closed\" data-toggle=\"~ .itemref-time-limits\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Time Limits",{name:"__",hash:{},data:data,loc:{start:{line:265,column:68},end:{line:265,column:88}}}))+"</h4>\n\n<!-- assessmentTest/timeLimits -->\n    <div class=\"itemref-time-limits toggled\">\n\n        <div class=\"lockedtime-container hidden\">\n\n            <div class=\"grid-row\">\n                <div class=\"col-5\">\n                    <label for=\"itemref-max-time\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Maximum Duration",{name:"__",hash:{},data:data,loc:{start:{line:274,column:50},end:{line:274,column:75}}}))+"</label>\n                </div>\n                <div class=\"col-6 duration-group\">\n                    <input type=\"text\" name=\"max-time\" value=\"00:00:00\" data-duration=\"HH:mm:ss\" data-bind=\"timeLimits.maxTime\" data-bind-encoder=\"time\" />\n                </div>\n                <div class=\"col-1 help\">\n                    <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                    <div class=\"tooltip-content\">\n                        "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Minimum duration : enforces the test taker to stay on the item for the given duration.",{name:"__",hash:{},data:data,loc:{start:{line:282,column:24},end:{line:282,column:119}}}))+"<br>\n                        "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Maximum duration : the items times out when the duration reaches 0.",{name:"__",hash:{},data:data,loc:{start:{line:283,column:24},end:{line:283,column:100}}}))+"<br>\n                        "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Locked duration  : guided navigation. The test transition to the next item once the duration reaches 0.",{name:"__",hash:{},data:data,loc:{start:{line:284,column:24},end:{line:284,column:136}}}))+"<br>\n                    </div>\n                </div>\n            </div>\n            <div class=\"locker\">\n                <button class=\"unlocked\" title='"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Link durations to activate the guided navigation",{name:"__",hash:{},data:data,loc:{start:{line:289,column:48},end:{line:289,column:105}}}))+"' ><span class=\"icon-unlink\"></span></button>\n            </div>\n            <div class=\"grid-row\">\n                <div class=\"col-5\">\n                    <label for=\"itemref-min-time\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Minimum Duration",{name:"__",hash:{},data:data,loc:{start:{line:293,column:50},end:{line:293,column:75}}}))+"</label>\n                </div>\n                <div class=\"col-6\">\n                    <input type=\"text\" name=\"min-time\" value=\"00:00:00\" data-duration=\"HH:mm:ss\"  data-bind=\"timeLimits.minTime\" data-bind-encoder=\"time\" />\n                </div>\n            </div>\n        </div>\n\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/timeLimits/maxTime -->\n        <div class=\"grid-row maxtime-container "+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"isLinear"),{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:302,column:47},end:{line:302,column:76}}}))?"":stack1)+"\">\n            <div class=\"col-5\">\n                <label for=\"itemref-max-time\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Maximum Duration",{name:"__",hash:{},data:data,loc:{start:{line:304,column:46},end:{line:304,column:71}}}))+"</label>\n            </div>\n            <div class=\"col-6 duration-group\">\n                <input type=\"text\" name=\"max-time\" value=\"00:00:00\" data-duration=\"HH:mm:ss\" data-bind=\"timeLimits.maxTime\" data-bind-encoder=\"time\" />\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Maximum duration for this item.",{name:"__",hash:{},data:data,loc:{start:{line:312,column:16},end:{line:312,column:56}}}))+"\n                </div>\n            </div>\n        </div>\n\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/timeLimits/minTime -->\n        <div class=\"grid-row mintime-container "+(null==(stack1=lookupProperty(helpers,"unless").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"isLinear"),{name:"unless",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:318,column:47},end:{line:318,column:84}}}))?"":stack1)+"\">\n            <div class=\"col-5\">\n                <label for=\"min-time\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Minimum Duration",{name:"__",hash:{},data:data,loc:{start:{line:320,column:38},end:{line:320,column:63}}}))+"</label>\n            </div>\n            <div class=\"col-6 duration-group\">\n                <input type=\"text\" name=\"min-time\" value=\"00:00:00\" data-duration=\"HH:mm:ss\" data-bind=\"timeLimits.minTime\" data-bind-encoder=\"time\" />\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Minimum duration for this item.",{name:"__",hash:{},data:data,loc:{start:{line:328,column:20},end:{line:328,column:60}}}))+"\n                </div>\n            </div>\n        </div>\n\n<!-- assessmentTest/testPart/assessmentSection/sectionPart/timeLimits/allowLateSubmission -->\n        <div class=\"grid-row pseudo-label-box\">\n            <div class=\"col-5\">\n                <label for=\"itemref-allow-late-submission\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Late submission allowed",{name:"__",hash:{},data:data,loc:{start:{line:336,column:59},end:{line:336,column:91}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <label>\n                    <input type=\"checkbox\" name=\"itemref-allow-late-submission\" value=\"true\" data-bind=\"timeLimits.allowLateSubmission\" data-bind-encoder=\"boolean\" />\n                    <span class=\"icon-checkbox\"></span>\n                </label>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Whether a candidate's response that is beyond the maximum duration of the item should still be accepted.",{name:"__",hash:{},data:data,loc:{start:{line:347,column:16},end:{line:347,column:129}}}))+"\n                </div>\n            </div>\n        </div>\n    </div>\n</div>"},useData:!0})}),define("tpl!taoQtiTest/controller/creator/templates/itemref-props-weight",["handlebars"],function(hb){return hb.template({compiler:[8,">= 4.3.0"],main:function main(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},helper;return"<div class=\"grid-row itemref-weight\">\n    <div class=\"col-9\">\n        <input data-bind=\"identifier\" data-validate=\"$notEmpty; $testIdFormat; $testIdAvailable(original="+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"identifier")||(null==depth0?depth0:lookupProperty(depth0,"identifier")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"identifier",hash:{},data:data,loc:{start:{line:3,column:105},end:{line:3,column:119}}}):helper))+");\" type=\"text\" value=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"identifier")||(null==depth0?depth0:lookupProperty(depth0,"identifier")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"identifier",hash:{},data:data,loc:{start:{line:3,column:142},end:{line:3,column:156}}}):helper))+"\" />\n    </div>\n    <div class=\"col-2\">\n        <input data-bind=\"value\" data-validate=\"$notEmpty; $numeric;\" type=\"text\" value=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"value")||(null==depth0?depth0:lookupProperty(depth0,"value")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"value",hash:{},data:data,loc:{start:{line:6,column:89},end:{line:6,column:98}}}):helper))+"\" data-bind-encoder=\"float\" />\n    </div>\n    <div class=\"col-1\">\n        <a class=\"itemref-weight-remove\" data-delete=\":parent .itemref-weight\">\n            <span class=\"icon-bin\"></span>\n        </a>\n    </div>\n</div>"},useData:!0})}),define("tpl!taoQtiTest/controller/creator/templates/rubricblock-props",["handlebars"],function(hb){return hb.template({1:function _(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0};return"    <div class=\"rubric-feedback toggled\">\n\n        <!--assessmentTest/testPart/assessmentSection/sectionPart/rubricBlock/feedback/activated -->\n        <div class=\"grid-row rubric-feedback-activated\">\n            <div class=\"col-5\">\n                <label for=\"activated\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Activated",{name:"__",hash:{},data:data,loc:{start:{line:72,column:39},end:{line:72,column:57}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <label>\n                    <input type=\"checkbox\" name=\"activated\" value=\"true\" data-bind=\"feedback.activated\" data-bind-encoder=\"boolean\" />\n                    <span class=\"icon-checkbox\"></span>\n                </label>\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Set the rubric block as a feedback block",{name:"__",hash:{},data:data,loc:{start:{line:83,column:20},end:{line:83,column:69}}}))+"\n                </div>\n            </div>\n        </div>\n\n        <!--assessmentTest/testPart/assessmentSection/sectionPart/rubricBlock/feedback/outcome -->\n        <div class=\"grid-row rubric-feedback-outcome\">\n            <div class=\"col-5\">\n                <label for=\"feedback-outcome\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Outcome",{name:"__",hash:{},data:data,loc:{start:{line:91,column:46},end:{line:91,column:62}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <input type=\"text\" name=\"feedback-outcome\" data-bind=\"feedback.outcome\" data-bind-encoder=\"string\" data-validate=\"$pattern(pattern=^([a-zA-Z_][a-zA-Z0-9_\\.-]*)?$);\" />\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Set outcome identifier the feedback block is related to",{name:"__",hash:{},data:data,loc:{start:{line:99,column:20},end:{line:99,column:84}}}))+"\n                </div>\n            </div>\n        </div>\n\n        <!--assessmentTest/testPart/assessmentSection/sectionPart/rubricBlock/feedback/matchValue -->\n        <div class=\"grid-row rubric-feedback-match-value\">\n            <div class=\"col-5\">\n                <label for=\"feedback-match-value\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Match value",{name:"__",hash:{},data:data,loc:{start:{line:107,column:50},end:{line:107,column:70}}}))+"</label>\n            </div>\n            <div class=\"col-6\">\n                <input type=\"text\" name=\"feedback-match-value\" data-bind=\"feedback.matchValue\" data-bind-encoder=\"string\" data-validate=\"$pattern(pattern=^([a-zA-Z_][a-zA-Z0-9_\\.-]*)?$);\" />\n            </div>\n            <div class=\"col-1 help\">\n                <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n                <div class=\"tooltip-content\">\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Set the value of the outcome that will activate the feedback block",{name:"__",hash:{},data:data,loc:{start:{line:115,column:20},end:{line:115,column:95}}}))+"\n                </div>\n            </div>\n        </div>\n    </div>\n"},compiler:[8,">= 4.3.0"],main:function main(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1,helper;return"<div class=\"rubricblock-props props clearfix\">\n\n    <h3>"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Rubric Block",{name:"__",hash:{},data:data,loc:{start:{line:3,column:8},end:{line:3,column:29}}}))+": "+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"orderIndex")||(null==depth0?depth0:lookupProperty(depth0,"orderIndex")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"orderIndex",hash:{},data:data,loc:{start:{line:3,column:31},end:{line:3,column:45}}}):helper))+"</h3>\n\n    <!--assessmentTest/testPart/assessmentSection/sectionPart/rubricBlock/views -->\n    <!--\n    <div class=\"grid-row\">\n        <div class=\"col-5\">\n            <label for=\"itemref-identifier\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Views",{name:"__",hash:{},data:data,loc:{start:{line:9,column:44},end:{line:9,column:58}}}))+" <abbr title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Required field",{name:"__",hash:{},data:data,loc:{start:{line:9,column:72},end:{line:9,column:95}}}))+"\">*</abbr></label>\n        </div>\n        <div class=\"col-6\">\n            <select name=\"view\" multiple=\"multiple\" data-bind=\"views\">\n                <option value=\"author\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Author",{name:"__",hash:{},data:data,loc:{start:{line:13,column:39},end:{line:13,column:54}}}))+"</option>\n                <option value=\"candidate\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Candidate",{name:"__",hash:{},data:data,loc:{start:{line:14,column:42},end:{line:14,column:60}}}))+"</option>\n                <option value=\"proctor\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Proctor",{name:"__",hash:{},data:data,loc:{start:{line:15,column:40},end:{line:15,column:56}}}))+"</option>\n                <option value=\"scorer\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Scorer",{name:"__",hash:{},data:data,loc:{start:{line:16,column:39},end:{line:16,column:54}}}))+"</option>\n                <option value=\"testConstructor\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Test constructor",{name:"__",hash:{},data:data,loc:{start:{line:17,column:48},end:{line:17,column:73}}}))+"</option>\n                <option value=\"tutor\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Tutor",{name:"__",hash:{},data:data,loc:{start:{line:18,column:38},end:{line:18,column:52}}}))+"</option>\n            </select>\n        </div>\n        <div class=\"col-1 help\">\n            <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n            <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Who can view the rubric block during the delivery.",{name:"__",hash:{},data:data,loc:{start:{line:24,column:16},end:{line:24,column:75}}}))+"\n            </div>\n        </div>\n    </div>\n    -->\n    <!--assessmentTest/testPart/assessmentSection/sectionPart/rubricBlock/class -->\n    <div class=\"grid-row\">\n        <div class=\"col-5\">\n            <label for=\"class\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Class",{name:"__",hash:{},data:data,loc:{start:{line:32,column:31},end:{line:32,column:45}}}))+"</label>\n        </div>\n        <div class=\"col-6\">\n            <input type=\"text\" name=\"class\" data-bind=\"class\" data-bind-encoder=\"string\" data-validate=\"$pattern(pattern=^([a-zA-Z_\\s][a-zA-Z0-9_\\s-]*)?$);\" />\n        </div>\n        <div class=\"col-1 help\">\n            <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n            <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Set the XHTML-QTI class of the rubric block.",{name:"__",hash:{},data:data,loc:{start:{line:40,column:16},end:{line:40,column:69}}}))+"\n            </div>\n        </div>\n    </div>\n\n    <!--assessmentTest/testPart/assessmentSection/sectionPart/rubricBlock/id -->\n    <!--\n    <div class=\"grid-row\">\n        <div class=\"col-5\">\n            <label for=\"id\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Identifier",{name:"__",hash:{},data:data,loc:{start:{line:49,column:28},end:{line:49,column:47}}}))+"</label>\n        </div>\n        <div class=\"col-6\">\n            <input type=\"text\" name=\"id\" data-bind=\"id\" data-bind-encoder=\"string\" data-validate=\"$pattern(pattern=^([a-zA-Z_\\s][a-zA-Z0-9_\\s-]*)?$);\" />\n        </div>\n        <div class=\"col-1 help\">\n            <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n            <div class=\"tooltip-content\">\n                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Set the XHTML-QTI identifier of the rubric block.",{name:"__",hash:{},data:data,loc:{start:{line:57,column:16},end:{line:57,column:74}}}))+"\n            </div>\n        </div>\n    </div>\n    -->\n\n    <h4 class=\"toggler closed\" data-toggle=\"~ .rubric-feedback\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Feedback block",{name:"__",hash:{},data:data,loc:{start:{line:63,column:64},end:{line:63,column:87}}}))+"</h4>\n\n    <!--assessmentTest/testPart/assessmentSection/sectionPart/rubricBlock/feedback -->\n"+(null==(stack1=lookupProperty(helpers,"with").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"feedback"),{name:"with",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:66,column:4},end:{line:120,column:13}}}))?"":stack1)+"</div>"},useData:!0})}),define("tpl!taoQtiTest/controller/creator/templates/category-presets",["handlebars"],function(hb){return hb.template({1:function _(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1,helper;return"\n<h4 class=\"toggler closed\" data-toggle=\"~ .category-preset-group-"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"groupId")||(null==depth0?depth0:lookupProperty(depth0,"groupId")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"groupId",hash:{},data:data,loc:{start:{line:3,column:65},end:{line:3,column:76}}}):helper))+"\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"groupLabel")||(null==depth0?depth0:lookupProperty(depth0,"groupLabel")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"groupLabel",hash:{},data:data,loc:{start:{line:3,column:78},end:{line:3,column:92}}}):helper))+"</h4>\n\n<div class=\"category-preset-group-"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"groupId")||(null==depth0?depth0:lookupProperty(depth0,"groupId")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"groupId",hash:{},data:data,loc:{start:{line:5,column:34},end:{line:5,column:45}}}):helper))+" toggled\">\n"+(null==(stack1=lookupProperty(helpers,"each").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"presets"),{name:"each",hash:{},fn:container.program(2,data,0),inverse:container.noop,data:data,loc:{start:{line:6,column:4},end:{line:24,column:13}}}))?"":stack1)+"</div>\n\n"},2:function _(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},helper;return"    <div class=\"grid-row pseudo-label-box category-preset\" data-qti-category=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"qtiCategory")||(null==depth0?depth0:lookupProperty(depth0,"qtiCategory")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"qtiCategory",hash:{},data:data,loc:{start:{line:7,column:78},end:{line:7,column:93}}}):helper))+"\">\n        <div class=\"col-1\">\n            <label>\n                <input type=\"checkbox\" name=\"category-preset-"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"id")||(null==depth0?depth0:lookupProperty(depth0,"id")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"id",hash:{},data:data,loc:{start:{line:10,column:61},end:{line:10,column:67}}}):helper))+"\" value=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"qtiCategory")||(null==depth0?depth0:lookupProperty(depth0,"qtiCategory")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"qtiCategory",hash:{},data:data,loc:{start:{line:10,column:76},end:{line:10,column:91}}}):helper))+"\"/>\n                <span class=\"icon-checkbox\"></span>\n            </label>\n        </div>\n        <div class=\"col-10\">\n            <label for=\"category-preset-"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"id")||(null==depth0?depth0:lookupProperty(depth0,"id")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"id",hash:{},data:data,loc:{start:{line:15,column:40},end:{line:15,column:46}}}):helper))+"\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:15,column:48},end:{line:15,column:57}}}):helper))+"</label>\n        </div>\n        <div class=\"col-1 help\">\n            <span class=\"icon-help\" data-tooltip=\"~ .tooltip-content\" data-tooltip-theme=\"info\"></span>\n            <div class=\"tooltip-content\">\n                "+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"description")||(null==depth0?depth0:lookupProperty(depth0,"description")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"description",hash:{},data:data,loc:{start:{line:20,column:16},end:{line:20,column:31}}}):helper))+"\n            </div>\n        </div>\n    </div>\n"},compiler:[8,">= 4.3.0"],main:function main(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1;return null==(stack1=lookupProperty(helpers,"each").call(null==depth0?container.nullContext||{}:depth0,depth0,{name:"each",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:1,column:0},end:{line:27,column:9}}}))?"":stack1},useData:!0})}),define("taoQtiTest/controller/creator/templates/index",["tpl!taoQtiTest/controller/creator/templates/testpart","tpl!taoQtiTest/controller/creator/templates/section","tpl!taoQtiTest/controller/creator/templates/rubricblock","tpl!taoQtiTest/controller/creator/templates/itemref","tpl!taoQtiTest/controller/creator/templates/outcomes","tpl!taoQtiTest/controller/creator/templates/test-props","tpl!taoQtiTest/controller/creator/templates/testpart-props","tpl!taoQtiTest/controller/creator/templates/section-props","tpl!taoQtiTest/controller/creator/templates/itemref-props","tpl!taoQtiTest/controller/creator/templates/itemref-props-weight","tpl!taoQtiTest/controller/creator/templates/rubricblock-props","tpl!taoQtiTest/controller/creator/templates/category-presets"],function(testPart,section,rubricBlock,itemRef,outcomes,testProps,testPartProps,sectionProps,itemRefProps,itemRefPropsWeight,rubricBlockProps,categoryPresets){'use strict';return{testpart:testPart,section:section,itemref:itemRef,rubricblock:rubricBlock,outcomes:outcomes,properties:{test:testProps,testpart:testPartProps,section:sectionProps,itemref:itemRefProps,itemrefweight:itemRefPropsWeight,rubricblock:rubricBlockProps,categorypresets:categoryPresets}}}),define("taoQtiTest/controller/creator/views/property",["jquery","uikitLoader","core/databinder","taoQtiTest/controller/creator/templates/index"],function($,ui,DataBinder,templates){'use strict';return function(tmplName,model){function propValidation(){var $togglers;$view.on("validated.group",function(e,isValid){"group"===e.namespace&&($togglers=$("#test-creator .property-toggler, #saver"),!0===isValid?$togglers.removeClass("disabled"):$togglers.addClass("disabled"))}),$view.groupValidator()}var $container=$(".test-creator-props"),template=templates.properties[tmplName],open=function(){var binderOptions={templates:templates.properties},databinder;$container.children(".props").hide().trigger("propclose.propview"),$view=$(template(model)).appendTo($container).filter(".props"),ui.startDomComponent($view),databinder=new DataBinder($view,model,binderOptions),databinder.bind(),propValidation(),$view.trigger("propopen.propview")},getView=function(){return $view},isOpen=function(){return"none"!==$view.css("display")},onOpen=function(cb){$view.on("propopen.propview",function(e){e.stopPropagation(),cb()})},onClose=function(cb){$view.on("propclose.propview",function(e){e.stopPropagation(),cb()})},destroy=function(){$view.remove()},toggle=function(){$container.children(".props").not($view).hide().trigger("propclose.propview"),isOpen()?$view.hide().trigger("propclose.propview"):$view.show().trigger("propopen.propview")},$view;return{open:open,getView:getView,isOpen:isOpen,onOpen:onOpen,onClose:onClose,destroy:destroy,toggle:toggle}}}),define("taoQtiTest/controller/creator/views/actions",["jquery","taoQtiTest/controller/creator/views/property"],function($,propertyView){'use strict';return{properties:function($container,template,model,cb){var propView=null;$container.find(".property-toggler").on("click",function(e){e.preventDefault();var $elt=$(this);$(this).hasClass("disabled")||($elt.blur(),null===propView?($container.addClass("active"),$elt.addClass("tlb-button-on"),propView=propertyView(template,model),propView.open(),propView.onOpen(function(){$container.addClass("active"),$elt.addClass("tlb-button-on")}),propView.onClose(function(){$container.removeClass("active"),$elt.removeClass("tlb-button-on")}),"function"==typeof cb&&cb(propView)):propView.toggle())})},move:function($actionContainer,containerClass,elementClass){var $element=$actionContainer.parents("."+elementClass),$container=$element.parents("."+containerClass);$(".move-up",$actionContainer).click(function(e){var $elements,index;return e.preventDefault(),!$element.is(":animated")&&void($elements=$("."+elementClass,$container),index=$elements.index($element),0<index&&$element.fadeOut(200,function(){$element.insertBefore($(".".concat(elementClass,":eq(").concat(index-1,")"),$container)).fadeIn(400,function(){return $container.trigger("change")})}))}),$(".move-down",$actionContainer).click(function(e){var $elements,index;return e.preventDefault(),!$element.is(":animated")&&void($elements=$("."+elementClass,$container),index=$elements.index($element),index<$elements.length-1&&1<$elements.length&&$element.fadeOut(200,function(){$element.insertAfter($(".".concat(elementClass,":eq(").concat(index+1,")"),$container)).fadeIn(400,function(){return $container.trigger("change")})}))})},removable:function($container,actionContainerElt){$container.each(function(){var $elt=$(this),$actionContainer=$(actionContainerElt,$elt),$delete=$("[data-delete]",$actionContainer);1>=$container.length?$delete.addClass("disabled"):$delete.removeClass("disabled")})},movable:function($container,elementClass,actionContainerElt){$container.each(function(){var $elt=$(this),$actionContainer=$(actionContainerElt,$elt),index=$container.index($elt),$moveUp=$(".move-up",$actionContainer),$moveDown=$(".move-down",$actionContainer);1===$container.length?($moveUp.addClass("disabled"),$moveDown.addClass("disabled")):0===index?($moveUp.addClass("disabled"),$moveDown.removeClass("disabled")):index>=$container.length-1?($moveDown.addClass("disabled"),$moveUp.removeClass("disabled")):($moveUp.removeClass("disabled"),$moveDown.removeClass("disabled"))})},disable:function($container,actionContainerElt){$container.find(actionContainerElt).find("[data-delete],.move-up,.move-down").addClass("disabled")},enable:function($container,actionContainerElt){$container.find(actionContainerElt).find("[data-delete],.move-up,.move-down").removeClass("disabled")}}}),define("taoQtiTest/controller/creator/helpers/categorySelector",["jquery","lodash","i18n","core/eventifier","ui/tooltip","taoQtiTest/controller/creator/templates/index","select2"],function($,_,__,eventifier,tooltip,templates){'use strict';function categorySelectorFactory($container){function updateCategories(){var presetSelected=$container.find(".category-preset input:checked").toArray().map(function(categoryEl){return categoryEl.value}),presetIndeterminate=$container.find(".category-preset input:indeterminate").toArray().map(function(categoryEl){return categoryEl.value}),customSelected=$customCategoriesSelect.siblings(".select2-container").find(".select2-search-choice").not(".partial").toArray().map(function(categoryEl){return categoryEl.textContent&&categoryEl.textContent.trim()}),customIndeterminate=$customCategoriesSelect.siblings(".select2-container").find(".select2-search-choice.partial").toArray().map(function(categoryEl){return categoryEl.textContent&&categoryEl.textContent.trim()}),selectedCategories,indeterminatedCategories;selectedCategories=presetSelected.concat(customSelected),indeterminatedCategories=presetIndeterminate.concat(customIndeterminate),this.trigger("category-change",selectedCategories,indeterminatedCategories)}var $presetsContainer=$container.find(".category-presets"),$customCategoriesSelect=$container.find("[name=category-custom]"),categorySelector,$presetsCheckboxes;return categorySelector={createForm:function(currentCategories){var self=this,presetsTpl=templates.properties.categorypresets,customCategories=_.difference(currentCategories,allQtiCategoriesPresets);$presetsContainer.append(presetsTpl(allPresets)),$presetsContainer.on("click",function(e){var $preset=$(e.target).closest(".category-preset"),$checkbox;$preset.length&&($checkbox=$preset.find("input"),$checkbox.prop("indeterminate",!1),_.defer(function(){updateCategories.call(self)}))}),$customCategoriesSelect.select2({width:"100%",tags:customCategories,multiple:!0,tokenSeparators:[","," ",";"],formatNoMatches:function formatNoMatches(){return __("Enter a custom category")},maximumInputLength:32}).on("change",function(){updateCategories.call(self)}),tooltip.lookup($container)},updateFormState:function(selected,indeterminate){var customCategories;indeterminate=indeterminate||[],customCategories=_.difference(selected.concat(indeterminate),allQtiCategoriesPresets),$presetsCheckboxes=$container.find(".category-preset input"),$presetsCheckboxes.each(function(){var category=this.value;this.indeterminate=!1,this.checked=!1,-1===indeterminate.indexOf(category)?-1!==selected.indexOf(category)&&(this.checked=!0):this.indeterminate=!0}),$customCategoriesSelect.select2("val",customCategories),$customCategoriesSelect.siblings(".select2-container").find(".select2-search-choice").each(function(){var $li=$(this),content=$li.find("div").text();-1!==indeterminate.indexOf(content)&&$li.addClass("partial")})}},eventifier(categorySelector),categorySelector}function extractCategoriesFromPresets(){return allPresets.reduce(function(prev,current){var groupIds=_.pluck(current.presets,"qtiCategory");return prev.concat(groupIds)},[])}var allPresets=[],allQtiCategoriesPresets=[];return categorySelectorFactory.setPresets=function(presets){_.isArray(presets)&&(allPresets=presets,allQtiCategoriesPresets=extractCategoriesFromPresets())},categorySelectorFactory}),define("taoQtiTest/controller/creator/helpers/sectionCategory",["lodash","i18n","core/errorHandler"],function(_,__,errorHandler){'use strict';function isValidSectionModel(model){return _.isObject(model)&&"assessmentSection"===model["qti-type"]&&_.isArray(model.sectionParts)}function getCategories(model){var categories,arrays,union,propagated,partial;return isValidSectionModel(model)?(categories=_.map(model.sectionParts,function(itemRef){if("assessmentItemRef"===itemRef["qti-type"]&&_.isArray(itemRef.categories))return _.compact(itemRef.categories)}),arrays=_.values(categories),union=_.union.apply(null,arrays),propagated=_.intersection.apply(null,arrays),partial=_.difference(union,propagated),{all:union.sort(),propagated:propagated.sort(),partial:partial.sort()}):void errorHandler.throw(".sectionCategory","invalid tool config format")}function addCategories(model,categories){isValidSectionModel(model)?_.each(model.sectionParts,function(itemRef){"assessmentItemRef"===itemRef["qti-type"]&&(!_.isArray(itemRef.categories)&&(itemRef.categories=[]),itemRef.categories=_.union(itemRef.categories,categories))}):errorHandler.throw(".sectionCategory","invalid tool config format")}function removeCategories(model,categories){isValidSectionModel(model)?_.each(model.sectionParts,function(itemRef){"assessmentItemRef"===itemRef["qti-type"]&&_.isArray(itemRef.categories)&&(itemRef.categories=_.difference(itemRef.categories,categories))}):errorHandler.throw(".sectionCategory","invalid tool config format")}return{isValidSectionModel:isValidSectionModel,setCategories:function(model,selected,partial){var currentCategories=getCategories(model),toRemove,toAdd;partial=partial||[],toRemove=_.difference(currentCategories.all,selected.concat(partial)),toAdd=_.difference(selected,currentCategories.propagated),addCategories(model,toAdd),removeCategories(model,toRemove)},getCategories:getCategories,addCategories:addCategories,removeCategories:removeCategories}}),define("taoQtiTest/controller/creator/helpers/qtiTest",["lodash","i18n","taoQtiTest/controller/creator/helpers/outcome","taoQtiTest/controller/creator/helpers/qtiElement"],function(_,__,outcomeHelper,qtiElementHelper){'use strict';var qtiTypesForUniqueIds=["assessmentTest","testPart","assessmentSection","assessmentItemRef"];return{extractIdentifiers:function(model,includesOnlyTypes,excludeTypes){var identifiers=[],extract=function extract(element){element&&_.has(element,"identifier")&&_.isString(element.identifier)&&(!includesOnlyTypes.length||_.contains(includesOnlyTypes,element["qti-type"]))&&identifiers.push({identifier:element.identifier.toUpperCase(),originalIdentifier:element.identifier,type:element["qti-type"],label:element.title||element.identifier}),_.forEach(element,function(subElement){(_.isPlainObject(subElement)||_.isArray(subElement))&&(!excludeTypes.length||!_.contains(excludeTypes,subElement["qti-type"]))&&extract(subElement)})};return(_.isPlainObject(model)||_.isArray(model))&&(excludeTypes=excludeTypes||[],includesOnlyTypes=includesOnlyTypes||[],extract(model)),identifiers},getIdentifiers:function(model,includesOnlyTypes,excludeTypes){return _.uniq(_.pluck(this.extractIdentifiers(model,includesOnlyTypes,excludeTypes),"identifier"))},getIdentifiersOf:function(model,qtiType){return this.getIdentifiers(model,[qtiType])},getAvailableIdentifier:function(model,qtiType,suggestion){var index=1,identifier,current;current=_.contains(qtiTypesForUniqueIds,qtiType)?this.getIdentifiers(model,qtiTypesForUniqueIds):this.getIdentifiersOf(model,qtiType),suggestion=suggestion||qtiType;do identifier=suggestion+"-"+index++;while(_.contains(current,identifier.toUpperCase()));return identifier},idFormatValidator:function(){return{name:"idFormat",message:__("is not a valid identifier (alphanum, underscore, dash and dots)"),validate:function validate(value,callback){"function"==typeof callback&&callback(/^[_a-zA-Z]{1}[a-zA-Z0-9\-._]{0,31}$/i.test(value))}}},testidFormatValidator:function(){return{name:"testIdFormat",message:__("is not a valid identifier (everything except spaces)"),validate:function validate(value,callback){"function"==typeof callback&&callback(/^\S+$/.test(value))}}},idAvailableValidator:function(modelOverseer){var self=this;return{name:"testIdAvailable",message:__("is already used in the test."),validate:function validate(value,callback){var counts={},key=value.toUpperCase(),identifiers=self.extractIdentifiers(modelOverseer.getModel(),qtiTypesForUniqueIds);"function"==typeof callback&&(counts=_.countBy(identifiers,"identifier"),callback("undefined"==typeof counts[key]||2>counts[key]))}}},filterQtiType:function(value,type){return value["qti-type"]&&value["qti-type"]===type},addMissingQtiType:function(collection,parentType){var self=this;_.forEach(collection,function(value,key){!_.isObject(value)||_.isArray(value)||_.has(value,"qti-type")||(_.isNumber(key)?parentType&&(value["qti-type"]=parentType):value["qti-type"]=key),_.isArray(value)?self.addMissingQtiType(value,key.replace(/s$/,"")):_.isObject(value)&&self.addMissingQtiType(value)})},consolidateModel:function(model){return model&&model.testParts&&_.isArray(model.testParts)&&_.forEach(model.testParts,function(testPart){testPart.assessmentSections&&_.isArray(testPart.assessmentSections)&&_.forEach(testPart.assessmentSections,function(assessmentSection){assessmentSection.ordering&&"undefined"!=typeof assessmentSection.ordering.shuffle&&!1===assessmentSection.ordering.shuffle&&delete assessmentSection.ordering,assessmentSection.sectionParts&&_.isArray(assessmentSection.sectionParts)&&_.forEach(assessmentSection.sectionParts,function(part){part.categories&&_.isArray(part.categories)&&(0===part.categories.length||0===part.categories[0].length)&&(part.categories=[])}),assessmentSection.rubricBlocks&&_.isArray(assessmentSection.rubricBlocks)&&(0===assessmentSection.rubricBlocks.length||1===assessmentSection.rubricBlocks.length&&0===assessmentSection.rubricBlocks[0].content.length?delete assessmentSection.rubricBlocks:0<assessmentSection.rubricBlocks.length&&_.forEach(assessmentSection.rubricBlocks,function(rubricBlock){rubricBlock.views=["candidate"]}))})}),model},validateModel:function(model){var identifiers=this.extractIdentifiers(model,qtiTypesForUniqueIds),nonUniqueIdentifiers=0,outcomes=_.indexBy(outcomeHelper.listOutcomes(model)),messageDetails="";if(_(identifiers).countBy("identifier").forEach(function(count,id){1<count&&(nonUniqueIdentifiers++,messageDetails+="\n"+id.originalIdentifier+" : "+id.type+" "+id.label)}),1<nonUniqueIdentifiers.length)throw new Error(__("The following identifiers are not unique accross the test : %s",messageDetails));_.forEach(model.testParts,function(testPart){_.forEach(testPart.assessmentSections,function(assessmentSection){_.forEach(assessmentSection.rubricBlocks,function(rubricBlock){var feedbackBlock=qtiElementHelper.lookupElement(rubricBlock,"rubricBlock.div.feedbackBlock","content");if(feedbackBlock&&!outcomes[feedbackBlock.outcomeIdentifier])throw new Error(__("The outcome \"%s\" does not exist, but it is referenced by a feedback block!",feedbackBlock.outcomeIdentifier))})})})}}}),define("taoQtiTest/controller/creator/views/itemref",["jquery","lodash","i18n","taoQtiTest/controller/creator/views/actions","taoQtiTest/controller/creator/helpers/categorySelector","taoQtiTest/controller/creator/helpers/sectionCategory","taoQtiTest/controller/creator/helpers/qtiTest","taoQtiTest/controller/creator/templates/index"],function($,_,__,actions,categorySelectorFactory,sectionCategory,qtiTestHelper,templates){'use strict';var resize=_.throttle(function(){var $refs=$(".itemrefs").first(),$actions=$(".itemref .actions").first(),width=$refs.innerWidth()-$actions.outerWidth();$(".itemref > .title").width(width)},100);return{setUp:function(creatorContext,refModel,sectionModel,partModel,$itemRef){function timeLimitsProperty(propView){var $view=propView.getView(),$minTimeContainer=$(".mintime-container",$view),$maxTimeContainer=$(".maxtime-container",$view),$lockedTimeContainer=$(".lockedtime-container",$view),$locker=$(".locker button",$lockedTimeContainer),$durationFields=$(":text[data-duration]",$lockedTimeContainer),$minTimeField=$(":text[name=\"min-time\"]",$lockedTimeContainer),$maxTimeField=$(":text[name=\"max-time\"]",$lockedTimeContainer),minToMaxHandler=_.throttle(function(){$maxTimeField.off("change.sync"),$maxTimeField.val($minTimeField.val()).trigger("change"),_.defer(function(){$maxTimeField.on("change.sync",minToMaxHandler)})},200),maxToMinHandler=_.throttle(function(){$minTimeField.off("change.sync"),$minTimeField.val($maxTimeField.val()).trigger("change"),_.defer(function(){$minTimeField.on("change.sync",minToMaxHandler)})},200),lockTimers=function(){$locker.removeClass("unlocked").addClass("locked").attr("title",__("Unlink to use separated durations")),$minTimeField.val($maxTimeField.val()).trigger("change"),$minTimeField.on("change.sync",minToMaxHandler),$maxTimeField.on("change.sync",maxToMinHandler)},unlockTimers=function(){$locker.removeClass("locked").addClass("unlocked").attr("title",__("Link durations to activate the guided navigation")),$durationFields.off("change.sync"),$minTimeField.val("00:00:00").trigger("change")},toggleTimeContainers=function(){refModel.isLinear=0===partModel.navigationMode,refModel.isLinear&&config.guidedNavigation?($minTimeContainer.addClass("hidden"),$maxTimeContainer.addClass("hidden"),$lockedTimeContainer.removeClass("hidden"),$minTimeField.val()===$maxTimeField.val()&&"00:00:00"!==$maxTimeField.val()&&lockTimers(),$locker.on("click",function(e){e.preventDefault(),$locker.hasClass("locked")?unlockTimers():lockTimers()})):refModel.isLinear?($lockedTimeContainer.addClass("hidden"),$minTimeContainer.removeClass("hidden"),$maxTimeContainer.removeClass("hidden")):($lockedTimeContainer.addClass("hidden"),$minTimeContainer.addClass("hidden"),$maxTimeContainer.removeClass("hidden"))};modelOverseer.on("testpart-change",function(){toggleTimeContainers()}),toggleTimeContainers(),$durationFields.on("change.check",function(){0<refModel.timeLimits.minTime&&0<refModel.timeLimits.maxTime&&refModel.timeLimits.minTime>refModel.timeLimits.maxTime?$minTimeField.parent("div").find(".duration-ctrl-wrapper").addClass("brd-danger"):$minTimeField.parent("div").find(".duration-ctrl-wrapper").removeClass("brd-danger")})}function categoriesProperty($view){var categorySelector=categorySelectorFactory($view),$categoryField=$view.find("[name=\"itemref-category\"]");categorySelector.createForm(),categorySelector.updateFormState(refModel.categories),$view.on("propopen.propview",function(){categorySelector.updateFormState(refModel.categories)}),categorySelector.on("category-change",function(selected){$categoryField.val(selected.join(",")),$categoryField.trigger("change"),modelOverseer.trigger("category-change",selected)})}function weightsProperty(propView){var $view=propView.getView(),$weightList=$view.find("[data-bind-each=\"weights\"]"),weightTpl=templates.properties.itemrefweight;$view.find(".itemref-weight-add").on("click",function(e){var defaultData={value:1,"qti-type":"weight",identifier:0===refModel.weights.length?"WEIGHT":qtiTestHelper.getAvailableIdentifier(refModel,"weight","WEIGHT")};e.preventDefault(),$weightList.append(weightTpl(defaultData)),refModel.weights.push(defaultData),$weightList.trigger("add.internalbinder"),$view.groupValidator()})}var modelOverseer=creatorContext.getModelOverseer(),config=modelOverseer.getConfig()||{},$actionContainer=$(".actions",$itemRef);refModel.itemSessionControl||(refModel.itemSessionControl={}),_.defaults(refModel.itemSessionControl,sectionModel.itemSessionControl),refModel.isLinear=0===partModel.navigationMode,actions.properties($actionContainer,"itemref",refModel,function(propView){var removePropHandler=function(){null!==propView&&propView.destroy()};categoriesProperty(propView.getView()),weightsProperty(propView),timeLimitsProperty(propView),$itemRef.parents(".testpart").on("delete",removePropHandler),$itemRef.parents(".section").on("delete",removePropHandler),$itemRef.on("delete",removePropHandler)}),actions.move($actionContainer,"itemrefs","itemref"),resize()},listenActionState:function(){$(".itemrefs").each(function(){actions.movable($(".itemref",$(this)),"itemref",".actions")}),$(document).on("delete",function(e){var $target=$(e.target),$parent;$target.hasClass("itemref")&&($parent=$target.parents(".itemrefs"),actions.disable($parent.find(".itemref"),".actions"))}).on("add change undo.deleter deleted.deleter",".itemrefs",function(e){var $target=$(e.target),$parent;($target.hasClass("itemref")||$target.hasClass("itemrefs"))&&($parent=$(".itemref",$target.hasClass("itemrefs")?$target:$target.parents(".itemrefs")),actions.enable($parent,".actions"),actions.movable($parent,"itemref",".actions"))})},resize:resize}}),define("taoQtiTest/controller/creator/encoders/dom2qti",["jquery","lodash","taoQtiTest/controller/creator/helpers/qtiElement","taoQtiTest/controller/creator/helpers/baseType"],function($,_,qtiElementHelper,baseType){'use strict';function getAttributes(object){return _.omit(object,["qti-type","content","xmlBase","lang","label"])}function attrToStr(attributes){return _.reduce(attributes,function(acc,value,key){return _.isNumber(value)||_.isBoolean(value)||_.isString(value)&&!_.isEmpty(value)?acc+" "+key+"=\""+value+"\" ":acc},"")}function normalizeNodeName(nodeName){var normalized=nodeName?nodeName.toLocaleLowerCase():"";return normalizedNodes[normalized]||normalized}var normalizedNodes={feedbackblock:"feedbackBlock",outcomeidentifier:"outcomeIdentifier",showhide:"showHide",printedvariable:"printedVariable",powerform:"powerForm",mappingindicator:"mappingIndicator"},typedAttributes={printedVariable:{identifier:baseType.getConstantByName("identifier"),powerForm:baseType.getConstantByName("boolean"),base:baseType.getConstantByName("intOrIdentifier"),index:baseType.getConstantByName("intOrIdentifier"),delimiter:baseType.getConstantByName("string"),field:baseType.getConstantByName("string"),mappingIndicator:baseType.getConstantByName("string")}};return{encode:function encode(modelValue){var self=this,startTag;if(_.isArray(modelValue))return _.reduce(modelValue,function(result,value){return result+self.encode(value)},"");return _.isObject(modelValue)&&modelValue["qti-type"]?"textRun"===modelValue["qti-type"]?modelValue.content:(startTag="<"+modelValue["qti-type"]+attrToStr(getAttributes(modelValue)),modelValue.content?startTag+">"+self.encode(modelValue.content)+"</"+modelValue["qti-type"]+">":startTag+"/>"):""+modelValue},decode:function decode(nodeValue){var self=this,$nodeValue=nodeValue instanceof $?nodeValue:$(nodeValue),result=[],nodeName;return _.forEach($nodeValue,function(elt){var object;3===elt.nodeType?!_.isEmpty($.trim(elt.nodeValue))&&result.push(qtiElementHelper.create("textRun",{content:elt.nodeValue,xmlBase:""})):1===elt.nodeType&&(nodeName=normalizeNodeName(elt.nodeName),object=_.merge(qtiElementHelper.create(nodeName,{id:"",class:"",xmlBase:"",lang:"",label:""}),_.transform(elt.attributes,function(acc,value){var attrName=normalizeNodeName(value.nodeName);attrName&&(typedAttributes[nodeName]&&typedAttributes[nodeName][attrName]?acc[attrName]=baseType.getValue(typedAttributes[nodeName][attrName],value.nodeValue):acc[attrName]=value.nodeValue)})),0<elt.childNodes.length&&(object.content=self.decode(elt.childNodes)),result.push(object))}),result}}}),define("taoQtiTest/controller/creator/qtiContentCreator",["lodash","jquery","lib/uuid","taoQtiItem/qtiCreator/helper/commonRenderer","taoQtiItem/qtiCreator/editor/containerEditor"],function(_,$,uuid,qtiCommonRenderer,containerEditor){'use strict';return{create:function(creatorContext,$container,options){var self=this,editorId=uuid(),areaBroker=creatorContext.getAreaBroker(),modelOverseer=creatorContext.getModelOverseer();qtiCommonRenderer.setContext(areaBroker.getContentCreatorPanelArea()),containerEditor.create($container,{areaBroker:areaBroker,removePlugins:"magicline,taoqtiimage,taoqtimedia,taoqtimaths,taoqtiinclude,taoqtitable,sharedspace",toolbar:[{name:"basicstyles",items:["Bold","Italic","Subscript","Superscript"]},{name:"insert",items:["SpecialChar","TaoQtiPrintedVariable"]},{name:"links",items:["Link"]},"/",{name:"styles",items:["Format"]},{name:"paragraph",items:["NumberedList","BulletedList","-","Blockquote","JustifyLeft","JustifyCenter","JustifyRight","JustifyBlock"]}],metadata:{getOutcomes:function(){return modelOverseer.getOutcomesNames()}},change:options.change||_.noop,resetRenderer:!0,autofocus:!1}),creatorContext.on("creatorclose."+editorId,function(){self.destroy(creatorContext,$container)}),$container.data("editorId",editorId)},destroy:function(creatorContext,$container){var editorId=$container.data("editorId");return editorId&&creatorContext.off("."+editorId),containerEditor.destroy($container)}}}),define("taoQtiTest/controller/creator/views/rubricblock",["jquery","lodash","i18n","ui/hider","ui/dialog/alert","util/namespace","taoQtiTest/controller/creator/views/actions","helpers","taoQtiTest/controller/creator/encoders/dom2qti","taoQtiTest/controller/creator/helpers/qtiElement","taoQtiTest/controller/creator/qtiContentCreator","ckeditor"],function($,_,__,hider,dialogAlert,namespaceHelper,actions,helpers,Dom2QtiEncoder,qtiElementHelper,qtiContentCreator){'use strict';return{setUp:function(creatorContext,rubricModel,$rubricBlock){function bindEvent($el,eventName,cb){return eventName=namespaceHelper.namespaceAll(eventName,rubricModel.uid),$el.off(eventName).on(eventName,cb)}function ensureWrap(html){return html=(html||"").trim(),("<"!==html.charAt(0)||">"!==html.charAt(html.length-1))&&(html="<div>"+html+"</div>"),1<$(html).length&&(html="<div>"+html+"</div>"),html}function editorToModel(html){var rubric=qtiElementHelper.lookupElement(rubricModel,"rubricBlock","content"),wrapper=qtiElementHelper.lookupElement(rubricModel,"rubricBlock.div.feedbackBlock","content"),content=Dom2QtiEncoder.decode(ensureWrap(html));wrapper?wrapper.content=content:rubric.content=content}function modelToEditor(){var rubric=qtiElementHelper.lookupElement(rubricModel,"rubricBlock","content")||{},wrapper=qtiElementHelper.lookupElement(rubricModel,"rubricBlock.div.feedbackBlock","content"),content=wrapper?wrapper.content:rubric.content,html=ensureWrap(Dom2QtiEncoder.encode(content));qtiContentCreator.destroy(creatorContext,$rubricBlockContent).then(function(){$rubricBlockContent.html(html),qtiContentCreator.create(creatorContext,$rubricBlockContent,{change:function(editorContent){editorToModel(editorContent)}})})}function updateFeedback(feedback){var activated=feedback&&feedback.activated,wrapper=qtiElementHelper.lookupElement(rubricModel,"rubricBlock.div.feedbackBlock","content");return activated?(wrapper?(wrapper.outcomeIdentifier=feedback.outcome,wrapper.identifier=feedback.matchValue):rubricModel.content=[qtiElementHelper.create("div",{content:[qtiElementHelper.create("feedbackBlock",{outcomeIdentifier:feedback.outcome,identifier:feedback.matchValue,content:rubricModel.content})]})],modelToEditor()):wrapper&&(rubricModel.content=wrapper.content,modelToEditor()),activated}function rbViews($propContainer){var $select=$("[name=view]",$propContainer);bindEvent($select.select2({width:"100%"}),"select2-removed",function(){0===$select.select2("val").length&&$select.select2("val",[1])}),0===$select.select2("val").length&&$select.select2("val",[1])}var modelOverseer=creatorContext.getModelOverseer(),areaBroker=creatorContext.getAreaBroker(),$rubricBlockContent=$(".rubricblock-content",$rubricBlock);rubricModel.orderIndex=(rubricModel.index||0)+1,rubricModel.uid=_.uniqueId("rb"),rubricModel.feedback={activated:!!qtiElementHelper.lookupElement(rubricModel,"rubricBlock.div.feedbackBlock","content"),outcome:qtiElementHelper.lookupProperty(rubricModel,"rubricBlock.div.feedbackBlock.outcomeIdentifier","content"),matchValue:qtiElementHelper.lookupProperty(rubricModel,"rubricBlock.div.feedbackBlock.identifier","content")},modelOverseer.before("scoring-write."+rubricModel.uid,function(){var feedbackOutcome=rubricModel.feedback&&rubricModel.feedback.outcome;feedbackOutcome&&0>_.indexOf(modelOverseer.getOutcomesNames(),feedbackOutcome)?(modelOverseer.changedRubricBlock=(modelOverseer.changedRubricBlock||0)+1,rubricModel.feedback.activated=!1,rubricModel.feedback.outcome="",updateFeedback(rubricModel.feedback),$rubricBlock.trigger("outcome-removed")):$rubricBlock.trigger("outcome-updated")}).on("scoring-write."+rubricModel.uid,function(){modelOverseer.changedRubricBlock&&(dialogAlert(__("Some rubric blocks have been updated to reflect the changes in the list of outcomes.")),modelOverseer.changedRubricBlock=0)}),actions.properties($rubricBlock,"rubricblock",rubricModel,function(propView){function changeFeedback(activated){hider.toggle($feedbackOutcomeLine,activated),hider.toggle($feedbackMatchLine,activated)}function removePropHandler(){rubricModel.feedback={},null!==propView&&propView.destroy()}function updateOutcomes(){var activated=rubricModel.feedback&&rubricModel.feedback.activated,outcomes=_.map(modelOverseer.getOutcomesNames(),function(name){return{id:name,text:name}});$feedbackOutcome.select2({minimumResultsForSearch:-1,width:"100%",data:outcomes}),activated||$feedbackActivated.prop("checked",!1),changeFeedback(activated)}var $view=propView.getView(),$feedbackOutcomeLine=$(".rubric-feedback-outcome",$view),$feedbackMatchLine=$(".rubric-feedback-match-value",$view),$feedbackOutcome=$("[name=feedback-outcome]",$view),$feedbackActivated=$("[name=activated]",$view);$("[name=type]",$view).select2({minimumResultsForSearch:-1,width:"100%"}),$view.on("change.binder",function(e,changedModel){"binder"===e.namespace&&"rubricBlock"===changedModel["qti-type"]&&changeFeedback(updateFeedback(changedModel.feedback))}),bindEvent($rubricBlock.parents(".testpart"),"delete",removePropHandler),bindEvent($rubricBlock.parents(".section"),"delete",removePropHandler),bindEvent($rubricBlock,"delete",removePropHandler),bindEvent($rubricBlock,"outcome-removed",function(){$feedbackOutcome.val(""),updateOutcomes()}),bindEvent($rubricBlock,"outcome-updated",function(){updateFeedback(rubricModel.feedback),updateOutcomes()}),changeFeedback(rubricModel.feedback),updateOutcomes(),rbViews($view)}),modelToEditor(),bindEvent($rubricBlock,"delete",function(){qtiContentCreator.destroy(creatorContext,$rubricBlockContent)}),$rubricBlockContent.on("editorfocus",function(){areaBroker.getPropertyPanelArea().children(".props").hide().trigger("propclose.propview")}),areaBroker.getContentCreatorPanelArea().find(".test-content").on("scroll",function(){CKEDITOR.document.getWindow().fire("scroll")})}}}),define("taoQtiTest/controller/creator/helpers/sectionBlueprints",["lodash","i18n","core/errorHandler"],function(_,__,errorHandler){'use strict';return{setBlueprint:function(model,blueprint){model.blueprint=blueprint},getBlueprint:function(getUrl,model){return $.ajax({url:getUrl,type:"GET",data:{section:model.identifier},dataType:"json"}).fail(function(){errorHandler.throw(".sectionBlueprint","invalid tool config format")})}}}),define("taoQtiTest/controller/creator/views/section",["jquery","lodash","uri","i18n","taoQtiTest/controller/creator/views/actions","taoQtiTest/controller/creator/views/itemref","taoQtiTest/controller/creator/views/rubricblock","taoQtiTest/controller/creator/templates/index","taoQtiTest/controller/creator/helpers/qtiTest","taoQtiTest/controller/creator/helpers/categorySelector","taoQtiTest/controller/creator/helpers/sectionCategory","taoQtiTest/controller/creator/helpers/sectionBlueprints"],function($,_,uri,__,actions,itemRefView,rubricBlockView,templates,qtiTestHelper,categorySelectorFactory,sectionCategory,sectionBlueprint){'use strict';return{setUp:function(creatorContext,sectionModel,partModel,$section){function addItemRef($refList,index,itemData){var $items=$refList.children("li"),$itemRef;index=index||$items.length,itemData.identifier=qtiTestHelper.getAvailableIdentifier(modelOverseer.getModel(),"assessmentItemRef","item"),itemData.index=index+1,$itemRef=$(templates.itemref(itemData)),0<index?$itemRef.insertAfter($items.eq(index-1)):$itemRef.appendTo($refList),$refList.trigger("add",[$itemRef,itemData])}function categoriesProperty($view){var categories=sectionCategory.getCategories(sectionModel),categorySelector=categorySelectorFactory($view);categorySelector.createForm(categories.all),updateFormState(categorySelector),$view.on("propopen.propview",function(){updateFormState(categorySelector)}),categorySelector.on("category-change",function(selected,indeterminate){sectionCategory.setCategories(sectionModel,selected,indeterminate),modelOverseer.trigger("category-change")})}function updateFormState(categorySelector){var categories=sectionCategory.getCategories(sectionModel);categorySelector.updateFormState(categories.propagated,categories.partial)}function blueprintProperty($view){function initBlueprint(){"undefined"==typeof sectionModel.blueprint&&sectionBlueprint.getBlueprint(config.routes.blueprintByTestSection,sectionModel).success(function(data){_.isEmpty(data)||""===sectionModel.blueprint||(sectionModel.blueprint=data.uri,$select.select2("data",{id:data.uri,text:data.text}),$select.trigger("change"))})}function setBlueprint(blueprint){sectionBlueprint.setBlueprint(sectionModel,blueprint)}var $select=$("[name=section-blueprint]",$view);$select.select2({ajax:{url:config.routes.blueprintsById,dataType:"json",delay:350,method:"POST",data:function data(params){return{identifier:params}},results:function results(data){return data}},minimumInputLength:3,width:"100%",multiple:!1,allowClear:!0,placeholder:__("Select a blueprint"),formatNoMatches:function formatNoMatches(){return __("Enter a blueprint")},maximumInputLength:32}).on("change",function(e){setBlueprint(e.val)}),initBlueprint(),$view.on("propopen.propview",function(){initBlueprint()})}var $actionContainer=$("h2",$section),modelOverseer=creatorContext.getModelOverseer(),config=modelOverseer.getConfig();sectionModel.itemSessionControl||(sectionModel.itemSessionControl={}),_.defaults(sectionModel.itemSessionControl,partModel.itemSessionControl),_.isEmpty(config.routes.blueprintsById)||(sectionModel.hasBlueprint=!0),actions.properties($actionContainer,"section",sectionModel,function(propView){function removePropHandler(){null!==propView&&propView.destroy()}var $view=propView.getView(),$selectionSwitcher=$("[name=section-enable-selection]",$view),$selectionSelect=$("[name=section-select]",$view),$selectionWithRep=$("[name=section-with-replacement]",$view),isSelectionFromServer=!!(sectionModel.selection&&sectionModel.selection["qti-type"]),$title;$selectionSwitcher.on("change",function(){!0===$selectionSwitcher.prop("checked")?($selectionSelect.incrementer("enable"),$selectionWithRep.removeClass("disabled")):($selectionSelect.incrementer("disable"),$selectionWithRep.addClass("disabled"))}),$selectionSwitcher.on("change",function(){$selectionSwitcher.prop("checked")||($selectionSelect.val(0),$selectionWithRep.prop("checked",!1),delete sectionModel.selection)}),$selectionSwitcher.prop("checked",isSelectionFromServer).trigger("change"),$title=$("[data-bind=title]",$section),$view.on("change.binder",function(e){"binder"===e.namespace&&"assessmentSection"===sectionModel["qti-type"]&&$title.text(sectionModel.title)}),$section.parents(".testpart").on("deleted.deleter",removePropHandler),$section.on("deleted.deleter",removePropHandler),categoriesProperty($view),"undefined"!=typeof sectionModel.hasBlueprint&&blueprintProperty($view)}),actions.move($actionContainer,"sections","section"),function(){sectionModel.sectionParts||(sectionModel.sectionParts=[]),$(".itemref",$section).each(function(){var $itemRef=$(this),index=$itemRef.data("bind-index");sectionModel.sectionParts[index]||(sectionModel.sectionParts[index]={}),itemRefView.setUp(creatorContext,sectionModel.sectionParts[index],sectionModel,partModel,$itemRef),$itemRef.find(".title").text(config.labels[uri.encode($itemRef.data("uri"))])})}(),function(){var $itemsPanel=$(".test-creator-items .item-selection");$itemsPanel.on("itemselect.creator",function(e,selection){var $placeholder=$(".itemref-placeholder",$section),$placeholders=$(".itemref-placeholder");0<_.size(selection)?$placeholder.show().off("click").on("click",function(){var defaultItemData={},categories;sectionModel.itemSessionControl&&!_.isUndefined(sectionModel.itemSessionControl.maxAttempts)&&(defaultItemData.itemSessionControl=_.clone(sectionModel.itemSessionControl)),categories=sectionCategory.getCategories(sectionModel),defaultItemData.categories=_.clone(categories.propagated)||[],_.forEach(selection,function(item){var itemData=_.defaults({href:item.uri,label:item.label,"qti-type":"assessmentItemRef"},defaultItemData);_.isArray(item.categories)&&(itemData.categories=item.categories.concat(itemData.categories)),addItemRef($(".itemrefs",$section),null,itemData)}),$itemsPanel.trigger("itemselected.creator"),$placeholders.hide().off("click")}):$placeholders.hide().off("click")}),$(document).off("add.binder","#"+$section.attr("id")+" .itemrefs").on("add.binder","#"+$section.attr("id")+" .itemrefs",function(e,$itemRef){var index,itemRefModel;"binder"===e.namespace&&$itemRef.hasClass("itemref")&&(index=$itemRef.data("bind-index"),itemRefModel=sectionModel.sectionParts[index],itemRefView.setUp(creatorContext,itemRefModel,sectionModel,partModel,$itemRef),modelOverseer.trigger("item-add",itemRefModel))})}(),function(){sectionModel.rubricBlocks||(sectionModel.rubricBlocks=[]),$(".rubricblock",$section).each(function(){var $rubricBlock=$(this),index=$rubricBlock.data("bind-index");sectionModel.rubricBlocks[index]||(sectionModel.rubricBlocks[index]={}),rubricBlockView.setUp(creatorContext,sectionModel.rubricBlocks[index],$rubricBlock)}),0<sectionModel.rubricBlocks.length&&$(".rub-toggler",$section).trigger("click")}(),function(){$(".rublock-adder",$section).adder({target:$(".rubricblocks",$section),content:templates.rubricblock,templateData:function templateData(cb){cb({"qti-type":"rubricBlock",index:$(".rubricblock",$section).length,content:[],views:[1]})}}),$(document).on("add.binder","#"+$section.attr("id")+" .rubricblocks",function(e,$rubricBlock){var index,rubricModel;"binder"===e.namespace&&$rubricBlock.hasClass("rubricblock")&&(index=$rubricBlock.data("bind-index"),rubricModel=sectionModel.rubricBlocks[index]||{},$(".rubricblock-binding",$rubricBlock).html("<p>&nbsp;</p>"),rubricBlockView.setUp(creatorContext,rubricModel,$rubricBlock),modelOverseer.trigger("rubric-add",rubricModel))})}()},listenActionState:function(){var $sections;$(".sections").each(function(){$sections=$(".section",$(this)),actions.removable($sections,"h2"),actions.movable($sections,"section","h2")}),$(document).on("delete",function(e){var $target=$(e.target),$parent;$target.hasClass("section")&&($parent=$target.parents(".sections"),actions.disable($parent.find(".section"),"h2"))}).on("add change undo.deleter deleted.deleter",function(e){var $target=$(e.target);($target.hasClass("section")||$target.hasClass("sections"))&&($sections=$(".section",$target.hasClass("sections")?$target:$target.parents(".sections")),actions.removable($sections,"h2"),actions.movable($sections,"section","h2"))}).on("open.toggler",".rub-toggler",function(e){"toggler"===e.namespace&&$(this).parents("h2").addClass("active")}).on("close.toggler",".rub-toggler",function(e){"toggler"===e.namespace&&$(this).parents("h2").removeClass("active")})}}}),define("taoQtiTest/controller/creator/views/testpart",["jquery","lodash","taoQtiTest/controller/creator/views/actions","taoQtiTest/controller/creator/views/section","taoQtiTest/controller/creator/templates/index","taoQtiTest/controller/creator/helpers/qtiTest"],function($,_,actions,sectionView,templates,qtiTestHelper){'use strict';return{setUp:function(creatorContext,partModel,$testPart){var $actionContainer=$("h1",$testPart),modelOverseer=creatorContext.getModelOverseer(),config=modelOverseer.getConfig();actions.properties($actionContainer,"testpart",partModel,function(propView){var $view=propView.getView(),$identifier=$("[data-bind=identifier]",$testPart);$view.on("change.binder",function(e,model){"binder"===e.namespace&&"testPart"===model["qti-type"]&&($identifier.text(model.identifier),modelOverseer.trigger("testpart-change",partModel))}),$testPart.on("delete",function(){null!==propView&&propView.destroy()})}),actions.move($actionContainer,"testparts","testpart"),function(){partModel.assessmentSections||(partModel.assessmentSections=[]),$(".section",$testPart).each(function(){var $section=$(this),index=$section.data("bind-index");partModel.assessmentSections[index]||(partModel.assessmentSections[index]={}),sectionView.setUp(creatorContext,partModel.assessmentSections[index],partModel,$section)})}(),function(){$(".section-adder",$testPart).adder({target:$(".sections",$testPart),content:templates.section,templateData:function templateData(cb){var sectionIndex=$(".section",$testPart).length;cb({"qti-type":"assessmentSection",identifier:qtiTestHelper.getAvailableIdentifier(modelOverseer.getModel(),"assessmentSection"),title:"Section "+(sectionIndex+1),index:0,sectionParts:[]})}}),$(document).off("add.binder","#"+$testPart.attr("id")+" .sections").on("add.binder","#"+$testPart.attr("id")+" .sections",function(e,$section){var index,sectionModel;"binder"===e.namespace&&$section.hasClass("section")&&(index=$section.data("bind-index"),sectionModel=partModel.assessmentSections[index],sectionView.setUp(creatorContext,sectionModel,partModel,$section),modelOverseer.trigger("section-add",sectionModel))})}()},listenActionState:function(){var $testParts=$(".testpart");actions.removable($testParts,"h1"),actions.movable($testParts,"testpart","h1"),$(".testparts").on("delete",function(e){var $target=$(e.target);$target.hasClass("testpart")&&actions.disable($(".testpart"),"h1")}).on("add change undo.deleter deleted.deleter",function(e){var $target=$(e.target);($target.hasClass("testpart")||$target.hasClass("testparts"))&&($testParts=$(".testpart"),actions.removable($testParts,"h1"),actions.movable($testParts,"testpart","h1"))})}}}),define("taoQtiTest/controller/creator/views/test",["jquery","lodash","i18n","ui/hider","ui/feedback","taoQtiTest/controller/creator/views/actions","taoQtiTest/controller/creator/views/testpart","taoQtiTest/controller/creator/templates/index","taoQtiTest/controller/creator/helpers/qtiTest"],function($,_,__,hider,feedback,actions,testPartView,templates,qtiTestHelper){'use strict';return function(creatorContext){var modelOverseer=creatorContext.getModelOverseer(),testModel=modelOverseer.getModel();actions.properties($(".test-creator-test > h1"),"test",testModel,function(propView){function changeScoring(scoring){var noOptions=!!scoring&&-1===["none","custom"].indexOf(scoring.outcomeProcessing),newScoringState=JSON.stringify(scoring);hider.toggle($cutScoreLine,!!scoring&&"cut"===scoring.outcomeProcessing),hider.toggle($categoryScoreLine,noOptions),hider.toggle($weightIdentifierLine,noOptions),hider.hide($descriptions),hider.show($descriptions.filter("[data-key=\""+scoring.outcomeProcessing+"\"]")),scoringState!==newScoringState&&modelOverseer.trigger("scoring-change",testModel),scoringState=newScoringState}function updateOutcomes(){var $panel=$(".outcome-declarations",$view);$panel.html(templates.outcomes(modelOverseer.getOutcomesList()))}var $view=propView.getView(),$categoryScoreLine=$(".test-category-score",$view),$cutScoreLine=$(".test-cut-score",$view),$weightIdentifierLine=$(".test-weight-identifier",$view),$descriptions=$(".test-outcome-processing-description",$view),$generate=$("[data-action=\"generate-outcomes\"]",$view),$title=$(".test-creator-test > h1 [data-bind=title]"),scoringState=JSON.stringify(testModel.scoring);$("[name=test-outcome-processing]",$view).select2({minimumResultsForSearch:-1,width:"100%"}),$generate.on("click",function(){$generate.addClass("disabled").attr("disabled",!0),modelOverseer.on("scoring-write.regenerate",function(){modelOverseer.off("scoring-write.regenerate"),feedback().success(__("The outcomes have been regenerated!")).on("destroy",function(){$generate.removeClass("disabled").removeAttr("disabled")})}).trigger("scoring-change")}),$view.on("change.binder",function(e,model){"binder"===e.namespace&&"assessmentTest"===model["qti-type"]&&(changeScoring(model.scoring),$title.text(model.title))}),modelOverseer.on("scoring-write",updateOutcomes),changeScoring(testModel.scoring),updateOutcomes()}),function(){testModel.testParts||(testModel.testParts=[]),$(".testpart").each(function(){var $testPart=$(this),index=$testPart.data("bind-index");testModel.testParts[index]||(testModel.testParts[index]={}),testPartView.setUp(creatorContext,testModel.testParts[index],$testPart)})}(),function(){$(".testpart-adder").adder({target:$(".testparts"),content:templates.testpart,templateData:function templateData(cb){var testPartIndex=$(".testpart").length;cb({"qti-type":"testPart",identifier:qtiTestHelper.getAvailableIdentifier(modelOverseer.getModel(),"testPart"),index:testPartIndex,navigationMode:0,submissionMode:0,assessmentSections:[{"qti-type":"assessmentSection",identifier:qtiTestHelper.getAvailableIdentifier(modelOverseer.getModel(),"assessmentSection","section"),title:"Section 1",index:0,sectionParts:[]}]})}}),$(document).off("add.binder",".testparts").on("add.binder",".testparts",function(e,$testPart,added){var partModel;"binder"===e.namespace&&$testPart.hasClass("testpart")&&(partModel=testModel.testParts[added.index],testPartView.setUp(creatorContext,partModel,$testPart),modelOverseer.trigger("part-add",partModel))})}()}}),define("taoQtiTest/controller/creator/helpers/processingRule",["lodash","taoQtiTest/controller/creator/helpers/outcomeValidator","taoQtiTest/controller/creator/helpers/qtiElement","taoQtiTest/controller/creator/helpers/baseType","taoQtiTest/controller/creator/helpers/cardinality"],function(_,outcomeValidator,qtiElementHelper,baseTypeHelper,cardinalityHelper){'use strict';function unaryOperator(type,expression,baseType,cardinality){var processingRule=processingRuleHelper.create(type,null,[expression]);return processingRule.minOperands=1,processingRule.maxOperands=1,addTypeAndCardinality(processingRule,baseType,cardinality),processingRule}function binaryOperator(type,left,right,baseType,cardinality){var processingRule=processingRuleHelper.create(type,null,[left,right]);return processingRule.minOperands=2,processingRule.maxOperands=2,addTypeAndCardinality(processingRule,baseType,cardinality),processingRule}function addTypeAndCardinality(processingRule,baseType,cardinality){return _.isUndefined(baseType)&&(baseType=[baseTypeHelper.INTEGER,baseTypeHelper.FLOAT]),_.isUndefined(cardinality)&&(cardinality=[cardinalityHelper.SINGLE]),processingRule.acceptedCardinalities=forceArray(cardinality),processingRule.acceptedBaseTypes=forceArray(baseType),processingRule}function addCategories(processingRule,includeCategories,excludeCategories){return processingRule.includeCategories=forceArray(includeCategories),processingRule.excludeCategories=forceArray(excludeCategories),processingRule}function addSectionIdentifier(processingRule,sectionIdentifier){if(sectionIdentifier){if(!outcomeValidator.validateIdentifier(sectionIdentifier))throw new TypeError("You must provide a valid weight identifier!");processingRule.sectionIdentifier=sectionIdentifier}else processingRule.sectionIdentifier="";return processingRule}function addWeightIdentifier(processingRule,weightIdentifier){if(weightIdentifier){if(!outcomeValidator.validateIdentifier(weightIdentifier))throw new TypeError("You must provide a valid weight identifier!");processingRule.weightIdentifier=weightIdentifier}else processingRule.weightIdentifier="";return processingRule}function validateIdentifier(identifier){if(!outcomeValidator.validateIdentifier(identifier))throw new TypeError("You must provide a valid identifier!");return identifier}function validateOutcome(outcome){if(!outcomeValidator.validateOutcome(outcome))throw new TypeError("You must provide a valid QTI element!");return outcome}function validateOutcomeList(outcomes){if(!outcomeValidator.validateOutcomes(outcomes))throw new TypeError("You must provide a valid list of QTI elements!");return outcomes}function forceArray(value){return value||(value=[]),_.isArray(value)||(value=[value]),value}var processingRuleHelper={create:function(type,identifier,expression){var processingRule=qtiElementHelper.create(type,identifier&&validateIdentifier(identifier));return expression&&processingRuleHelper.setExpression(processingRule,expression),processingRule},setExpression:function(processingRule,expression){processingRule&&(_.isArray(expression)?(processingRule.expression&&(processingRule.expression=null),processingRule.expressions=validateOutcomeList(expression)):(processingRule.expressions&&(processingRule.expressions=null),expression&&(processingRule.expression=validateOutcome(expression))))},addExpression:function(processingRule,expression){processingRule&&expression&&(processingRule.expression&&(processingRule.expressions=forceArray(processingRule.expression),processingRule.expression=null),_.isArray(expression)?processingRule.expressions=forceArray(processingRule.expressions).concat(validateOutcomeList(expression)):processingRule.expressions?processingRule.expressions.push(expression):processingRule.expression=validateOutcome(expression))},setOutcomeValue:function(identifier,expression){return processingRuleHelper.create("setOutcomeValue",validateIdentifier(identifier),expression)},gte:function(left,right){return binaryOperator("gte",left,right)},lte:function(left,right){return binaryOperator("lte",left,right)},divide:function(left,right){return binaryOperator("divide",left,right)},sum:function(terms){var processingRule=processingRuleHelper.create("sum",null,forceArray(terms));return processingRule.minOperands=1,processingRule.maxOperands=-1,processingRule.acceptedCardinalities=[cardinalityHelper.SINGLE,cardinalityHelper.MULTIPLE,cardinalityHelper.ORDERED],processingRule.acceptedBaseTypes=[baseTypeHelper.INTEGER,baseTypeHelper.FLOAT],processingRule},testVariables:function(identifier,type,weightIdentifier,includeCategories,excludeCategories){var processingRule=processingRuleHelper.create("testVariables");return processingRule.variableIdentifier=validateIdentifier(identifier),processingRule.baseType=baseTypeHelper.getValid(type),addWeightIdentifier(processingRule,weightIdentifier),addSectionIdentifier(processingRule,""),addCategories(processingRule,includeCategories,excludeCategories),processingRule},outcomeMaximum:function(identifier,weightIdentifier,includeCategories,excludeCategories){var processingRule=processingRuleHelper.create("outcomeMaximum");return processingRule.outcomeIdentifier=validateIdentifier(identifier),addWeightIdentifier(processingRule,weightIdentifier),addSectionIdentifier(processingRule,""),addCategories(processingRule,includeCategories,excludeCategories),processingRule},numberPresented:function(includeCategories,excludeCategories){var processingRule=processingRuleHelper.create("numberPresented");return addSectionIdentifier(processingRule,""),addCategories(processingRule,includeCategories,excludeCategories),processingRule},baseValue:function(value,type){var processingRule=processingRuleHelper.create("baseValue");return processingRule.baseType=baseTypeHelper.getValid(type,baseTypeHelper.FLOAT),processingRule.value=baseTypeHelper.getValue(processingRule.baseType,value),processingRule},variable:function(identifier,weightIdentifier){var processingRule=processingRuleHelper.create("variable",validateIdentifier(identifier));return addWeightIdentifier(processingRule,weightIdentifier),processingRule},match:function(left,right){return binaryOperator("match",left,right,cardinalityHelper.SAME,cardinalityHelper.SAME)},isNull:function(expression){return unaryOperator("isNull",expression,baseTypeHelper.ANY,cardinalityHelper.ANY)},outcomeCondition:function(outcomeIf,outcomeElse){var processingRule=processingRuleHelper.create("outcomeCondition");if(!outcomeValidator.validateOutcome(outcomeIf,!1,"outcomeIf"))throw new TypeError("You must provide a valid outcomeIf element!");if(outcomeElse&&!outcomeValidator.validateOutcome(outcomeElse,!1,"outcomeElse"))throw new TypeError("You must provide a valid outcomeElse element!");return processingRule.outcomeIf=outcomeIf,processingRule.outcomeElseIfs=[],outcomeElse&&(processingRule.outcomeElse=outcomeElse),processingRule},outcomeIf:function(expression,instruction){var processingRule=processingRuleHelper.create("outcomeIf");return _.isArray(instruction)||(instruction=[instruction]),processingRule.expression=validateOutcome(expression),processingRule.outcomeRules=validateOutcomeList(instruction),processingRule},outcomeElse:function(instruction){var processingRule=processingRuleHelper.create("outcomeElse");return _.isArray(instruction)||(instruction=[instruction]),processingRule.outcomeRules=validateOutcomeList(instruction),processingRule}};return processingRuleHelper}),define("taoQtiTest/controller/creator/helpers/scoring",["lodash","i18n","core/format","taoQtiTest/controller/creator/helpers/baseType","taoQtiTest/controller/creator/helpers/outcome","taoQtiTest/controller/creator/helpers/processingRule"],function(_,__,format,baseTypeHelper,outcomeHelper,processingRuleHelper){'use strict';var _Mathmax2=Math.max;function addTotalScoreOutcomes(model,scoring,identifier,weight,category){var outcome=outcomeHelper.createOutcome(identifier,baseTypeHelper.FLOAT),processingRule=processingRuleHelper.setOutcomeValue(identifier,processingRuleHelper.sum(processingRuleHelper.testVariables(scoring.scoreIdentifier,-1,weight&&scoring.weightIdentifier,category)));outcomeHelper.addOutcome(model,outcome,processingRule)}function addMaxScoreOutcomes(model,scoring,identifier,weight,category){var outcome=outcomeHelper.createOutcome(identifier,baseTypeHelper.FLOAT),processingRule=processingRuleHelper.setOutcomeValue(identifier,processingRuleHelper.sum(processingRuleHelper.testVariables("MAXSCORE",-1,weight&&scoring.weightIdentifier,category)));outcomeHelper.addOutcome(model,outcome,processingRule)}function addRatioOutcomes(model,identifier,identifierTotal,identifierMax){var outcome=outcomeHelper.createOutcome(identifier,baseTypeHelper.FLOAT),outcomeCondition=processingRuleHelper.outcomeCondition(processingRuleHelper.outcomeIf(processingRuleHelper.isNull(processingRuleHelper.variable(identifierMax)),processingRuleHelper.setOutcomeValue(identifier,processingRuleHelper.baseValue(0,baseTypeHelper.FLOAT))),processingRuleHelper.outcomeElse(processingRuleHelper.setOutcomeValue(identifier,processingRuleHelper.divide(processingRuleHelper.variable(identifierTotal),processingRuleHelper.variable(identifierMax)))));outcomeHelper.addOutcome(model,outcome),outcomeHelper.addOutcomeProcessing(model,outcomeCondition)}function addCutScoreOutcomes(model,identifier,scoreIdentifier,countIdentifier,cutScore){var outcome=outcomeHelper.createOutcome(identifier,baseTypeHelper.BOOLEAN),processingRule=processingRuleHelper.setOutcomeValue(identifier,processingRuleHelper.gte(processingRuleHelper.divide(processingRuleHelper.variable(scoreIdentifier),processingRuleHelper.variable(countIdentifier)),processingRuleHelper.baseValue(cutScore,baseTypeHelper.FLOAT)));outcomeHelper.addOutcome(model,outcome,processingRule)}function addGlobalCutScoreOutcomes(model,identifier,ratioIdentifier,cutScore){var outcome=outcomeHelper.createOutcome(identifier,baseTypeHelper.BOOLEAN),processingRule=processingRuleHelper.setOutcomeValue(identifier,processingRuleHelper.gte(processingRuleHelper.variable(ratioIdentifier),processingRuleHelper.baseValue(cutScore,baseTypeHelper.FLOAT)));outcomeHelper.addOutcome(model,outcome,processingRule)}function addFeedbackScoreOutcomes(model,identifier,variable,passed,notPassed){var type=baseTypeHelper.IDENTIFIER,outcome=outcomeHelper.createOutcome(identifier,type),processingRule=processingRuleHelper.outcomeCondition(processingRuleHelper.outcomeIf(processingRuleHelper.match(processingRuleHelper.variable(variable),processingRuleHelper.baseValue(!0,baseTypeHelper.BOOLEAN)),processingRuleHelper.setOutcomeValue(identifier,processingRuleHelper.baseValue(passed,type))),processingRuleHelper.outcomeElse(processingRuleHelper.setOutcomeValue(identifier,processingRuleHelper.baseValue(notPassed,type))));outcomeHelper.addOutcome(model,outcome),outcomeHelper.addOutcomeProcessing(model,processingRule)}function formatCategoryOutcome(category,template){return format(template,category.toUpperCase())}function belongToRecipe(identifier,recipe,onlyCategories){var match=!1;return recipe.signature&&recipe.signature.test(identifier)&&(match=!0,onlyCategories&&_.forEach(recipe.outcomes,function(outcome){if(outcome.identifier===identifier||outcome.weighted&&outcome.weighted===identifier||outcome.feedback&&outcome.feedback===identifier)return match=!1,!1})),match}function matchRecipe(outcomeRecipe,outcomes,categories){function matchRecipeOutcome(recipe,identifier){var outcomeMatch=!1;return recipe.signature&&recipe.signature.test(identifier)&&_.forEach(recipe.outcomes,function(outcome){if(outcome.identifier!==identifier&&(!outcome.weighted||outcome.weighted&&outcome.weighted!==identifier)&&(!outcome.feedback||outcome.feedback&&outcome.feedback!==identifier)?categories&&_.forEach(categories,function(category){if(outcome.categoryIdentifier&&identifier===formatCategoryOutcome(category,outcome.categoryIdentifier)?outcomeMatch=!0:outcome.categoryWeighted&&identifier===formatCategoryOutcome(category,outcome.categoryWeighted)?outcomeMatch=!0:outcome.categoryFeedback&&identifier===formatCategoryOutcome(category,outcome.categoryFeedback)&&(outcomeMatch=!0),outcomeMatch)return!1}):outcomeMatch=!0,outcomeMatch)return!1}),!outcomeMatch&&recipe.include&&(outcomeMatch=matchRecipeOutcome(outcomesRecipes[recipe.include],identifier)),outcomeMatch}var signatures=getSignatures(outcomeRecipe),match=!0;return _.forEach(outcomes,function(identifier){var signatureMatch=!1;if(_.forEach(signatures,function(signature){if(signature.test(identifier))return signatureMatch=!0,!1}),signatureMatch&&(match=matchRecipeOutcome(outcomeRecipe,identifier),!match))return!1}),match}function getSignatures(recipe){for(var signatures=[];recipe;)recipe.signature&&signatures.push(recipe.signature),recipe=recipe.include&&outcomesRecipes[recipe.include];return signatures}function getRecipes(recipe){for(var descriptors=[];recipe;)recipe.outcomes&&(descriptors=[].concat(recipe.outcomes,descriptors)),recipe=recipe.include&&outcomesRecipes[recipe.include];return descriptors}function getOutcomesRecipe(outcome){var identifier=outcomeHelper.getOutcomeIdentifier(outcome),mode=null;return _.forEach(outcomesRecipes,function(processingRecipe){if(belongToRecipe(identifier,processingRecipe))return mode=processingRecipe,!1}),mode}function listScoringModes(outcomes){var modes={};return _.forEach(outcomes,function(outcome){var recipe=getOutcomesRecipe(outcome);recipe&&(modes[recipe.key]=!0)}),_.keys(modes)}function handleCategories(modelOverseer){var model=modelOverseer.getModel();return!!(model.scoring&&model.scoring.categoryScore)}function hasCategoryOutcome(model){var categoryOutcomes=!1;return _.forEach(outcomeHelper.getOutcomeDeclarations(model),function(outcomeDeclaration){var identifier=outcomeHelper.getOutcomeIdentifier(outcomeDeclaration);_.forEach(outcomesRecipes,function(processingRecipe){if(belongToRecipe(identifier,processingRecipe,!0))return categoryOutcomes=!0,!1})}),categoryOutcomes}function getCutScore(model){var values=_(outcomeHelper.getOutcomeProcessingRules(model)).map(function(outcome){return outcomeHelper.getProcessingRuleProperty(outcome,"setOutcomeValue.gte.baseValue.value")}).compact().uniq().value();return _.isEmpty(values)&&(values=[defaultCutScore]),_Mathmax2(0,_.max(values))}function getWeightIdentifier(model){var values=[];return outcomeHelper.eachOutcomeProcessingRuleExpressions(model,function(processingRule){"testVariables"===processingRule["qti-type"]&&processingRule.weightIdentifier&&values.push(processingRule.weightIdentifier)}),values=_(values).compact().uniq().value(),values.length?values[0]:""}function getOutcomeProcessing(modelOverseer){var model=modelOverseer.getModel(),outcomeDeclarations=outcomeHelper.getOutcomeDeclarations(model),outcomeRules=outcomeHelper.getOutcomeProcessingRules(model),declarations=listScoringModes(outcomeDeclarations),processing=listScoringModes(outcomeRules),diff=_.difference(declarations,processing),count=_.size(declarations),outcomeProcessing="custom",included;return count===_.size(processing)&&(count?_.isEmpty(diff)&&(1<count&&(included=[],_.forEach(declarations,function(mode){outcomesRecipes[mode]&&outcomesRecipes[mode].include&&included.push(outcomesRecipes[mode].include)}),processing=_.difference(processing,included),count=_.size(processing)),1===count&&(outcomeProcessing=processing[0],!matchRecipe(outcomesRecipes[outcomeProcessing],modelOverseer.getOutcomesNames(),modelOverseer.getCategories())&&(outcomeProcessing="custom"))):outcomeProcessing="none"),outcomeProcessing}function detectScoring(modelOverseer){var model=modelOverseer.getModel();return{modes:processingModes,scoreIdentifier:"SCORE",weightIdentifier:getWeightIdentifier(model),cutScore:getCutScore(model),categoryScore:hasCategoryOutcome(model),outcomeProcessing:getOutcomeProcessing(modelOverseer)}}function removeScoring(model){var scoringOutcomes=_.indexBy(outcomeHelper.listOutcomes(model,getOutcomesRecipe),function(outcome){return outcome});outcomeHelper.removeOutcomes(model,function(outcome){function browseExpressions(processingRule){_.isArray(processingRule)?_.forEach(processingRule,browseExpressions):processingRule&&(scoringOutcomes[outcomeHelper.getOutcomeIdentifier(processingRule)]&&(match=!0),!match&&processingRule.expression&&browseExpressions(processingRule.expression),!match&&processingRule.expressions&&browseExpressions(processingRule.expressions),!match&&processingRule.outcomeRules&&browseExpressions(processingRule.outcomeRules),!match&&processingRule.outcomeIf&&browseExpressions(processingRule.outcomeIf),!match&&processingRule.outcomeElse&&browseExpressions(processingRule.outcomeElse))}var match=!1;return"outcomeCondition"===outcome["qti-type"]?browseExpressions(outcome):match=!!scoringOutcomes[outcomeHelper.getOutcomeIdentifier(outcome)],match})}function getOutcomes(model){return{outcomeDeclarations:[].concat(outcomeHelper.getOutcomeDeclarations(model)),outcomeProcessing:{outcomeRules:[].concat(outcomeHelper.getOutcomeProcessingRules(model))}}}var defaultCutScore=.5,processingModes={none:{key:"none",label:__("None"),description:__("No outcome processing. Erase the existing rules, if any.")},custom:{key:"custom",label:__("Custom"),description:__("Custom outcome processing. No changes will be made to the existing rules.")},total:{key:"total",label:__("Total score"),description:__("The score will be processed for the entire test. A sum of all SCORE outcomes will be computed, the result will take place in the SCORE_TOTAL outcome.")+" "+__("If the category option is set, the score will also be processed per categories, and each results will take place in the SCORE_xxx outcome, where xxx is the name of the category.")},cut:{key:"cut",label:__("Cut score"),description:__("The score will be processed for the entire test. A sum of all SCORE outcomes will be computed and divided by the sum of MAX SCORE, the result will be compared to the cut score (or pass ratio), then the PASS_TOTAL outcome will be set accordingly.")+" "+__("If the category option is set, the score will also be processed per categories, and each results will take place in the PASS_xxx outcome, where xxx is the name of the category.")}},outcomesRecipes={none:{key:"none",clean:!0},custom:{key:"custom",clean:!1},total:{key:"total",signature:/^SCORE_([a-zA-Z][a-zA-Z0-9_\.-]*)$/,outcomes:[{writer:"total",identifier:"SCORE_TOTAL",weighted:"SCORE_TOTAL_WEIGHTED",categoryIdentifier:"SCORE_CATEGORY_%s",categoryWeighted:"SCORE_CATEGORY_WEIGHTED_%s"},{writer:"max",identifier:"SCORE_TOTAL_MAX",weighted:"SCORE_TOTAL_MAX_WEIGHTED",categoryIdentifier:"SCORE_CATEGORY_MAX_%s",categoryWeighted:"SCORE_CATEGORY_WEIGHTED_MAX_%s"},{writer:"ratio",identifier:"SCORE_RATIO",weighted:"SCORE_RATIO_WEIGHTED",scoreIdentifier:{total:"SCORE_TOTAL",max:"SCORE_TOTAL_MAX"},scoreWeighted:{total:"SCORE_TOTAL_WEIGHTED",max:"SCORE_TOTAL_MAX_WEIGHTED"}}],clean:!0},cut:{key:"cut",include:"total",signature:/^PASS_([a-zA-Z][a-zA-Z0-9_\.-]*)$/,outcomes:[{writer:"cut",identifier:"PASS_ALL",feedback:"PASS_ALL_RENDERING",feedbackOk:"passed",feedbackFailed:"not_passed",categoryIdentifier:"PASS_CATEGORY_%s",categoryFeedback:"PASS_CATEGORY_%s_RENDERING"}],clean:!0}},outcomesWriters={ratio:function(descriptor,scoring,outcomes){addRatioOutcomes(outcomes,descriptor.identifier,descriptor.scoreIdentifier.total,descriptor.scoreIdentifier.max),scoring.weightIdentifier&&addRatioOutcomes(outcomes,descriptor.weighted,descriptor.scoreWeighted.total,descriptor.scoreWeighted.max)},total:function(descriptor,scoring,outcomes,categories){addTotalScoreOutcomes(outcomes,scoring,descriptor.identifier,!1),descriptor.weighted&&scoring.weightIdentifier&&addTotalScoreOutcomes(outcomes,scoring,descriptor.weighted,!0),descriptor.categoryIdentifier&&categories&&_.forEach(categories,function(category){addTotalScoreOutcomes(outcomes,scoring,formatCategoryOutcome(category,descriptor.categoryIdentifier),!1,category),descriptor.categoryWeighted&&scoring.weightIdentifier&&addTotalScoreOutcomes(outcomes,scoring,formatCategoryOutcome(category,descriptor.categoryWeighted),!0,category)})},max:function(descriptor,scoring,outcomes,categories){addMaxScoreOutcomes(outcomes,scoring,descriptor.identifier,!1),descriptor.weighted&&scoring.weightIdentifier&&addMaxScoreOutcomes(outcomes,scoring,descriptor.weighted,!0),descriptor.categoryIdentifier&&categories&&_.forEach(categories,function(category){addMaxScoreOutcomes(outcomes,scoring,formatCategoryOutcome(category,descriptor.categoryIdentifier),!1,category),descriptor.categoryWeighted&&scoring.weightIdentifier&&addMaxScoreOutcomes(outcomes,scoring,formatCategoryOutcome(category,descriptor.categoryWeighted),!0,category)})},cut:function(descriptor,scoring,outcomes,categories){var cutScore=scoring.cutScore,totalModeOutcomes=outcomesRecipes.total.outcomes,total=_.find(totalModeOutcomes,{writer:"total"}),max=_.find(totalModeOutcomes,{writer:"max"}),ratio=_.find(totalModeOutcomes,{writer:"ratio"}),whichOutcome=scoring.weightIdentifier?"weighted":"identifier",ratioIdentifier=ratio[whichOutcome];return addGlobalCutScoreOutcomes(outcomes,descriptor.identifier,ratioIdentifier,cutScore),descriptor.feedback&&addFeedbackScoreOutcomes(outcomes,descriptor.feedback,descriptor.identifier,descriptor.feedbackOk,descriptor.feedbackFailed),descriptor.categoryIdentifier&&categories&&_.forEach(categories,function(category){var categoryOutcome=scoring.weightIdentifier?"categoryWeighted":"categoryIdentifier",categoryOutcomeIdentifier=formatCategoryOutcome(category,descriptor.categoryIdentifier),categoryScoreIdentifier=formatCategoryOutcome(category,total[categoryOutcome]),categoryCountIdentifier=formatCategoryOutcome(category,max[categoryOutcome]);addCutScoreOutcomes(outcomes,categoryOutcomeIdentifier,categoryScoreIdentifier,categoryCountIdentifier,cutScore),descriptor.categoryFeedback&&addFeedbackScoreOutcomes(outcomes,formatCategoryOutcome(category,descriptor.categoryFeedback),categoryOutcomeIdentifier,descriptor.feedbackOk,descriptor.feedbackFailed)}),outcomes}},scoringHelper={init:function(modelOverseer){var model;if(!modelOverseer||!_.isFunction(modelOverseer.getModel))throw new TypeError("You must provide a valid modelOverseer");model=modelOverseer.getModel(),model.scoring=detectScoring(modelOverseer),modelOverseer.on("scoring-change category-change delete",function(){modelOverseer.trigger("scoring-generate",scoringHelper.generate(modelOverseer))}).on("scoring-generate",function(outcomes){outcomeHelper.replaceOutcomes(model,outcomes),modelOverseer.trigger("scoring-write",model)}).trigger("scoring-init",model)},generate:function(modelOverseer){var model,scoring,outcomes,outcomeRecipe,recipes,categories;if(!modelOverseer||!_.isFunction(modelOverseer.getModel))throw new TypeError("You must provide a valid modelOverseer");if(model=modelOverseer.getModel(),scoring=model.scoring,outcomes=getOutcomes(model),scoring)if(outcomeRecipe=outcomesRecipes[scoring.outcomeProcessing],outcomeRecipe)outcomeRecipe.clean&&removeScoring(outcomes),recipes=getRecipes(outcomeRecipe),handleCategories(modelOverseer)&&(categories=modelOverseer.getCategories()),_.forEach(recipes,function(recipe){var writer=outcomesWriters[recipe.writer];writer(recipe,scoring,outcomes,categories)});else throw new Error("Unknown score processing mode: "+scoring.outcomeProcessing);return outcomes}};return scoringHelper}),define("taoQtiTest/controller/creator/creator",["module","jquery","lodash","helpers","i18n","ui/feedback","core/databindcontroller","taoQtiTest/controller/creator/qtiTestCreator","taoQtiTest/controller/creator/views/item","taoQtiTest/controller/creator/views/test","taoQtiTest/controller/creator/views/testpart","taoQtiTest/controller/creator/views/section","taoQtiTest/controller/creator/views/itemref","taoQtiTest/controller/creator/encoders/dom2qti","taoQtiTest/controller/creator/templates/index","taoQtiTest/controller/creator/helpers/qtiTest","taoQtiTest/controller/creator/helpers/scoring","taoQtiTest/controller/creator/helpers/categorySelector","ui/validator/validators"],function(module,$,_,helpers,__,feedback,DataBindController,qtiTestCreatorFactory,itemView,testView,testPartView,sectionView,itemrefView,Dom2QtiEncoder,templates,qtiTestHelper,scoringHelper,categorySelector,validators){'use strict';return{routes:{},start:function start(options){var $container=$("#test-creator"),$saver=$("#saver"),creatorContext,binder,binderOptions,modelOverseer;this.identifiers=[],options=_.merge(module.config(),options||{}),options.routes=options.routes||{},options.labels=options.labels||{},options.categoriesPresets=options.categoriesPresets||{},options.guidedNavigation=!0===options.guidedNavigation,categorySelector.setPresets(options.categoriesPresets),$("#authoringBack").on("click",function(e){e.preventDefault(),creatorContext&&creatorContext.trigger("creatorclose"),window.history.back()}),itemView($(".test-creator-items .item-selection",$container)),$container.on("change.binder delete.binder",function(e,model){"binder"===e.namespace&&model&&modelOverseer&&modelOverseer.trigger(e.type,model)}),binderOptions=_.merge(options.routes,{filters:{isItemRef:function isItemRef(value){return qtiTestHelper.filterQtiType(value,"assessmentItemRef")},isSection:function isSection(value){return qtiTestHelper.filterQtiType(value,"assessmentSection")}},encoders:{dom2qti:Dom2QtiEncoder},templates:templates,beforeSave:function beforeSave(model){qtiTestHelper.addMissingQtiType(model),qtiTestHelper.consolidateModel(model);try{qtiTestHelper.validateModel(model)}catch(err){return $saver.attr("disabled",!1).removeClass("disabled"),feedback().error(__("The test has not been saved.")+" ".concat(err)),!1}return!0}}),binder=DataBindController.takeControl($container,binderOptions).get(function(model){creatorContext=qtiTestCreatorFactory($container,{uri:options.uri,labels:options.labels,routes:options.routes,guidedNavigation:options.guidedNavigation}),creatorContext.setTestModel(model),modelOverseer=creatorContext.getModelOverseer(),scoringHelper.init(modelOverseer),validators.register("idFormat",qtiTestHelper.idFormatValidator()),validators.register("testIdFormat",qtiTestHelper.testidFormatValidator()),validators.register("testIdAvailable",qtiTestHelper.idAvailableValidator(modelOverseer),!0),testView(creatorContext),testPartView.listenActionState(),sectionView.listenActionState(),itemrefView.listenActionState(),itemrefView.resize(),$(window).off("resize.qti-test-creator").on("resize.qti-test-creator",function(){return itemrefView.resize()})}),$saver.on("click",function(event){event.preventDefault(),$saver.hasClass("disabled")||($saver.attr("disabled",!0).addClass("disabled"),binder.save(function(){$saver.attr("disabled",!1).removeClass("disabled"),feedback().success(__("Test Saved"))},function(){$saver.attr("disabled",!1).removeClass("disabled")}))})}}}),define("taoQtiTest/controller/creator/helpers/ckConfigurator",["ui/ckeditor/ckConfigurator","mathJax"],function(ckConfigurator){'use strict';return{getConfig:function getConfig(editor,toolbarType,options){return options=options||{},options.underline=!0,ckConfigurator.getConfig(editor,toolbarType,options)}}}),define("taoQtiTest/controller/routes",[],function(){'use strict';return{Creator:{css:"creator",actions:{index:"controller/creator/creator"}},XmlEditor:{actions:{edit:"controller/content/edit"}}}}),define("css!taoQtiTestCss/new-test-runner",[],function(){}),define("taoQtiTest/controller/runner/runner",["jquery","lodash","i18n","context","module","core/router","core/logger","layout/loading-bar","ui/feedback","util/url","taoTests/runner/providerLoader","taoTests/runner/runner","css!taoQtiTestCss/new-test-runner"],function($,_,__,context,module,router,loggerFactory,loadingBar,feedback,urlUtil,providerLoader,runner){'use strict';var requiredOptions=["testDefinition","testCompilation","serviceCallId","bootstrap","options","providers"];return{start:function start(config){var $container=$(".runner"),logger=loggerFactory("controller/runner",{serviceCallId:config.serviceCallId,plugins:config&&config.providers&&Object.keys(config.providers.plugins)}),preventFeedback=!1,errorFeedback=null,exit=function(reason,level){var url=config.options.exitUrl,params={};reason&&(!level&&(level="warning"),params[level]=reason,url=urlUtil.build(url,params)),window.location=url},onError=function(err,displayMessage){onFeedback(err,displayMessage,"error")},onWarning=function(err,displayMessage){onFeedback(err,displayMessage,"warning")},onFeedback=function(err,displayMessage,type){var typeMap={warning:{logger:"warn",feedback:"warning"},error:{logger:"error",feedback:"error"}},loggerByType=logger[typeMap[type].logger],feedbackByType=feedback()[typeMap[type].feedback];return displayMessage=displayMessage||err.message,_.isString(displayMessage)||(displayMessage=JSON.stringify(displayMessage)),loadingBar.stop(),loggerByType({displayMessage:displayMessage},err),"error"===type&&(403===err.code||500===err.code)?(displayMessage="".concat(__("An error occurred during the test, please content your administrator.")," ").concat(displayMessage),exit(displayMessage,"error")):void(!preventFeedback&&(errorFeedback=feedbackByType(displayMessage,{timeout:-1})))},moduleConfig=module.config(),exitReason;return loadingBar.start(),requiredOptions.every(function(option){return"undefined"!=typeof config[option]})?void(moduleConfig&&_.isArray(moduleConfig.extraRoutes)&&moduleConfig.extraRoutes.length&&router.dispatch(moduleConfig.extraRoutes),config.provider=Object.assign(config.provider||{},{runner:"qti"}),providerLoader(config.providers,context.bundle).then(function(results){var testRunnerConfig=_.omit(config,["providers"]);if(testRunnerConfig.renderTo=$container,results.proxy&&"function"==typeof results.proxy.getAvailableProviders){var loadedProxies=results.proxy.getAvailableProviders();testRunnerConfig.provider.proxy=loadedProxies[0]}logger.debug({config:testRunnerConfig,providers:config.providers},"Start test runner"),runner(config.provider.runner,results.plugins,testRunnerConfig).on("error",onError).on("warning",onWarning).on("ready",function(){_.defer(function(){$container.removeClass("hidden")})}).on("pause",function(data){data&&data.reason&&(exitReason=data.reason)}).after("destroy",function(){this.removeAllListeners(),exit(exitReason)}).on("disablefeedbackalerts",function(){errorFeedback&&errorFeedback.close(),preventFeedback=!0}).on("enablefeedbackalerts",function(){preventFeedback=!1}).init()}).catch(function(err){onError(err,__("An error occurred during the test initialization!"))})):onError(new TypeError(__("Missing required configuration option %s",name)))}}}),define("taoQtiTest/testRunner/actionBarHook",["jquery","lodash","core/errorHandler","core/promise"],function($,_,errorHandler,Promise){'use strict';function isValidConfig(toolconfig){return!!(_.isObject(toolconfig)&&toolconfig.hook)}function triggerItemLoaded(tool){tool&&tool.itemLoaded&&tool.itemLoaded()}function _appendInOrder($container,$button){var order=$button.data("order"),$after,$before;"last"===order?$container.append($button):"first"===order?$container.prepend($button):(order=_.parseInt(order),_.isNaN(order)?$container.append($button):($container.children(".action").each(function(){var $btn=$(this),_order=$btn.data("order");if("last"===_order)$before=$btn,$after=null;else if("first"===_order)$before=null,$after=$btn;else{if(_order=_.parseInt(_order),_.isNaN(_order)||_order>order)return $before=$btn,$after=null,!1;_order===order?$after=$btn:_order<order&&($after=$btn,$before=null)}}),$after?$after.after($button):$before?$before.before($button):$container.append($button)))}function isValidHook(hook){return _.isObject(hook)&&_(["init","render","clear","isVisible"]).reduce(function(result,method){return result&&_.isFunction(hook[method])},!0)}var $doc=$(document),tools={},itemIsLoaded=!1;return $doc.off(".actionBarHook").on("serviceloaded.actionBarHook",function(){itemIsLoaded=!0,_.forEach(tools,function(tool){triggerItemLoaded(tool)})}),{isValid:isValidConfig,initQtiTool:function($toolsContainer,id,toolconfig,testContext,testRunner){return itemIsLoaded=!1,tools[id]=null,_.isString(toolconfig)&&(toolconfig={hook:toolconfig}),new Promise(function(resolve){isValidConfig(toolconfig)?require([toolconfig.hook],function(hook){var $button,$existingBtn;isValidHook(hook)?(hook.init(id,toolconfig,testContext,testRunner),$existingBtn=$toolsContainer.children("[data-control=\""+id+"\"]"),$existingBtn.length&&(hook.clear($existingBtn),$existingBtn.remove()),hook.isVisible()&&(tools[id]=hook,$button=hook.render(),_appendInOrder($toolsContainer,$button),$button.trigger("ready.actionBarHook",[hook]),itemIsLoaded&&triggerItemLoaded(hook)),resolve(hook)):(errorHandler.throw(".actionBarHook","invalid hook format"),resolve(null))},function(){errorHandler.throw(".actionBarHook","the hook amd module cannot be found"),resolve(null)}):(errorHandler.throw(".actionBarHook","invalid tool config format"),resolve(null))})}}}),define("taoQtiTest/testRunner/actionBarTools",["jquery","lodash","core/eventifier","core/promise","taoQtiTest/testRunner/actionBarHook"],function($,_,eventifier,Promise,actionBarHook){'use strict';var registeredQtiTools,qtiTools;return eventifier({register:function(tools){var registerTools=tools||{};this.trigger("beforeregister",registerTools,this),registeredQtiTools=registerTools,this.trigger("afterregister",registerTools,this)},getRegisteredTools:function(){return registeredQtiTools||{}},getRegistered:function(id){return registeredQtiTools&&registeredQtiTools[id]},isRegistered:function(id){return!!(registeredQtiTools&&registeredQtiTools[id])},get:function(id){return qtiTools&&qtiTools[id]},list:function(){return _.values(qtiTools||{})},render:function(container,testContext,testRunner,callback){var self=this,$container=$(container),promises=[];this.trigger("beforerender",$container,testContext,testRunner,this),_.forIn(this.getRegisteredTools(),function(toolconfig,id){promises.push(actionBarHook.initQtiTool($container,id,toolconfig,testContext,testRunner))}),Promise.all(promises).then(function(values){var tools=[];qtiTools={},_.forEach(values,function(tool){tool&&(tools.push(tool),qtiTools[tool.getId()]=tool)}),_.isFunction(callback)&&callback.call(self,tools,$container,testContext,testRunner,self),self.trigger("afterrender",tools,$container,testContext,testRunner,self)})}})}),define("tpl!taoQtiTest/testRunner/tpl/navigator",["handlebars"],function(hb){return hb.template({1:function _(){return" hidden"},compiler:[8,">= 4.3.0"],main:function main(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1,helper;return"<aside class=\"test-sidebar test-sidebar-"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"region")||(null==depth0?depth0:lookupProperty(depth0,"region")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"region",hash:{},data:data,loc:{start:{line:1,column:40},end:{line:1,column:50}}}):helper))+" flex-container-navi qti-navigator"+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"hidden"),{name:"if",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:1,column:84},end:{line:1,column:112}}}))?"":stack1)+"\">\n            <div class=\"qti-navigator-collapsible\">\n                <span class=\"qti-navigator-collapse icon icon-left\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Collapse the review panel",{name:"__",hash:{},data:data,loc:{start:{line:3,column:75},end:{line:3,column:109}}}))+"\"></span>\n                <span class=\"qti-navigator-expand icon icon-right\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Expand the review panel",{name:"__",hash:{},data:data,loc:{start:{line:4,column:74},end:{line:4,column:106}}}))+"\"></span>\n            </div>\n\n            <div class=\"qti-navigator-info collapsible\">\n                <span class=\"qti-navigator-label\">\n                    <span class=\"qti-navigator-text\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Test status",{name:"__",hash:{},data:data,loc:{start:{line:9,column:53},end:{line:9,column:73}}}))+"</span>\n                    <span class=\"icon-up\"></span>\n                    <span class=\"icon-down\"></span>\n                </span>\n                <ul class=\"collapsible-panel plain\">\n                    <li class=\"qti-navigator-viewed\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Viewed items",{name:"__",hash:{},data:data,loc:{start:{line:14,column:60},end:{line:14,column:81}}}))+"\">\n                        <span class=\"qti-navigator-label\">\n                            <span class=\"qti-navigator-icon icon-viewed\"></span>\n                            <span class=\"qti-navigator-text\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Viewed",{name:"__",hash:{},data:data,loc:{start:{line:17,column:61},end:{line:17,column:76}}}))+"</span>\n                            <span class=\"qti-navigator-counter\">-/-</span>\n                        </span>\n                    </li>\n                    <li class=\"qti-navigator-answered\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Completed items",{name:"__",hash:{},data:data,loc:{start:{line:21,column:62},end:{line:21,column:86}}}))+"\">\n                        <span class=\"qti-navigator-label\">\n                            <span class=\"qti-navigator-icon icon-answered\"></span>\n                            <span class=\"qti-navigator-text\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Answered",{name:"__",hash:{},data:data,loc:{start:{line:24,column:61},end:{line:24,column:78}}}))+"</span>\n                            <span class=\"qti-navigator-counter\">-/-</span>\n                        </span>\n                    </li>\n                    <li class=\"qti-navigator-unanswered\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Unanswered items",{name:"__",hash:{},data:data,loc:{start:{line:28,column:64},end:{line:28,column:89}}}))+"\">\n                        <span class=\"qti-navigator-label\">\n                            <span class=\"qti-navigator-icon icon-unanswered\"></span>\n                            <span class=\"qti-navigator-text\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Unanswered",{name:"__",hash:{},data:data,loc:{start:{line:31,column:61},end:{line:31,column:80}}}))+"</span>\n                            <span class=\"qti-navigator-counter\">-/-</span>\n                        </span>\n                    </li>\n                    <li class=\"qti-navigator-flagged\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Items marked for later review",{name:"__",hash:{},data:data,loc:{start:{line:35,column:61},end:{line:35,column:99}}}))+"\">\n                        <span class=\"qti-navigator-label\">\n                            <span class=\"qti-navigator-icon icon-flagged\"></span>\n                            <span class=\"qti-navigator-text\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Flagged",{name:"__",hash:{},data:data,loc:{start:{line:38,column:61},end:{line:38,column:77}}}))+"</span>\n                            <span class=\"qti-navigator-counter\">-/-</span>\n                        </span>\n                    </li>\n                </ul>\n            </div>\n\n            <div class=\"qti-navigator-filters\">\n                <ul role=\"tablist\" class=\"plain clearfix\">\n                    <li role=\"tab\" aria-selected=\"true\" class=\"qti-navigator-filter active\" data-mode=\"all\">\n                        <span title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Reset filters",{name:"__",hash:{},data:data,loc:{start:{line:48,column:37},end:{line:48,column:59}}}))+"\" class=\"qti-navigator-tab\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"All",{name:"__",hash:{},data:data,loc:{start:{line:48,column:87},end:{line:48,column:99}}}))+"</span>\n                    </li>\n                    <li role=\"tab\" class=\"qti-navigator-filter\" data-mode=\"unanswered\">\n                        <span class=\"icon-unanswered qti-navigator-tab\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Only display the unanswered items",{name:"__",hash:{},data:data,loc:{start:{line:51,column:79},end:{line:51,column:121}}}))+"\"></span>\n                    </li>\n                    <li role=\"tab\" class=\"qti-navigator-filter\" data-mode=\"flagged\">\n                        <span class=\"icon-flagged qti-navigator-tab\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Only display the items marked for review",{name:"__",hash:{},data:data,loc:{start:{line:54,column:76},end:{line:54,column:125}}}))+"\"></span>\n                    </li>\n                </ul>\n            </div>\n\n            <nav class=\"qti-navigator-tree\">\n            </nav>\n\n            <div id=\"qti-navigator-linear\" class=\"qti-navigator-linear\">\n                <span class=\"icon icon-info\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"In this part of the test navigation is not allowed.",{name:"__",hash:{},data:data,loc:{start:{line:63,column:52},end:{line:63,column:112}}}))+"\"></span>\n                <p class=\"qti-navigator-message\">\n                    "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"In this part of the test navigation is not allowed.",{name:"__",hash:{},data:data,loc:{start:{line:65,column:20},end:{line:65,column:80}}}))+"\n                </p>\n            </div>\n        </aside>"},useData:!0})}),define("tpl!taoQtiTest/testRunner/tpl/navigatorTree",["handlebars"],function(hb){return hb.template({1:function _(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1,helper;return"                    <li class=\"qti-navigator-part collapsible "+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"active"),{name:"if",hash:{},fn:container.program(2,data,0),inverse:container.program(4,data,0),data:data,loc:{start:{line:3,column:62},end:{line:3,column:106}}}))?"":stack1)+"\" data-id=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"id")||(null==depth0?depth0:lookupProperty(depth0,"id")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"id",hash:{},data:data,loc:{start:{line:3,column:117},end:{line:3,column:123}}}):helper))+"\">\n                        <span class=\"qti-navigator-label\" title=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:4,column:65},end:{line:4,column:74}}}):helper))+"\">\n                            <span class=\"qti-navigator-text\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:5,column:61},end:{line:5,column:70}}}):helper))+"</span>\n                            <span class=\"icon-up\"></span>\n                            <span class=\"icon-down\"></span>\n                        </span>\n"+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==(stack1=null==depth0?depth0:lookupProperty(depth0,"sections"))?stack1:lookupProperty(stack1,"length"),{name:"if",hash:{},fn:container.program(6,data,0),inverse:container.program(29,data,0),data:data,loc:{start:{line:9,column:24},end:{line:44,column:31}}}))?"":stack1)+"                    </li>\n"},2:function _(){return"active"},4:function _(){return"collapsed"},6:function _(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1;return"                        <ul class=\"qti-navigator-sections collapsible-panel plain\">\n"+(null==(stack1=lookupProperty(helpers,"each").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"sections"),{name:"each",hash:{},fn:container.program(7,data,0),inverse:container.noop,data:data,loc:{start:{line:11,column:28},end:{line:29,column:37}}}))?"":stack1)+"                        </ul>\n"},7:function _(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1,helper;return"                            <li class=\"qti-navigator-section collapsible "+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"active"),{name:"if",hash:{},fn:container.program(2,data,0),inverse:container.program(4,data,0),data:data,loc:{start:{line:12,column:73},end:{line:12,column:117}}}))?"":stack1)+"\" data-id=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"id")||(null==depth0?depth0:lookupProperty(depth0,"id")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"id",hash:{},data:data,loc:{start:{line:12,column:128},end:{line:12,column:134}}}):helper))+"\">\n                                <span class=\"qti-navigator-label\" title=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:13,column:73},end:{line:13,column:82}}}):helper))+"\">\n                                    <span class=\"qti-navigator-text\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:14,column:69},end:{line:14,column:78}}}):helper))+"</span>\n                                    <span class=\"qti-navigator-counter\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"answered")||(null==depth0?depth0:lookupProperty(depth0,"answered")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"answered",hash:{},data:data,loc:{start:{line:15,column:72},end:{line:15,column:84}}}):helper))+"/"+container.escapeExpression(container.lambda(null==(stack1=null==depth0?depth0:lookupProperty(depth0,"items"))?stack1:lookupProperty(stack1,"length"),depth0))+"</span>\n                                </span>\n                                <ul class=\"qti-navigator-items collapsible-panel plain\">\n"+(null==(stack1=lookupProperty(helpers,"each").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"items"),{name:"each",hash:{},fn:container.program(8,data,0),inverse:container.noop,data:data,loc:{start:{line:18,column:36},end:{line:26,column:45}}}))?"":stack1)+"                                </ul>\n                            </li>\n"},8:function _(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1,helper;return"                                    <li class=\"qti-navigator-item"+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"active"),{name:"if",hash:{},fn:container.program(9,data,0),inverse:container.noop,data:data,loc:{start:{line:19,column:65},end:{line:19,column:93}}}))?"":stack1)+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"flagged"),{name:"if",hash:{},fn:container.program(11,data,0),inverse:container.noop,data:data,loc:{start:{line:19,column:93},end:{line:19,column:123}}}))?"":stack1)+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"answered"),{name:"if",hash:{},fn:container.program(13,data,0),inverse:container.noop,data:data,loc:{start:{line:19,column:123},end:{line:19,column:155}}}))?"":stack1)+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"viewed"),{name:"if",hash:{},fn:container.program(15,data,0),inverse:container.program(17,data,0),data:data,loc:{start:{line:19,column:155},end:{line:19,column:198}}}))?"":stack1)+"\" data-id=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"id")||(null==depth0?depth0:lookupProperty(depth0,"id")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"id",hash:{},data:data,loc:{start:{line:19,column:209},end:{line:19,column:215}}}):helper))+"\" data-position=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"position")||(null==depth0?depth0:lookupProperty(depth0,"position")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"position",hash:{},data:data,loc:{start:{line:19,column:232},end:{line:19,column:244}}}):helper))+"\">\n                                        <span class=\"qti-navigator-label truncate\" title=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:20,column:90},end:{line:20,column:99}}}):helper))+"\">\n                                            <span class=\"qti-navigator-icon icon-"+(null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"flagged"),{name:"if",hash:{},fn:container.program(19,data,0),inverse:container.program(21,data,0),data:data,loc:{start:{line:21,column:81},end:{line:21,column:198}}}))?"":stack1)+"\"></span>\n                                            <span class=\"qti-navigator-number\">"+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"index")||data&&lookupProperty(data,"index"))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"index",hash:{},data:data,loc:{start:{line:22,column:79},end:{line:22,column:89}}}):helper))+"</span>\n                                            "+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"label")||(null==depth0?depth0:lookupProperty(depth0,"label")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"label",hash:{},data:data,loc:{start:{line:23,column:44},end:{line:23,column:53}}}):helper))+"\n                                        </span>\n                                    </li>\n"},9:function _(){return" active"},11:function _(){return" flagged"},13:function _(){return" answered"},15:function _(){return" viewed"},17:function _(){return" unseen"},19:function _(){return"flagged"},21:function _(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1;return null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"answered"),{name:"if",hash:{},fn:container.program(22,data,0),inverse:container.program(24,data,0),data:data,loc:{start:{line:21,column:111},end:{line:21,column:191}}}))?"":stack1},22:function _(){return"answered"},24:function _(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1;return null==(stack1=lookupProperty(helpers,"if").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"viewed"),{name:"if",hash:{},fn:container.program(25,data,0),inverse:container.program(27,data,0),data:data,loc:{start:{line:21,column:143},end:{line:21,column:184}}}))?"":stack1},25:function _(){return"viewed"},27:function _(){return"unseen"},29:function _(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},helper;return"                        <div class=\"qti-navigator-linear-part collapsible-panel\">\n                            <span class=\"icon icon-info\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"In this part of the test navigation is not allowed.",{name:"__",hash:{},data:data,loc:{start:{line:33,column:64},end:{line:33,column:124}}}))+"\"></span>\n                            <p class=\"qti-navigator-message\">\n                                "+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"In this part of the test navigation is not allowed.",{name:"__",hash:{},data:data,loc:{start:{line:35,column:32},end:{line:35,column:92}}}))+"\n                            </p>\n                            <p class=\"qti-navigator-actions\">\n                                <button class=\"btn-info small\" data-id=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"itemId")||(null==depth0?depth0:lookupProperty(depth0,"itemId")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"itemId",hash:{},data:data,loc:{start:{line:38,column:72},end:{line:38,column:82}}}):helper))+"\" data-position=\""+container.escapeExpression((helper=null==(helper=lookupProperty(helpers,"position")||(null==depth0?depth0:lookupProperty(depth0,"position")))?container.hooks.helperMissing:helper,"function"==typeof helper?helper.call(null==depth0?container.nullContext||{}:depth0,{name:"position",hash:{},data:data,loc:{start:{line:38,column:99},end:{line:38,column:111}}}):helper))+"\" title=\""+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Start Test-part",{name:"__",hash:{},data:data,loc:{start:{line:38,column:120},end:{line:38,column:144}}}))+"\">\n                                    <span class=\"qti-navigator-text\">"+container.escapeExpression((lookupProperty(helpers,"__")||depth0&&lookupProperty(depth0,"__")||container.hooks.helperMissing).call(null==depth0?container.nullContext||{}:depth0,"Start Test-part",{name:"__",hash:{},data:data,loc:{start:{line:39,column:69},end:{line:39,column:93}}}))+"</span>\n                                    <span class=\"icon-play r\"></span>\n                                </button>\n                            </p>\n                        </div>\n"},compiler:[8,">= 4.3.0"],main:function main(container,depth0,helpers,partials,data){var lookupProperty=container.lookupProperty||function(parent,propertyName){return Object.prototype.hasOwnProperty.call(parent,propertyName)?parent[propertyName]:void 0},stack1;return"<ul class=\"qti-navigator-parts plain\">\n"+(null==(stack1=lookupProperty(helpers,"each").call(null==depth0?container.nullContext||{}:depth0,null==depth0?depth0:lookupProperty(depth0,"parts"),{name:"each",hash:{},fn:container.program(1,data,0),inverse:container.noop,data:data,loc:{start:{line:2,column:20},end:{line:46,column:29}}}))?"":stack1)+"                </ul>"},useData:!0})}),define("taoQtiTest/testRunner/testReview",["jquery","lodash","i18n","tpl!taoQtiTest/testRunner/tpl/navigator","tpl!taoQtiTest/testRunner/tpl/navigatorTree","util/capitalize"],function($,_,__,navigatorTpl,navigatorTreeTpl,capitalize){'use strict';var _cssCls={active:"active",collapsed:"collapsed",collapsible:"collapsible",hidden:"hidden",disabled:"disabled",flagged:"flagged",answered:"answered",viewed:"viewed",unseen:"unseen",icon:"qti-navigator-icon",scope:{test:"scope-test",testPart:"scope-test-part",testSection:"scope-test-section"}},_selectors={component:".qti-navigator",filterBar:".qti-navigator-filters",tree:".qti-navigator-tree",collapseHandle:".qti-navigator-collapsible",linearState:".qti-navigator-linear",infoAnswered:".qti-navigator-answered .qti-navigator-counter",infoViewed:".qti-navigator-viewed .qti-navigator-counter",infoUnanswered:".qti-navigator-unanswered .qti-navigator-counter",infoFlagged:".qti-navigator-flagged .qti-navigator-counter",infoPanel:".qti-navigator-info",infoPanelLabels:".qti-navigator-info > .qti-navigator-label",parts:".qti-navigator-part",partLabels:".qti-navigator-part > .qti-navigator-label",sections:".qti-navigator-section",sectionLabels:".qti-navigator-section > .qti-navigator-label",items:".qti-navigator-item",itemLabels:".qti-navigator-item > .qti-navigator-label",itemIcons:".qti-navigator-item > .qti-navigator-icon",icons:".qti-navigator-icon",linearStart:".qti-navigator-linear-part button",counters:".qti-navigator-counter",actives:".active",collapsible:".collapsible",collapsiblePanels:".collapsible-panel",unseen:".unseen",answered:".answered",flagged:".flagged",notFlagged:":not(.flagged)",notAnswered:":not(.answered)",hidden:".hidden"},_filterMap={all:"",unanswered:_selectors.answered,flagged:_selectors.notFlagged,answered:_selectors.notAnswered,filtered:_selectors.hidden},_optionsMap={reviewScope:"reviewScope",reviewPreventsUnseen:"preventsUnseen",canCollapse:"canCollapse"},_reviewScopes={test:"test",testPart:"testPart",testSection:"testSection"},testReview={init:function(element,options){var initOptions=_.isObject(options)&&options||{},putOnRight="right"===initOptions.region,insertMethod=putOnRight?"append":"prepend";if(this.options=initOptions,this.disabled=!1,this.hidden=!!initOptions.hidden,this.currentFilter="all",this.$component&&this.$component.remove(),this.$container=$(element),insertMethod=this.$container[insertMethod],insertMethod)insertMethod.call(this.$container,navigatorTpl({region:putOnRight?"right":"left",hidden:this.hidden}));else throw new Error("Unable to inject the component structure into the DOM");return this._loadDOM(),this._initEvents(),this._updateDisplayOptions(),this},_loadDOM:function _loadDOM(){this.$component=this.$container.find(_selectors.component),this.$infoAnswered=this.$component.find(_selectors.infoAnswered),this.$infoViewed=this.$component.find(_selectors.infoViewed),this.$infoUnanswered=this.$component.find(_selectors.infoUnanswered),this.$infoFlagged=this.$component.find(_selectors.infoFlagged),this.$filterBar=this.$component.find(_selectors.filterBar),this.$filters=this.$filterBar.find("li"),this.$tree=this.$component.find(_selectors.tree),this.$linearState=this.$component.find(_selectors.linearState)},_initEvents:function _initEvents(){var self=this;this.$component.on("click"+_selectors.component,_selectors.collapseHandle,function(){self.disabled||(self.$component.toggleClass(_cssCls.collapsed),self.$component.hasClass(_cssCls.collapsed)&&self._openSelected())}),this.$component.on("click"+_selectors.component,_selectors.infoPanelLabels,function(){if(!self.disabled){var $panel=$(this).closest(_selectors.infoPanel);self._togglePanel($panel,_selectors.infoPanel)}}),this.$tree.on("click"+_selectors.component,_selectors.partLabels,function(){if(!self.disabled){var $panel=$(this).closest(_selectors.parts),open=self._togglePanel($panel,_selectors.parts);open&&($panel.hasClass(_cssCls.active)?self._openSelected():self._openOnly($panel.find(_selectors.sections).first(),$panel))}}),this.$tree.on("click"+_selectors.component,_selectors.sectionLabels,function(){if(!self.disabled){var $panel=$(this).closest(_selectors.sections);self._togglePanel($panel,_selectors.sections)}}),this.$tree.on("click"+_selectors.component,_selectors.itemLabels,function(event){if(!self.disabled){var $item=$(this).closest(_selectors.items),$target;$item.hasClass(_cssCls.disabled)||($target=$(event.target),$target.is(_selectors.icons)&&!self.$component.hasClass(_cssCls.collapsed)?!$item.hasClass(_cssCls.unseen)&&self._mark($item):(self._select($item),self._jump($item)))}}),this.$tree.on("click"+_selectors.component,_selectors.linearStart,function(){if(!self.disabled){var $btn=$(this);$btn.hasClass(_cssCls.disabled)||($btn.addClass(_cssCls.disabled),self._jump($btn))}}),this.$filterBar.on("click"+_selectors.component,"li",function(){if(!self.disabled){var $btn=$(this),mode=$btn.data("mode");self.$filters.removeClass(_cssCls.active),self.$component.removeClass(_cssCls.collapsed),$btn.addClass(_cssCls.active),self._filter(mode)}})},_filter:function _filter(criteria){var $items=this.$tree.find(_selectors.items).removeClass(_cssCls.hidden),filter=_filterMap[criteria];filter&&$items.filter(filter).addClass(_cssCls.hidden),this._updateSectionCounters(!!filter),this.currentFilter=criteria},_select:function _select(position,open){var selected=position&&position.jquery?position:this.$tree.find("[data-position="+position+"]"),hierarchy=selected.parentsUntil(this.$tree);return open&&this._openOnly(hierarchy),this.$tree.find(_selectors.actives).removeClass(_cssCls.active),hierarchy.add(selected).addClass(_cssCls.active),selected},_openSelected:function _openSelected(){var selected=this.$tree.find(_selectors.items+_selectors.actives),hierarchy=selected.parentsUntil(this.$tree);return this._openOnly(hierarchy),selected},_openOnly:function _openOnly(opened,root){(root||this.$tree).find(_selectors.collapsible).addClass(_cssCls.collapsed),opened.removeClass(_cssCls.collapsed)},_togglePanel:function _togglePanel(panel,collapseSelector){var collapsed=panel.hasClass(_cssCls.collapsed);return collapseSelector&&this.$tree.find(collapseSelector).addClass(_cssCls.collapsed),collapsed?panel.removeClass(_cssCls.collapsed):panel.addClass(_cssCls.collapsed),collapsed},_setItemIcon:function _setItemIcon($item,icon){$item.find(_selectors.icons).attr("class",_cssCls.icon+" icon-"+icon)},_adjustItemIcon:function _adjustItemIcon($item){var icon=null,defaultIcon=_cssCls.unseen,iconCls=[_cssCls.flagged,_cssCls.answered,_cssCls.viewed];_.forEach(iconCls,function(cls){if($item.hasClass(cls))return icon=cls,!1}),this._setItemIcon($item,icon||defaultIcon)},_toggleFlag:function _toggleFlag($item,flag){$item.toggleClass(_cssCls.flagged,flag),this._adjustItemIcon($item)},_mark:function _mark($item){var itemId=$item.data("id"),itemPosition=$item.data("position"),flag=!$item.hasClass(_cssCls.flagged);this._toggleFlag($item),this.trigger("mark",[flag,itemPosition,itemId])},_jump:function _jump($item){var itemId=$item.data("id"),itemPosition=$item.data("position");this.trigger("jump",[itemPosition,itemId])},_updateSectionCounters:function _updateSectionCounters(filtered){var self=this,filter=_filterMap[filtered?"filtered":"answered"];this.$tree.find(_selectors.sections).each(function(){var $section=$(this),$items=$section.find(_selectors.items),$filtered=$items.filter(filter),total=$items.length,nb=total-$filtered.length;self._writeCount($section.find(_selectors.counters),nb,total)})},_updateDisplayOptions:function _updateDisplayOptions(){var reviewScope=_reviewScopes[this.options.reviewScope]||"test",scopeClass=_cssCls.scope[reviewScope],$root=this.$component;_.forEach(_cssCls.scope,function(cls){$root.removeClass(cls)}),scopeClass&&$root.addClass(scopeClass),$root.toggleClass(_cssCls.collapsible,this.options.canCollapse)},_updateOptions:function _updateOptions(testContext){var options=this.options;_.forEach(_optionsMap,function(optionKey,contextKey){void 0!==testContext[contextKey]&&(options[optionKey]=testContext[contextKey])})},_updateInfos:function _updateInfos(){var progression=this.progression,unanswered=+progression.total-+progression.answered;this._writeCount(this.$infoAnswered,progression.answered,progression.total),this._writeCount(this.$infoUnanswered,unanswered,progression.total),this._writeCount(this.$infoViewed,progression.viewed,progression.total),this._writeCount(this.$infoFlagged,progression.flagged,progression.total)},_writeCount:function _writeCount($place,count,total){$place.text(count+"/"+total)},_getProgressionOfTest:function _getProgressionOfTest(testContext){return{total:testContext.numberItems||0,answered:testContext.numberCompleted||0,viewed:testContext.numberPresented||0,flagged:testContext.numberFlagged||0}},_getProgressionOfTestPart:function _getProgressionOfTestPart(testContext){return{total:testContext.numberItemsPart||0,answered:testContext.numberCompletedPart||0,viewed:testContext.numberPresentedPart||0,flagged:testContext.numberFlaggedPart||0}},_getProgressionOfTestSection:function _getProgressionOfTestSection(testContext){return{total:testContext.numberItemsSection||0,answered:testContext.numberCompletedSection||0,viewed:testContext.numberPresentedSection||0,flagged:testContext.numberFlaggedSection||0}},_updateTree:function _updateTree(testContext){var navigatorMap=testContext.navigatorMap,reviewScope=this.options.reviewScope,reviewScopeSection="testSection"===reviewScope,_partsFilter=function(part){return reviewScopeSection&&part.sections&&(part.sections=_.filter(part.sections,_partsFilter)),part.active};navigatorMap?(("testPart"===reviewScope||reviewScopeSection)&&(navigatorMap=_.filter(navigatorMap,_partsFilter)),this.$filterBar.show(),this.$linearState.hide(),this.$tree.html(navigatorTreeTpl({parts:navigatorMap})),this.options.preventsUnseen&&this.$tree.find(_selectors.unseen).addClass(_cssCls.disabled)):(this.$filterBar.hide(),this.$linearState.show(),this.$tree.empty()),this._filter(this.$filters.filter(_selectors.actives).data("mode"))},setItemFlag:function(position,flag){var $item=position&&position.jquery?position:this.$tree.find("[data-position="+position+"]"),progression=this.progression;this._toggleFlag($item,flag),progression.flagged=this.$tree.find(_selectors.flagged).length,this._writeCount(this.$infoFlagged,progression.flagged,progression.total),this._filter(this.currentFilter)},updateNumberFlagged:function updateNumberFlagged(testContext,position,flag){var fields=["numberFlagged"],currentPosition=testContext.itemPosition,currentFound=!1,currentSection=null,currentPart=null,itemFound=!1,itemSection=null,itemPart=null;testContext.navigatorMap?(_.forEach(testContext.navigatorMap,function(part){if(_.forEach(part&&part.sections,function(section){if(_.forEach(section&&section.items,function(item){if(item&&(item.position===position&&(itemPart=part,itemSection=section,itemFound=!0),item.position===currentPosition&&(currentPart=part,currentSection=section,currentFound=!0),itemFound&&currentFound))return!1}),itemFound&&currentFound)return!1}),itemFound&&currentFound)return!1}),itemFound&&currentPart===itemPart&&fields.push("numberFlaggedPart"),itemFound&&currentSection===itemSection&&fields.push("numberFlaggedSection")):(fields.push("numberFlaggedPart"),fields.push("numberFlaggedSection")),_.forEach(fields,function(field){field in testContext&&(testContext[field]+=flag?1:-1)})},getProgression:function getProgression(testContext){var reviewScope=_reviewScopes[this.options.reviewScope]||"test",progressInfoMethod="_getProgressionOf"+capitalize(reviewScope),getProgression=this[progressInfoMethod]||this._getProgressionOfTest,progression=getProgression&&getProgression(testContext)||{};return progression},update:function(testContext){return this.progression=this.getProgression(testContext),this._updateOptions(testContext),this._updateInfos(testContext),this._updateTree(testContext),this._updateDisplayOptions(testContext),this},disable:function(){return this.disabled=!0,this.$component.addClass(_cssCls.disabled),this},enable:function(){return this.disabled=!1,this.$component.removeClass(_cssCls.disabled),this},hide:function(){return this.disabled=!0,this.hidden=!0,this.$component.addClass(_cssCls.hidden),this},show:function(){return this.disabled=!1,this.hidden=!1,this.$component.removeClass(_cssCls.hidden),this},toggle:function(show){return void 0===show&&(show=this.hidden),show?this.show():this.hide(),this},on:function(){var dom=this.$component;return dom&&dom.on.apply(dom,arguments),this},off:function(){var dom=this.$component;return dom&&dom.off.apply(dom,arguments),this},trigger:function(eventName,extraParameters){var dom=this.$component;return void 0===extraParameters&&(extraParameters=[]),_.isArray(extraParameters)||(extraParameters=[extraParameters]),extraParameters.push(this),dom&&dom.trigger(eventName,extraParameters),this}};return function testReviewFactory(element,options){var component=_.clone(testReview,!0);return component.init(element,options)}}),define("taoQtiTest/testRunner/progressUpdater",["jquery","lodash","i18n","ui/progressbar"],function($,_,__){'use strict';var _Mathmax3=Math.max,_Mathfloor2=Math.floor,progressUpdaters={init:function init(progressBar,progressLabel){return this.progressBar=$(progressBar).progressbar(),this.progressLabel=$(progressLabel),this},write:function write(label,ratio){return this.progressLabel.text(label),this.progressBar.progressbar("value",ratio),this},update:function update(testContext){var progressIndicator=testContext.progressIndicator||"percentage",getProgression=this[progressIndicator+"Progression"]||this.percentageProgression,progression=getProgression&&getProgression(testContext)||{};return this.write(progression.label,progression.ratio),progression},percentageProgression:function percentageProgression(testContext){var total=_Mathmax3(1,testContext.numberItems),ratio=_Mathfloor2(100*(testContext.numberCompleted/total));return{ratio:ratio,label:ratio+"%"}},positionProgression:function positionProgression(testContext){var progressScope=testContext.progressIndicatorScope,progressScopeCounter={test:{total:"numberItems",position:"itemPosition"},testPart:{total:"numberItemsPart",position:"itemPositionPart"},testSection:{total:"numberItemsSection",position:"itemPositionSection"}},counter=progressScopeCounter[progressScope]||progressScopeCounter.test,total=_Mathmax3(1,testContext[counter.total]),position=testContext[counter.position]+1;return{ratio:_Mathfloor2(100*(position/total)),label:__("Item %d of %d",position,total)}}};return function progressUpdaterFactory(progressBar,progressLabel){var updater=_.clone(progressUpdaters,!0);return updater.init(progressBar,progressLabel)}}),define("taoQtiTest/testRunner/testMetaData",["lodash"],function(_){'use strict';return function(options){function setLocalStorageData(val){var currentKey=testMetaData.getLocalStorageKey();try{window.localStorage.setItem(currentKey,val)}catch(domException){if("QuotaExceededError"===domException.name||"NS_ERROR_DOM_QUOTA_REACHED"===domException.name){for(var removed=0,i=window.localStorage.length,key;i--;)key=localStorage.key(i),/^testMetaData_.*/.test(key)&&key!==currentKey&&(window.localStorage.removeItem(key),removed++);if(removed)setLocalStorageData(val);else throw domException}else throw domException}}function getLocalStorageData(){var data=window.localStorage.getItem(testMetaData.getLocalStorageKey()),result=JSON.parse(data)||{};return result}var _data={},_testServiceCallId;if(!options||void 0===options.testServiceCallId)throw new TypeError("testServiceCallId option is required");var testMetaData={SECTION_EXIT_CODE:{COMPLETED_NORMALLY:700,QUIT:701,COMPLETE_TIMEOUT:703,TIMEOUT:704,FORCE_QUIT:705,IN_PROGRESS:706,ERROR:300},TEST_EXIT_CODE:{COMPLETE:"C",TERMINATED:"T",INCOMPLETE:"IC",INCOMPLETE_QUIT:"IQ",INACTIVE:"IA",CANDIDATE_DISAGREED_WITH_NDA:"DA"},getTestServiceCallId:function(){return _testServiceCallId},setTestServiceCallId:function(value){_testServiceCallId=value},setData:function(data){_data=data,setLocalStorageData(JSON.stringify(_data))},addData:function(data,overwrite){data=_.clone(data),void 0===overwrite&&(overwrite=!1),overwrite?_.merge(_data,data):_data=_.merge(data,_data),setLocalStorageData(JSON.stringify(_data))},getData:function(){return _.clone(_data)},clearData:function(){_data={},window.localStorage.removeItem(testMetaData.getLocalStorageKey())},getLocalStorageKey:function(){return"testMetaData_"+_testServiceCallId}};return function(){_testServiceCallId=options.testServiceCallId,testMetaData.setData(getLocalStorageData())}(),testMetaData}}),define("taoQtiTest/controller/runtime/testRunner",["jquery","lodash","i18n","module","taoQtiTest/testRunner/actionBarTools","taoQtiTest/testRunner/testReview","taoQtiTest/testRunner/progressUpdater","taoQtiTest/testRunner/testMetaData","serviceApi/ServiceApi","serviceApi/UserInfoService","serviceApi/StateStorage","iframeNotifier","mathJax","ui/feedback","ui/deleter","moment","ui/modal","ui/progressbar"],function($,_,__,module,actionBarTools,testReview,progressUpdater,testMetaDataFactory,ServiceApi,UserInfoService,StateStorage,iframeNotifier,MathJax,feedback,deleter,moment,modal){'use strict';var _Mathround2=Math.round,_Mathmax4=Math.max,_Mathfloor3=Math.floor,timerIds=[],currentTimes=[],lastDates=[],timeDiffs=[],waitingTime=0,$doc=$(document),optionNextSection="x-tao-option-nextSection",optionNextSectionWarning="x-tao-option-nextSectionWarning",optionReviewScreen="x-tao-option-reviewScreen",optionEndTestWarning="x-tao-option-endTestWarning",optionNoExitTimedSectionWarning="x-tao-option-noExitTimedSectionWarning",TestRunner={TEST_STATE_INITIAL:0,TEST_STATE_INTERACTING:1,TEST_STATE_MODAL_FEEDBACK:2,TEST_STATE_SUSPENDED:3,TEST_STATE_CLOSED:4,TEST_NAVIGATION_LINEAR:0,TEST_NAVIGATION_NONLINEAR:1,TEST_ITEM_STATE_INTERACTING:1,beforeTransition:function beforeTransition(callback){iframeNotifier.parent("loading"),this.disableGui(),$controls.$itemFrame.hide(),$controls.$rubricBlocks.hide(),$controls.$timerWrapper.hide(),"function"==typeof callback&&setTimeout(callback,0)},afterTransition:function afterTransition(){this.enableGui(),iframeNotifier.parent("unloading"),testMetaData.addData({ITEM:{ITEM_START_TIME_CLIENT:Date.now()/1e3}})},jump:function jump(position){var self=this,params={position:position};this.disableGui(),this.isJumpOutOfSection(position)&&this.isCurrentItemActive()&&this.isTimedSection()?this.exitTimedSection("jump",params):this.killItemSession(function(){self.actionCall("jump",params)})},keepItemTimed:function keepItemTimed(duration){if(duration){var self=this;self.actionCall("keepItemTimed",{duration:duration})}},markForReview:function markForReview(flag,position){var self=this;iframeNotifier.parent("loading"),this.disableGui(),$.ajax({url:self.testContext.markForReviewUrl,cache:!1,async:!0,type:"POST",dataType:"json",data:{flag:flag,position:position},success:function success(){self.testReview&&(self.testReview.setItemFlag(position,flag),self.testReview.updateNumberFlagged(self.testContext,position,flag),self.testContext.itemPosition===position&&(self.testContext.itemFlagged=flag),self.updateTools(self.testContext)),self.enableGui(),iframeNotifier.parent("unloading")}})},moveForward:function moveForward(){function doExitSection(){self.isTimedSection()&&!self.testContext.isTimeout?self.exitTimedSection("moveForward"):self.exitSection("moveForward")}var self=this;this.disableGui(),0==this.testContext.numberItemsSection-this.testContext.itemPositionSection-1&&this.isCurrentItemActive()?this.shouldDisplayEndTestWarning()?(this.displayEndTestWarning(doExitSection),this.enableGui()):doExitSection():this.killItemSession(function(){self.actionCall("moveForward")})},shouldDisplayEndTestWarning:function shouldDisplayEndTestWarning(){return!0===this.testContext.isLast&&this.hasOption("x-tao-option-endTestWarning")},displayEndTestWarning:function displayEndTestWarning(nextAction){var options={confirmLabel:__("OK"),cancelLabel:__("Cancel"),showItemCount:!1};this.displayExitMessage(__("You are about to submit the test. You will not be able to access this test once submitted. Click OK to continue and submit the test."),nextAction,options)},moveBackward:function moveBackward(){var self=this;this.disableGui(),0==this.testContext.itemPositionSection&&this.isCurrentItemActive()&&this.isTimedSection()?this.exitTimedSection("moveBackward"):this.killItemSession(function(){self.actionCall("moveBackward")})},isJumpOutOfSection:function isJumpOutOfSection(jumpPosition){var items=this.getCurrentSectionItems(),isJumpToOtherSection=!0,isValidPosition=0<=jumpPosition&&jumpPosition<this.testContext.numberItems;if(isValidPosition){for(var i in items)if(items.hasOwnProperty(i)&&items[i].position==jumpPosition){isJumpToOtherSection=!1;break}}else isJumpToOtherSection=!1;return isJumpToOtherSection},exitSection:function exitSection(action,params,exitCode){var self=this;testMetaData.addData({SECTION:{SECTION_EXIT_CODE:exitCode||testMetaData.SECTION_EXIT_CODE.COMPLETED_NORMALLY}}),self.killItemSession(function(){self.actionCall(action,params)})},exitTimedSection:function exitTimedSection(action,params){var self=this,qtiRunner=this.getQtiRunner(),doExitTimedSection=function(){qtiRunner&&qtiRunner.updateItemApi(),self.exitSection(action,params)};"moveForward"===action&&this.shouldDisplayEndTestWarning()||this.hasOption("x-tao-option-noExitTimedSectionWarning")||this.testContext.keepTimerUpToTimeout?doExitTimedSection():this.displayExitMessage(__("After you complete the section it would be impossible to return to this section to make changes. Are you sure you want to end the section?"),doExitTimedSection,{scope:"testSection"}),this.enableGui()},nextSection:function nextSection(){var self=this,qtiRunner=this.getQtiRunner(),doNextSection=function(){self.exitSection("nextSection",null,testMetaData.SECTION_EXIT_CODE.QUIT)};qtiRunner&&qtiRunner.updateItemApi(),this.hasOption("x-tao-option-nextSectionWarning")?this.displayExitMessage(__("After you complete the section it would be impossible to return to this section to make changes. Are you sure you want to end the section?"),doNextSection,{scope:"testSection"}):doNextSection(),this.enableGui()},getProgression:function getProgression(scope){var scopeSuffix=scope&&{test:"",testPart:"Part",testSection:"Section"}[scope]||"";return{total:this.testContext["numberItems"+scopeSuffix]||0,answered:this.testContext["numberCompleted"+scopeSuffix]||0,viewed:this.testContext["numberPresented"+scopeSuffix]||0,flagged:this.testContext["numberFlagged"+scopeSuffix]||0}},displayExitMessage:function displayExitMessage(message,action,options){var self=this,options=options||{},scope=options.scope,confirmLabel=options.confirmLabel||__("Yes"),cancelLabel=options.cancelLabel||__("No"),showItemCount="undefined"==typeof options.showItemCount||options.showItemCount,$confirmBox=$(".exit-modal-feedback"),progression=this.getProgression(scope),unansweredCount=progression.total-progression.answered,flaggedCount=progression.flagged;return showItemCount&&(unansweredCount&&this.isCurrentItemAnswered()&&unansweredCount--,flaggedCount&&unansweredCount?message=__("You have %s unanswered question(s) and have %s item(s) marked for review.",unansweredCount.toString(),flaggedCount.toString())+" "+message:(flaggedCount&&(message=__("You have %s item(s) marked for review.",flaggedCount.toString())+" "+message),unansweredCount&&(message=__("You have %s unanswered question(s).",unansweredCount.toString())+" "+message))),$confirmBox.find(".message").html(message),$confirmBox.find(".js-exit-confirm").html(confirmLabel),$confirmBox.find(".js-exit-cancel").html(cancelLabel),$confirmBox.modal({width:500}),$confirmBox.find(".js-exit-cancel, .modal-close").off("click").on("click",function(){$confirmBox.modal("close")}),$confirmBox.find(".js-exit-confirm").off("click").on("click",function(){$confirmBox.modal("close"),_.isFunction(action)&&action.call(self)}),$confirmBox},killItemSession:function killItemSession(callback){testMetaData.addData({ITEM:{ITEM_END_TIME_CLIENT:Date.now()/1e3,ITEM_TIMEZONE:moment().utcOffset(moment().utcOffset()).format("Z")}}),"function"!=typeof callback&&(callback=_.noop),this.itemServiceApi.kill(callback)},isCurrentItemActive:function isCurrentItemActive(){return 4!=this.testContext.itemSessionState},isCurrentItemAnswered:function isCurrentItemAnswered(){var answered=!1;return _.each(this.getCurrentItemState(),function(state){if(state&&_.isObject(state.response)&&null!==state.response.base)return answered=!0,!1}),answered},hasOption:function hasOption(option){return 0<=_.indexOf(this.testContext.categories,option)},getQtiRunner:function getQtiRunner(){var itemFrame=document.getElementById("qti-item"),itemWindow=itemFrame&&itemFrame.contentWindow,itemContainerFrame=itemWindow&&itemWindow.document.getElementById("item-container"),itemContainerWindow=itemContainerFrame&&itemContainerFrame.contentWindow;return itemContainerWindow&&itemContainerWindow.qtiRunner},isTimedSection:function(){var timeConstraints=this.testContext.timeConstraints,isTimedSection=!1;for(var index in timeConstraints)timeConstraints.hasOwnProperty(index)&&"assessmentSection"===timeConstraints[index].qtiClassName&&(isTimedSection=!0);return isTimedSection},getCurrentSectionItems:function getCurrentSectionItems(){var partId=this.testContext.testPartId,navMap=this.testContext.navigatorMap,sectionItems;for(var partIndex in navMap)if(navMap.hasOwnProperty(partIndex)&&navMap[partIndex].id===partId)for(var sectionIndex in navMap[partIndex].sections)if(navMap[partIndex].sections.hasOwnProperty(sectionIndex)&&!0===navMap[partIndex].sections[sectionIndex].active){sectionItems=navMap[partIndex].sections[sectionIndex].items;break}return sectionItems},skip:function skip(){var self=this,doSkip=function(){self.disableGui(),self.actionCall("skip")};this.shouldDisplayEndTestWarning()?this.displayEndTestWarning(doSkip):doSkip()},timeout:function timeout(){var self=this;this.disableGui(),this.testContext.isTimeout=!0,this.updateTimer(),this.killItemSession(function(){var confirmBox=$(".timeout-modal-feedback"),testContext=self.testContext,confirmBtn=confirmBox.find(".js-timeout-confirm, .modal-close");testContext.numberCompletedSection===testContext.numberItemsSection?testMetaData.addData({SECTION:{SECTION_EXIT_CODE:testMetaData.SECTION_EXIT_CODE.COMPLETE_TIMEOUT}}):testMetaData.addData({SECTION:{SECTION_EXIT_CODE:testMetaData.SECTION_EXIT_CODE.TIMEOUT}}),self.enableGui(),confirmBox.modal({width:500}),confirmBtn.off("click").on("click",function(){confirmBox.modal("close"),self.actionCall("timeout")})})},setTestContext:function setTestContext(testContext){this.testContext=testContext,this.itemServiceApi=eval(testContext.itemServiceApiCall),this.itemServiceApi.setHasBeenPaused(testContext.hasBeenPaused)},initMetadata:function initMetadata(){testMetaData=testMetaDataFactory({testServiceCallId:this.itemServiceApi.serviceCallId})},getSessionStateService:function getSessionStateService(){return sessionStateService||(sessionStateService=this.testContext.sessionStateService({accuracy:1e3})),sessionStateService},update:function update(testContext){var self=this;$controls.$itemFrame.remove();var $runner=$("#runner");$runner.css("height","auto"),this.getSessionStateService().restart(),this.setTestContext(testContext),this.updateContext(),this.updateProgress(),this.updateNavigation(),this.updateTestReview(),this.updateInformation(),this.updateRubrics(),this.updateTools(testContext),this.updateTimer(),this.updateExitButton(),this.resetCurrentItemState(),this.initMetadata(),$controls.$itemFrame=$("<iframe id=\"qti-item\" frameborder=\"0\" scrollbars=\"no\"/>"),$controls.$itemFrame.appendTo($controls.$contentBox),this.testContext.itemSessionState===this.TEST_ITEM_STATE_INTERACTING&&!1===self.testContext.isTimeout?($doc.off(".testRunner").on("serviceloaded.testRunner",function(){self.afterTransition(),self.adjustFrame(),$controls.$itemFrame.css({visibility:"visible"})}),this.itemServiceApi.loadInto($controls.$itemFrame[0],function(){})):self.afterTransition()},updateInformation:function updateInformation(){!0===this.testContext.isTimeout?feedback().error(__("Time limit reached for item \"%s\".",this.testContext.itemIdentifier)):this.testContext.itemSessionState!==this.TEST_ITEM_STATE_INTERACTING&&feedback().error(__("No more attempts allowed for item \"%s\".",this.testContext.itemIdentifier))},updateTools:function(testContext){var showSkip=!1,showSkipEnd=!1,showNextSection=!!testContext.nextSection&&(this.hasOption("x-tao-option-nextSection")||this.hasOption("x-tao-option-nextSectionWarning"));!0===this.testContext.allowSkipping&&(!1===this.testContext.isLast?showSkip=!0:showSkipEnd=!0),$controls.$skip.toggle(showSkip),$controls.$skipEnd.toggle(showSkipEnd),$controls.$nextSection.toggle(showNextSection),actionBarTools.render(".tools-box-list",testContext,TestRunner)},createTimer:function createTimer(cst){var $timer=$("<div>",{class:"qti-timer qti-timer__type-"+cst.qtiClassName}),$label=$("<div>",{class:"qti-timer_label truncate",text:cst.label}),$time=$("<div>",{class:"qti-timer_time",text:this.formatTime(cst.seconds)});return $timer.append($label),$timer.append($time),$timer},updateTimer:function updateTimer(){var self=this,hasTimers;$controls.$timerWrapper.empty();for(var i=0;i<timerIds.length;i++)clearTimeout(timerIds[i]);if(timerIds=[],currentTimes=[],lastDates=[],timeDiffs=[],!1===self.testContext.isTimeout&&self.testContext.itemSessionState===self.TEST_ITEM_STATE_INTERACTING&&(hasTimers=!!this.testContext.timeConstraints.length,$controls.$topActionBar.toggleClass("has-timers",hasTimers),hasTimers)){for(i=0;i<this.testContext.timeConstraints.length;i++){var cst=this.testContext.timeConstraints[i];if(!1===cst.allowLateSubmission){if($controls.$timerWrapper.append(self.createTimer(cst)),currentTimes[i]=cst.seconds,lastDates[i]=new Date,timeDiffs[i]=0,timerIndex=i,self.testContext.timerWarning&&self.testContext.timerWarning[cst.qtiClassName]){cst.warnings={},_(self.testContext.timerWarning[cst.qtiClassName]).forEach(function(value,key){_.contains(["info","warning","danger"],value)&&(cst.warnings[key]={type:value,showed:cst.seconds<=key,point:parseInt(key,10)})});var closestPreviousWarning=_.find(cst.warnings,{showed:!0});!_.isEmpty(closestPreviousWarning)&&closestPreviousWarning.point&&(cst.warnings[closestPreviousWarning.point].showed=!1)}(function(timerIndex,cst){timerIds[timerIndex]=setInterval(function(){if(timeDiffs[timerIndex]+=new Date().getTime()-lastDates[timerIndex].getTime(),1e3<=timeDiffs[timerIndex]){var seconds=timeDiffs[timerIndex]/1e3;currentTimes[timerIndex]-=seconds,timeDiffs[timerIndex]=0}$timers.eq(timerIndex).html(self.formatTime(_Mathround2(currentTimes[timerIndex]))),0>=currentTimes[timerIndex]?(currentTimes[timerIndex]=0,clearInterval(timerIds[timerIndex]),$controls.$itemFrame.hide(),self.timeout()):lastDates[timerIndex]=new Date;var warning=_.findLast(cst.warnings,{showed:!1});!_.isEmpty(warning)&&_.isFinite(warning.point)&&currentTimes[timerIndex]<=warning.point&&self.timeWarning(cst,warning)},1e3)})(timerIndex,cst)}}$timers=$controls.$timerWrapper.find(".qti-timer .qti-timer_time"),$controls.$timerWrapper.show()}},timeWarning:function timeWarning(cst,warning){var message="",$timer=$controls.$timerWrapper.find(".qti-timer__type-"+cst.qtiClassName),$time=$timer.find(".qti-timer_time"),remaining;switch($time.removeClass("txt-info txt-warning txt-danger").addClass("txt-"+warning.type),remaining=moment.duration(warning.point,"seconds").humanize(),cst.qtiClassName){case"assessmentItemRef":message=__("Warning \u2013 You have %s remaining to complete this item.",remaining);break;case"assessmentSection":message=__("Warning \u2013 You have %s remaining to complete this section.",remaining);break;case"testPart":message=__("Warning \u2013 You have %s remaining to complete this test part.",remaining);break;case"assessmentTest":message=__("Warning \u2013 You have %s remaining to complete the test.",remaining);}feedback()[warning.type](message),cst.warnings[warning.point].showed=!0},updateRubrics:function updateRubrics(){if($controls.$rubricBlocks.remove(),0<this.testContext.rubrics.length){$controls.$rubricBlocks=$("<div id=\"qti-rubrics\"/>");for(var i=0;i<this.testContext.rubrics.length;i++)$controls.$rubricBlocks.append(this.testContext.rubrics[i]);$controls.$rubricBlocks.find("a").bind("click keypress",function(){return window.open(this.href),!1}),$controls.$rubricBlocks.prependTo($controls.$contentBox),MathJax&&MathJax.Hub.Queue(["Typeset",MathJax.Hub],$controls.$rubricBlocks[0])}},updateNavigation:function updateNavigation(){$controls.$exit.show(),!0===this.testContext.isLast?($controls.$moveForward.hide(),$controls.$moveEnd.show()):($controls.$moveForward.show(),$controls.$moveEnd.hide()),this.testContext.navigationMode===this.TEST_NAVIGATION_LINEAR?$controls.$moveBackward.hide():($controls.$controls.show(),!0===this.testContext.canMoveBackward?$controls.$moveBackward.show():$controls.$moveBackward.hide())},updateTestReview:function updateTestReview(){var considerProgress=!0===this.testContext.considerProgress;this.testReview&&(this.testReview.toggle(considerProgress&&this.hasOption("x-tao-option-reviewScreen")),this.testReview.update(this.testContext))},updateProgress:function updateProgress(){var considerProgress=!0===this.testContext.considerProgress;$controls.$progressBox.css("visibility",considerProgress?"visible":"hidden"),considerProgress&&this.progressUpdater.update(this.testContext)},updateContext:function updateContext(){$controls.$title.text(this.testContext.testTitle);var sectionText=!0===this.testContext.isDeepestSectionVisible?" - "+this.testContext.sectionTitle:"";$controls.$position.text(sectionText),$controls.$titleGroup.show()},updateExitButton:function updateExitButton(){$controls.$logout.toggleClass("hidden",!this.testContext.logoutButton),$controls.$exit.toggleClass("hidden",!this.testContext.exitButton)},adjustFrame:function adjustFrame(){var rubricHeight=$controls.$rubricBlocks.outerHeight(!0)||0,finalHeight=$(window).innerHeight()-$controls.$topActionBar.outerHeight()-$controls.$bottomActionBar.outerHeight(),itemFrame=$controls.$itemFrame.get(0),frameContentHeight;$controls.$contentBox.height(finalHeight),$controls.$sideBars.length&&$controls.$sideBars.each(function(){var $sideBar=$(this);$sideBar.height(finalHeight-$sideBar.outerHeight()+$sideBar.height())}),itemFrame&&itemFrame.contentWindow&&(frameContentHeight=$controls.$itemFrame.contents().outerHeight(!0),frameContentHeight<finalHeight&&(rubricHeight?frameContentHeight=_Mathmax4(frameContentHeight,finalHeight-rubricHeight):frameContentHeight=finalHeight),itemFrame.contentWindow.$&&itemFrame.contentWindow.$("body").trigger("setheight",[frameContentHeight]),$controls.$itemFrame.height(frameContentHeight))},disableGui:function disableGui(){$controls.$naviButtons.addClass("disabled"),this.testReview&&this.testReview.disable()},enableGui:function enableGui(){$controls.$naviButtons.removeClass("disabled"),this.testReview&&this.testReview.enable()},hideGui:function hideGui(){$controls.$naviButtons.addClass("hidden"),this.testReview&&this.testReview.hide()},showGui:function showGui(){$controls.$naviButtons.removeClass("hidden"),this.testReview&&this.testReview.show()},formatTime:function formatTime(totalSeconds){var sec_num=totalSeconds,hours=_Mathfloor3(sec_num/3600),minutes=_Mathfloor3((sec_num-3600*hours)/60),seconds=_Mathfloor3(sec_num-3600*hours-60*minutes);10>hours&&(hours="0"+hours),10>minutes&&(minutes="0"+minutes),10>seconds&&(seconds="0"+seconds);var time=hours+":"+minutes+":"+seconds;return time},processError:function(error){var self=this;this.hideGui(),this.beforeTransition(),iframeNotifier.parent("messagealert",{message:error.message,action:function action(){testMetaData&&testMetaData.clearData(),error.state===self.TEST_STATE_CLOSED?self.serviceApi.finish():self.serviceApi.exit()}})},actionCall:function actionCall(action,extraParams){var self=this,params={metaData:testMetaData?testMetaData.getData():{}};extraParams&&(params=_.assign(params,extraParams)),this.beforeTransition(function(){$.ajax({url:self.testContext[action+"Url"],cache:!1,data:params,async:!0,dataType:"json",success:function success(testContext){testMetaData.clearData(),testContext.success?testContext.state===self.TEST_STATE_CLOSED?self.serviceApi.finish():self.update(testContext):self.processError(testContext)}})})},exit:function exit(){var self=this;testMetaData.addData({TEST:{TEST_EXIT_CODE:testMetaData.TEST_EXIT_CODE.INCOMPLETE},SECTION:{SECTION_EXIT_CODE:testMetaData.SECTION_EXIT_CODE.QUIT}}),this.displayExitMessage(__("Are you sure you want to end the test?"),function(){self.killItemSession(function(){self.actionCall("endTestSession"),testMetaData.clearData()})},{scope:this.testReview?this.testContext.reviewScope:null})},setCurrentItemState:function setCurrentItemState(id,state){id&&(this.currentItemState[id]=state)},resetCurrentItemState:function resetCurrentItemState(){this.currentItemState={}},getCurrentItemState:function getCurrentItemState(){return this.currentItemState}},config=module.config(),$timers,$controls,timerIndex,testMetaData,sessionStateService;return config&&actionBarTools.register(config.qtiTools),{start:function start(testContext){$controls={$moveForward:$("[data-control=\"move-forward\"]"),$moveEnd:$("[data-control=\"move-end\"]"),$moveBackward:$("[data-control=\"move-backward\"]"),$nextSection:$("[data-control=\"next-section\"]"),$skip:$("[data-control=\"skip\"]"),$skipEnd:$("[data-control=\"skip-end\"]"),$exit:$(window.parent.document).find("[data-control=\"exit\"]"),$logout:$(window.parent.document).find("[data-control=\"logout\"]"),$naviButtons:$(".bottom-action-bar .action"),$skipButtons:$(".navi-box .skip"),$forwardButtons:$(".navi-box .forward"),$progressBar:$("[data-control=\"progress-bar\"]"),$progressLabel:$("[data-control=\"progress-label\"]"),$progressBox:$(".progress-box"),$title:$("[data-control=\"qti-test-title\"]"),$position:$("[data-control=\"qti-test-position\"]"),$timerWrapper:$("[data-control=\"qti-timers\"]"),$contentPanel:$(".content-panel"),$controls:$(".qti-controls"),$itemFrame:$("#qti-item"),$rubricBlocks:$("#qti-rubrics"),$contentBox:$("#qti-content"),$sideBars:$(".test-sidebar"),$topActionBar:$(".horizontal-action-bar.top-action-bar"),$bottomActionBar:$(".horizontal-action-bar.bottom-action-bar")},$controls.$titleGroup=$controls.$title.add($controls.$position),$doc.ajaxError(function(event,jqxhr){403===jqxhr.status&&iframeNotifier.parent("serviceforbidden")}),window.onServiceApiReady=function(serviceApi){TestRunner.serviceApi=serviceApi,testContext.success?testContext.state===TestRunner.TEST_STATE_CLOSED?(serviceApi.finish(),testMetaData.clearData()):TestRunner.getSessionStateService().getDuration()?(TestRunner.setTestContext(testContext),TestRunner.initMetadata(),TestRunner.keepItemTimed(TestRunner.getSessionStateService().getDuration()),TestRunner.getSessionStateService().restart()):TestRunner.update(testContext):TestRunner.processError(testContext)},TestRunner.beforeTransition(),TestRunner.testContext=testContext,$controls.$skipButtons.click(function(){$(this).hasClass("disabled")||TestRunner.skip()}),$controls.$forwardButtons.click(function(){$(this).hasClass("disabled")||TestRunner.moveForward()}),$controls.$moveBackward.click(function(){$(this).hasClass("disabled")||TestRunner.moveBackward()}),$controls.$nextSection.click(function(){$(this).hasClass("disabled")||TestRunner.nextSection()}),$controls.$exit.click(function(e){e.preventDefault(),TestRunner.exit()}),$(window).on("resize",_.throttle(function(){TestRunner.adjustFrame(),$controls.$titleGroup.show()},250)),$doc.on("loading",function(){iframeNotifier.parent("loading")}),$doc.on("unloading",function(){iframeNotifier.parent("unloading")}),TestRunner.progressUpdater=progressUpdater($controls.$progressBar,$controls.$progressLabel),testContext.reviewScreen&&(TestRunner.testReview=testReview($controls.$contentPanel,{region:testContext.reviewRegion||"left",hidden:!TestRunner.hasOption("x-tao-option-reviewScreen"),reviewScope:testContext.reviewScope,preventsUnseen:!!testContext.reviewPreventsUnseen,canCollapse:!!testContext.reviewCanCollapse}).on("jump",function(event,position){TestRunner.jump(position)}).on("mark",function(event,flag,position){TestRunner.markForReview(flag,position)}),$controls.$sideBars=$(".test-sidebar")),TestRunner.updateProgress(),TestRunner.updateTestReview(),iframeNotifier.parent("serviceready"),TestRunner.adjustFrame(),$controls.$topActionBar.add($controls.$bottomActionBar).animate({opacity:1},600),deleter($("#feedback-box")),modal($("body")),$(document).on("responsechange",function(e,responseId,response){responseId&&response&&TestRunner.setCurrentItemState(responseId,{response:response})}).on("stateready",function(e,id,state){id&&state&&TestRunner.setCurrentItemState(id,state)}).on("heightchange",function(e,height){$controls.$itemFrame.height(height)})}}}),function(c){var d=document,s=d.createElement("style");s.type="text/css",d.getElementsByTagName("head")[0].appendChild(s),s.styleSheet?s.styleSheet.cssText=c:s.appendChild(d.createTextNode(c))}("/* BASICS */\n\n.CodeMirror {\n  /* Set height, width, borders, and global font properties here */\n  font-family: monospace;\n  height: 300px;\n  color: black;\n  direction: ltr;\n}\n\n/* PADDING */\n\n.CodeMirror-lines {\n  padding: 4px 0; /* Vertical padding around content */\n}\n.CodeMirror pre.CodeMirror-line,\n.CodeMirror pre.CodeMirror-line-like {\n  padding: 0 4px; /* Horizontal padding of content */\n}\n\n.CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {\n  background-color: white; /* The little square between H and V scrollbars */\n}\n\n/* GUTTER */\n\n.CodeMirror-gutters {\n  border-right: 1px solid #ddd;\n  background-color: #f7f7f7;\n  white-space: nowrap;\n}\n.CodeMirror-linenumbers {}\n.CodeMirror-linenumber {\n  padding: 0 3px 0 5px;\n  min-width: 20px;\n  text-align: right;\n  color: #999;\n  white-space: nowrap;\n}\n\n.CodeMirror-guttermarker { color: black; }\n.CodeMirror-guttermarker-subtle { color: #999; }\n\n/* CURSOR */\n\n.CodeMirror-cursor {\n  border-left: 1px solid black;\n  border-right: none;\n  width: 0;\n}\n/* Shown when moving in bi-directional text */\n.CodeMirror div.CodeMirror-secondarycursor {\n  border-left: 1px solid silver;\n}\n.cm-fat-cursor .CodeMirror-cursor {\n  width: auto;\n  border: 0 !important;\n  background: #7e7;\n}\n.cm-fat-cursor div.CodeMirror-cursors {\n  z-index: 1;\n}\n.cm-fat-cursor-mark {\n  background-color: rgba(20, 255, 20, 0.5);\n  -webkit-animation: blink 1.06s steps(1) infinite;\n  -moz-animation: blink 1.06s steps(1) infinite;\n  animation: blink 1.06s steps(1) infinite;\n}\n.cm-animate-fat-cursor {\n  width: auto;\n  border: 0;\n  -webkit-animation: blink 1.06s steps(1) infinite;\n  -moz-animation: blink 1.06s steps(1) infinite;\n  animation: blink 1.06s steps(1) infinite;\n  background-color: #7e7;\n}\n@-moz-keyframes blink {\n  0% {}\n  50% { background-color: transparent; }\n  100% {}\n}\n@-webkit-keyframes blink {\n  0% {}\n  50% { background-color: transparent; }\n  100% {}\n}\n@keyframes blink {\n  0% {}\n  50% { background-color: transparent; }\n  100% {}\n}\n\n/* Can style cursor different in overwrite (non-insert) mode */\n.CodeMirror-overwrite .CodeMirror-cursor {}\n\n.cm-tab { display: inline-block; text-decoration: inherit; }\n\n.CodeMirror-rulers {\n  position: absolute;\n  left: 0; right: 0; top: -50px; bottom: 0;\n  overflow: hidden;\n}\n.CodeMirror-ruler {\n  border-left: 1px solid #ccc;\n  top: 0; bottom: 0;\n  position: absolute;\n}\n\n/* DEFAULT THEME */\n\n.cm-s-default .cm-header {color: blue;}\n.cm-s-default .cm-quote {color: #090;}\n.cm-negative {color: #d44;}\n.cm-positive {color: #292;}\n.cm-header, .cm-strong {font-weight: bold;}\n.cm-em {font-style: italic;}\n.cm-link {text-decoration: underline;}\n.cm-strikethrough {text-decoration: line-through;}\n\n.cm-s-default .cm-keyword {color: #708;}\n.cm-s-default .cm-atom {color: #219;}\n.cm-s-default .cm-number {color: #164;}\n.cm-s-default .cm-def {color: #00f;}\n.cm-s-default .cm-variable,\n.cm-s-default .cm-punctuation,\n.cm-s-default .cm-property,\n.cm-s-default .cm-operator {}\n.cm-s-default .cm-variable-2 {color: #05a;}\n.cm-s-default .cm-variable-3, .cm-s-default .cm-type {color: #085;}\n.cm-s-default .cm-comment {color: #a50;}\n.cm-s-default .cm-string {color: #a11;}\n.cm-s-default .cm-string-2 {color: #f50;}\n.cm-s-default .cm-meta {color: #555;}\n.cm-s-default .cm-qualifier {color: #555;}\n.cm-s-default .cm-builtin {color: #30a;}\n.cm-s-default .cm-bracket {color: #997;}\n.cm-s-default .cm-tag {color: #170;}\n.cm-s-default .cm-attribute {color: #00c;}\n.cm-s-default .cm-hr {color: #999;}\n.cm-s-default .cm-link {color: #00c;}\n\n.cm-s-default .cm-error {color: #f00;}\n.cm-invalidchar {color: #f00;}\n\n.CodeMirror-composing { border-bottom: 2px solid; }\n\n/* Default styles for common addons */\n\ndiv.CodeMirror span.CodeMirror-matchingbracket {color: #0b0;}\ndiv.CodeMirror span.CodeMirror-nonmatchingbracket {color: #a22;}\n.CodeMirror-matchingtag { background: rgba(255, 150, 0, .3); }\n.CodeMirror-activeline-background {background: #e8f2ff;}\n\n/* STOP */\n\n/* The rest of this file contains styles related to the mechanics of\n   the editor. You probably shouldn't touch them. */\n\n.CodeMirror {\n  position: relative;\n  overflow: hidden;\n  background: white;\n}\n\n.CodeMirror-scroll {\n  overflow: scroll !important; /* Things will break if this is overridden */\n  /* 50px is the magic margin used to hide the element's real scrollbars */\n  /* See overflow: hidden in .CodeMirror */\n  margin-bottom: -50px; margin-right: -50px;\n  padding-bottom: 50px;\n  height: 100%;\n  outline: none; /* Prevent dragging from highlighting the element */\n  position: relative;\n}\n.CodeMirror-sizer {\n  position: relative;\n  border-right: 50px solid transparent;\n}\n\n/* The fake, visible scrollbars. Used to force redraw during scrolling\n   before actual scrolling happens, thus preventing shaking and\n   flickering artifacts. */\n.CodeMirror-vscrollbar, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-gutter-filler {\n  position: absolute;\n  z-index: 6;\n  display: none;\n}\n.CodeMirror-vscrollbar {\n  right: 0; top: 0;\n  overflow-x: hidden;\n  overflow-y: scroll;\n}\n.CodeMirror-hscrollbar {\n  bottom: 0; left: 0;\n  overflow-y: hidden;\n  overflow-x: scroll;\n}\n.CodeMirror-scrollbar-filler {\n  right: 0; bottom: 0;\n}\n.CodeMirror-gutter-filler {\n  left: 0; bottom: 0;\n}\n\n.CodeMirror-gutters {\n  position: absolute; left: 0; top: 0;\n  min-height: 100%;\n  z-index: 3;\n}\n.CodeMirror-gutter {\n  white-space: normal;\n  height: 100%;\n  display: inline-block;\n  vertical-align: top;\n  margin-bottom: -50px;\n}\n.CodeMirror-gutter-wrapper {\n  position: absolute;\n  z-index: 4;\n  background: none !important;\n  border: none !important;\n}\n.CodeMirror-gutter-background {\n  position: absolute;\n  top: 0; bottom: 0;\n  z-index: 4;\n}\n.CodeMirror-gutter-elt {\n  position: absolute;\n  cursor: default;\n  z-index: 4;\n}\n.CodeMirror-gutter-wrapper ::selection { background-color: transparent }\n.CodeMirror-gutter-wrapper ::-moz-selection { background-color: transparent }\n\n.CodeMirror-lines {\n  cursor: text;\n  min-height: 1px; /* prevents collapsing before first draw */\n}\n.CodeMirror pre.CodeMirror-line,\n.CodeMirror pre.CodeMirror-line-like {\n  /* Reset some styles that the rest of the page might have set */\n  -moz-border-radius: 0; -webkit-border-radius: 0; border-radius: 0;\n  border-width: 0;\n  background: transparent;\n  font-family: inherit;\n  font-size: inherit;\n  margin: 0;\n  white-space: pre;\n  word-wrap: normal;\n  line-height: inherit;\n  color: inherit;\n  z-index: 2;\n  position: relative;\n  overflow: visible;\n  -webkit-tap-highlight-color: transparent;\n  -webkit-font-variant-ligatures: contextual;\n  font-variant-ligatures: contextual;\n}\n.CodeMirror-wrap pre.CodeMirror-line,\n.CodeMirror-wrap pre.CodeMirror-line-like {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  word-break: normal;\n}\n\n.CodeMirror-linebackground {\n  position: absolute;\n  left: 0; right: 0; top: 0; bottom: 0;\n  z-index: 0;\n}\n\n.CodeMirror-linewidget {\n  position: relative;\n  z-index: 2;\n  padding: 0.1px; /* Force widget margins to stay inside of the container */\n}\n\n.CodeMirror-widget {}\n\n.CodeMirror-rtl pre { direction: rtl; }\n\n.CodeMirror-code {\n  outline: none;\n}\n\n/* Force content-box sizing for the elements where we expect it */\n.CodeMirror-scroll,\n.CodeMirror-sizer,\n.CodeMirror-gutter,\n.CodeMirror-gutters,\n.CodeMirror-linenumber {\n  -moz-box-sizing: content-box;\n  box-sizing: content-box;\n}\n\n.CodeMirror-measure {\n  position: absolute;\n  width: 100%;\n  height: 0;\n  overflow: hidden;\n  visibility: hidden;\n}\n\n.CodeMirror-cursor {\n  position: absolute;\n  pointer-events: none;\n}\n.CodeMirror-measure pre { position: static; }\n\ndiv.CodeMirror-cursors {\n  visibility: hidden;\n  position: relative;\n  z-index: 3;\n}\ndiv.CodeMirror-dragcursors {\n  visibility: visible;\n}\n\n.CodeMirror-focused div.CodeMirror-cursors {\n  visibility: visible;\n}\n\n.CodeMirror-selected { background: #d9d9d9; }\n.CodeMirror-focused .CodeMirror-selected { background: #d7d4f0; }\n.CodeMirror-crosshair { cursor: crosshair; }\n.CodeMirror-line::selection, .CodeMirror-line > span::selection, .CodeMirror-line > span > span::selection { background: #d7d4f0; }\n.CodeMirror-line::-moz-selection, .CodeMirror-line > span::-moz-selection, .CodeMirror-line > span > span::-moz-selection { background: #d7d4f0; }\n\n.cm-searching {\n  background-color: #ffa;\n  background-color: rgba(255, 255, 0, .4);\n}\n\n/* Used to force a border model for a node */\n.cm-force-border { padding-right: .1px; }\n\n@media print {\n  /* Hide the cursor when printing */\n  .CodeMirror div.CodeMirror-cursors {\n    visibility: hidden;\n  }\n}\n\n/* See issue #2901 */\n.cm-tab-wrap-hack:after { content: ''; }\n\n/* Help users use markselection to safely style text background */\nspan.CodeMirror-selectedtext { background: none; }\n@-o-keyframes loadingbar{0%{left:-10%}50%{left:90%}100%{left:-10%}}@-moz-keyframes loadingbar{0%{left:-10%}50%{left:90%}100%{left:-10%}}@-webkit-keyframes loadingbar{0%{left:-10%}50%{left:90%}100%{left:-10%}}@keyframes loadingbar{0%{left:-10%}50%{left:90%}100%{left:-10%}}.loading-bar{height:6px;position:absolute;width:100%;top:0px;display:none;z-index:10000;cursor:progress}.loading-bar.fixed{position:fixed;width:100%}.loading-bar.fixed:before{top:0 !important}.loading-bar.loading{display:block;overflow:hidden;top:58px}.loading-bar.loading:before{position:absolute;content:'';height:6px;width:20%;display:block;transform:translateZ(0);background:-webkit-linear-gradient(to right, rgba(0,0,0,0) 0%, #c35a13 20%, #c35a13 80%, rgba(0,0,0,0) 100%);background:-moz-linear-gradient(to right, rgba(0,0,0,0) 0%, #c35a13 20%, #c35a13 80%, rgba(0,0,0,0) 100%);background:-ms-linear-gradient(to right, rgba(0,0,0,0) 0%, #c35a13 20%, #c35a13 80%, rgba(0,0,0,0) 100%);background:-o-linear-gradient(to right, rgba(0,0,0,0) 0%, #c35a13 20%, #c35a13 80%, rgba(0,0,0,0) 100%);background:linear-gradient(to right, rgba(0,0,0,0) 0%, #c35a13 20%, #c35a13 80%, rgba(0,0,0,0) 100%);-webkit-animation:loadingbar 5s linear infinite;-moz-animation:loadingbar 5s linear infinite;-ms-animation:loadingbar 5s linear infinite;-o-animation:loadingbar 5s linear infinite;animation:loadingbar 5s linear infinite}.loading-bar.loading.loadingbar-covered{top:0px;overflow-y:visible}.loading-bar.loading.loadingbar-covered:before{top:86px}.no-version-warning .loading-bar.loadingbar-covered:before{top:58px}.action-bar{background:#266d9c;padding:3px;overflow:hidden;color:#e7eff4}.action-bar li{float:left}.action-bar li .li-inner{padding-bottom:1px;text-decoration:none !important;outline:0;display:inline-block;color:inherit}.action-bar li .li-inner:hover{color:white}.action-bar li span.glyph{text-shadow:0 0 0 transparent;color:inherit}.action-bar li input{width:100%;font-size:12px;font-size:1.2rem;padding:2px 4px}.action-bar li.active .li-inner{color:white}.action-bar.horizontal-action-bar{padding:5px;height:35px}.action-bar.horizontal-action-bar .search-area{margin:2px 0 0 0;border:none;float:right;display:inline-block;position:relative;padding:0 30px 0 0}.action-bar.horizontal-action-bar .search-area input{padding-right:34px;min-width:250px !important}.action-bar.horizontal-action-bar .search-area button{position:absolute;right:32px;top:-2px;cursor:default;opacity:.5;background:transparent;width:25px;height:25px}.action-bar.horizontal-action-bar .search-area button:before{color:#666}.action-bar.horizontal-action-bar .search-area .icon-help{position:absolute;right:5px;top:-1px;text-shadow:0px 0px transparent;color:white;cursor:pointer;display:block;width:24px;height:24px;line-height:24px;text-align:center}.action-bar.horizontal-action-bar li{margin:0 1px;border:1px transparent solid;text-align:center;float:left}.action-bar.horizontal-action-bar li .glyph{width:14px}.action-bar.horizontal-action-bar li .svg-glyph{height:14px;width:14px;margin-right:9px}.action-bar.horizontal-action-bar li.btn-info{overflow:hidden;background:transparent}.action-bar.horizontal-action-bar li.btn-info:hover,.action-bar.horizontal-action-bar li.btn-info.active{border-color:rgba(255,255,255,0.3);opacity:1}.action-bar.horizontal-action-bar li.disabled{background:none !important;text-shadow:inherit !important;opacity:0.45 !important;color:inherit !important}.action-bar.horizontal-action-bar li.disabled a{cursor:not-allowed !important}.action-bar.vertical-action-bar li{max-height:60px}.action-bar.vertical-action-bar li .li-inner{height:60px;display:block;overflow:hidden;text-overflow:ellipsis;text-align:center;font-size:12px;font-size:1.2rem;line-height:12px}.action-bar.vertical-action-bar li .glyph{display:block;margin:12px auto 3px;width:20px;height:20px}.action-bar.tree-action-bar{background:#f3f1ef;position:relative;left:-1px;padding:0;margin:0 2.8571428571% 8px 2.8571428571%;width:94.6428571429%;font-size:13px;font-size:1.3rem}.action-bar.tree-action-bar li{background:rgba(255,255,255,0.5);border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px;line-height:1.3;padding:0;text-align:center;float:left;width:65px;height:65px;margin:0 1px 1px 0}.action-bar.tree-action-bar li .glyph,.action-bar.tree-action-bar li .svg-glyph{display:block;color:#0e5d91;margin:12px auto 1px !important}.action-bar.tree-action-bar li .svg-glyph{width:20px;height:20px}.action-bar.tree-action-bar li .glyph{font-size:17px !important;font-size:1.7rem !important}.action-bar.tree-action-bar li .li-inner{display:block;height:65px;padding:2px;font-size:11px;font-size:1.1rem;color:#222}.action-bar.tree-action-bar li:hover{background:#ddd;color:#666}.action-bar .tree-filters{width:160px;position:relative}.action-bar .tree-filters input{padding-right:24px}.action-bar .tree-filters span{position:absolute;right:3px;color:#555;width:22px;top:2px;line-height:20px;display:inline-block;text-align:center;text-shadow:0 0 0 transparent;border-left:1px solid #ddd;cursor:pointer}.action-bar .tree-filters span.icon-close{display:none}.action-bar .tree-filters span:hover{color:#0e5d91}@media (max-width: 1150px){.action-bar.horizontal-action-bar .search-area{float:none;position:absolute;right:0px}.action-bar.horizontal-action-bar .search-area input{padding-right:30px;min-width:auto !important;width:150px}.action-bar.horizontal-action-bar .search-area input:focus{width:220px}}body.oversized-nav:not(.delivery-scope) .action-bar.horizontal-action-bar .search-area{float:none;position:absolute;right:0px}body.oversized-nav:not(.delivery-scope) .action-bar.horizontal-action-bar .search-area input{padding-right:30px;min-width:auto !important;width:150px}body.oversized-nav:not(.delivery-scope) .action-bar.horizontal-action-bar .search-area input:focus{width:220px}.section-container{top:0 !important}.section-container .flex-container-full{-ms-order:0;-webkit-order:0;order:0;flex-item-align:stretch;-ms-flex-item-align:stretch;-webkit-align-self:stretch;align-self:stretch;-ms-flex:0 0 100%;-webkit-flex:0 0 100%;flex:0 0 100%}.section-container .flex-container-half{-ms-order:0;-webkit-order:0;order:0;flex-item-align:stretch;-ms-flex-item-align:stretch;-webkit-align-self:stretch;align-self:stretch;-ms-flex:0 0 50%;-webkit-flex:0 0 50%;flex:0 0 50%}.section-container .flex-container-third{-ms-order:0;-webkit-order:0;order:0;flex-item-align:stretch;-ms-flex-item-align:stretch;-webkit-align-self:stretch;align-self:stretch;-ms-flex:0 0 33.3333333333%;-webkit-flex:0 0 33.3333333333%;flex:0 0 33.3333333333%}.section-container .flex-container-quarter{-ms-order:0;-webkit-order:0;order:0;flex-item-align:stretch;-ms-flex-item-align:stretch;-webkit-align-self:stretch;align-self:stretch;-ms-flex:0 0 25%;-webkit-flex:0 0 25%;flex:0 0 25%}.section-container .flex-container-remaining{-ms-order:0;-webkit-order:0;order:0;flex-item-align:stretch;-ms-flex-item-align:stretch;-webkit-align-self:stretch;align-self:stretch;-ms-flex:1 1 480px;-webkit-flex:1 1 480px;flex:1 1 480px}.section-container .flex-container-main-form{-ms-order:0;-webkit-order:0;order:0;flex-item-align:stretch;-ms-flex-item-align:stretch;-webkit-align-self:stretch;align-self:stretch;-ms-flex:0 0 500px;-webkit-flex:0 0 500px;flex:0 0 500px;margin:0 20px 20px 0}.section-container .flex-container-navi{-ms-order:0;-webkit-order:0;order:0;flex-item-align:stretch;-ms-flex-item-align:stretch;-webkit-align-self:stretch;align-self:stretch;-ms-flex:0 0 280px;-webkit-flex:0 0 280px;flex:0 0 280px}.section-container .section-header{border:none}.section-container .content-panel{width:100%;height:100%;margin:0;padding:0;border:none !important;display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch}.section-container .tab-container{border:none;display:none;list-style-type:none;padding:0;margin:0}.section-container .tab-container li{float:left;position:relative;top:0;padding:0;margin:0 1px 0px 0;border-top:1px solid #f3f1ef !important;border-bottom:1px solid #f3f1ef !important;background:#f3f1ef !important}.section-container .tab-container li a{top:0 !important;margin-bottom:0 !important;padding:6px 16px;text-decoration:none;min-height:32px;color:#222;float:left}.section-container .tab-container li.active,.section-container .tab-container li:hover{border-bottom-color:#4a86ad !important;border-top-color:#6e9ebd !important;background:#266d9c !important}.section-container .tab-container li.active a,.section-container .tab-container li:hover a{background:transparent !important;border-color:transparent !important;color:#fff !important;text-shadow:1px 1px 0 rgba(0,0,0,0.2)}.section-container .tab-container li.disabled:hover{background:#f3f1ef !important}.section-container .tab-container li.disabled:hover a{cursor:not-allowed !important;color:#222 !important}.section-container .navi-container{display:none;background:#f3f1ef;-ms-order:0;-webkit-order:0;order:0;flex-item-align:stretch;-ms-flex-item-align:stretch;-webkit-align-self:stretch;align-self:stretch;-ms-flex:0 0 280px;-webkit-flex:0 0 280px;flex:0 0 280px;border-right:1px #ddd solid}.section-container .navi-container .block-title{font-size:14px;font-size:1.4rem;padding:2px 8px;margin:0}.section-container .navi-container .tree-action-bar-box{margin:10px 0;opacity:0}.section-container .navi-container .tree-action-bar-box.active{opacity:1;-webkit-opacity:0.25s ease-in-out;-moz-opacity:0.25s ease-in-out;opacity:0.25s ease-in-out}.section-container .content-container{border:none;-ms-order:0;-webkit-order:0;order:0;flex-item-align:stretch;-ms-flex-item-align:stretch;-webkit-align-self:stretch;align-self:stretch;-ms-flex:1 1 auto;-webkit-flex:1 1 auto;flex:1 1 auto;-ms-flex:1 1;-webkit-flex:1 1;flex:1 1}.section-container .content-block{padding:20px;overflow-y:auto;display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;-webkit-flex-wrap:wrap;flex-wrap:wrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch}.section-container .content-block>.grid-container{width:100%}.section-container .content-block .data-container-wrapper{padding:0px 20px 0 0}.section-container .content-block .data-container-wrapper:before,.section-container .content-block .data-container-wrapper:after{content:\" \";display:table}.section-container .content-block .data-container-wrapper:after{clear:both}.section-container .content-block .data-container-wrapper>section,.section-container .content-block .data-container-wrapper .data-container{width:260px;margin:0 20px 20px 0;float:left;border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px}.section-container .content-block .data-container-wrapper>section.double,.section-container .content-block .data-container-wrapper .data-container.double{width:540px}.section-container .content-block .data-container-wrapper>section .emptyContentFooter,.section-container .content-block .data-container-wrapper .data-container .emptyContentFooter{display:none}.section-container .content-block .data-container-wrapper>section .tree,.section-container .content-block .data-container-wrapper .data-container .tree{border:none;max-width:none;max-height:none}.section-container .content-block .data-container-wrapper>section form,.section-container .content-block .data-container-wrapper .data-container form{background:none;border:none;margin:0;padding:0}.section-container .content-block .data-container-wrapper>section>header,.section-container .content-block .data-container-wrapper>section .ui-widget-header,.section-container .content-block .data-container-wrapper .data-container>header,.section-container .content-block .data-container-wrapper .data-container .ui-widget-header{background:#f3f1ef;border-width:0px !important;border-bottom:1px #ddd solid !important}.section-container .content-block .data-container-wrapper>section>header h1,.section-container .content-block .data-container-wrapper>section>header h6,.section-container .content-block .data-container-wrapper>section .ui-widget-header h1,.section-container .content-block .data-container-wrapper>section .ui-widget-header h6,.section-container .content-block .data-container-wrapper .data-container>header h1,.section-container .content-block .data-container-wrapper .data-container>header h6,.section-container .content-block .data-container-wrapper .data-container .ui-widget-header h1,.section-container .content-block .data-container-wrapper .data-container .ui-widget-header h6{padding:4px;margin:0;font-size:14px;font-size:1.4rem}.section-container .content-block .data-container-wrapper>section>div,.section-container .content-block .data-container-wrapper>section .ui-widget-content,.section-container .content-block .data-container-wrapper>section .container-content,.section-container .content-block .data-container-wrapper .data-container>div,.section-container .content-block .data-container-wrapper .data-container .ui-widget-content,.section-container .content-block .data-container-wrapper .data-container .container-content{border-width:0px !important;overflow-y:auto;min-height:250px;padding:5px}.section-container .content-block .data-container-wrapper>section>div .icon-grip,.section-container .content-block .data-container-wrapper>section .ui-widget-content .icon-grip,.section-container .content-block .data-container-wrapper>section .container-content .icon-grip,.section-container .content-block .data-container-wrapper .data-container>div .icon-grip,.section-container .content-block .data-container-wrapper .data-container .ui-widget-content .icon-grip,.section-container .content-block .data-container-wrapper .data-container .container-content .icon-grip{cursor:move}.section-container .content-block .data-container-wrapper>section>footer,.section-container .content-block .data-container-wrapper .data-container>footer{min-height:33px}.section-container .content-block .data-container-wrapper>section>footer,.section-container .content-block .data-container-wrapper>section .data-container-footer,.section-container .content-block .data-container-wrapper .data-container>footer,.section-container .content-block .data-container-wrapper .data-container .data-container-footer{background:#f3f1ef;text-align:right !important;padding:4px;border-width:0px !important;border-top:1px #ddd solid !important}.section-container .content-block .data-container-wrapper>section>footer .square,.section-container .content-block .data-container-wrapper>section .data-container-footer .square,.section-container .content-block .data-container-wrapper .data-container>footer .square,.section-container .content-block .data-container-wrapper .data-container .data-container-footer .square{width:28px}.section-container .content-block .data-container-wrapper>section>footer .square span,.section-container .content-block .data-container-wrapper>section .data-container-footer .square span,.section-container .content-block .data-container-wrapper .data-container>footer .square span,.section-container .content-block .data-container-wrapper .data-container .data-container-footer .square span{padding:0;left:0}.section-container .content-block .data-container-wrapper>section ol,.section-container .content-block .data-container-wrapper .data-container ol{margin:0 0 0 15px;padding:10px}.section-container .content-block #form-container.ui-widget-content{border:none !important}.section-container .content-block form:not(.list-container){border:1px #ddd solid;background:#f3f1ef;padding:30px;border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px}.section-container .content-block [class^=\"btn-\"],.section-container .content-block [class*=\" btn-\"]{margin:0 2px}.qti-navigator{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-o-user-select:none;user-select:none;display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;-webkit-flex-direction:column;-moz-flex-direction:column;-ms-flex-direction:column;-o-flex-direction:column;flex-direction:column;padding:0;cursor:default;min-width:calc(18rem - 8px);height:100%;position:relative}.qti-navigator span{display:inline-block}.qti-navigator .collapsed .collapsible-panel{display:none !important}.qti-navigator .collapsed .qti-navigator-label .icon-up{display:none}.qti-navigator .collapsed .qti-navigator-label .icon-down{display:inline-block}.qti-navigator .collapsible>.qti-navigator-label,.qti-navigator .qti-navigator-item>.qti-navigator-label{cursor:pointer}.qti-navigator.scope-test-section .qti-navigator-part>.qti-navigator-label{display:none !important}.qti-navigator .qti-navigator-label{display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;min-width:calc(100% - 12px);padding:0 6px;line-height:3rem}.qti-navigator .qti-navigator-label .icon-up,.qti-navigator .qti-navigator-label .icon-down{line-height:3rem;margin-left:auto}.qti-navigator .qti-navigator-label .icon-down{display:none}.qti-navigator .qti-navigator-label .qti-navigator-number{display:none}.qti-navigator .qti-navigator-icon,.qti-navigator .icon{position:relative;top:1px;display:inline-block;width:2rem;line-height:2.8rem}.qti-navigator .unseen .qti-navigator-icon{cursor:default}.qti-navigator.prevents-unseen:not(.skipahead-enabled) .unseen .qti-navigator-icon,.qti-navigator.prevents-unseen:not(.skipahead-enabled) .unseen .qti-navigator-label{cursor:not-allowed !important}.qti-navigator .icon-answered:before{content:\"\\e69a\"}.qti-navigator .icon-viewed:before{content:\"\\e631\"}.qti-navigator .icon-flagged:before{content:\"\\e64e\"}.qti-navigator .icon-unanswered:before,.qti-navigator .icon-unseen:before{content:\"\\e6a5\"}.qti-navigator .qti-navigator-counter{text-align:right;margin-left:auto;font-size:12px;font-size:1.2rem}.qti-navigator .qti-navigator-actions{text-align:center}.qti-navigator .qti-navigator-info.collapsed{height:calc(3rem + 1px)}.qti-navigator .qti-navigator-info{height:calc(5 * (3rem + 1px));overflow:hidden}.qti-navigator .qti-navigator-info>.qti-navigator-label{min-width:calc(100% - 16px);padding:0 8px}.qti-navigator .qti-navigator-info ul{padding:0 4px}.qti-navigator .qti-navigator-info ul .qti-navigator-label span.qti-navigator-text{padding:0 6px;min-width:10rem}.qti-navigator .qti-navigator-info ul .qti-navigator-label span.qti-navigator-icon{min-width:1.5rem}.qti-navigator .qti-navigator-info ul .qti-navigator-label span.qti-navigator-counter{min-width:5rem}.qti-navigator .qti-navigator-filters{margin-top:1rem;text-align:center;width:15rem;height:calc(3rem + (2 * 1px))}.qti-navigator .qti-navigator-filters ul{display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch}.qti-navigator .qti-navigator-filters li{display:block}.qti-navigator .qti-navigator-filters li .qti-navigator-tab{border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px;border-left:none;line-height:3rem;min-width:5rem;cursor:pointer;white-space:nowrap}.qti-navigator .qti-navigator-tree{-webkit-flex:1;-moz-flex:1;-ms-flex:1;-o-flex:1;flex:1;overflow-y:auto}.qti-navigator .qti-navigator-linear,.qti-navigator .qti-navigator-linear-part{padding:8px}.qti-navigator .qti-navigator-linear .icon,.qti-navigator .qti-navigator-linear-part .icon{display:none}.qti-navigator .qti-navigator-linear .qti-navigator-label,.qti-navigator .qti-navigator-linear-part .qti-navigator-label{font-size:14px;font-size:1.4rem}.qti-navigator .qti-navigator-linear .qti-navigator-title,.qti-navigator .qti-navigator-linear-part .qti-navigator-title{font-size:14px;font-size:1.4rem;margin:8px 0}.qti-navigator .qti-navigator-linear .qti-navigator-message,.qti-navigator .qti-navigator-linear-part .qti-navigator-message{font-size:14px;font-size:1.4rem}.qti-navigator .qti-navigator-part>.qti-navigator-label{padding:0 8px}.qti-navigator .qti-navigator-part:not(:first-child){margin-top:1px}.qti-navigator .qti-navigator-section>.qti-navigator-label{padding:0 8px}.qti-navigator .qti-navigator-item{margin:1px 0;padding-left:10px}.qti-navigator .qti-navigator-item:first-child{margin-top:0}.qti-navigator .qti-navigator-item.disabled>.qti-navigator-label{cursor:not-allowed}.qti-navigator .qti-navigator-collapsible{cursor:pointer;text-align:center;display:none;position:absolute;top:0;bottom:0;right:0;padding-top:50%}.qti-navigator .qti-navigator-collapsible .icon{font-size:20px;font-size:2rem;width:1rem !important;height:2rem !important}.qti-navigator .qti-navigator-collapsible .qti-navigator-expand{display:none}.qti-navigator.collapsible{padding-right:calc(1rem + 10px) !important}.qti-navigator.collapsible .qti-navigator-collapsible{display:block}.qti-navigator.collapsed{width:calc(8rem + 1rem + 10px);min-width:8rem}.qti-navigator.collapsed ul{padding:0 !important}.qti-navigator.collapsed .qti-navigator-text,.qti-navigator.collapsed .qti-navigator-info>.qti-navigator-label,.qti-navigator.collapsed .qti-navigator-part>.qti-navigator-label,.qti-navigator.collapsed .qti-navigator-section>.qti-navigator-label,.qti-navigator.collapsed .qti-navigator-message{display:none !important}.qti-navigator.collapsed .qti-navigator-label{padding:0 2px !important;width:calc(8rem - 4px);min-width:calc(8rem - 4px)}.qti-navigator.collapsed .qti-navigator-icon,.qti-navigator.collapsed .icon{width:auto}.qti-navigator.collapsed .qti-navigator-counter{margin-left:0;min-width:4rem !important}.qti-navigator.collapsed .qti-navigator-collapsible .qti-navigator-collapse{display:none}.qti-navigator.collapsed .qti-navigator-collapsible .qti-navigator-expand{display:block}.qti-navigator.collapsed .qti-navigator-info{height:calc(4 * (3rem + 1px))}.qti-navigator.collapsed .qti-navigator-info.collapsed .collapsible-panel{display:block !important}.qti-navigator.collapsed .qti-navigator-filters{width:calc(8rem - 16px)}.qti-navigator.collapsed .qti-navigator-filter span{display:none}.qti-navigator.collapsed .qti-navigator-filter.active span{display:block;border:0 none;width:calc(8rem - 16px)}.qti-navigator.collapsed .qti-navigator-item,.qti-navigator.collapsed .qti-navigator-linear,.qti-navigator.collapsed .qti-navigator-linear-part{padding-left:2px;text-align:center}.qti-navigator.collapsed .qti-navigator-item{overflow:hidden}.qti-navigator.collapsed .qti-navigator-item .qti-navigator-icon{padding-left:6px;width:2rem}.qti-navigator.collapsed .qti-navigator-item .qti-navigator-number{display:inline-block;margin-left:6px;margin-right:8rem}.qti-navigator.collapsed .qti-navigator-linear,.qti-navigator.collapsed .qti-navigator-linear-part{padding:0 0 8px 0}.qti-navigator.collapsed .qti-navigator-linear .icon,.qti-navigator.collapsed .qti-navigator-linear-part .icon{display:block}.qti-navigator.collapsed .qti-navigator-actions button{padding:0 9px 0 5px}.qti-navigator .qti-navigator-info>.qti-navigator-label{background-color:#D4D5D7;color:#222;border-top:1px solid #D4D5D7}.qti-navigator .qti-navigator-info li{border-bottom:1px solid #fff}.qti-navigator .qti-navigator-filter .qti-navigator-tab{background-color:#fff}.qti-navigator .qti-navigator-filter .qti-navigator-tab:hover{background-color:#3e7da7;color:#fff}.qti-navigator .qti-navigator-filter.active .qti-navigator-tab{background-color:#a4a9b1;color:#fff}.qti-navigator .qti-navigator-linear,.qti-navigator .qti-navigator-linear-part{background:#fff}.qti-navigator .qti-navigator-part>.qti-navigator-label{background-color:#dddfe2}.qti-navigator .qti-navigator-part>.qti-navigator-label:hover{background-color:#c6cacf}.qti-navigator .qti-navigator-part.active>.qti-navigator-label{background-color:#c0c4ca}.qti-navigator .qti-navigator-section>.qti-navigator-label{border-bottom:1px solid #fff}.qti-navigator .qti-navigator-section>.qti-navigator-label:hover{background-color:#ebe8e4}.qti-navigator .qti-navigator-section.active>.qti-navigator-label{background-color:#ded9d4}.qti-navigator .qti-navigator-item{background:#fff}.qti-navigator .qti-navigator-item.active{background:#f4f7f8}.qti-navigator .qti-navigator-item:hover{background:#eef3f5}.qti-navigator .qti-navigator-item.disabled{background-color:#e2deda !important}.qti-navigator .qti-navigator-collapsible{background-color:#dfe1e4;color:#222}.qti-navigator .qti-navigator-collapsible .icon{color:#fff}.document-viewer-plugin{position:relative}.document-viewer-plugin .viewer-overlay{position:fixed;top:0;left:0;bottom:0;right:0;z-index:10000;width:100%;opacity:.5;background-color:#e4ecef}.document-viewer-plugin .viewer-panel{position:fixed;top:10px;left:10px;bottom:10px;right:10px;z-index:100000;color:#222;background:#f3f1ef;font-size:14px;font-size:1.4rem;border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px}.document-viewer-plugin .viewer-header{position:relative;width:100%;height:30px;padding:5px 0;z-index:1}.document-viewer-plugin .viewer-header .viewer-title{font-size:15px;font-size:1.5rem;padding:0;margin:0 0 0 1.6rem}.document-viewer-plugin .viewer-header .icon{float:right;font-size:20px;font-size:2rem;color:#266d9c;margin:1px 6px;top:3px}.document-viewer-plugin .viewer-header .icon:hover{cursor:pointer;opacity:.75}.document-viewer-plugin .viewer-content{padding:0 20px;margin-top:4px;position:relative;height:calc(100% - 40px);overflow:auto}.qti-choiceInteraction.maskable .qti-choice .answer-mask{position:absolute;top:0;right:0;height:100%;padding:5px 10px 0 10px;z-index:10;color:#0e5d91;border:solid 1px #222;background-color:#c8d6dc;text-align:right;vertical-align:middle}.qti-choiceInteraction.maskable .qti-choice .answer-mask:hover{color:#568eb2}.qti-choiceInteraction.maskable .qti-choice .answer-mask .answer-mask-toggle:before{font-family:'tao' !important;speak:none;font-style:normal;font-weight:normal;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;content:\"\\e643\"}.qti-choiceInteraction.maskable .qti-choice .label-content{padding-right:40px}.qti-choiceInteraction.maskable .qti-choice.masked .answer-mask{width:100%}.qti-choiceInteraction.maskable .qti-choice.masked .answer-mask .answer-mask-toggle:before{font-family:'tao' !important;speak:none;font-style:normal;font-weight:normal;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;content:\"\\e631\"}.qti-choiceInteraction.maskable .qti-choice.masked .answer-mask:hover{background-color:#d2dde2}.mask-container.mask-container{background-color:transparent}.mask-container.mask-container .dynamic-component-title-bar{border-top-left-radius:5px;border-top-right-radius:5px;background-color:transparent;border:none;position:absolute;width:100%;z-index:1}.mask-container.mask-container .dynamic-component-title-bar.moving{background:#f3f1ef;border-bottom:1px solid #8d949e}.mask-container.mask-container .dynamic-component-title-bar .closer{display:none}.mask-container.mask-container .dynamic-component-resize-container .dynamic-component-resize-wrapper{bottom:0}.mask-container.mask-container .dynamic-component-resize-container .dynamic-component-resize-wrapper:hover,.mask-container.mask-container .dynamic-component-resize-container .dynamic-component-resize-wrapper.resizing{bottom:20px}.mask-container.mask-container .dynamic-component-content .mask{position:absolute;width:100%;height:100%;-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px;background:transparent;opacity:1}.mask-container.mask-container .dynamic-component-content .mask .inner{-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px;position:relative;width:100%;height:100%;background-color:#fff;opacity:1;box-sizing:content-box;padding-bottom:30px}.mask-container.mask-container .dynamic-component-content .mask .controls{background:#f3f1ef;position:absolute;top:0;right:0;padding:0 5px 0 10px;border-radius:5px;border-top-left-radius:0;border-bottom-right-radius:0;border-bottom:1px solid #8d949e;border-left:1px solid #8d949e;height:30px;z-index:2}.mask-container.mask-container .dynamic-component-content .mask .controls a{text-decoration:none;margin-right:5px;vertical-align:middle}.mask-container.mask-container .dynamic-component-content .mask .controls a:hover{color:#0a4166}.mask-container.mask-container .dynamic-component-content .mask .controls .view{font-size:20px;font-size:2rem}.mask-container.mask-container .dynamic-component-content .mask .controls .close{font-size:20px;font-size:2rem}.mask-container.mask-container .dynamic-component-content.moving .mask .inner{border-color:rgba(14,93,145,0.5);opacity:.55}.mask-container.mask-container .dynamic-component-content.moving .mask .controls{border-left:none;border-bottom-left-radius:0;z-index:2}.mask-container.mask-container .dynamic-component-content.sizing .mask{border-color:rgba(14,93,145,0.5)}.mask-container.mask-container .dynamic-component-content.sizing .mask .inner{opacity:.55}.mask-container.mask-container .dynamic-component-content.sizing .mask .controls{background-color:transparent;border-bottom:none;border-left:none}.mask-container.mask-container.previewing .dynamic-component-content .mask .inner{opacity:.15;-webkit-transition:opacity, 600ms, ease, 0s;-moz-transition:opacity, 600ms, ease, 0s;-ms-transition:opacity, 600ms, ease, 0s;-o-transition:opacity, 600ms, ease, 0s;transition:opacity, 600ms, ease, 0s}.mask-container.mask-container.previewing .dynamic-component-content .mask .controls{background-color:transparent;border-bottom:none;border-left:none}.connectivity-box{display:none;width:40px;margin-left:40px}.connectivity-box.with-message{width:60px}.connectivity-box .icon-connect,.connectivity-box .icon-disconnect{display:none;line-height:2;font-size:16px;font-size:1.6rem;text-shadow:0 1px 0 rgba(0,0,0,0.9)}.connectivity-box .message-connect,.connectivity-box .message-disconnected{display:none;font-size:14px;font-size:1.4rem;text-shadow:none;margin-right:3px}.connectivity-box.connected,.connectivity-box.disconnected{display:inline-block}.connectivity-box.connected .icon-connect,.connectivity-box.connected .message-connect{display:inline-block}.connectivity-box.disconnected .icon-disconnect,.connectivity-box.disconnected .message-disconnected{display:inline-block}.line-reader-mask{box-sizing:border-box;border:0 solid #0E5D91;background-color:#f3f7fa}.line-reader-mask.hidden{display:none}.line-reader-mask.resizing{background-color:rgba(243,247,250,0.8);border-color:rgba(14,93,145,0.5)}.line-reader-mask.resizer{z-index:99999 !important}.line-reader-mask.resizer.se .resize-control{border-right:2px solid #0E5D91;border-bottom:2px solid #0E5D91;width:40px;height:40px}.line-reader-mask.border-top{border-top-width:1px}.line-reader-mask.border-right{border-right-width:1px}.line-reader-mask.border-bottom{border-bottom-width:1px}.line-reader-mask.border-left{border-left-width:1px}.line-reader-mask.ne{-webkit-border-top-right-radius:5px;-moz-border-radius-topright:5px;border-top-right-radius:5px}.line-reader-mask.se{-webkit-border-bottom-right-radius:5px;-moz-border-radius-bottomright:5px;border-bottom-right-radius:5px}.line-reader-mask.sw{-webkit-border-bottom-left-radius:5px;-moz-border-radius-bottomleft:5px;border-bottom-left-radius:5px}.line-reader-mask.nw{-webkit-border-top-left-radius:5px;-moz-border-radius-topleft:5px;border-top-left-radius:5px}.line-reader-mask.se .resize-control{width:20px;height:20px;margin-bottom:10px;margin-right:10px;border-right:1px solid #0E5D91;border-bottom:1px solid #0E5D91;position:absolute;right:0;bottom:0;cursor:nwse-resize}.line-reader-mask.e .resize-control{position:absolute;width:20px;height:20px;bottom:-10px;left:-10px;border-right:1px solid #0E5D91;border-bottom:1px solid #0E5D91;cursor:nesw-resize}.line-reader-mask.s .resize-control{position:absolute;width:20px;height:10px;right:-10px;border-bottom:1px solid #0E5D91}.line-reader-overlay{box-sizing:border-box;opacity:0}.line-reader-overlay.hidden{display:none}.line-reader-overlay.moving{-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px}.line-reader-overlay.moving.n{max-height:none}.line-reader-overlay.moving,.line-reader-overlay .inner-window{overflow:hidden;position:absolute;opacity:1;background-color:transparent;border:1px solid rgba(14,93,145,0.5)}.line-reader-overlay .inner-window{box-sizing:content-box}.line-reader-overlay .mask-bg{box-sizing:border-box;border:0 solid rgba(243,247,250,0.8);background-color:transparent;position:absolute}.line-reader-overlay.n{max-height:30px;opacity:1}.line-reader-overlay.n .icon-mobile-menu{font-size:22px;font-size:2.2rem;display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;-webkit-justify-content:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;border-bottom:1px solid #0E5D91;color:#0E5D91;position:absolute;left:0;top:0;height:30px;width:100%;z-index:1}.line-reader-overlay.n .icon-mobile-menu:hover{color:#0a4166}.line-reader-overlay.n .icon-mobile-menu:before{position:relative;top:3px}.line-reader-overlay .icon-mobile-menu{display:none}.line-reader-inner-drag{-moz-border-radius:3px;-webkit-border-radius:3px;border-radius:3px;display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;-webkit-justify-content:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;text-align:center;padding-top:3px;color:#0E5D91}.line-reader-inner-drag.hidden{display:none}.line-reader-inner-drag:hover{background-color:#87aec8;color:#0a4166}.line-reader-inner-drag.moving{background-color:transparent;color:#9fbed3}.line-reader-inner-drag .icon{text-shadow:none !important;border-bottom-left-radius:110px;border-bottom-right-radius:110px;border:1px solid #0E5D91;border-top:0;width:50px;height:25px;position:relative;bottom:10px}.line-reader-inner-drag .icon:before{position:relative;top:5px;left:1px}.line-reader-closer{font-size:22px;font-size:2.2rem;cursor:pointer;color:#0E5D91;width:12px;height:12px}.line-reader-closer:hover{color:#0a4166}.line-reader-closer .icon{text-shadow:none !important}.magnifier-container.magnifier-container{background-color:transparent}.magnifier-container.magnifier-container .dynamic-component-title-bar{border-top-left-radius:5px;border-top-right-radius:5px;background-color:transparent;border:none;position:absolute;width:100%;z-index:3}.magnifier-container.magnifier-container .dynamic-component-title-bar.moving{background:#f3f1ef;border-bottom:1px solid #8d949e}.magnifier-container.magnifier-container .dynamic-component-title-bar .closer{display:none}.magnifier-container.magnifier-container .dynamic-component-resize-container .dynamic-component-resize-wrapper{bottom:0}.magnifier-container.magnifier-container .dynamic-component-resize-container .dynamic-component-resize-wrapper:hover,.magnifier-container.magnifier-container .dynamic-component-resize-container .dynamic-component-resize-wrapper.resizing{bottom:20px}.magnifier-container.magnifier-container .dynamic-component-content .magnifier{position:absolute;width:100%;height:100%;overflow:hidden;background-color:#fff;opacity:1;-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px;box-sizing:content-box;padding-bottom:30px}@-o-keyframes fadeIn{0%{opacity:0;visibility:visible}100%{opacity:1;visibility:visible}}@-moz-keyframes fadeIn{0%{opacity:0;visibility:visible}100%{opacity:1;visibility:visible}}@-webkit-keyframes fadeIn{0%{opacity:0;visibility:visible}100%{opacity:1;visibility:visible}}@keyframes fadeIn{0%{opacity:0;visibility:visible}100%{opacity:1;visibility:visible}}@-o-keyframes fadeOut{0%{opacity:1;visibility:visible}100%{opacity:0;visibility:hidden}}@-moz-keyframes fadeOut{0%{opacity:1;visibility:visible}100%{opacity:0;visibility:hidden}}@-webkit-keyframes fadeOut{0%{opacity:1;visibility:visible}100%{opacity:0;visibility:hidden}}@keyframes fadeOut{0%{opacity:1;visibility:visible}100%{opacity:0;visibility:hidden}}@-o-keyframes pop{0%{opacity:0;visibility:visible}50%{opacity:.5;visibility:visible;transform:scale(2)}100%{opacity:0;visibility:hidden;transform:scale(3)}}@-moz-keyframes pop{0%{opacity:0;visibility:visible}50%{opacity:.5;visibility:visible;transform:scale(2)}100%{opacity:0;visibility:hidden;transform:scale(3)}}@-webkit-keyframes pop{0%{opacity:0;visibility:visible}50%{opacity:.5;visibility:visible;transform:scale(2)}100%{opacity:0;visibility:hidden;transform:scale(3)}}@keyframes pop{0%{opacity:0;visibility:visible}50%{opacity:.5;visibility:visible;transform:scale(2)}100%{opacity:0;visibility:hidden;transform:scale(3)}}.magnifier-container.magnifier-container .dynamic-component-content .magnifier .level{position:absolute;overflow:hidden;z-index:1;top:0;left:0;bottom:0;right:0;background:transparent;color:#3e7da7;opacity:1;font-size:50px;font-size:5rem;display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;-webkit-justify-content:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-webkit-animation:pop 400ms forwards;-moz-animation:pop 400ms forwards;-ms-animation:pop 400ms forwards;-o-animation:pop 400ms forwards;animation:pop 400ms forwards}.magnifier-container.magnifier-container .dynamic-component-content .magnifier .level:before{content:\"x\"}.magnifier-container.magnifier-container .dynamic-component-content .magnifier .overlay{position:absolute;overflow:hidden;z-index:2;top:0;left:0;bottom:0;right:0;background:transparent}.magnifier-container.magnifier-container .dynamic-component-content .magnifier>.controls{position:absolute;background-color:#f3f1ef;border:0 solid #8d949e;min-height:29px;z-index:4}.magnifier-container.magnifier-container .dynamic-component-content .magnifier>.controls a{color:#222;text-decoration:none;font-size:20px;font-size:2rem;margin:0 2px}.magnifier-container.magnifier-container .dynamic-component-content .magnifier>.controls a:hover{color:#0a4166}.magnifier-container.magnifier-container .dynamic-component-content .magnifier>.controls.close{top:0;right:0;border-bottom-width:1px;border-left-width:1px;-webkit-border-bottom-left-radius:5px;-moz-border-radius-bottomleft:5px;border-bottom-left-radius:5px}.magnifier-container.magnifier-container .dynamic-component-content .magnifier .inner{position:absolute}.magnifier-container.magnifier-container .dynamic-component-content.moving .magnifier .controls{border-left:none;border-bottom-left-radius:0}.magnifier-container.magnifier-container .dynamic-component-content.sizing{border-color:rgba(14,93,145,0.5)}.magnifier-container.magnifier-container .dynamic-component-content.sizing .inner,.magnifier-container.magnifier-container .dynamic-component-content.sizing .controls,.magnifier-container.magnifier-container .dynamic-component-content.sizing .level{opacity:0.45 !important}.progress-box .progressbar .progressbar-points{display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch}.progress-box .progressbar .progressbar-points>span.progressbar-point{flex:1;display:inline-block;border:1px solid #0e5d91;background-color:#f3f1ef;height:calc(1rem - 4px);margin:0 1px 0 0}.progress-box .progressbar .progressbar-points>span.progressbar-point:last-child{margin-right:0}.progress-box .progressbar .progressbar-points>span.progressbar-point.reached{background-color:#0e5d91}.progress-box .progressbar .progressbar-points>span.progressbar-point.current{background-color:#a4a9b1}.tts-container .tts-controls{display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;background-color:#f3f1ef;-webkit-box-shadow:0 2px 3px 1px rgba(0,0,0,0.2);-moz-box-shadow:0 2px 3px 1px rgba(0,0,0,0.2);-ms-box-shadow:0 2px 3px 1px rgba(0,0,0,0.2);-o-box-shadow:0 2px 3px 1px rgba(0,0,0,0.2);box-shadow:0 2px 3px 1px rgba(0,0,0,0.2)}.tts-container .tts-controls .tts-control{display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;-webkit-justify-content:center;-moz-justify-content:center;-ms-justify-content:center;-o-justify-content:center;justify-content:center;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center;color:#222;height:100%;padding:6px 8.5px;text-decoration:none}.tts-container .tts-controls .tts-control .tts-control-label{padding-left:7.5px}.tts-container .tts-controls .tts-control .tts-icon{font-size:18px;text-align:center;width:18px}.tts-container .tts-controls .tts-control .icon-pause{display:none}.tts-container .tts-controls .tts-control.tts-control-drag{cursor:move}.tts-container .tts-controls .tts-control.tts-control-drag .tts-icon{color:#555}.tts-container .tts-controls .tts-control.tts-control-drag:hover{background-color:transparent}.tts-container .tts-controls .tts-control:hover{background-color:#ddd8d2}.tts-container .tts-controls .tts-control-container{display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch}.tts-container .tts-controls .tts-control-container .tts-slider-container{display:none}.tts-container .tts-controls .tts-control-container .tts-slider-container .tts-slider{margin:0 8.5px;width:80px}.tts-container.playing .tts-controls .tts-control .icon-pause{display:block}.tts-container.playing .tts-controls .tts-control .icon-play{display:none}.tts-container.sfhMode .tts-controls .tts-control.tts-control-mode{-webkit-box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);-moz-box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);-ms-box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);-o-box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);background-color:#ddd8d2}.tts-container.settings .tts-controls .tts-control-container .tts-slider-container{display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;-webkit-align-items:center;-moz-align-items:center;-ms-align-items:center;-o-align-items:center;align-items:center}.tts-container.settings .tts-controls .tts-control-container:last-child{-webkit-box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);-moz-box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);-ms-box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);-o-box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);box-shadow:inset 2px 2px 4px rgba(0,0,0,0.2);background-color:#ddd8d2}.tts-container.settings .tts-controls .tts-control-container .tts-control-settings:hover{background-color:transparent}.tts-content-node{outline:none}.tts-visible.tts-component-container .test-runner-sections .tts-content-node:hover,.tts-visible.tts-component-container .test-runner-sections .tts-content-node:focus{background-color:transparent !important;color:#222 !important}.tts-visible.tts-component-container .test-runner-sections .tts-content-node .label-box,.tts-visible.tts-component-container .test-runner-sections .tts-content-node .qti-choice{cursor:default !important}.tts-sfhMode.tts-component-container .test-runner-sections{cursor:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c3ZnIHdpZHRoPSIxNHB4IiBoZWlnaHQ9IjE0cHgiIHZpZXdCb3g9IjAgMCAxNCAxNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4gICAgICAgIDx0aXRsZT5Hcm91cCAyPC90aXRsZT4gICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+ICAgIDxnIGlkPSJQYWdlLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPiAgICAgICAgPGcgaWQ9IkFydGJvYXJkIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjQuMDAwMDAwLCAtMTYuMDAwMDAwKSI+ICAgICAgICAgICAgPGcgaWQ9Ikdyb3VwLTIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIzLjAwMDAwMCwgMTUuMDAwMDAwKSI+ICAgICAgICAgICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGUtQ29weS02IiB4PSIwIiB5PSIwIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjwvcmVjdD4gICAgICAgICAgICAgICAgPGcgaWQ9Imljb24tLy0xNi0vLWNoZXZyb24tYm90dG9tLWNvcHkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEuMDAwMDAwLCAyLjAwMDAwMCkiIGZpbGw9IiMyRDJEMkQiPiAgICAgICAgICAgICAgICAgICAgPHBvbHlnb24gaWQ9InN3YXAtaWNvbi1jb2xvciIgcG9pbnRzPSIwIDAgMCA4IDYgNCI+PC9wb2x5Z29uPiAgICAgICAgICAgICAgICA8L2c+ICAgICAgICAgICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGUtQ29weSIgZmlsbD0iIzJEMkQyRCIgeD0iOSIgeT0iNSIgd2lkdGg9IjYiIGhlaWdodD0iMiI+PC9yZWN0PiAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlLUNvcHktNCIgZmlsbD0iIzJEMkQyRCIgeD0iOSIgeT0iMSIgd2lkdGg9IjYiIGhlaWdodD0iMiI+PC9yZWN0PiAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlLUNvcHktMiIgZmlsbD0iIzJEMkQyRCIgeD0iOSIgeT0iOSIgd2lkdGg9IjYiIGhlaWdodD0iMiI+PC9yZWN0PiAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlLUNvcHktMyIgZmlsbD0iIzJEMkQyRCIgeD0iMSIgeT0iMTMiIHdpZHRoPSIxNCIgaGVpZ2h0PSIyIj48L3JlY3Q+ICAgICAgICAgICAgPC9nPiAgICAgICAgPC9nPiAgICA8L2c+PC9zdmc+) 0 32,auto !important}.tts-sfhMode.tts-component-container .test-runner-sections .tts-content-node.tts-active-content-node:hover{color:#222 !important;background-color:#ff0 !important}.tts-sfhMode.tts-component-container .test-runner-sections .tts-content-node:hover,.tts-sfhMode.tts-component-container .test-runner-sections .tts-content-node:focus{color:#222 !important;background-color:#f3f1ef !important}.tts-sfhMode.tts-component-container .test-runner-sections .tts-content-node .label-box,.tts-sfhMode.tts-component-container .test-runner-sections .tts-content-node .qti-choice{cursor:url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz48c3ZnIHdpZHRoPSIxNHB4IiBoZWlnaHQ9IjE0cHgiIHZpZXdCb3g9IjAgMCAxNCAxNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIj4gICAgICAgIDx0aXRsZT5Hcm91cCAyPC90aXRsZT4gICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+ICAgIDxnIGlkPSJQYWdlLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPiAgICAgICAgPGcgaWQ9IkFydGJvYXJkIiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMjQuMDAwMDAwLCAtMTYuMDAwMDAwKSI+ICAgICAgICAgICAgPGcgaWQ9Ikdyb3VwLTIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDIzLjAwMDAwMCwgMTUuMDAwMDAwKSI+ICAgICAgICAgICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGUtQ29weS02IiB4PSIwIiB5PSIwIiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiPjwvcmVjdD4gICAgICAgICAgICAgICAgPGcgaWQ9Imljb24tLy0xNi0vLWNoZXZyb24tYm90dG9tLWNvcHkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDEuMDAwMDAwLCAyLjAwMDAwMCkiIGZpbGw9IiMyRDJEMkQiPiAgICAgICAgICAgICAgICAgICAgPHBvbHlnb24gaWQ9InN3YXAtaWNvbi1jb2xvciIgcG9pbnRzPSIwIDAgMCA4IDYgNCI+PC9wb2x5Z29uPiAgICAgICAgICAgICAgICA8L2c+ICAgICAgICAgICAgICAgIDxyZWN0IGlkPSJSZWN0YW5nbGUtQ29weSIgZmlsbD0iIzJEMkQyRCIgeD0iOSIgeT0iNSIgd2lkdGg9IjYiIGhlaWdodD0iMiI+PC9yZWN0PiAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlLUNvcHktNCIgZmlsbD0iIzJEMkQyRCIgeD0iOSIgeT0iMSIgd2lkdGg9IjYiIGhlaWdodD0iMiI+PC9yZWN0PiAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlLUNvcHktMiIgZmlsbD0iIzJEMkQyRCIgeD0iOSIgeT0iOSIgd2lkdGg9IjYiIGhlaWdodD0iMiI+PC9yZWN0PiAgICAgICAgICAgICAgICA8cmVjdCBpZD0iUmVjdGFuZ2xlLUNvcHktMyIgZmlsbD0iIzJEMkQyRCIgeD0iMSIgeT0iMTMiIHdpZHRoPSIxNCIgaGVpZ2h0PSIyIj48L3JlY3Q+ICAgICAgICAgICAgPC9nPiAgICAgICAgPC9nPiAgICA8L2c+PC9zdmc+) 0 32,auto !important}.tts-sfhMode.tts-component-container .test-runner-sections img.tts-content-node:hover,.tts-sfhMode.tts-component-container .test-runner-sections img.tts-content-node:focus{padding:5px}.tts-playing.tts-component-container .test-runner-sections .tts-content-node.tts-active-content-node,.tts-playing.tts-component-container .test-runner-sections .tts-content-node.tts-active-content-node *{color:#222 !important;background-color:#ff0 !important}.tts-playing.tts-component-container .test-runner-sections .tts-content-node.tts-active-content-node:hover,.tts-playing.tts-component-container .test-runner-sections .tts-content-node.tts-active-content-node *:hover{color:#222 !important;background-color:#ff0 !important}.tts-playing.tts-component-container .test-runner-sections img.tts-content-node.tts-active-content-node{padding:5px}body.delivery-scope{min-height:100vh;max-height:100vh;margin-bottom:0}.runner{position:relative}.test-runner-scope{position:relative;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:calc(100vh - 99px)}.test-runner-scope .landmark-title-hidden{width:1px;height:1px;overflow:hidden;position:absolute}.test-runner-scope .test-runner-sections{-webkit-flex:1 1 0%;-ms-flex:1 1 0%;flex:1 1 0%;overflow:hidden;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row}.test-runner-scope .test-sidebar{background:#f3f1ef;-webkit-flex:0 1 auto;-ms-flex:0 1 auto;flex:0 1 auto;height:calc(100vh - 179px);overflow-y:auto;max-width:350px}.test-runner-scope .test-sidebar>.qti-panel{max-width:350px;padding:10px}@media only screen and (max-device-width: 800px){.test-runner-scope .test-sidebar{max-width:200px}.test-runner-scope .test-sidebar>.qti-panel{max-width:200px}}@media only screen and (min-device-width: 800px) and (max-device-width: 1280px){.test-runner-scope .test-sidebar{max-width:250px}.test-runner-scope .test-sidebar>.qti-panel{max-width:250px}}@media only screen and (min-device-width: 1280px) and (max-device-width: 1440px){.test-runner-scope .test-sidebar{max-width:300px}.test-runner-scope .test-sidebar>.qti-panel{max-width:300px}}.test-runner-scope .test-sidebar-left{border-right:1px #ddd solid}.test-runner-scope .test-sidebar-left .landmark-title--hidden{position:absolute;overflow:hidden;height:1px;width:1px;word-wrap:normal}.test-runner-scope .test-sidebar-right{border-left:1px #ddd solid}.test-runner-scope .content-wrapper{position:relative;-webkit-flex:1 1 0%;-ms-flex:1 1 0%;flex:1 1 0%;overflow:auto;padding:0}.test-runner-scope .content-wrapper .overlay{position:absolute;left:0;right:0;top:0;bottom:0;width:100%;opacity:.9}.test-runner-scope .content-wrapper .overlay-full{background-color:#fff;opacity:1}.test-runner-scope #qti-content{-webkit-overflow-scrolling:touch;max-width:1024px;width:100%;margin:auto}.test-runner-scope #qti-item{width:100%;min-width:100%;height:auto;overflow:visible}.test-runner-scope .qti-item{padding:30px}.test-runner-scope .size-wrapper{max-width:1280px;margin:auto;width:100%}.test-runner-scope #qti-rubrics{margin:auto;max-width:1024px;width:100%}.test-runner-scope #qti-rubrics .qti-rubricBlock{margin:20px 0}.test-runner-scope #qti-rubrics .hidden{display:none}.test-runner-scope .visible-hidden{position:absolute;overflow:hidden;height:1px;width:1px;word-wrap:normal}.no-controls .test-runner-scope{height:100vh}.test-runner-scope .action-bar.content-action-bar{padding:2px}.test-runner-scope .action-bar.content-action-bar li{margin:2px 0 0 10px;border:none}.test-runner-scope .action-bar.content-action-bar li.btn-info{padding-top:6px;height:36px;margin-top:0;border-bottom:solid 2px transparent;border-radius:0}.test-runner-scope .action-bar.content-action-bar li.btn-info.btn-group{border:none !important;overflow:hidden;padding:0}.test-runner-scope .action-bar.content-action-bar li.btn-info.btn-group a{float:left;margin:0 2px;padding:0 15px;border:1px solid rgba(255,255,255,0.3);border-radius:0px;display:inline-block;height:inherit}.test-runner-scope .action-bar.content-action-bar li.btn-info.btn-group a:first-of-type{border-top-left-radius:3px;border-bottom-left-radius:3px;margin-left:0}.test-runner-scope .action-bar.content-action-bar li.btn-info.btn-group a:last-of-type{border-top-right-radius:3px;border-bottom-right-radius:3px;margin-right:0}.test-runner-scope .action-bar.content-action-bar li.btn-info.btn-group a:hover,.test-runner-scope .action-bar.content-action-bar li.btn-info.btn-group a.active{border-color:rgba(255,255,255,0.8)}.test-runner-scope .action-bar.content-action-bar li.btn-info.btn-group a .no-label{padding-right:0}.test-runner-scope .action-bar.content-action-bar li.btn-info:hover,.test-runner-scope .action-bar.content-action-bar li.btn-info.active{border-bottom-color:rgba(255,255,255,0.8)}.test-runner-scope .action-bar.content-action-bar li.btn-info:active,.test-runner-scope .action-bar.content-action-bar li.btn-info.active{background:#e7eff4;border-color:rgba(255,255,255,0.8)}.test-runner-scope .action-bar.content-action-bar li.btn-info:active a,.test-runner-scope .action-bar.content-action-bar li.btn-info.active a{color:#266d9c;text-shadow:none}.test-runner-scope .action-bar.content-action-bar li.btn-info:active:hover,.test-runner-scope .action-bar.content-action-bar li.btn-info.active:hover{background:#fff}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar{opacity:1;height:40px}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar>.control-box{height:38px;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:space-between;-ms-flex-pack:space-between;justify-content:space-between;padding-left:10px;padding-right:10px}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar>.control-box .title-box{font-size:14px;font-size:1.4rem;padding:4px 0 0;-ms-flex:0 1 auto;-webkit-flex:0 1 auto;flex:0 1 auto}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar>.control-box .progress-box,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar>.control-box .item-number-box{padding-top:4px;white-space:nowrap;-ms-flex:0 1 auto;-webkit-flex:0 1 auto;flex:0 1 auto}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar>.control-box .progress-box .qti-controls,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar>.control-box .item-number-box .qti-controls{display:inline-block;margin-left:20px;white-space:nowrap}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar>.control-box .timer-box{-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.top-action-bar>.control-box .progressbar{margin-top:5px;min-width:150px;max-width:200px;height:0.6em}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box{color:rgba(255,255,255,0.9);text-shadow:1px 1px 0 black}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box .lft,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box .rgt{padding-left:20px}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box .lft:first-child,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box .rgt:first-child{padding-left:0}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box .lft:last-child ul,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box .rgt:last-child ul{display:inline-block}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box [class^=\"btn-\"],.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar>.control-box [class*=\" btn-\"]{white-space:nowrap}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .action{position:relative;overflow:visible}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu{color:#222;background:#f3f1ef;border:1px solid #aaa9a7;overflow:auto;list-style:none;min-width:150px;margin:0;padding:0;position:absolute;bottom:36px;left:-3px}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action{display:inline-block;text-align:left;width:100%;white-space:nowrap;overflow:hidden;color:#222;border-bottom:1px solid #c2c1bf;margin:0;-moz-border-radius:0px;-webkit-border-radius:0px;border-radius:0px;height:32px;padding:6px 15px;line-height:1;border-left:solid 3px transparent}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action .icon-checkbox-checked{display:none}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.active{background-color:#dbd9d7;font-weight:bold}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.hover .icon-checkbox,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:hover .icon-checkbox,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.active .icon-checkbox{display:none}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.hover .icon-checkbox-checked,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:hover .icon-checkbox-checked,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.active .icon-checkbox-checked{display:inline-block}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:focus,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.hover,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:hover{background-color:#0e5d91;color:#fff;border-left-color:#313030 !important}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:focus .label,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:focus .icon,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.hover .label,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.hover .icon,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:hover .label,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:hover .icon{color:#fff}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:focus .icon,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action.hover .icon,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action:hover .icon{color:#e7eff4}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action .label,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar .tools-box .menu .action .icon{font-size:14px;font-size:1.4rem;text-shadow:none;color:#222}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar{overflow:visible;position:relative}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .action{line-height:1.6}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .icon.no-label{padding-right:0}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .tool-label-collapsed .btn-info .text,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .tool-label-collapsed-hover .btn-info:not(:hover) .text,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .btn-info.no-tool-label .text,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .btn-info.tool-label-collapsed .text,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .btn-info.tool-label-collapsed-over:not(:hover) .text{display:none}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .tool-label-collapsed .btn-info .icon,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .tool-label-collapsed-hover .btn-info:not(:hover) .icon,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .btn-info.no-tool-label .icon,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .btn-info.tool-label-collapsed .icon,.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .btn-info.tool-label-collapsed-over:not(:hover) .icon{padding:0}.test-runner-scope .action-bar.content-action-bar.horizontal-action-bar.bottom-action-bar .landmark-title--hidden{position:absolute;clip:rect(1px, 1px, 1px, 1px);overflow:hidden;height:1px;width:1px;word-wrap:normal}.test-runner-scope [data-control=\"exit\"]{margin-left:20px}.test-runner-scope [data-control=\"comment-toggle\"]{display:none}.test-runner-scope.non-lti-context .title-box{display:none}.test-runner-scope [data-control=\"qti-comment\"]{background-color:#f3f1ef;position:absolute;bottom:33px;left:8px;text-align:right;padding:5px;border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px;-webkit-box-shadow:0 0 15px 1px rgba(0,0,0,0.2);-moz-box-shadow:0 0 15px 1px rgba(0,0,0,0.2);-ms-box-shadow:0 0 15px 1px rgba(0,0,0,0.2);-o-box-shadow:0 0 15px 1px rgba(0,0,0,0.2);box-shadow:0 0 15px 1px rgba(0,0,0,0.2)}.test-runner-scope [data-control=\"qti-comment\"] textarea{display:block;height:100px;resize:none;width:350px;padding:3px;margin:0  0 10px 0;border:none;font-size:13px;font-size:1.3rem;border:1px solid #ddd;border-radius:2px;-webkit-border-radius:2px}.test-runner-scope .tools-box{position:relative;overflow:visible}.wait-content .wait-content_text--centered{text-align:center}.wait-content .wait-content_actions-list{display:-ms-flex;display:-webkit-flex;display:flex;-ms-flex-direction:row;-webkit-flex-direction:row;flex-direction:row;-ms-flex-wrap:nowrap;-webkit-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-start;justify-content:flex-start;-webkit-align-content:flex-start;align-content:flex-start;-webkit-align-items:stretch;align-items:stretch;-webkit-flex-direction:column;-moz-flex-direction:column;-ms-flex-direction:column;-o-flex-direction:column;flex-direction:column}.wait-content .wait-content_actions-list .wait-content_text--centered{position:relative;right:15px}.action-bar .shortcuts-list-wrapper{width:100%;height:100%;position:fixed;top:0;left:0;display:flex;align-items:center;align-content:center;justify-content:center;overflow:auto;background:rgba(0,0,0,0.5);z-index:10001}.action-bar .shortcuts-list-wrapper .shortcuts-list{width:auto;min-width:400px;height:auto;min-height:300px;padding:30px !important;color:#222 !important;text-shadow:none !important;position:relative;background-color:#fff;border:1px solid #ddd}.action-bar .shortcuts-list-wrapper .shortcuts-list .shortcuts-list-description{width:450px}.action-bar .shortcuts-list-wrapper .shortcuts-list .shortcuts-list-title{font-size:24px;margin-top:0}.action-bar .shortcuts-list-wrapper .shortcuts-list .shortcuts-group-title{font-size:18px;margin-top:20px}.action-bar .shortcuts-list-wrapper .shortcuts-list .shortcuts-group-title:focus{outline:3px solid #276D9B;outline-offset:3px}.action-bar .shortcuts-list-wrapper .shortcuts-list .shortcuts-group-list{list-style:none;margin:0;padding:0}.action-bar .shortcuts-list-wrapper .shortcuts-list .shortcuts-group-list .shortcut-item{display:-ms-flexbox;display:-webkit-flex;display:flex;float:none;margin:0}.action-bar .shortcuts-list-wrapper .shortcuts-list .shortcuts-group-list .shortcut-item .shortcut-item-action,.action-bar .shortcuts-list-wrapper .shortcuts-list .shortcuts-group-list .shortcut-item .shortcut-item-shortcut{-ms-flex:0 1 50%;-webkit-flex:0 1 50%;flex:0 1 50%;margin:0;text-align:center}.action-bar .shortcuts-list-wrapper .shortcuts-list .shortcuts-group-list .shortcut-item .shortcut-item-action{text-align:left}.action-bar .shortcuts-list-wrapper .shortcuts-list .btn-close{background-color:transparent;box-shadow:none;height:20px;padding:0;position:absolute;right:12px;top:10px;width:20px}.action-bar .shortcuts-list-wrapper .shortcuts-list .btn-close .icon-close{color:#222;font-size:20px;padding:0}.action-bar .shortcuts-list-wrapper .shortcuts-list .btn-close:focus{outline:3px solid #276D9B;outline-offset:3px}.jump-links-container .jump-links-box{display:block;width:0;height:0;position:absolute}.jump-links-container .jump-links-box .jump-link-item{position:fixed;display:block;z-index:1001}.jump-links-container .jump-links-box .jump-link{z-index:1002;position:fixed;display:block;overflow:hidden;top:10px;left:10px;width:0;padding:0 !important;font-size:2.4rem !important}.jump-links-container .jump-links-box .jump-link:focus{width:auto;height:auto;padding:30px !important;background:#f3f1ef;color:#222 !important;border:3px solid #222;outline:none;text-shadow:none !important}.jump-links-container .jump-links-box .jump-link:focus:hover{background:#f3f1ef;text-decoration:underline}\n\n/*# sourceMappingURL=../../../taoQtiTest/views/css/new-test-runner.css.map */"),define("taoQtiTest/loader/taoQtiTest.bundle",function(){}),define("taoQtiTest/loader/taoQtiTest.min",["taoItems/loader/taoItems.min","taoQtiItem/loader/taoQtiItem.min","taoTests/loader/taoTests.min"],function(){});
//# sourceMappingURL=taoQtiTest.min.js.map