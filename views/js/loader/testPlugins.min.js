function _typeof2(obj){return _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},_typeof2(obj)}define("core/delegator",["lodash"],function(_){'use strict';function delegator(api,provider,config){function delegate(fnName){var response,args;if(!provider)throw new Error("There is no "+name+" provider!");else if(_.isFunction(provider[fnName])||defaultProvider)args=_slice.call(arguments,1),response=(provider[fnName]||defaultProvider).apply(context,args),wrapper&&(response=wrapper(response)),eventifier&&api.trigger.apply(api,[fnName,response].concat(args));else throw new Error("There is no method called "+fnName+" in the "+name+" provider!");return response}var extendedConfig=_.defaults(config||{},defaults),eventifier=!!(extendedConfig.eventifier&&api&&api.trigger),context=extendedConfig.forward?provider:api,defaultProvider=_.isFunction(extendedConfig.defaultProvider)?extendedConfig.defaultProvider:_.noop,wrapper=_.isFunction(extendedConfig.wrapper)?extendedConfig.wrapper:null,name=extendedConfig.name;return extendedConfig.required&&(defaultProvider=null),delegate}_=_&&_.hasOwnProperty("default")?_["default"]:_;var defaults={name:"provided",eventifier:!0},_slice=[].slice;return delegator}),define("core/promise",[],function(){'use strict';return Promise}),define("core/plugin",["lodash","core/delegator","core/promise"],function(_,delegator,Promise){'use strict';function pluginFactory(provider,defaults){var pluginName;if(!_.isPlainObject(provider)||!_.isString(provider.name)||_.isEmpty(provider.name)||!_.isFunction(provider.init))throw new TypeError("A plugin should be defined at least by a name property and an init method");return pluginName=provider.name,defaults=defaults||{},function(host,areaBroker,config){var states={},pluginContent={},plugin,delegate;if(!_.isObject(host)||!_.isFunction(host.on)||!_.isFunction(host.trigger))throw new TypeError("A plugin host should be a valid eventified object");return config=_.defaults(config||{},defaults),plugin={install:function(){var self=this;return delegate("install").then(function(){self.trigger("install")})},init:function(content){var self=this;return states={},content&&(pluginContent=content),delegate("init",content).then(function(){self.setState("init",!0).trigger("init")})},render:function(){var self=this;return delegate("render").then(function(){self.setState("ready",!0).trigger("render").trigger("ready")})},finish:function(){var self=this;return delegate("finish").then(function(){self.setState("finish",!0).trigger("finish")})},destroy:function(){var self=this;return delegate("destroy").then(function(){config={},states={},self.setState("init",!1),self.trigger("destroy")})},trigger:function(name){var args=[].slice.call(arguments,1);return host.trigger.apply(host,["plugin-"+name+"."+pluginName,plugin].concat(args)),this},getHost:function(){return host},getAreaBroker:function(){return areaBroker},getConfig:function(){return config},setConfig:function(name,value){return _.isPlainObject(name)?config=_.defaults(name,config):config[name]=value,this},getState:function(name){return!!states[name]},setState:function(name,active){if(!_.isString(name)||_.isEmpty(name))throw new TypeError("The state must have a name");return states[name]=!!active,this},getContent:function(){return pluginContent},setContent:function(content){return pluginContent=content,this},getName:function(){return pluginName},show:function(){var self=this;return delegate("show").then(function(){self.setState("visible",!0).trigger("show")})},hide:function(){var self=this;return delegate("hide").then(function(){self.setState("visible",!1).trigger("hide")})},enable:function(){var self=this;return delegate("enable").then(function(){self.setState("enabled",!0).trigger("enable")})},disable:function(){var self=this;return delegate("disable").then(function(){self.setState("enabled",!1).trigger("disable")})}},delegate=delegator(plugin,provider,{eventifier:!1,wrapper:function(response){return Promise.resolve(response)}}),_.isString(defaults.hostName)&&!_.isEmpty(defaults.hostName)&&(plugin["get"+defaults.hostName.charAt(0).toUpperCase()+defaults.hostName.slice(1)]=plugin.getHost),plugin}}return _=_&&_.hasOwnProperty("default")?_["default"]:_,delegator=delegator&&delegator.hasOwnProperty("default")?delegator["default"]:delegator,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,pluginFactory}),define("taoQtiTest/runner/plugins/content/accessibility/focusOnFirstField",["jquery","lodash","taoTests/runner/plugin","ckeditor"],function($,_,pluginFactory,ckEditor){'use strict';function isIOSDevice(){return /(iPhone|iPad)/i.test(navigator.userAgent)}return pluginFactory({name:"focusOnFirstField",init:function(){var self=this;isIOSDevice()||this.getTestRunner().after("renderitem",function(){var $input=self.getAreaBroker().getContentArea().find(".qti-itemBody").find("input, textarea, select").not(":input[type=button], :input[type=submit], :input[type=reset]").first(),$cke=$input.closest(".qti-interaction").find(".cke");$cke.length?_.delay(function(){ckEditor.instances[$cke.attr("id").replace(/^cke_/,"")].focus()},100):$input.focus()})}})}),function(global,factory){"object"===("undefined"==typeof exports?"undefined":_typeof2(exports))&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define("lib/uuid",factory):(global=global||self,global.uuid=factory())}(this,function(){'use strict';var CHARS=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];return function(len,radix){var chars=CHARS,uuid=[],i,r;if(radix=radix||chars.length,len)for(i=0;i<len;i++)uuid[i]=chars[0|Math.random()*radix];else for(uuid[8]=uuid[13]=uuid[18]=uuid[23]="-",uuid[14]="4",i=0;36>i;i++)uuid[i]||(r=0|16*Math.random(),uuid[i]=chars[19===i?8|3&r:r]);return uuid.join("")}}),define("core/format",["lodash"],function(_){'use strict';function format(message){var replacements=Array.prototype.slice.call(arguments,1);return _.reduce(message.match(pattern),function(acc,match,index){var replacement="";if(void 0!==replacements[index]){switch(match){case"%d":replacement=+replacements[index];break;case"%j":try{replacement=JSON.stringify(replacements[index]).replace(/"/g,"")}catch(e){}break;default:replacement=replacements[index];}message=message.replace(match,replacement)}return message},message)}_=_&&_.hasOwnProperty("default")?_["default"]:_;var pattern=/(%[sdj])/g;return format}),define("core/logger/api",["lodash","core/format","core/promise"],function(_,format,Promise){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,format=format&&format.hasOwnProperty("default")?format["default"]:format,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise;var defaultLevel="info",levels={fatal:60,error:50,warn:40,info:30,debug:20,trace:10},logQueue=[],getLevel=function(level){return"undefined"==typeof level||_.isString(level)&&!_.has(levels,level)?defaultLevel:_.isNumber(level)?_.findKey(levels,function(l){return l===level})||defaultLevel:level},getLevelNum=function(level){return _.isString(level)&&_.has(levels,level)?levels[level]:_.isNumber(level)&&_.contains(levels,level)?level:levels[defaultLevel]},checkMinLevel=function(minLevel,level){return getLevelNum(level)>=getLevelNum(minLevel)},loggerFactory=function loggerFactory(name,minLevel,fields){var baseRecord,logger;if(!_.isString(name)||_.isEmpty(name))throw new TypeError("A logger needs a name");return _.isPlainObject(minLevel)&&"undefined"==typeof field&&(fields=minLevel,minLevel=defaultLevel),baseRecord=_.defaults(fields||{},{name:name,pid:1,hostname:navigator.userAgent}),logger={log:function(level,recordFields,message){var rest=[],time=new Date().toISOString(),record,err;if(!1!==loggerFactory.providers&&checkMinLevel(minLevel||defaultLevel,level))return _.isString(recordFields)||recordFields instanceof Error?(message=recordFields,recordFields={},rest=[].slice.call(arguments,2)):rest=[].slice.call(arguments,3),record={level:getLevel(level),v:0,time:time},checkMinLevel(levels.error,level)||message instanceof Error?(message instanceof Error?err=message:(message=_.isObject(message)?JSON.stringify(message):message,err=new Error(message)),record.msg=err.message,record.err=err):record.msg=format.apply(null,[message].concat(rest)),_.merge(record,baseRecord,recordFields),logQueue.push(record),loggerFactory.flush(),this},level:function(value){return"undefined"==typeof value?getLevel(minLevel):(minLevel=getLevelNum(value),this)},child:function(childFields){return loggerFactory(name,minLevel,_.defaults(childFields,baseRecord))}},_.reduce(levels,function(target,level,levelName){return target[levelName]=_.partial(logger.log,level),target},logger)};return loggerFactory.levels=levels,loggerFactory.providers=!1,loggerFactory.load=function(providerConfigs){var self=this,modules=[];return this.providers=[],new Promise(function(resolve,reject){_.forEach(providerConfigs,function(providerConfig,providerName){modules.push(providerName)}),require(modules,function(){var loadedProviders=[].slice.call(arguments);_.forEach(loadedProviders,function(provider,moduleKey){try{self.register(provider,providerConfigs[modules[moduleKey]])}catch(err){reject(err)}}),self.flush(),resolve()},reject)})},loggerFactory.register=function(provider,providerConfig){if(!_.isPlainObject(provider)||!_.isFunction(provider.log))throw new TypeError("A log provider is an object with a log method");provider.checkMinLevel=checkMinLevel,_.isFunction(provider.setConfig)&&provider.setConfig(providerConfig),this.providers=this.providers||[],this.providers.push(provider)},loggerFactory.flush=function(){_.isArray(this.providers)&&0<this.providers.length&&(_.forEach(logQueue,function(message){_.forEach(loggerFactory.providers,function(provider){provider.log.call(provider,message)})}),logQueue=[])},loggerFactory.setDefaultLevel=function(level){return defaultLevel=getLevel(level),defaultLevel},loggerFactory}),define("core/logger",["lodash","module","core/logger/api"],function(_,module,loggerFactory){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,module=module&&module.hasOwnProperty("default")?module["default"]:module,loggerFactory=loggerFactory&&loggerFactory.hasOwnProperty("default")?loggerFactory["default"]:loggerFactory;var defaultConfig={level:loggerFactory.levels.warn,loggers:{"core/logger/console":{level:"warn"}}},config=_.defaults(module.config()||{},defaultConfig),logger=loggerFactory("core/logger");return loggerFactory.setDefaultLevel(config.level),loggerFactory.load(config.loggers),window.onerror=function(msg,url,line,col){logger.error("Caught[via window.onerror]: '"+msg+"' from "+url+":"+line+":"+col)},window.setTaoLogLevel=function(level){return loggerFactory.setDefaultLevel(level)},loggerFactory}),define("core/eventifier",["lodash","core/promise","lib/uuid","core/logger"],function(_,Promise,uuid,loggerFactory){'use strict';function getEventNames(eventNames){return!_.isString(eventNames)||_.isEmpty(eventNames)?[]:_(eventNames.split(/\s/g)).compact().uniq().value()}function getName(eventName){return-1<eventName.indexOf(".")?eventName.substr(0,eventName.indexOf(".")):eventName}function getNamespace(eventName){return-1<eventName.indexOf(".")?eventName.substr(eventName.indexOf(".")+1):"@"}function getHandlerObject(){return{before:[],between:[],after:[]}}function eventifier(target){var eventHandlers={},getHandlers=function(eventName,type){var name=getName(eventName),ns=getNamespace(eventName);return type=type||"between",eventHandlers[ns]=eventHandlers[ns]||{},eventHandlers[ns][name]=eventHandlers[ns][name]||getHandlerObject(),eventHandlers[ns][name][type]},eventApi={on:function(eventNames,handler){return _.isFunction(handler)&&_.forEach(getEventNames(eventNames),function(eventName){getHandlers(eventName).push(handler)}),this},off:function(eventNames){return _.forEach(getEventNames(eventNames),function(eventName){var name=getName(eventName),ns=getNamespace(eventName),offNamespaces;ns&&!name?"*"===ns?(offNamespaces={},offNamespaces["@"]=eventHandlers["@"],eventHandlers=offNamespaces):eventHandlers[ns]={}:_.forEach(eventHandlers,function(nsHandlers,namespace){nsHandlers[name]&&("@"===ns||ns===namespace)&&(nsHandlers[name]=getHandlerObject())})}),this},removeAllListeners:function(){return eventHandlers={},this},trigger:function(eventNames){function triggerAllHandlers(allHandlers,name,ns){var event={name:name,namespace:ns};allHandlers.before.length?triggerBefore(allHandlers.before,event).then(function(){triggerBetween(allHandlers,event)}).catch(function(err){logHandlerStop("before",event,err)}):triggerBetween(allHandlers,event)}function triggerBefore(handlers,event){var beforeArgs=args.slice(),pHandlers;return beforeArgs.unshift(event),pHandlers=handlers.map(function(handler){var value=!shouldStop(event.name)&&handler.apply(self,beforeArgs);return!1===value?Promise.reject():value}),Promise.all(pHandlers)}function triggerBetween(allHandlers,event){shouldStop(event.name)?logHandlerStop("before",event):triggerHandlers(allHandlers.between,event).then(function(){triggerAfter(allHandlers.after,event)}).catch(function(err){logHandlerStop("on",event,err)})}function triggerAfter(handlers,event){shouldStop(event.name)?logHandlerStop("on",event):triggerHandlers(handlers,event).then(function(){shouldStop(event.name)&&logHandlerStop("after",event)}).catch(function(err){logHandlerStop("after",event,err)})}function triggerHandlers(handlers,event){var pHandlers;return pHandlers=handlers.map(function(handler){return shouldStop(event.name)?Promise.reject():handler.apply(self,args)}),Promise.all(pHandlers)}function logHandlerStop(stoppedIn,event,err){err instanceof Error&&logger.error(err),logger.trace({err:err,event:event.name,stoppedIn:stoppedIn},event.name+" handlers stopped")}function shouldStop(name){return stoppedEvents[name]}var self=this,args=[].slice.call(arguments,1);return stoppedEvents={},_.forEach(getEventNames(eventNames),function(eventName){var ns=getNamespace(eventName),name=getName(eventName),mergedHandlers=_(eventHandlers).filter(function(nsHandlers,namespace){return nsHandlers[name]&&("@"===ns||ns===namespace||"*"===namespace)}).reduce(function(acc,nsHandlers){return acc.before=acc.before.concat(nsHandlers[name].before),acc.between=acc.between.concat(nsHandlers[name].between),acc.after=acc.after.concat(nsHandlers[name].after),acc},getHandlerObject());logger.trace({event:eventName,args:args},"trigger %s",eventName),mergedHandlers&&triggerAllHandlers(mergedHandlers,name,ns)}),this},before:function(eventNames,handler){return _.isFunction(handler)&&_.forEach(getEventNames(eventNames),function(eventName){getHandlers(eventName,"before").push(handler)}),this},after:function(eventNames,handler){return _.isFunction(handler)&&_.forEach(getEventNames(eventNames),function(eventName){getHandlers(eventName,"after").push(handler)}),this},stopEvent:function(name){_.isString(name)&&!_.isEmpty(name.trim())&&(stoppedEvents[name.trim()]=!0)},spread:function(destination,eventNames){var self=this;return destination&&_.isFunction(destination.trigger)&&(_.isString(eventNames)&&(eventNames=getEventNames(eventNames)),_.forEach(eventNames,function(eventName){self.on(eventName,function(){var args=[eventName].concat([].slice.call(arguments));destination.trigger.apply(destination,args)})})),this}},targetName,logger,stoppedEvents;return target=target||{},targetName=target.name||target.id||target.serial||uuid(6),logger=eventifierLogger.child({target:targetName}),_(eventApi).functions().forEach(function(method){_.isFunction(target[method])&&eventifierLogger.warn("The target object has already a method named "+method,target),target[method]=function(){var args=[].slice.call(arguments);return eventApi[method].apply(target,args)}}),target}_=_&&_.hasOwnProperty("default")?_["default"]:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,uuid=uuid&&uuid.hasOwnProperty("default")?uuid["default"]:uuid,loggerFactory=loggerFactory&&loggerFactory.hasOwnProperty("default")?loggerFactory["default"]:loggerFactory;var eventifierLogger=loggerFactory("core/eventifier");return eventifier}),define("util/namespace",["lodash"],function(_){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_;var reSplit=/\s/g,namespaceSep=".",namespaceHelper={split:function(names,normalize){return!_.isString(names)||_.isEmpty(names)?[]:(normalize&&(names=names.toLowerCase()),_(names.trim().split(reSplit)).compact().uniq().value())},getName:function(namespaced){return!_.isString(namespaced)||_.isEmpty(namespaced)?"":-1<namespaced.indexOf(namespaceSep)?namespaced.substr(0,namespaced.indexOf(namespaceSep)):namespaced},getNamespace:function(namespaced,defaultNs){return!_.isString(namespaced)||_.isEmpty(namespaced)?"":-1<namespaced.indexOf(namespaceSep)?namespaced.substr(namespaced.indexOf(namespaceSep)+1):defaultNs||"@"},namespaceAll:function(names,namespace,normalize){var suffix;return _.isArray(names)||(names=namespaceHelper.split(names,normalize)),normalize&&(namespace=namespace.toLowerCase()),suffix=namespace?namespaceSep+namespace:"",_(names).map(function(sh){return 0>sh.indexOf(namespaceSep)?sh+suffix:sh}).compact().uniq().value().join(" ")}};return namespaceHelper}),define("util/shortcut/registry",["jquery","lodash","util/namespace"],function($,_,namespaceHelper){'use strict';var _StringfromCharCode=String.fromCharCode;function registerEvent(target,eventName,listener){target.addEventListener?target.addEventListener(eventName,listener,!1):target.attachEvent?target.attachEvent("on"+eventName,listener):target["on"+eventName]=listener}function unregisterEvent(target,eventName,listener){target.removeEventListener?target.removeEventListener(eventName,listener,!1):target.detachEvent?target.detachEvent("on"+eventName,listener):target["on"+eventName]=null}function getActualKey(event){var code=event.which||event.keyCode,character=32<=code?_StringfromCharCode(code).toLowerCase():"",key=event.key&&event.key.toLowerCase(),keyName=event.code&&event.code.toLowerCase();return keyName&&(0===keyName.indexOf("key")?("a">key||"z"<key)&&"a"<=character&&"z">=character&&(key=character):0===keyName.indexOf("digit")&&(key=keyName.substr(5))),specialKeys[code]||key||character}function getActualButton(event){var buttons={clickLeft:!1,clickRight:!1,clickMiddle:!1,clickBack:!1,clickForward:!1};if(event.buttons)buttons.clickLeft=!!(1&event.buttons),buttons.clickRight=!!(2&event.buttons),buttons.clickMiddle=!!(4&event.buttons),buttons.clickBack=!!(8&event.buttons),buttons.clickForward=!!(16&event.buttons);else switch(event.button){case 0:buttons.clickLeft=!0;break;case 1:buttons.clickMiddle=!0;break;case 2:buttons.clickRight=!0;break;case 3:buttons.clickBack=!0;break;case 4:buttons.clickForward=!0;}return buttons}function getActualScroll(event){return{scrollUp:0>event.deltaY,scrollDown:0<event.deltaY}}function normalizeCommand(descriptor){var key=translateKeys[descriptor.key]||descriptor.key,parts=[];return descriptor.ctrlKey&&parts.push("control"),descriptor.altKey&&parts.push("alt"),descriptor.shiftKey&&parts.push("shift"),descriptor.metaKey&&parts.push("meta"),descriptor.scrollDown&&parts.push("scrollDown"),descriptor.scrollUp&&parts.push("scrollUp"),descriptor.clickLeft&&parts.push("clickLeft"),descriptor.clickRight&&parts.push("clickRight"),descriptor.clickMiddle&&parts.push("clickMiddle"),descriptor.clickBack&&parts.push("clickBack"),descriptor.clickForward&&parts.push("clickForward"),key&&0>parts.indexOf(key)&&parts.push(key),parts.join("+")}function parseCommand(shortcut){var parts=namespaceHelper.getName(shortcut).split("+"),descriptor={keyboardInvolved:!1,mouseClickInvolved:!1,mouseWheelInvolved:!1,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,key:null,scrollUp:null,scrollDown:null,clickLeft:null,clickRight:null,clickMiddle:null,clickBack:null,clickForward:null};return _.forEach(parts,function(part){if(modifiers[part])descriptor[modifiers[part]]=!0;else if(0<=part.indexOf("mouse")){if(descriptor.keyboardInvolved)throw new Error("A shortcut cannot involve both mouse and regular keys!");0<=part.indexOf("scroll")&&(descriptor.mouseWheelInvolved=!0,descriptor.scrollUp=0<=part.indexOf("up"),descriptor.scrollDown=0<=part.indexOf("down")),0<=part.indexOf("click")&&(descriptor.mouseClickInvolved=!0,descriptor.clickLeft=0<=part.indexOf("left"),descriptor.clickRight=0<=part.indexOf("right"),descriptor.clickMiddle=0<=part.indexOf("middle"),descriptor.clickBack=0<=part.indexOf("back"),descriptor.clickForward=0<=part.indexOf("forward"))}else{if(descriptor.mouseClickInvolved||descriptor.mouseWheelInvolved)throw new Error("A shortcut cannot involve both mouse and regular keys!");descriptor.keyboardInvolved=!0,descriptor.key=part}}),descriptor}$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,namespaceHelper=namespaceHelper&&namespaceHelper.hasOwnProperty("default")?namespaceHelper["default"]:namespaceHelper;var modifiers={ctrl:"ctrlKey",alt:"altKey",option:"altKey",shift:"shiftKey",meta:"metaKey",cmd:"metaKey",win:"metaKey"},translateKeys={escape:"esc",arrowdown:"down",arrowleft:"left",arrowright:"right",arrowup:"up"},specialKeys={8:"backspace",9:"tab",13:"enter",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",91:"meta",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",145:"scrolllock",144:"numlock"};return function(root,defaultOptions){function getHandlers(command,namespace){return handlers[namespace]=handlers[namespace]||{},handlers[namespace][command]=handlers[namespace][command]||[],handlers[namespace][command]}function getCommandHandlers(command){return _.reduce(handlers,function(acc,nsHandlers){return nsHandlers[command]&&(acc=acc.concat(nsHandlers[command])),acc},[])}function clearHandlers(command,namespace){namespace&&!command?handlers[namespace]={}:_.forEach(handlers,function(nsHandlers,ns){nsHandlers[command]&&("*"===namespace||namespace===ns)&&(nsHandlers[command]=[])})}function setOptions(descriptor,options){descriptor.options=_.defaults(_.merge(descriptor.options||{},options),defaultOptions)}function registerKeyboard(){keyboardIsRegistered||(registerEvent(root,"keydown",onKeyboard),keyboardIsRegistered=!0),keyboardCount++}function unregisterKeyboard(){keyboardCount--,0>=keyboardCount&&(keyboardCount=0,keyboardIsRegistered&&(unregisterEvent(root,"keydown",onKeyboard),keyboardIsRegistered=!1))}function registerMouseClick(){mouseClickIsRegistered||(registerEvent(root,"click",onMouseClick),mouseClickIsRegistered=!0),mouseClickCount++}function unregisterMouseClick(){mouseClickCount--,0>=mouseClickCount&&(mouseClickCount=0,mouseClickIsRegistered&&(unregisterEvent(root,"click",onMouseClick),mouseClickIsRegistered=!1))}function registerMouseWheel(){mouseWheelIsRegistered||(registerEvent(root,"wheel",onMouseWheel),mouseWheelIsRegistered=!0),mouseWheelCount++}function unregisterMouseWheel(){mouseWheelCount--,0>=mouseWheelCount&&(mouseWheelCount=0,mouseWheelIsRegistered&&(unregisterEvent(root,"wheel",onMouseWheel),mouseWheelIsRegistered=!1))}function registerCommand(command,descriptor){shortcuts[command]=descriptor,descriptor.keyboardInvolved&&registerKeyboard(),descriptor.mouseClickInvolved&&registerMouseClick(),descriptor.mouseWheelInvolved&&registerMouseWheel()}function unregisterCommand(command){var descriptor=shortcuts[command];shortcuts[command]=null,descriptor&&(descriptor.keyboardInvolved&&unregisterKeyboard(),descriptor.mouseClickInvolved&&unregisterMouseClick(),descriptor.mouseWheelInvolved&&unregisterMouseWheel())}function onKeyboard(event){processShortcut(event,{keyboardInvolved:!0,ctrlKey:event.ctrlKey,altKey:event.altKey,shiftKey:event.shiftKey,metaKey:event.metaKey,key:getActualKey(event)})}function onMouseClick(event){processShortcut(event,_.merge({mouseClickInvolved:!0,ctrlKey:event.ctrlKey,altKey:event.altKey,shiftKey:event.shiftKey,metaKey:event.metaKey},getActualButton(event)))}function onMouseWheel(event){processShortcut(event,_.merge({mouseClickInvolved:!0,ctrlKey:event.ctrlKey,altKey:event.altKey,shiftKey:event.shiftKey,metaKey:event.metaKey},getActualScroll(event)))}function processShortcut(event,descriptor){var command=normalizeCommand(descriptor),shortcut=shortcuts[command],shortcutHandlers,$target;if(shortcut&&!states.disabled){if(!0===shortcut.options.avoidInput&&($target=$(event.target),$target.closest("[type=\"text\"],textarea").length&&(!shortcut.options.allowIn||!$target.closest(shortcut.options.allowIn).length)))return;!1===shortcut.options.propagate&&event.stopPropagation(),!0===shortcut.options.prevent&&event.preventDefault(),shortcutHandlers=getCommandHandlers(command),shortcutHandlers&&_.forEach(shortcutHandlers,function(handler){handler(event,command)})}}var keyboardIsRegistered=!1,mouseClickIsRegistered=!1,mouseWheelIsRegistered=!1,keyboardCount=0,mouseClickCount=0,mouseWheelCount=0,shortcuts={},handlers={},states={};return root.jquery&&(root=root.get(0)),{set:function(shortcut,options){return _.forEach(namespaceHelper.split(shortcut,!0),function(normalized){var descriptor=parseCommand(normalized),command=normalizeCommand(descriptor);setOptions(descriptor,options),registerCommand(command,descriptor)}),this},add:function(shortcut,handler,options){return _.isFunction(handler)&&_.forEach(namespaceHelper.split(shortcut,!0),function(normalized){var namespace=namespaceHelper.getNamespace(normalized,"*"),descriptor=parseCommand(normalized),command=normalizeCommand(descriptor);setOptions(descriptor,options),registerCommand(command,descriptor),getHandlers(command,namespace).push(handler)}),this},remove:function(shortcut){return _.forEach(namespaceHelper.split(shortcut,!0),function(normalized){var namespace=namespaceHelper.getNamespace(normalized,"*"),descriptor=parseCommand(normalized),command=normalizeCommand(descriptor);clearHandlers(command,namespace),getCommandHandlers(command).length||unregisterCommand(command)}),this},exists:function(shortcut){var normalized=(shortcut+"").trim().toLowerCase(),namespace=namespaceHelper.getNamespace(normalized,"*"),descriptor=parseCommand(normalized),command=normalizeCommand(descriptor),shortcutExists=!1;return shortcuts[command]?shortcutExists="*"===namespace||!!getHandlers(command,namespace).length:!command&&(shortcutExists=!_.isEmpty(handlers[namespace])),shortcutExists},clear:function(){return shortcuts={},handlers={},keyboardCount=0,mouseClickCount=0,mouseWheelCount=0,unregisterKeyboard(),unregisterMouseClick(),unregisterMouseWheel(),this},getState:function(name){return!!states[name]},setState:function(name,state){return states[name]=!!state,this},enable:function(){return this.setState("disabled",!1),this},disable:function(){return this.setState("disabled",!0),this}}}}),define("ui/keyNavigation/navigator",["jquery","lodash","core/eventifier","util/shortcut/registry"],function($,_,eventifier,shortcutRegistry){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,eventifier=eventifier&&eventifier.hasOwnProperty("default")?eventifier["default"]:eventifier,shortcutRegistry=shortcutRegistry&&shortcutRegistry.hasOwnProperty("default")?shortcutRegistry["default"]:shortcutRegistry;var _navigationGroups={},_ns=".ui-key-navigator",_defaults={defaultPosition:0,keepState:!1,replace:!1,loop:!1,propagateTab:!0},isNavigableElement=function(navElement){return navElement&&_.isFunction(navElement.init)&&_.isFunction(navElement.destroy)&&_.isFunction(navElement.getElement)&&_.isFunction(navElement.isVisible)&&_.isFunction(navElement.isEnabled)&&_.isFunction(navElement.focus)},keyNavigatorFactory=function(config){var _cursor={position:-1,navigable:null},getCurrentCursor=function(){var isFocused=!1;return document.activeElement&&_.forEach(navigables,function(navigable,index){if(navigable.isVisible()&&navigable.isEnabled()&&(document.activeElement===navigable.getElement().get(0)||(!$(document.activeElement).hasClass("key-navigation-highlight")||$(document.activeElement).data("key-navigatior-id")!==id)&&$.contains(navigable.getElement().get(0),document.activeElement)))return _cursor.position=index,_cursor.navigable=navigable,isFocused=!0,!1}),isFocused?_cursor:null},getClosestPositionRight=function(fromPosition){var pos;for(pos=fromPosition;pos<navigables.length;pos++)if(navigables[pos]&&navigables[pos].isVisible()&&navigables[pos].isEnabled())return pos;return-1},getClosestPositionLeft=function(fromPosition){var pos;for(pos=fromPosition;0<=pos;pos--)if(navigables[pos]&&navigables[pos].isVisible()&&navigables[pos].isEnabled())return pos;return-1},id,navigables,keyNavigator,$group;if(config=_.defaults(config||{},_defaults),id=config.id||_.uniqueId("navigator_"),navigables=config.elements||[],_navigationGroups[id])if(config.replace)_navigationGroups[id].destroy();else throw new TypeError("the navigation group id is already in use : "+id);if(_.each(navigables,function(navigable){navigable.init(),navigable.getElement().data("key-navigatior-id",id)}),config.group)if($group=$(config.group),$group.length)$group.addClass("key-navigation-group").attr("data-navigation-id",id);else throw new TypeError("group element does not exist");return keyNavigator=eventifier({getId:function(){return id},getGroup:function(){return $group},isFocused:function(){return!!getCurrentCursor()},next:function(){var cursor=getCurrentCursor(),pos;return cursor?(pos=getClosestPositionRight(cursor.position+1),0<=pos?this.focusPosition(pos):config.loop?this.focusPosition(getClosestPositionRight(0)):this.trigger("upperbound"),this.trigger("next",getCurrentCursor())):this.focusPosition(getClosestPositionRight(0)),this},previous:function(){var cursor=getCurrentCursor(),pos;return cursor?(pos=getClosestPositionLeft(cursor.position-1),0<=pos?this.focusPosition(pos):config.loop?this.focusPosition(getClosestPositionLeft(navigables.length-1)):this.trigger("lowerbound"),this.trigger("previous",getCurrentCursor())):this.focusPosition(getClosestPositionRight(0)),this},activate:function(target){var cursor=getCurrentCursor();return cursor&&this.trigger("activate",cursor,target),this},goto:function(groupId){return _navigationGroups[groupId]?_navigationGroups[groupId].focus():this.trigger("error",new Error("goto an unknown navigation group")),this},focus:function(originNavigator){var pos;return config.keepState&&_cursor&&0<=_cursor.position?pos=_cursor.position:_.isFunction(config.defaultPosition)?(pos=config.defaultPosition(navigables),0>pos&&(pos=0)):pos=config.defaultPosition,this.focusPosition(getClosestPositionRight(pos),originNavigator),this},focusPosition:function(position,originNavigator){return navigables[position]&&(_cursor.navigable&&this.trigger("blur",this.getCursor(),originNavigator),_cursor.position=position,navigables[_cursor.position].focus(),_cursor.navigable=navigables[_cursor.position],this.trigger("focus",this.getCursor(),originNavigator)),this},first:function(){return this.focusPosition(getClosestPositionRight(0)),this},last:function(){return this.focusPosition(getClosestPositionLeft(navigables.length-1)),this},destroy:function(){return _.each(navigables,function(navigable){navigable.getElement().off(_ns),navigable.destroy(),navigable.shortcuts&&navigable.shortcuts.clear()}),delete _navigationGroups[id],this},blur:function(){var cursor=this.getCursor();return cursor&&cursor.navigable&&cursor.navigable.getElement().blur(),this},getCursor:function(){return _.clone(_cursor)},getNavigables:function(){return _.clone(navigables)}}),_.each(navigables,function(navigable){if(!isNavigableElement(navigable))throw new TypeError("not a valid navigable element");navigable.shortcuts=shortcutRegistry(navigable.getElement()).add("tab shift+tab",function(e,key){keyNavigator.trigger(key,e.target)},{propagate:!!config.propagateTab,prevent:!0}).add("enter",function(e){$(e.target).is(":text,textarea")||(e.preventDefault(),keyNavigator.activate(e.target))},{propagate:!1}).add("up down left right",function(e,key){var $target=$(e.target);$target.is(":text,textarea")||(!$target.is("img")&&!$target.hasClass("key-navigation-scrollable")&&e.preventDefault(),keyNavigator.trigger(key,e.target))},{propagate:!1}),navigable.getElement().on("keyup"+_ns,function(e){var keyCode=e.keyCode?e.keyCode:e.charCode;32===keyCode&&(e.target!==this&&$(e.target).is(":input")?e.stopPropagation():(e.preventDefault(),keyNavigator.activate(e.target)))}).on("blur"+_ns,function(){var cursor=keyNavigator.getCursor();cursor&&cursor.navigable&&keyNavigator.trigger("blur",cursor)})}),_navigationGroups[id]=keyNavigator,keyNavigator};return keyNavigatorFactory.get=function(id){if(_navigationGroups[id])return _navigationGroups[id]},keyNavigatorFactory}),define("ui/keyNavigation/navigableDomElement",["jquery","core/eventifier"],function($,eventifier){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,eventifier=eventifier&&eventifier.hasOwnProperty("default")?eventifier["default"]:eventifier;var navigableDomElement=function($element){return $element=$($element),eventifier({init:function(){if(!$element.length)throw new TypeError("dom element does not exist");return $element.attr("tabindex",-1),$element.addClass("key-navigation-highlight"),this},destroy:function(){return $element.removeClass("key-navigation-highlight"),this},getElement:function(){return $element},isVisible:function(){return $element.is(":visible")},isEnabled:function(){return!$element.is(":disabled")},focus:function(){return $element.focus(),this}})};return navigableDomElement.createFromDoms=function($elements){var list=[];return $elements.each(function(){list.push(navigableDomElement($(this)))}),list},navigableDomElement}),define("ui/keyNavigation/navigableGroupElement",["jquery","lodash","core/eventifier"],function($,_,eventifier){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,eventifier=eventifier&&eventifier.hasOwnProperty("default")?eventifier["default"]:eventifier;var navigableGroupElementFactory=function(keyNavigator){var $group;if(!keyNavigator)throw new TypeError("the navigation group does not exist");if($group=keyNavigator.getGroup(),!$group.length||!$.contains(document,$group[0]))throw new TypeError("the group dom element does not exist");return eventifier({init:function(){return $group.on("focusin.navigable-group-element",function(){$group.addClass("focusin")}).on("focusout.navigable-group-element",function(){_.defer(function(){document.activeElement&&$.contains($group.get(0),document.activeElement)||$group.removeClass("focusin")})}),this},destroy:function(){return $group.removeClass("focusin").off(".navigable-group-element"),this},getElement:function(){return $group},isVisible:function(){var hasVisibleNavigable=!1;return!!$group.is(":visible")&&(_.forEach(keyNavigator.getNavigables(),function(nav){if(nav.isVisible())return hasVisibleNavigable=!0,!1}),hasVisibleNavigable)},isEnabled:function(){var hasEnabledNavigable=!1;return!$group.is(":disabled")&&(_.forEach(keyNavigator.getNavigables(),function(nav){if(nav.isEnabled())return hasEnabledNavigable=!0,!1}),hasEnabledNavigable)},focus:function(){return keyNavigator.focus(this),this}})};return navigableGroupElementFactory.createFromNavigators=function(keyNavigators){var list=[];return _.each(keyNavigators,function(keyNavigator){list.push(navigableGroupElementFactory(keyNavigator))}),list},navigableGroupElementFactory}),define("util/shortcut",["util/shortcut/registry"],function(shortcutRegistry){'use strict';shortcutRegistry=shortcutRegistry&&shortcutRegistry.hasOwnProperty("default")?shortcutRegistry["default"]:shortcutRegistry;var shortcut=shortcutRegistry(window,{propagate:!1,prevent:!0});return shortcut}),define("css!taoQtiTestCss/plugins/key-navigation",[],function(){}),define("taoQtiTest/runner/plugins/content/accessibility/keyNavigation",["jquery","lodash","ui/keyNavigation/navigator","ui/keyNavigation/navigableDomElement","ui/keyNavigation/navigableGroupElement","util/shortcut","util/namespace","taoTests/runner/plugin","css!taoQtiTestCss/plugins/key-navigation"],function($,_,keyNavigator,navigableDomElement,navigableGroupElement,shortcut,namespaceHelper,pluginFactory){'use strict';function initToolbarNavigation(){var $navigationBar=$(".bottom-action-bar"),$focusables=$navigationBar.find(".action:not(.btn-group):visible, .action.btn-group .li-inner:visible"),navigables=navigableDomElement.createFromDoms($focusables);return navigables.length?[keyNavigator({id:"bottom-toolbar",replace:!0,group:$navigationBar,elements:navigables,defaultPosition:navigables.length-1}).on("right down",function(elem){return!!allowedToNavigateFrom(elem)&&void this.next()}).on("left up",function(elem){return!!allowedToNavigateFrom(elem)&&void this.previous()}).on("activate",function(cursor){cursor.navigable.getElement().click().mousedown()})]:[]}function initHeaderNavigation(){var $headerElements=$("[data-control=\"exit\"]:visible a"),navigables=navigableDomElement.createFromDoms($headerElements);return navigables.length?[keyNavigator({id:"header-toolbar",group:$headerElements.closest(".infoControl"),elements:navigables,loop:!0,replace:!0}).on("activate",function(cursor){cursor.navigable.getElement().click()})]:[]}function initNavigatorNavigation(testRunner){var $panel=testRunner.getAreaBroker().getPanelArea(),$navigator=$panel.find(".qti-navigator"),navigators=[],itemListingVisited=!1,filtersNavigator,itemsNavigator,$filters,$trees,navigableFilters,navigableTrees,filterCursor;return $navigator.length&&!$navigator.hasClass("disabled")&&($filters=$navigator.find(".qti-navigator-filters .qti-navigator-filter"),navigableFilters=navigableDomElement.createFromDoms($filters),navigableFilters.length&&(filtersNavigator=keyNavigator({keepState:!0,id:"navigator-filters",replace:!0,elements:navigableFilters,group:$navigator}).on("right",function(elem){return!!allowedToNavigateFrom(elem)&&void this.next()}).on("left",function(elem){return!!allowedToNavigateFrom(elem)&&void this.previous()}).on("down",function(elem){return!!allowedToNavigateFrom(elem)&&void(itemsNavigator&&_.defer(function(){itemListingVisited?itemsNavigator.focus().first():itemsNavigator.focus()}))}).on("up",function(elem){return!!allowedToNavigateFrom(elem)&&void(itemsNavigator&&_.defer(function(){itemsNavigator.last()}))}).on("focus",function(cursor,origin){cursor.navigable.getElement().click(),(filterCursor&&filterCursor.position!==cursor.position||origin)&&(itemListingVisited=!1),filterCursor=cursor}),navigators.push(filtersNavigator)),$trees=$navigator.find(".qti-navigator-tree .qti-navigator-item:not(.unseen) .qti-navigator-label"),navigableTrees=navigableDomElement.createFromDoms($trees),navigableTrees.length&&(itemsNavigator=keyNavigator({id:"navigator-items",replace:!0,elements:navigableTrees,defaultPosition:function(navigables){var pos=0;return filterCursor&&"flagged"!==filterCursor.navigable.getElement().data("mode")&&_.forIn(navigables,function(navigable,i){var $parent=navigable.getElement().parent(".qti-navigator-item");if($parent.hasClass("active")&&$parent.is(":visible"))return pos=i,!1}),pos}}).on("down",function(elem){return!!allowedToNavigateFrom(elem)&&void this.next()}).on("up",function(elem){return!!allowedToNavigateFrom(elem)&&void this.previous()}).on("right",function(elem){return!!allowedToNavigateFrom(elem)&&void(filtersNavigator&&filtersNavigator.focus().next())}).on("left",function(elem){return!!allowedToNavigateFrom(elem)&&void(filtersNavigator&&filtersNavigator.focus().previous())}).on("activate",function(cursor){cursor.navigable.getElement().click()}).on("lowerbound upperbound",function(){filtersNavigator&&filtersNavigator.focus()}).on("focus",function(cursor){itemListingVisited=!0,cursor.navigable.getElement().parent().addClass("key-navigation-highlight")}).on("blur",function(cursor){cursor.navigable.getElement().parent().removeClass("key-navigation-highlight")}))),navigators}function initDefaultContentNavigation(testRunner){var itemNavigators=[],$content=testRunner.getAreaBroker().getContentArea();return $content.find(".key-navigation-focusable").addClass("key-navigation-scrollable"),$content.find(".key-navigation-focusable,.qti-interaction").filter(function(){return!$(this).parents(".qti-interaction").length}).each(function(){var $itemElement=$(this);$itemElement.hasClass("qti-interaction")?itemNavigators=_.union(itemNavigators,initInteractionNavigation($itemElement)):itemNavigators.push(keyNavigator({elements:navigableDomElement.createFromDoms($itemElement),group:$itemElement,propagateTab:!1}))}),itemNavigators}function initAllContentButtonsNavigation(testRunner){var navigableElements=[],$content=testRunner.getAreaBroker().getContentArea(),$qtiIteractionsNodeList=$content.find(".key-navigation-focusable,.qti-interaction").filter(function(){return!$(this).parents(".qti-interaction").length}),$qtiChoiceNodesList=$qtiIteractionsNodeList.find(".qti-choice");return $content.find(".key-navigation-focusable").addClass("key-navigation-scrollable"),$qtiChoiceNodesList.each(function(){var $itemElement=$(this),keyNavigatorItem=keyNavigator({elements:navigableDomElement.createFromDoms($itemElement),group:$itemElement,propagateTab:!1});keyNavigatorItem.on("activate",function(cursor){var $elt=cursor.navigable.getElement();$elt.is(":checkbox")?$elt.each(function(){this.click()}):$elt.click()}),navigableElements.push(keyNavigatorItem)}),navigableElements}function initInteractionNavigation($interaction){var interactionNavigators=[],$inputs,interactionNavigables;if($interaction.find(".key-navigation-focusable").each(function(){var $nav=$(this);$nav.closest(".qti-choice").length||interactionNavigators.push(keyNavigator({elements:navigableDomElement.createFromDoms($nav),group:$nav,propagateTab:!1}))}),$interaction.off(".keyNavigation"),$inputs=$interaction.is(":input")?$interaction:$interaction.find(":input"),interactionNavigables=navigableDomElement.createFromDoms($inputs),interactionNavigables.length){var keyNavigatorItem=keyNavigator({elements:interactionNavigables,group:$interaction,loop:!1});keyNavigatorItem.on("right down",function(elem){return!!allowedToNavigateFrom(elem)&&void this.next()}).on("left up",function(elem){return!!allowedToNavigateFrom(elem)&&void this.previous()}).on("activate",function(cursor){var $elt=cursor.navigable.getElement();$elt.is(":checkbox")?$elt.each(function(){this.click()}):$elt.click()}).on("focus",function(cursor){cursor.navigable.getElement().closest(".qti-choice").addClass("key-navigation-highlight")}).on("blur",function(cursor){cursor.navigable.getElement().closest(".qti-choice").removeClass("key-navigation-highlight")}),interactionNavigators.push(keyNavigatorItem)}return interactionNavigators}function initRubricNavigation(){var rubricNavigators=[],$rubricArea=$("#qti-rubrics"),$itemElements;return $itemElements=$rubricArea.find(".qti-rubricBlock"),$itemElements.each(function(){var $itemElement=$(this),id="rubric_element_navigation_group_"+rubricNavigators.length;rubricNavigators.push(keyNavigator({id:id,elements:navigableDomElement.createFromDoms($itemElement),group:$itemElement,replace:!0}))}),rubricNavigators}function initTestRunnerNavigation(testRunner,config){var keyNavigatorItem,navigators;switch(document.activeElement&&document.activeElement.blur(),config.contentNavigatorType){case"linear":navigators=_.union(initRubricNavigation(testRunner),initAllContentButtonsNavigation(testRunner),initToolbarNavigation(testRunner),initNavigatorNavigation(testRunner),initHeaderNavigation(testRunner));break;default:navigators=_.union(initRubricNavigation(testRunner),initDefaultContentNavigation(testRunner),initToolbarNavigation(testRunner),initNavigatorNavigation(testRunner),initHeaderNavigation(testRunner));}return navigators=navigableGroupElement.createFromNavigators(navigators),keyNavigatorItem=keyNavigator({id:"test-runner",replace:!0,loop:!0,elements:navigators}),keyNavigatorItem.on("tab",function(elem){allowedToNavigateFrom(elem)&&this.next()}).on("shift+tab",function(elem){allowedToNavigateFrom(elem)&&this.previous()}),"linear"===config.contentNavigatorType&&keyNavigatorItem.on("right",function(elem){var isCurrentElementFirst=$(elem).is(":first-child");isCurrentElementFirst&&allowedToNavigateFrom(elem)&&this.next()}).on("left",function(elem){var isCurrentElementLast=$(elem).is(":last-child");isCurrentElementLast&&allowedToNavigateFrom(elem)&&this.previous()}),keyNavigatorItem}function allowedToNavigateFrom(element){var $element=$(element);return!($element.hasClass("no-key-navigation")||0<$element.parents(".no-key-navigation").length)}var defaultPluginConfig={contentNavigatorType:"default"};return pluginFactory({name:"keyNavigation",init:function(){var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginConfig=_.defaults((testConfig.plugins||{})[self.getName()]||{},defaultPluginConfig);this.disable(),testRunner.after("renderitem",function(){self.groupNavigator=initTestRunnerNavigation(testRunner,pluginConfig),shortcut.add("tab shift+tab",function(e){return!!allowedToNavigateFrom(e.target)&&void(!self.groupNavigator.isFocused()&&self.groupNavigator.focus())})}).on("unloaditem",function(){self.disable()}).on("setcontenttabtype",function(type){pluginConfig.contentNavigatorType=type})},destroy:function(){shortcut.remove("."+this.getName()),this.groupNavigator&&this.groupNavigator.destroy()}})}),define("core/pluginifier",["jquery","lodash"],function($,_){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_;var basePlugin={options:function(dataNs,ns,_options){return this.each(function(){var $elt=$(this),currentOptions=$elt.data(dataNs);currentOptions&&$elt.data(dataNs,_.merge(currentOptions,_options))})},disable:function(dataNs,ns){return this.each(function(){var $elt=$(this),options=$elt.data(dataNs);options&&$elt.addClass(options.disableClass||"disabled").trigger("disable."+ns)})},enable:function(dataNs,ns){return this.each(function(){var $elt=$(this),options=$elt.data(dataNs);options&&$elt.removeClass(options.disableClass||"disabled").trigger("enable."+ns)})}};return{register:function(pluginName,plugin,config){config=config||{};var ns=config.ns||pluginName.toLowerCase(),dataNs=config.dataNs||"ui."+ns,expose=config.expose||[];return _.isFunction($.fn[pluginName])?$.error("A plugin named "+pluginName+" is already registered"):_.isPlainObject(plugin)&&_.isFunction(plugin.init)?void(_.assign(plugin,_.transform(basePlugin,function(result,prop,key){_.isFunction(prop)&&(result[key]=_.partial(basePlugin[key],dataNs,ns))})),_.forEach(expose,function(toExposeName){var privateMethod=toExposeName,publicMethod=toExposeName;/^_/.test(expose)?publicMethod=publicMethod.replace(/^_/,""):privateMethod="_"+privateMethod,_.isFunction(plugin[privateMethod])&&!_.isFunction(plugin[publicMethod])&&(plugin[publicMethod]=function(){var args=Array.prototype.slice.call(arguments,0),returnValue;return this.each(function(){returnValue=plugin[privateMethod].apply(plugin,[$(this)].concat(args))}),returnValue||this})}),$.fn[pluginName]=function(method){if(plugin[method]){if(/^_/.test(method))$.error("Trying to call a private method `"+method+"`");else return plugin[method].apply(this,Array.prototype.slice.call(arguments,1));}else if("object"===_typeof(method)||!method)return plugin.init.apply(this,arguments);$.error("Method "+method+" does not exist on plugin")}):$.error("The object to register as a jQuery plugin must be a plain object with an `init` method.")}}}),define("core/dataattrhandler",["jquery","lodash"],function($,_){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_;var defaults={container:!1,listenerEvent:"click",useTarget:!0,bubbled:!1},letDefaultOn=[":radio",":checkbox"],shouldPreventDefault=function($elt){return!$elt.is(letDefaultOn.join(","))},DataAttrHandler=function(attrName,options){var self=this;this.options=_.defaults(options,defaults);var selector="[data-"+attrName+"]";return _.has(this.options,"namespace")&&_.isString(this.options.namespace)?void(this.options.container&&this.options.container.selector&&(selector=this.options.container.selector+" "+selector),this.options.inner&&(selector+=" "+this.options.inner),$(document).off(this.options.listenerEvent,selector).on(this.options.listenerEvent,selector,function(e){var $elt=$(e.target);if(!0===self.options.bubbled||$elt.is(selector)){var $target,$outer;void 0===$elt.data(attrName)&&(self.options.inner||self.options.bubbled)&&($outer=$elt,$elt=$elt.parents("[data-"+attrName+"]")),$target=!0===self.options.useTarget?DataAttrHandler.getTarget(attrName,$elt):self.options.inner?$outer:void 0,$elt.data(self.options.namespace)||("function"==typeof self.createPlugin&&self.createPlugin($elt,$target),$elt.is(":radio")&&$elt.attr("name")&&$(":radio[name=\""+$elt.attr("name")+"\"]").not($elt).on(self.options.listenerEvent,function(e){"function"==typeof self.callPluginMethod&&self.callPluginMethod($elt,$target),shouldPreventDefault($elt)&&e.preventDefault()})),"function"==typeof self.callPluginMethod&&self.callPluginMethod($elt,$target),shouldPreventDefault($elt)&&e.preventDefault()}})):$.error("The plugin data namespace option is required")};return DataAttrHandler.prototype.init=function(cb){return this.createPlugin=cb,this},DataAttrHandler.prototype.trigger=function(cb){return this.callPluginMethod=cb,this},DataAttrHandler.getTarget=function(attrName,$elt){var relativeRegex=/^(\+|>|~|:parent|<)/,$target=[],targetSelector=$elt.attr("data-"+attrName)||$elt.attr("href")||$elt.attr("attrName");if(!_.isEmpty(targetSelector)){var matches=relativeRegex.exec(targetSelector);if(null!==matches){var selector=targetSelector.replace(relativeRegex,"");$target=":parent"===matches[0]||"<"===matches[0]?$elt.parents(selector):"~"===matches[0]?$elt.siblings(selector):"+"===matches[0]?$elt.next(selector):$(selector,$elt)}else $target=$(targetSelector)}return $target},DataAttrHandler}),define("ui/modal",["jquery","core/pluginifier","core/dataattrhandler"],function($,Pluginifier,DataAttrHandler){'use strict';var _Mathmax=Math.max;function closeModal($element,reason){var options=$element.data("ui.modal"),$overlay=$("#"+options.modalOverlay),onClose=function(){$element.removeClass("opened"),$element.css("display","none"),$element.trigger("closed.modal",reason)};modal._unBindEvents($element),options.animate&&$element.is(":visible")?($overlay.fadeOut(options.animate-100),$element.animate({opacity:"0",top:"-1000px"},options.animate,onClose)):($overlay.hide(),$element.hide(),onClose())}function listenDataAttr($container){new DataAttrHandler("modal",{container:$container,listenerEvent:"click",namespace:"ui.modal"}).init(function($elt,$target){$target.modal()})}$=$&&$.hasOwnProperty("default")?$["default"]:$,Pluginifier=Pluginifier&&Pluginifier.hasOwnProperty("default")?Pluginifier["default"]:Pluginifier,DataAttrHandler=DataAttrHandler&&DataAttrHandler.hasOwnProperty("default")?DataAttrHandler["default"]:DataAttrHandler;var dataNs="ui.modal",defaults={modalCloseClass:"modal-close",modalOverlayClass:"modal-bg",startClosed:!1,disableClosing:!1,width:"responsive",minWidth:0,minHeight:0,vCenter:!0,$context:null,animate:400},animateDiff=100,modal={init:function(options){return options=$.extend(!0,{},defaults,options),options.animate&&("number"==typeof options.animate?options.animate=_Mathmax(animateDiff,options.animate):options.animate=defaults.animate),$(this).each(function(){var $modal=$(this);if(options.modalOverlay="__modal-bg-"+($modal.attr("id")||new Date().getTime()),$modal.data(dataNs,options),0===$("#"+options.modalOverlay).length){var $overlay=$("<div/>").attr({id:options.modalOverlay,class:options.modalOverlayClass});options.$context instanceof $&&options.$context.length?($overlay.css("position","absolute"),options.$context.append($overlay)):$modal.after($overlay)}0!==$("."+options.modalCloseClass,$modal).length||options.disableClosing||$("<button id=\"modal-close-btn\" class=\""+options.modalCloseClass+"\"><span class=\"icon-close\"></span></button>").appendTo($modal),options.startClosed||modal._open($modal),$modal.trigger("create.modal")})},_destroy:function($element){return $element.each(function(){var $modal=$(this),options=$modal.data(dataNs);$modal.removeData(dataNs),$("#"+options.modalOverlay).remove(),$modal.hide(),$element.trigger("destroyed.modal")})},_bindEvents:function($element){var options=$element.data(dataNs);options&&("responsive"===options.width&&$(window).on("resize.modal",function(e){e.preventDefault(),modal._resize($element)}),!options.disableClosing&&($("."+options.modalCloseClass,$element).on("click.modal",function(e){e.preventDefault(),closeModal($element,"close")}),$("#"+options.modalOverlay).on("click.modal",function(e){e.preventDefault(),closeModal($element,"overlay")}),!options.disableEscape&&$(document).on("keydown.modal",function(e){27===e.keyCode&&(e.preventDefault(),closeModal($element,"escape"))})))},_unBindEvents:function($element){var options=$element.data(dataNs);options&&"responsive"===options.width&&$(window).off("resize.modal"),$element.off("click.modal"),options&&!options.disableClosing&&($("."+options.modalCloseClass,$element).off("click.modal"),$("#"+options.modalOverlay).off("click.modal"),$(document).off("keydown.modal"))},_open:function($element){var modalHeight=$element.outerHeight(),windowHeight=$(window).height(),options=$element.data(dataNs),topOffset,onOpen,$overlay,to;"undefined"!=typeof options&&(onOpen=function(){$element.addClass("opened"),modal._bindEvents($element),$element.trigger("opened.modal")},topOffset=options.top?options.top:options.vCenter||modalHeight>windowHeight?40:(windowHeight-modalHeight)/2,!options.top&&!$element.parent().hasClass("no-scroll-offset")&&$element.parents().map(function(){"BODY"!==this.tagName&&"HTML"!==this.tagName&&(topOffset+=parseInt($(this).scrollTop(),10))}),to={opacity:"1",top:topOffset+"px"},modal._resize($element),$overlay=$("#"+options.modalOverlay),$element.show(),options.animate&&$element.is(":visible")?($element.css({top:"-"+modalHeight+"px",display:"block"}),$overlay.fadeIn(options.animate-animateDiff),$element.animate(to,options.animate,onOpen)):($overlay.show(),$element.css(to),onOpen()))},_close:function($element){closeModal($element,"api")},_resize:function($element){var options=$element.data(dataNs),windowWidth=parseInt($(window).width(),10),css={},modalWidth="responsive"===options.width?.7*windowWidth:parseInt(options.width,10);css.width=_Mathmax(modalWidth,options.minWidth),options.minHeight&&(css.minHeight=parseInt(options.minHeight)+"px"),$element.css(css)}};return Pluginifier.register("modal",modal,{expose:["open","close","destroy"]}),listenDataAttr}),define("ui/dialog",["jquery","lodash","i18n","handlebars","lib/dompurify/purify","ui/keyNavigation/navigator","ui/keyNavigation/navigableDomElement","util/shortcut/registry","ui/modal"],function($$1,_,__,Handlebars,DOMPurify,keyNavigator,navigableDomElement,shortcutRegistry){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function bodyTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function buttonsTpl(data,options,asString){var html=Template$1(data,options);return asString||!0?html:$(html)}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,__=__&&__.hasOwnProperty("default")?__["default"]:__,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,keyNavigator=keyNavigator&&keyNavigator.hasOwnProperty("default")?keyNavigator["default"]:keyNavigator,navigableDomElement=navigableDomElement&&navigableDomElement.hasOwnProperty("default")?navigableDomElement["default"]:navigableDomElement,shortcutRegistry=shortcutRegistry&&shortcutRegistry.hasOwnProperty("default")?shortcutRegistry["default"]:shortcutRegistry,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="\n        <h4 class=\"strong\">",(helper=helpers.heading)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.heading,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</h4>\n        ",buffer}function program3(depth0,data){var buffer="",stack1,helper;return buffer+="\n        <div class=\"content\">",(helper=helpers.content)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.content,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n        ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<div class=\"preview-modal-feedback modal ",(helper=helpers["class"])?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0["class"],stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <div class=\"modal-body clearfix\">\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.heading,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n        <p class=\"message\">",(helper=helpers.message)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.message,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</p>\n\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.content,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n        <div class=\"buttons rgt\"></div>\n    </div>\n</div>\n",buffer});Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template$1=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="\n    <button class=\"btn-",(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+" small ",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-control=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" type=\"button\">\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.icon,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        <span class=\"label\">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n    </button>\n",buffer}function program2(depth0,data){var buffer="",stack1,helper;return buffer+="<span class=\"icon-",(helper=helpers.icon)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.icon,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"></span> ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1;return stack1=helpers.each.call(depth0,depth0&&depth0.buttons,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n",buffer}),_scope=".modal",_definedButtons={ok:{id:"ok",type:"info",label:__("Ok"),close:!0},cancel:{id:"cancel",type:"regular",label:__("Cancel"),close:!0},yes:{id:"yes",type:"info",label:__("Yes"),close:!0},no:{id:"no",type:"regular",label:__("No"),close:!0}},_defaults={message:"",content:"",width:500,animate:!1,autoRender:!1,autoDestroy:!1,renderTo:"body",buttons:"cancel,ok"},dialog={init:function(options){var self=this,events={},initOptions=_.omit(options||{},function(value,key){var omit=!1;return 2<key.length&&"on"===key.substr(0,2)&&(events[key.substr(2)]=value,omit=!0),omit});return _.defaults(this,initOptions,_defaults),this.$html=$$1(bodyTpl(this)),this.$buttons=this.$html.find(".buttons"),this.rendered=!1,this.destroyed=!1,this.$buttons.on("click"+_scope,"button",this._onButtonClick.bind(this)),this.setButtons(this.buttons),_.forEach(events,function(callback,eventName){0>eventName.indexOf(".")&&(eventName+=_scope),self.on(eventName.toLowerCase(),callback)}),this.autoRender&&this.render(),this},destroy:function(){return this.destroyed||(this._destroy(),this.rendered=!1,this.destroyed=!0,this.trigger("destroy"+_scope),this.$buttons.off(_scope),this.$html.off(_scope).remove(),this.$html=null,this.$buttons=null),this},setButtons:function(buttons){var self=this;return this.destroyed||(!buttons&&(buttons=_defaults.buttons),!_.isArray(buttons)&&_.isString(buttons)&&(buttons=buttons.split(",")),this.buttons={},_.forEach(buttons,function(btn){_.isString(btn)&&(btn=btn.trim(),btn=_definedButtons[btn]||{id:btn,type:"info",label:btn}),btn.type||(btn.type="regular"),self.buttons[btn.id]=btn}),this.$buttons.html(buttonsTpl(this))),this},render:function(to){return this.destroyed||($$1(to||this.renderTo).append(this.$html),this._install(),this.rendered=!0),this},show:function(){return this.destroyed||(this.rendered?this._open():this.render()),this},hide:function(){return!this.destroyed&&this.rendered&&(this._close(),this.autoDestroy&&this.destroy()),this},on:function(){var dom=this.$html;return dom&&dom.on.apply(dom,arguments),this},off:function(){var dom=this.$html;return dom&&dom.off.apply(dom,arguments),this},trigger:function(eventName,extraParameters){var dom=this.$html;return dom&&(void 0===extraParameters&&(extraParameters=[]),!_.isArray(extraParameters)&&(extraParameters=[extraParameters]),extraParameters=Array.prototype.slice.call(extraParameters),extraParameters.push(this),dom.trigger(eventName,extraParameters)),this},getDom:function(){return this.$html},_onButtonClick:function(event){var $btn=$$1(event.target).closest("button"),id=$btn.data("control"),btn=this.buttons[id];btn&&this._execute(btn)},_execute:function(btn){btn.action&&btn.action.apply(this,[btn,this]),this.trigger(btn.id+"btn"+_scope,[btn]),btn.close&&this.hide()},focus:function(button){var focusPosition=-1;button&&(focusPosition=_.findIndex(this.navigator.getNavigables(),function(navigable){return navigable.getElement().is("[data-control=\""+button+"\"]")})),0<=focusPosition?this.navigator.focusPosition(focusPosition):this.navigator.focus()},_install:function(){var self=this,$buttons,closeButton;this.destroyed||(this.$html.modal({width:this.width,animate:this.animate,disableClosing:this.disableClosing,disableEscape:this.disableEscape}).on("closed"+_scope,function(){self.autoDestroy&&self.destroy()}),$buttons=this.$buttons.find("button"),closeButton=$$1(_scope).find("#modal-close-btn")[0],closeButton&&$buttons.push(closeButton),this.navigator=keyNavigator({elements:navigableDomElement.createFromDoms($buttons)}).on("right down",function(){this.next()}).on("left up",function(){this.previous()}).on("tab",function(){this.getCursor().position===$buttons.length-1?this.first():this.next()}).on("shift+tab",function(){0===this.getCursor().position?this.last():this.previous()}).on("activate",function(cursor){cursor.navigable.getElement().click()}),self.navigator.last(),this.globalShortcut=shortcutRegistry($$1("body")).add("tab shift+tab",function(){self.navigator.isFocused()||self.navigator.focus()}),self.trigger("create.dialog"))},_open:function(){this.$html.modal("open")},_close:function(){this.$html.modal("close")},_destroy:function(){this.$html.modal("destroy"),this.navigator&&this.navigator.destroy(),this.globalShortcut&&this.globalShortcut.clear()}},dialogFactory=function(options){var instance=_.clone(dialog,!0);return instance.init(options),instance};return dialogFactory}),define("ui/dialog/alert",["lodash","ui/dialog"],function(_,dialog){'use strict';function dialogAlert(message,action,onCreateDialog){var dlg=dialog({message:message,buttons:"ok",autoDestroy:!0,autoRender:!0}).on("create.dialog",function(){onCreateDialog&&onCreateDialog()});return _.isFunction(action)&&dlg.on("closed.modal",action),dlg}return _=_&&_.hasOwnProperty("default")?_["default"]:_,dialog=dialog&&dialog.hasOwnProperty("default")?dialog["default"]:dialog,dialogAlert}),define("ui/dialog/confirm",["lodash","i18n","ui/dialog"],function(_,__,dialog){'use strict';function dialogConfirm(message,accept,refuse,options){var accepted=!1,_options={buttons:{labels:{ok:__("Ok"),cancel:__("Cancel")}}},dialogOptions,dlg;return options=_.defaults(options||{},_options),dialogOptions={message:message,autoRender:!0,autoDestroy:!0,onOkBtn:function(){accepted=!0,_.isFunction(accept)&&accept.call(this)},buttons:{ok:{id:"ok",type:"info",label:options.buttons.labels.ok||__("Ok"),close:!0},cancel:{id:"cancel",type:"regular",label:options.buttons.labels.cancel||__("Cancel"),close:!0}}},dlg=dialog(dialogOptions),_.isFunction(refuse)&&dlg.on("closed.modal",function(){accepted||refuse.call(this)}),dlg}return _=_&&_.hasOwnProperty("default")?_["default"]:_,__=__&&__.hasOwnProperty("default")?__["default"]:__,dialog=dialog&&dialog.hasOwnProperty("default")?dialog["default"]:dialog,dialogConfirm}),define("taoQtiTest/runner/plugins/content/dialog/dialog",["jquery","lodash","i18n","taoTests/runner/plugin","ui/dialog/alert","ui/dialog/confirm","util/shortcut/registry","util/shortcut","util/namespace"],function($,_,__,pluginFactory,dialogAlert,dialogConfirm,shortcutRegistry,globalShortcut,namespaceHelper){'use strict';var actionPrefix="tool-dialog-",defaultOptions={alert:{focus:"ok"},confirm:{focus:"ok"}};return pluginFactory({name:"dialog",init:function(){function closeAccept(dialog){dialog.trigger("okbtn.modal").hide()}function closeReject(dialog){dialog.hide()}function closeLast(accept,shortcut){var handle=opened.length&&opened[opened.length-1];handle&&(handle.shortcut=shortcut,accept?closeAccept(handle.dialog):closeReject(handle.dialog))}function addHandle(namespace,stack,dialog,message,accept,reject,options){var handle={context:namespace,dialog:dialog(message,function(e,reason){_.isFunction(accept)&&accept(handle.shortcut||reason)},function(e,reason){_.isFunction(reject)&&reject(handle.shortcut||reason)},options)};globalShortcut.disable(),dialogShortcut.enable(),stack.push(handle),opened.push(handle),handle.dialog.focus(options.focus),handle.dialog.on("closed.modal",function(){removeHandle(stack,handle.dialog),removeHandle(opened,handle.dialog),opened.length||(globalShortcut.enable(),dialogShortcut.disable())})}function removeHandle(stack,dialog){dialog&&_.remove(stack,function(handle){if(handle&&dialog===handle.dialog)return!0})}function closeDialogs(namespace,accept,stack){stack?_.forEach(stack,function(handle){handle&&("@"===namespace||namespace===handle.context)&&(accept?closeAccept(handle.dialog):closeReject(handle.dialog))}):(closeDialogs(namespace,accept,alerts),closeDialogs(namespace,accept,confirms))}var testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginConfig=_.defaults((testConfig.plugins||{}).dialog||{},defaultOptions),pluginShortcuts=(testConfig.shortcuts||{}).dialog||{},alerts=[],confirms=[],opened=[],dialogShortcut=shortcutRegistry($("body"),{propagate:!1,prevent:!0});dialogShortcut.disable().set("Tab Shift+Tab"),testConfig.allowShortcuts&&_.forEach(pluginShortcuts,function(command,key){dialogShortcut.add(namespaceHelper.namespaceAll(command,"dialog",!0),function(e,shortcut){testRunner.trigger(actionPrefix+key,shortcut)})}),testRunner.before("alert.*",function(e,msg,accept,options){addHandle(e.namespace,alerts,dialogAlert,msg,accept,accept,_.merge({},pluginConfig.alert,options))}).before("confirm.*",function(e,msg,accept,reject,options){addHandle(e.namespace,confirms,dialogConfirm,msg,accept,reject,_.merge({},pluginConfig.confirm,options))}).before("closedialog.*",function(e,accept){closeDialogs(e.namespace,accept)}).on(actionPrefix+"accept",function(shortcut){closeLast(!0,shortcut)}).on(actionPrefix+"reject",function(shortcut){closeLast(!1,shortcut)}).on("destroy",function(){closeDialogs(".@"),dialogShortcut.clear(),dialogShortcut=null})}})}),define("taoQtiTest/runner/plugins/content/dialog/exitMessages",["lodash","core/promise","taoTests/runner/plugin"],function(_,Promise,pluginFactory){'use strict';return pluginFactory({name:"exitMessages",init:function(){},install:function(){var testRunner=this.getTestRunner();testRunner.before("leave",function(e,data){if(_.isObject(data)&&data.message)return new Promise(function(resolve){var context=testRunner.getTestContext();context&&context.itemIdentifier&&testRunner.disableItem(context.itemIdentifier),testRunner.trigger("disablefeedbackalerts").trigger("alert.leave",data.message,function(){testRunner.trigger("enablefeedbackalerts"),resolve()})})})}})}),define("ui/hider",["jquery","core/eventifier"],function($){'use strict';function jqWrap(element){return element instanceof $?element:$(element)}$=$&&$.hasOwnProperty("default")?$["default"]:$;return{show:function(element){return jqWrap(element).removeClass("hidden")},hide:function(element){return jqWrap(element).addClass("hidden")},toggle:function(element,state){return"undefined"!=typeof state&&(state=!state),jqWrap(element).toggleClass("hidden",state)},isHidden:function(element,real){var $elt=jqWrap(element);return real?$elt.hasClass("hidden")||"none"===$elt.css("display")||"hidden"===$elt.css("visibility"):$elt.hasClass("hidden")}}}),define("taoQtiTest/runner/plugins/content/dialog/itemAlertMessage",["jquery","i18n","ui/hider","taoTests/runner/plugin"],function($,__,hider,pluginFactory){'use strict';return pluginFactory({name:"itemAlertMessage",init:function(){var self=this;this.$element=$(this.getContent().dom),this.$element.on("closed.modal",function(){$(this).modal("destroy")}).on("destroyed.modal",function(){self.$element=null,self.trigger("resume",self)})},render:function(){var testRunner=this.getTestRunner(),itemRunner=testRunner.itemRunner,$modalsContainer=this.getContent().$container;$modalsContainer||($modalsContainer=$("#modalFeedbacks",itemRunner._item.container)),$modalsContainer.append(this.$element),this.$element.modal({startClosed:!1,top:200})},destroy:function(){this.$element&&this.$element.length&&this.$element.modal("close")}})}),define("tpl!taoQtiTest/runner/plugins/templates/button",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+=" ",(helper=helpers.className)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.className,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),buffer}function program3(depth0,data){var buffer="",stack1,helper;return buffer+="<span class=\"icon icon-",(helper=helpers.icon)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.icon,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers.unless.call(depth0,depth0&&depth0.text,{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\"></span>",buffer}function program4(){return" no-label"}function program6(depth0,data){var buffer="",stack1,helper;return buffer+="<span class=\"text\">",(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<li data-control=\"",(helper=helpers.control)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.control,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" class=\"small btn-info action",stack1=helpers["if"].call(depth0,depth0&&depth0.className,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" title=\"",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <a class=\"li-inner\" href=\"#\" onclick=\"return false\">\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.icon,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.text,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </a>\n</li>",buffer})}),define("taoQtiTest/runner/plugins/content/dialog/itemInlineMessage",["jquery","i18n","ui/hider","taoTests/runner/plugin","tpl!taoQtiTest/runner/plugins/templates/button"],function($,__,hider,pluginFactory,buttonTpl){'use strict';var buttonData={next:{control:"move-forward",title:__("Submit and go to the next item"),icon:"forward",text:__("OK")},end:{control:"move-end",title:__("Submit and go to the end of the test"),icon:"fast-forward",text:__("OK & End test")}};return pluginFactory({name:"itemInlineMessage",init:function(){var self=this,testRunner=this.getTestRunner();this.$button=function(){var dataType=testRunner.getTestContext().isLast?"end":"next",$btn=$(buttonTpl(buttonData[dataType]));return $btn.addClass("modalFeedback-button"),$btn.on("click",function(e){e.preventDefault(),self.disable(),"move-end"===$(this).data("control")&&self.trigger("end"),$btn.remove(),self.$element.remove(),self.trigger("resume",self)}),$btn}(),this.$element=$(this.getContent().dom)},render:function(){var $navigationContainer=this.getAreaBroker().getNavigationArea(),testRunner=this.getTestRunner(),itemRunner=testRunner.itemRunner,$inlineContainer=this.getContent().$container;!$inlineContainer&&itemRunner._item.container&&($inlineContainer=$(".qti-itemBody",itemRunner._item.container)),$inlineContainer.append(this.$element),$(".modalFeedback-button",$navigationContainer).length||$navigationContainer.append(this.$button)},enable:function(){this.$button.removeProp("disabled").removeClass("disabled")},disable:function(){this.$button.prop("disabled",!0).addClass("disabled")},destroy:function(){this.$button.click()}})}),define("css!ui/component/css/components",[],function(){}),define("ui/component",["jquery","lodash","core/eventifier","handlebars","i18n","lib/dompurify/purify","css!ui/component/css/components.css"],function($$1,_,eventifier,Handlebars,__,DOMPurify){'use strict';var _Mathround=Math.round;function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function defaultTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function delegatedResize(){var width=this.config.width,height=this.config.height,$container=this.getContainer(),$element=this.getElement();$container&&("auto"===width&&(width=$container.width()),"auto"===height&&(height=$container.height())),$element&&(_.isNumber(width)&&$element.css({width:"".concat(width,"px")}),_.isNumber(height)&&$element.css({height:"".concat(height,"px")})),this._width=width,this._height=height}function component(specs,defaults){var componentTpl=defaultTpl,componentState={},componentApi={init:function(config){return this.config=_(config||{}).omit(function(value){return null===value||"undefined"==typeof value}).defaults(defaults||{}).value(),componentState={},this.trigger("init"),this.config.renderTo&&($container=$$1(this.config.renderTo),this.render()),this},destroy:function(){return this.trigger("destroy"),this.$component&&this.$component.remove(),this.$component=null,componentState={},this},render:function(container){return container&&($container=$$1(container)),this.$component=$$1(componentTpl(this.config)),$container&&(this.config.replace&&$container.empty(),$container.append(this.$component)),this.setState("rendered",!0),delegatedResize.call(this),this.trigger("render",this.$component),this},setSize:function(width,height){return this.config.width=width,this.config.height=height,this.is("rendered")&&delegatedResize.call(this),this.trigger("setsize",width,height),this},getSize:function(){if(this.is("rendered"))return{width:this._width||0,height:this._height||0}},getOuterSize:function(includeMargin){var $component;if(this.is("rendered"))return $component=this.getElement(),includeMargin=includeMargin||!1,{width:_Mathround($component.outerWidth(includeMargin)),height:_Mathround($component.outerHeight(includeMargin))}},show:function(){return this.trigger("show",this),this.setState("hidden",!1)},hide:function(){return this.trigger("hide",this),this.setState("hidden",!0)},enable:function(){return this.trigger("enable",this),this.setState("disabled",!1)},disable:function(){return this.trigger("disable",this),this.setState("disabled",!0)},is:function(state){return!!componentState[state]},setState:function(state,flag){return flag=!!flag,componentState[state]=flag,this.$component&&this.$component.toggleClass(state,flag),this.trigger("state",state,flag,this),this},getContainer:function(){return $container},getElement:function(){return this.$component},getTemplate:function(){return componentTpl},setTemplate:function(template){var tpl=template||defaultTpl;return componentTpl=tpl,_.isFunction(componentTpl)||(componentTpl=function(){return tpl}),this.trigger("template",componentTpl),this},getConfig:function(){return this.config||defaults||{}}},$container;return specs&&_(specs).functions().forEach(function(method){componentApi[method]=function(){return specs[method].apply(componentApi,_slice.call(arguments))}}),eventifier(componentApi)}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,eventifier=eventifier&&eventifier.hasOwnProperty("default")?eventifier["default"]:eventifier,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),"<div class=\"component\"></div>"}),_slice=[].slice;return component}),define("util/regexEscape",[],function(){'use strict';return function(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}}),define("util/wrapLongWords",["util/regexEscape"],function(regexEscape){'use strict';function wrapLongWords(str,threshold){str=str.toString().replace(/([\w])</g,"$1 <");for(var chunkExp=new RegExp(".{1,"+threshold+"}","g"),longWords=str.match(new RegExp("[\\S]{"+threshold+",}","g"))||[],i=longWords.length,cut;i--;)cut=getCutTerm(longWords[i],chunkExp),str=str.replace(new RegExp(regexEscape(longWords[i]),"g"),cut);return str}regexEscape=regexEscape&&regexEscape.hasOwnProperty("default")?regexEscape["default"]:regexEscape;var getCutTerm=function(longWord,chunkExp){for(var cutTerms=longWord.match(chunkExp),i=cutTerms.length,oldFirst="",newFirst="",offenders=[".",":",";"];i--;)newFirst=cutTerms[i].charAt(0),-1<offenders.indexOf(newFirst)&&(cutTerms[i]=cutTerms[i].substr(1)),-1<offenders.indexOf(oldFirst)&&(cutTerms[i]+=oldFirst),oldFirst=newFirst;return cutTerms.join(" ")};return wrapLongWords}),define("util/encode",[],function(){'use strict';var _reQuot=/"/g,_reApos=/'/g,encodeHTML=function(html){return document.createElement("a").appendChild(document.createTextNode(html)).parentNode.innerHTML};return{html:encodeHTML,attribute:function(html){return encodeHTML(html).replace(_reQuot,"&quot;").replace(_reApos,"&apos;")},encodeBase64:function(str){return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g,function(match,p1){return String.fromCharCode("0x"+p1)}))},decodeBase64:function(str){return decodeURIComponent(Array.prototype.map.call(atob(str),function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join(""))}}}),define("ui/feedback",["jquery","lodash","core/format","ui/component","util/wrapLongWords","util/encode","handlebars","i18n","lib/dompurify/purify"],function($$1,_,format,component,wrapLongWords,encode,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function tpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,format=format&&format.hasOwnProperty("default")?format["default"]:format,component=component&&component.hasOwnProperty("default")?component["default"]:component,wrapLongWords=wrapLongWords&&wrapLongWords.hasOwnProperty("default")?wrapLongWords["default"]:wrapLongWords,encode=encode&&encode.hasOwnProperty("default")?encode["default"]:encode,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div id=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" class=\"feedback feedback-",(helper=helpers.level)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.level,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+" ",stack1=helpers["if"].call(depth0,depth0&&depth0.popup,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"popup"},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\">\n    <span class=\"icon-",(helper=helpers.level)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.level,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"></span>\n    <div>\n        ",stack1=(helper=helpers.dompurify||depth0&&depth0.dompurify,options={hash:{},data:data},helper?helper.call(depth0,depth0&&depth0.msg,options):helperMissing.call(depth0,"dompurify",depth0&&depth0.msg,options)),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </div>\n    <span title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Close message",options):helperMissing.call(depth0,"__","Close message",options)))+"\" class=\"icon-close\" data-close=\":parent .feedback\"></span>\n</div>\n",buffer}),currents=[],levels=["info","success","warning","danger","error"],defaultOptions={timeout:{info:2e3,success:2e3,warning:4e3,danger:4e3,error:8e3},wrapLongWordsAfter:40,encodeHtml:!0,popup:!0},feedbackFactory=function($container,config){var feedback;if($container&&$container.length||($container=$$1("#feedback-box")),!$container.length)throw new TypeError("The feedback needs to belong to an existing container");return feedback=component({message:function(level,msg,params,options){var displayedMessage=msg;return level&&_.contains(levels,level)||(level="info"),_.isPlainObject(params)&&(options=params,params=[]),this.config=_.defaults(options||{},this.config),this.config.level=level,this.config.encodeHtml&&(displayedMessage=encode.html(displayedMessage)),this.config.wrapLongWordsAfter&&(displayedMessage=wrapLongWords(displayedMessage,this.config.wrapLongWordsAfter)),_.isArray(params)&&params.length&&(displayedMessage=format.apply(format,[displayedMessage].concat(params))),this.config.msg=displayedMessage,this},info:function(msg,params,options){return this.message("info",msg,params,options).open()},success:function(msg,params,options){return this.message("success",msg,params,options).open()},warning:function(msg,params,options){return this.message("warning",msg,params,options).open()},danger:function(msg,params,options){return this.message("danger",msg,params,options).open()},error:function(msg,params,options){return this.message("error",msg,params,options).open()},open:function(){return _(currents).reject(this).invoke("close"),this.display()},close:function(){this.is("rendered")&&this.destroy()},display:function(){return this.is("rendered")?this.show():this.render($container),this}},defaultOptions),feedback.setTemplate(tpl).on("init",function(){this.config.id="feedback-"+(currents.length+1),currents.push(this),$container.trigger("create.feedback")}).on("render",function(){var self=this,$component=this.getElement(),$closer=$$1(".icon-close",$component),timeout=_.isPlainObject(this.config.timeout)?this.config.timeout[this.config.level]:this.config.timeout;$closer.off("click").on("click",function(e){e.preventDefault(),self.destroy()}),_.isNumber(timeout)&&0<timeout&&_.delay(function(){self.close()},timeout),$container.trigger("display.feedback")}).on("destroy",function(){$container.trigger("close.feedback"),_.remove(currents,this)}).init(config)};return feedbackFactory}),define("taoQtiTest/runner/plugins/content/feedback/feedback",["jquery","i18n","taoTests/runner/plugin","ui/feedback"],function($,__,pluginFactory,feedback){'use strict';return pluginFactory({name:"feedback",init:function(){var self=this,testRunner=this.getTestRunner(),closeCurrent=function(){currentFeedback&&currentFeedback.close()},currentFeedback;this.setState("enabled",!0),testRunner.on("error",function(err){var message=err,type="error";self.getState("enabled")&&("object"===_typeof2(err)&&(message=err.message,type=err.type),message||(message="TestState"===type?__("The test has been closed/suspended!"):"FileNotFound"===type?__("File not found!"):__("An error occurred!")),currentFeedback=feedback().error(message))}).on("danger",function(message){self.getState("enabled")&&(currentFeedback=feedback().danger(message))}).on("warning",function(message){self.getState("enabled")&&(currentFeedback=feedback().warning(message))}).on("info",function(message){self.getState("enabled")&&(currentFeedback=feedback().info(message))}).on("alert.* confirm.* unloaditem",closeCurrent).on("disablefeedbackalerts",function(){closeCurrent(),self.setState("enabled",!1)}).on("enablefeedbackalerts",function(){self.setState("enabled",!0)})}})}),define("taoQtiTest/runner/plugins/content/loading/loading",["layout/loading-bar","taoTests/runner/plugin"],function(loadingBar,pluginFactory){'use strict';return pluginFactory({name:"loading",init:function(){var testRunner=this.getTestRunner();testRunner.on("unloaditem",function(){loadingBar.start()}).on("renderitem",function(){loadingBar.stop()})}})}),define("ui/autoscroll",["jquery"],function($){'use strict';var _Mathmin=Math.min,_Mathmax2=Math.max;return $=$&&$.hasOwnProperty("default")?$["default"]:$,function(element,container){return new Promise(function(resolve){var $element=$(element),$container=$(container||$element.parent()),currentScrollTop,minScrollTop,maxScrollTop,scrollTop;$element.length&&$container.length?(currentScrollTop=$container.scrollTop(),maxScrollTop=$element.offset().top-$container.offset().top+currentScrollTop,minScrollTop=maxScrollTop-$container.height()+$element.outerHeight(),scrollTop=_Mathmax2(_Mathmin(maxScrollTop,currentScrollTop),minScrollTop),scrollTop===currentScrollTop?resolve():$container.animate({scrollTop:scrollTop}).promise().done(resolve)):resolve()})}}),define("taoQtiTest/runner/plugins/content/modalFeedback/modalFeedback",["jquery","lodash","module","taoTests/runner/plugin","taoQtiTest/runner/plugins/content/dialog/itemInlineMessage","taoQtiTest/runner/plugins/content/dialog/itemAlertMessage","ui/autoscroll"],function($,_,module,pluginFactory,inlineMessage,alertMessage,autoscroll){'use strict';function destroyFeedback(feedback){var removed=!1;_.remove(renderedFeedbacks,function(storedFeedback){var found=storedFeedback===feedback;return found&&(removed=!0),found}),removed&&(feedback.destroy(),!renderedFeedbacks.length&&nextStep())}function defineMode(inline){inlineMode=inline,messagePlugin=inlineMode?inlineMessage:alertMessage}var inlineMode,messagePlugin,renderedFeedbacks,isDestroyed,nextStep;return pluginFactory({name:"QtiModalFeedback",init:function(){nextStep=function(){},defineMode(!!module.config().inlineModalFeedback)},render:function(){var self=this,testRunner=this.getTestRunner(),createMessages=function(renderingQueue,inline){var bInlineMode=inlineMode;isDestroyed=!1,renderedFeedbacks=[],_.isBoolean(inline)&&defineMode(inline),renderingQueue.length?(_.forEach(renderingQueue,function(renderingToken){var feedback=messagePlugin(testRunner,testRunner.getAreaBroker());feedback.init({dom:renderingToken.feedback.render({inline:inlineMode}),$container:inlineMode?renderingToken.$container:null}),feedback.render(),renderedFeedbacks.push(feedback)}),inlineMode&&renderedFeedbacks&&autoscroll($(".qti-modalFeedback",testRunner.getAreaBroker().getContentArea()).first(),testRunner.getAreaBroker().getContentArea().parents(".content-wrapper"))):nextStep(),defineMode(bInlineMode)};inlineMode?testRunner.off("plugin-resume.itemInlineMessage").on("plugin-resume.itemInlineMessage",function(){self.destroy()}):testRunner.off("plugin-resume.itemAlertMessage").on("plugin-resume.itemAlertMessage",function(feedback){destroyFeedback(feedback)}),testRunner.on("modalFeedbacks",function(renderingQueue,done,inline){nextStep=done,createMessages(renderingQueue,inline)})},destroy:function(){var tFeedbacks,i;if(!isDestroyed)if(isDestroyed=!0,!renderedFeedbacks)nextStep();else for(i in tFeedbacks=renderedFeedbacks.slice(0),tFeedbacks)destroyFeedback(tFeedbacks[i])}})}),define("taoQtiTest/runner/plugins/content/overlay/overlay",["jquery","i18n","taoTests/runner/plugin"],function($,__,pluginFactory){'use strict';return pluginFactory({name:"overlay",init:function(){var self=this,testRunner=this.getTestRunner();this.$element=$("<div />"),this.$element.on("click mousedown mouseup touchstart touchend keyup keydow keypress scroll drop",function(e){e.stopImmediatePropagation(),e.stopPropagation()});testRunner.on("disableitem",function(){self.enable()}).on("enableitem unloaditem",function(){self.disable()})},render:function(){var $contentArea=this.getTestRunner().getAreaBroker().getContentArea();$contentArea.after(this.$element)},destroy:function(){this.$element.remove()},enable:function(){var testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginsConfig=testConfig.plugins||{},overlayConfig=pluginsConfig.overlay||{};this.$element.addClass("overlay"),overlayConfig.full&&this.$element.addClass("overlay-full")},disable:function(){this.$element.removeClass("overlay overlay-full")},show:function(){this.enable()},hide:function(){this.disable()}})}),define("taoQtiTest/runner/plugins/content/responsiveness/collapser",["lodash","jquery","taoTests/runner/plugin"],function(_,$,pluginFactory){'use strict';var labelHiddenCls="no-tool-label",separatorCls="separator",defaults={collapseTools:!0,collapseNavigation:!1,collapseInOrder:!1,hover:!1,collapseOrder:[]},$window=$(window);return pluginFactory({name:"collapser",init:function(){function buildCollapsiblesList(){allCollapsibles=config.collapseInOrder&&config.collapseOrder.length?getCollapsiblesFromConfig():config.collapseInOrder?getSortedCollapsiblesFromDom():getUnsortedCollapsiblesFromDom()}function getExtraWidth($element){var expandedWidth,collapsedWidth;return $element.removeClass(collapseCls),expandedWidth=$element.outerWidth(!0),$element.addClass(collapseCls),collapsedWidth=$element.outerWidth(!0),$element.removeClass(collapseCls),expandedWidth-collapsedWidth}function toggleCollapsibles(){availableWidth=getAvailableWidth(),availableWidth<previousAvailableWidth?collapseInOrder():expandInOrder(),previousAvailableWidth=availableWidth}function collapseInOrder(){for(var collapsiblesCopy=_.clone(allCollapsibles),toCollapse;collapseNeeded()&&collapsiblesCopy.length;)toCollapse=collapsiblesCopy.shift(),toCollapse.$elements.addClass(collapseCls)}function collapseNeeded(){return getToolbarWidth()>getAvailableWidth()}function expandInOrder(){_.forEachRight(allCollapsibles,function(toExpand){if(toExpand.$elements.hasClass(collapseCls))if(expandPossible(toExpand.extraWidth))toExpand.$elements.removeClass(collapseCls);else return!1})}function expandPossible(extraWidth){return getToolbarWidth()+extraWidth<getAvailableWidth()}function getAvailableWidth(){return $actionsBar.width()-20}function getToolbarWidth(){return $toolbox.outerWidth(!0)+$navigation.outerWidth(!0)}function getControlsFromDom(){var $controls=$();return config.collapseTools&&($controls=$controls.add($toolbox.find(">ul>[data-control]").not("."+labelHiddenCls).not("."+separatorCls))),config.collapseNavigation&&($controls=$controls.add($navigation.find(">ul>[data-control]").not("."+labelHiddenCls).not("."+separatorCls))),$controls}function getCollapsiblesFromConfig(){return _.compact(config.collapseOrder.map(function(selector){var $elements=$(selector).not("."+labelHiddenCls).not("."+separatorCls),extraWidth=0;return!!$elements.length&&($elements.each(function(){extraWidth+=getExtraWidth($(this))}),{$elements:$elements,extraWidth:extraWidth})}))}function getSortedCollapsiblesFromDom(){var $elements=getControlsFromDom(),_allCollapsibles=[],order={};return $elements.each(function(){var ctrl=this.dataset.control,key=ctrl.substring(0,ctrl.search(/[A-Z-_]/))||ctrl;order[key]=order[key]||$(),order[key]=order[key].add($(this))}),_.forOwn(order,function($elements){var extraWidth=0;$elements.each(function(){extraWidth+=getExtraWidth($(this))}),_allCollapsibles.push({$elements:$elements,extraWidth:extraWidth})}),_.compact(_allCollapsibles)}function getUnsortedCollapsiblesFromDom(){var $elements=getControlsFromDom(),_allCollapsibles=[],extraWidth=0;return $elements.each(function(){extraWidth+=getExtraWidth($(this))}),_allCollapsibles.push({$elements:$elements,extraWidth:extraWidth}),_.compact(_allCollapsibles)}var testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginsConfig=testConfig.plugins||{},config=_.defaults(pluginsConfig.collapser||{},defaults),collapseCls=config.hover?"tool-label-collapsed-hover":"tool-label-collapsed",areaBroker=testRunner.getAreaBroker(),$actionsBar=areaBroker.getArea("actionsBar"),$toolbox=areaBroker.getToolboxArea(),$navigation=areaBroker.getNavigationArea(),allCollapsibles,availableWidth,previousAvailableWidth;$window.on("resize.collapser",_.throttle(function(){testRunner.trigger("collapseTools")},40)),testRunner.after("renderitem loaditem",function(){previousAvailableWidth=1/0,buildCollapsiblesList(),testRunner.trigger("collapseTools")}).on("collapseTools.collapser",function(){toggleCollapsibles()})},destroy:function(){$window.off(".collapser")}})}),define("tpl!taoQtiTest/runner/plugins/content/rubricBlock/rubricBlock",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},"<div id=\"qti-rubrics\"></div>"})}),define("taoQtiTest/runner/plugins/content/rubricBlock/rubricBlock",["jquery","i18n","core/promise","ui/hider","taoTests/runner/plugin","tpl!taoQtiTest/runner/plugins/content/rubricBlock/rubricBlock"],function($,__,Promise,hider,pluginFactory,containerTpl){'use strict';var blankifyLinks=function($container){$("a",$container).attr("target","_blank")},mathify=function($container){return new Promise(function(resolve){0<$("math",$container).length?require(["mathJax"],function(MathJax){MathJax?(MathJax.Hub.Queue(["Typeset",MathJax.Hub],$container[0]),MathJax.Hub.Queue(resolve)):resolve()},resolve):resolve()})};return pluginFactory({name:"rubricBlock",init:function(){var self=this,testRunner=this.getTestRunner();this.$element=$(containerTpl()),this.hide(),testRunner.on("ready",function(){self.hide()}).on("loaditem",function(){var context=testRunner.getTestContext();context.rubrics&&(self.$element.html(context.rubrics),blankifyLinks(self.$element),mathify(self.$element).then(function(){testRunner.trigger("rubricblock")}))}).on("renderitem",function(){self.show()}).on("unloaditem",function(){self.hide(),self.$element.empty()})},render:function(){var $container=this.getAreaBroker().getContentArea();$container.before(this.$element)},destroy:function(){this.$element.remove()},enable:function(){this.$element.removeProp("disabled").removeClass("disabled")},disable:function(){this.$element.prop("disabled",!0).addClass("disabled")},show:function(){hider.show(this.$element)},hide:function(){hider.hide(this.$element)}})}),define("core/polling",["lodash","core/promise","core/eventifier"],function(_,Promise,eventifier){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,eventifier=eventifier&&eventifier.hasOwnProperty("default")?eventifier["default"]:eventifier;var pollingFactory=function(config){var _Mathabs=Math.abs,state={},startTimer=function(){timer=setTimeout(iteration,interval),state.stopped=!1,state.pending=!0},stopTimer=function(){clearTimeout(timer),timer=null,state.stopped=!0,state.pending=!1},iteration=function(){return max&&iter>=max?void polling.stop():void(iter=(iter||0)+1,state.processing=!0,state.pending=!1,polling.trigger("call"),action.call(context,polling),!promise&&!state.stopped&&(state.processing=!1,startTimer()))},polling={async:function(){var resolver={};return promise=new Promise(function(resolve,reject){resolver.resolve=resolve,resolver.reject=reject}),promise.then(function(){promise=null,state.processing=!1,state.stopped||startTimer(),polling.trigger("resolved")}).catch(function(){promise=null,state.processing=!1,polling.stop(),polling.trigger("rejected")}),polling.trigger("async",resolver),resolver},next:function(){var _next;return(state.stopped&&(iter=0),stopTimer(),max&&iter>=max)?this:(state.stopped=!1,promise?(_next=this.next.bind(this),promise.then(_next).catch(_next)):(this.trigger("next"),iteration()),this)},start:function(){return timer||(iter=0,startTimer(),this.trigger("start")),this},stop:function(){return stopTimer(),this.trigger("stop"),this},setInterval:function(value){return interval=_Mathabs(parseInt(value,10)||60000),this.trigger("setinterval",interval),this},getInterval:function(){return interval},setAction:function(fn){return action=fn,this.trigger("setaction",action),this},getAction:function(){return action},setContext:function(ctx){return context=ctx||this,this.trigger("setcontext",ctx),this},getContext:function(){return context},setMax:function(value){return max=_Mathabs(parseInt(value,10)||0),this},getMax:function(){return max},getIteration:function(){return iter||0},is:function(stateName){return!!state[stateName]}},timer,promise,interval,max,iter,action,context,autoStart;return eventifier(polling),interval=60000,context=polling,action=null,state.stopped=!0,autoStart=!1,iter=0,_.isFunction(config)&&(polling.setAction(config),config=null),_.isObject(config)&&(polling.setAction(config.action),polling.setInterval(config.interval||arguments[1]),polling.setContext(config.context),polling.setMax(config.max),autoStart=!!config.autoStart),autoStart&&polling.start(),polling};return pollingFactory}),define("css!ui/waitingDialog/css/waitingDialog",[],function(){}),define("ui/waitingDialog/waitingDialog",["jquery","lodash","i18n","ui/component","ui/dialog","css!ui/waitingDialog/css/waitingDialog.css"],function($,_,__,component,dialog){'use strict';function waitingDialogFactory(config){var waitingDialog=component({beginWait:function(){return this.is("waiting")||(this.setState("waiting",!0),$content.text(this.config.waitContent),$button.prop("disabled",!0).find(".label").text(this.config.waitButtonText).end().find("[class^='icon-']").removeClass("hidden"),config.showSecondary&&($secondaryButton.removeProp("disabled"),$secondaryButton.removeClass("hidden"),this.config.buttonSeparatorText&&$betweenButtonsText.removeClass("hidden")),this.trigger("wait")),this},endWait:function(){return this.is("waiting")&&(this.setState("waiting",!1),$content.text(this.config.proceedContent),$button.removeProp("disabled").find(".label").text(this.config.proceedButtonText).end().find("[class^='icon-']").addClass("hidden"),config.showSecondary&&($secondaryButton.prop("disabled",!0),$secondaryButton.addClass("hidden"),this.config.buttonSeparatorText&&$betweenButtonsText.addClass("hidden")),this.trigger("unwait")),this},destroy:function(){return this.dialog&&this.dialog.destroy(),this.trigger("destroy")}},defaultConfig).on("init",function(){var self=this,buttons=[{id:"waiting",type:"info",icon:this.config.waitButtonIcon,label:this.config.waitButtonText,close:!0}];this.config.showSecondary&&this.config.secondaryButtonText&&buttons.push({id:"secondary",type:"info",icon:this.config.secondaryButtonIcon,label:this.config.secondaryButtonText,close:!1}),this.dialog=dialog({message:this.config.message,content:this.config.waitContent||"",width:this.config.width,autoRender:!1,disableClosing:!0,disableEscape:!0,buttons:buttons}),$content=$(".content",this.dialog.getDom()),$button=$("[data-control=\"waiting\"]",this.dialog.getDom()),this.config.showSecondary&&(this.dialog.getDom().addClass("has-secondary"),$secondaryButton=$("[data-control=\"secondary\"]",this.dialog.getDom()),$secondaryButton.on("click",function(){self.trigger("secondaryaction")}),this.config.buttonSeparatorText&&($betweenButtonsText=$("<span>").text(__("or")).addClass("between-buttons-text").insertBefore($secondaryButton))),this.beginWait(),this.render()}).on("render",function(){var self=this;this.dialog.on("closed.modal",function(){self.is("waiting")||self.trigger("proceed")}).render(this.config.container||"body")}),$button,$secondaryButton,$betweenButtonsText,$content;return _.defer(function(){waitingDialog.init(config||{})}),waitingDialog}$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,__=__&&__.hasOwnProperty("default")?__["default"]:__,component=component&&component.hasOwnProperty("default")?component["default"]:component,dialog=dialog&&dialog.hasOwnProperty("default")?dialog["default"]:dialog;var defaultConfig={message:__("Waiting"),waitContent:__("Please wait while ..."),waitButtonText:__("Please wait"),waitButtonIcon:"clock",proceedContent:__("Wait is over"),proceedButtonText:__("Proceed"),showSecondary:!1};return waitingDialogFactory}),define("tpl!taoQtiTest/runner/plugins/controls/connectivity/connectivity",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"connectivity-box ",(helper=helpers.state)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.state,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <span data-control=\"connectivity-connected\" class=\"qti-controls icon-connect\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Connected to server",options):helperMissing.call(depth0,"__","Connected to server",options)))+"\"></span>\n    <span data-control=\"connectivity-disconnected\" class=\"qti-controls icon-disconnect\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Disconnected from server",options):helperMissing.call(depth0,"__","Disconnected from server",options)))+"\"></span>\n</div>",buffer})}),define("taoQtiTest/runner/plugins/controls/connectivity/connectivity",["jquery","lodash","i18n","core/promise","core/polling","ui/waitingDialog/waitingDialog","taoTests/runner/plugin","tpl!taoQtiTest/runner/plugins/controls/connectivity/connectivity"],function($,_,__,Promise,pollingFactory,waitingDialog,pluginFactory,connectivityTpl){'use strict';var defaultConfig={checkInterval:30000,indicator:!0};return pluginFactory({name:"connectivity",init:function(){var self=this,testRunner=this.getTestRunner(),proxy=testRunner.getProxy(),config=_.defaults(this.getConfig()||{},defaultConfig);config&&config.indicator&&(this.$element=$(connectivityTpl({state:proxy.isOnline()?"connected":"disconnected"})),testRunner.on("disconnect",function(){self.$element.removeClass("connected").addClass("disconnected")}).on("reconnect",function(){self.$element.removeClass("disconnected").addClass("connected")})),this.polling&&_.isNumber(config.checkInterval)&&this.polling.setInterval(config.checkInterval)},install:function(){var self=this,waiting=!1,testRunner=this.getTestRunner(),proxy=testRunner.getProxy();this.displayWaitingDialog=function(){var message=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",dialog;return new Promise(function(resolve){waiting||(waiting=!0,testRunner.before("pause.waiting",function(){return new Promise(function(pauseResolve){proxy.off("reconnect.pausing").after("reconnect.pausing",pauseResolve)})}),dialog=waitingDialog({message:__("You are encountering a prolonged connectivity loss. ")+message,waitContent:__("Please wait while we try to restore the connection."),proceedContent:__("The connection seems to be back, please proceed")}).on("proceed",function(){resolve()}).on("render",function(){proxy.off("reconnect.waiting").after("reconnect.waiting",function(){testRunner.off("pause.waiting"),waiting=!1,dialog.endWait()})}))})},this.polling=pollingFactory({action:function(){testRunner.getProxy().telemetry(testRunner.getTestContext().itemIdentifier,"up").catch(_.noop)},interval:defaultConfig.checkInterval,autoStart:!1}),proxy.on("disconnect",function(source){testRunner.getState("disconnected")||(testRunner.setState("disconnected",!0),testRunner.trigger("disconnect",source),self.polling.start())}).on("reconnect",function(){testRunner.getState("disconnected")&&(testRunner.setState("disconnected",!1),testRunner.trigger("reconnect"),self.polling.stop())}),testRunner.before("leave",function(e,data){if(proxy.isOffline())return self.displayWaitingDialog(data.message).then(function(){testRunner.trigger("leave",data)}).catch(function(generalErr){testRunner.trigger("error",generalErr)}),!1}),testRunner.before("error.connectivity",function(e,err){return!proxy.isConnectivityError(err)&&(proxy.isOffline()?(self.displayWaitingDialog().then(function(){"nav"===err.type&&testRunner.loadItem(testRunner.getTestContext().itemIdentifier),"finish"===err.type&&testRunner.finish(),"pause"===err.type&&testRunner.trigger("pause",{reasons:err.data&&err.data.reasons,message:err.data&&err.data.comment})}).catch(function(generalErr){testRunner.trigger("error",generalErr)}),!1):void 0)})},render:function(){var $container=this.getAreaBroker().getControlArea();this.$element&&$container.append(this.$element)}})}),define("core/timer",[],function(){'use strict';return function(config){function now(){return window.performance.now()}var initConfig=config||{},begin=now(),last=begin,duration=initConfig.startDuration||0,state={},disableAutoStart=!1===initConfig.autoStart,timer={start:function(startDuration){return begin=now(),last=begin,duration=startDuration||0,state.running=!0,state.started=!0,this},tick:function(){var timestamp=now(),elapsed;return state.running&&(elapsed=timestamp-last,last=timestamp),elapsed},pause:function(){return state.running&&(duration+=now()-begin,state.running=!1),this},resume:function(){return state.running||(begin=now(),last=begin,state.started=!0,state.running=!0),this},stop:function(){return state.running&&(duration+=now()-begin),state.running=!1,state.started=!1,this},getDuration:function(){return state.running?duration+(now()-begin):duration},is:function(stateName){return!!state[stateName]},add:function(time){return time=parseFloat(time),duration+=time,last-=time,this},sub:function(time){return time=parseFloat(time),duration-=time,last+=time,this}};return disableAutoStart||timer.start(initConfig.startDuration),timer}}),define("taoQtiTest/runner/plugins/controls/duration/duration",["lodash","core/polling","core/timer","core/promise","taoTests/runner/plugin"],function(_,pollingFactory,timerFactory,Promise,pluginFactory){'use strict';return pluginFactory({name:"duration",install:function(){this.getTestRunner().getTestStore().setVolatile(this.getName())},init:function(){var self=this,testRunner=this.getTestRunner();return testRunner.getPluginStore(this.getName()).then(function(durationStore){function getItemDuration(attemptId){return /^(.*)+#+\d+$/.test(attemptId)?durationStore.getItem(attemptId):Promise.reject(new Error("Is it really an attempt id, like \"itemid#attempt\""))}self.stopwatch=timerFactory({autoStart:!1}),self.polling=pollingFactory({action:function(){var context=testRunner.getTestContext(),itemAttemptId=context.itemIdentifier+"#"+context.attempt;durationStore.getItem(itemAttemptId).then(function(duration){var elapsed=self.stopwatch.tick();duration=_.isNumber(duration)?duration:0,elapsed=_.isNumber(elapsed)&&0<elapsed?elapsed/1e3:0,durationStore.setItem(itemAttemptId,duration+elapsed)})},interval:1000,autoStart:!1}),testRunner.after("renderitem",function(){self.enable()}).on("enableitem",function(){self.enable()}).before("move skip exit timeout",function(){var context=testRunner.getTestContext(),itemAttemptId=context.itemIdentifier+"#"+context.attempt;return getItemDuration(itemAttemptId).then(function(duration){var params={itemDuration:0};_.isNumber(duration)&&0<duration&&(params.itemDuration=duration),testRunner.getProxy().addCallActionParams(params)})}).on("move skip exit timeout error disableitem",function(){self.disable()}).on("plugin-get.duration",function(e,attemptId,getDuration){_.isFunction(getDuration)&&getDuration(getItemDuration(attemptId))})})},destroy:function(){this.polling.stop(),this.stopwatch.stop()},enable:function(){this.getState("enabled")||(this.polling.start(),this.stopwatch.resume())},disable:function(){this.getState("enabled")&&(this.polling.stop(),this.stopwatch.pause())}})}),define("taoQtiTest/runner/helpers/map",["lodash"],function(_){'use strict';function getEmptyStats(){return{questions:0,answered:0,flagged:0,viewed:0,total:0,questionsViewed:0}}return{getJumps:function(map){return map&&map.jumps},getParts:function(map){return map&&map.parts},getSections:function(map){var parts=this.getParts(map),result={};return _.forEach(parts,function(part){var sections=part.sections;sections&&_.forEach(sections,function(section){result[section.id]=section})}),result},getActiveItem:function(map){var parts=this.getParts(map),result={};return _.forEach(parts,function(part){var sections=part.sections;sections&&_.forEach(sections,function(section){if(section.active){var items=section.items;_.forEach(items,function(item){item.active&&(result=item)})}})}),result},getNextSections:function(map,sectionId){var sections=this.getSections(map),result={},canList=!1;return _.forEach(sections,function(section){canList&&(result[section.id]=section),section.id===sectionId&&(canList=!0)}),result},getJump:function(map,position){var jumps=this.getJumps(map);return jumps&&jumps[position]},getPart:function(map,partName){var parts=this.getParts(map);return parts&&parts[partName]},getSection:function(map,sectionName){var parts=this.getParts(map),section=null;return _.forEach(parts,function(part){var sections=part.sections;if(sections&&sections[sectionName])return section=sections[sectionName],!1}),section},getItem:function(map,itemName){var jump=_.find(this.getJumps(map),{identifier:itemName});return this.getItemAt(map,jump&&jump.position)},getTestStats:function(map){return map&&map.stats},getPartStats:function(map,partName){var part=this.getPart(map,partName);return part&&part.stats},getSectionStats:function(map,sectionName){var section=this.getSection(map,sectionName);return section&&section.stats},getScopeStats:function(map,position,scope){var jump=this.getJump(map,position);switch(scope){case"section":case"testSection":return this.getSectionStats(map,jump&&jump.section);case"part":case"testPart":return this.getPartStats(map,jump&&jump.part);default:case"test":return this.getTestStats(map);}},getScopeMap:function(map,position,scope){var scopeMap=_.cloneDeep(map||{}),jump=this.getJump(scopeMap,position),part=this.getPart(scopeMap,jump&&jump.part),section=this.getSection(scopeMap,jump&&jump.section);return scope&&"test"!==scope&&(scopeMap.parts={},part&&(scopeMap.parts[jump.part]=part)),part&&("section"===scope||"testSection"===scope)&&(part.sections={},section&&(part.sections[jump.section]=section)),section&&(section.stats=this.computeItemStats(section.items)),part&&(part.stats=this.computeStats(part.sections)),scopeMap.stats=this.computeStats(scopeMap.parts),scopeMap},getScopeMapFromContext:function(map,context,scope){var scopeMap=_.cloneDeep(map||{}),part,section;return context&&context.testPartId&&(part=this.getPart(scopeMap,context.testPartId)),context&&context.sectionId&&(section=this.getSection(scopeMap,context.sectionId)),scope&&"test"!==scope&&(scopeMap.parts={},part&&(scopeMap.parts[context.testPartId]=part)),part&&("section"===scope||"testSection"===scope)&&(part.sections={},section&&(part.sections[context.sectionId]=section)),section&&(section.stats=this.computeItemStats(section.items)),part&&(part.stats=this.computeStats(part.sections)),scopeMap.stats=this.computeStats(scopeMap.parts),scopeMap},getItemPart:function(map,position){var jump=this.getJump(map,position);return this.getPart(map,jump&&jump.part)},getItemSection:function(map,position){var jump=this.getJump(map,position),part=this.getPart(map,jump&&jump.part),sections=part&&part.sections;return sections&&sections[jump&&jump.section]},getItemAt:function(map,position){var jump=this.getJump(map,position),part=this.getPart(map,jump&&jump.part),sections=part&&part.sections,section=sections&&sections[jump&&jump.section],items=section&&section.items;return items&&items[jump&&jump.identifier]},getItemIdentifier:function(map,position){var item;return item=_.isFinite(position)?this.getItemAt(map,position):this.getItem(map,position),item&&item.id},each:function(map,callback){return _.isFunction(callback)&&_.forEach(map&&map.parts,function(part){_.forEach(part&&part.sections,function(section){_.forEach(section&&section.items,function(item){callback(item,section,part,map)})})}),map},updateItemStats:function(map,position){var jump=this.getJump(map,position),part=this.getPart(map,jump&&jump.part),sections=part&&part.sections,section=sections&&sections[jump&&jump.section];return section&&(section.stats=this.computeItemStats(section.items)),part&&(part.stats=this.computeStats(part.sections)),map&&(map.stats=this.computeStats(map.parts)),map},computeItemStats:function(items){return _.reduce(items,function(acc,item){return item.informational||(acc.questions++,item.answered&&acc.answered++,item.viewed&&acc.questionsViewed++),item.flagged&&acc.flagged++,item.viewed&&acc.viewed++,acc.total++,acc},getEmptyStats())},computeStats:function(collection){return _.reduce(collection,function(acc,item){return acc.questions+=item.stats.questions,acc.answered+=item.stats.answered,acc.flagged+=item.stats.flagged,acc.viewed+=item.stats.viewed,acc.total+=item.stats.total,acc.questionsViewed+=item.stats.questionsViewed,acc},getEmptyStats())},patch:function(currentMap,partialMap){var self=this,targetMap;if(!_.isPlainObject(partialMap)||!partialMap.parts)throw new TypeError("Invalid test map format");return currentMap&&"test"!==partialMap.scope?(targetMap=_.cloneDeep(currentMap),_.forEach(partialMap.parts,function(partialPart,targetPartId){"part"===partialMap.scope&&(targetMap.parts[targetPartId]=_.cloneDeep(partialPart)),"section"===partialMap.scope&&_.forEach(partialPart.sections,function(partialSection,targetSectionId){targetMap.parts[targetPartId].sections[targetSectionId]=_.cloneDeep(partialSection),targetMap.parts[targetPartId].sections[targetSectionId].stats=self.computeItemStats(targetMap.parts[targetPartId].sections[targetSectionId].items)}),targetMap.parts[targetPartId].stats=self.computeStats(targetMap.parts[targetPartId].sections)}),targetMap.stats=this.computeStats(targetMap.parts)):targetMap=_.cloneDeep(partialMap),targetMap=this.reindex(targetMap),targetMap},reindex:function(map){var offset=0,offsetPart=0,offsetSection=0,lastPartId,lastSectionId;if(!_.isPlainObject(map)||!map.parts)throw new TypeError("Invalid test map format");return map.jumps=[],_.sortBy(map&&map.parts,"position").forEach(function(part){_.sortBy(part&&part.sections,"position").forEach(function(section){_.sortBy(section&&section.items,"position").forEach(function(item){lastPartId!==part.id&&(offsetPart=0,lastPartId=part.id,part.position=offset),lastSectionId!==section.id&&(offsetSection=0,lastSectionId=section.id,section.position=offset),item.position=offset,item.index=offsetSection+1,item.positionInPart=offsetPart,item.positionInSection=offsetSection,map.jumps[offset]={identifier:item.id,section:section.id,part:part.id,position:offset},offset++,offsetSection++,offsetPart++})})}),map},createJumpTable:function(map){if(!_.isPlainObject(map)||!map.parts)throw new TypeError("Invalid test map format");return map.jumps=[],this.each(map,function(item,section,part){var offset=item.position;map.jumps[offset]={identifier:item.id,section:section.id,part:part.id,position:offset}}),map}}}),define("taoQtiTest/runner/plugins/controls/progressbar/progress",["lodash","i18n","core/format","taoQtiTest/runner/helpers/map"],function(_,__,format,mapHelper){'use strict';function getFixedMap(testMap,testContext){var item;return testContext.itemAnswered&&testContext.isLinear&&(testMap=_.cloneDeep(testMap),item=mapHelper.getItemAt(testMap,testContext.itemPosition),item.answered=!1),testMap}function getEmptyStats(){return{position:0,reached:0,viewed:0,completed:0,total:0}}function updateStats(stats,element,position){element.position<=position&&stats.position++,element.stats.viewed&&(stats.reached++,element.stats.viewed===element.stats.total&&stats.viewed++),element.stats.answered&&element.stats.answered===element.stats.questions&&stats.completed++,stats.total++}function updateItemStats(stats,element,position){element.position<=position&&stats.position++,element.viewed&&(stats.reached++,stats.viewed++),element.answered&&stats.completed++,stats.total++}function getCategoriesToMatch(categories){var matchSize=categories&&categories.length;return matchSize&&_.reduce(categories,function(map,category){return map[category]=!0,map},{})}function getProgressStats(testMap,testContext,config,scope){var fixedMap=getFixedMap(testMap,testContext),scopedMap=mapHelper.getScopeMap(fixedMap,testContext.itemPosition,scope),stats=_.clone(scopedMap.stats),categoriesToMatch,matchSize;return"categories"===config.indicator&&(categoriesToMatch=getCategoriesToMatch(config.categories),matchSize=config.categories&&config.categories.length,stats.matchedCategories=getEmptyStats()),stats.parts=getEmptyStats(),stats.sections=getEmptyStats(),stats.answerableParts=getEmptyStats(),stats.answerableSections=getEmptyStats(),_.forEach(scopedMap.parts,function(part){updateStats(stats.parts,part,testContext.itemPosition),0<part.stats.questions&&updateStats(stats.answerableParts,part,testContext.itemPosition),_.forEach(part.sections,function(section){updateStats(stats.sections,section,testContext.itemPosition),0<section.stats.questions&&updateStats(stats.answerableSections,section,testContext.itemPosition),"categories"===config.indicator&&_.forEach(section.items,function(item){matchCategories(item.categories,categoriesToMatch,matchSize)&&updateItemStats(stats.matchedCategories,item,testContext.itemPosition)})})}),stats}function matchCategories(categories,expectedCategories,minWanted){var matched=0;return expectedCategories&&_.forEach(categories,function(category){if(expectedCategories[category]&&(matched++,matched>=minWanted))return!1}),matched===minWanted}function getRatio(position,total){var _Mathfloor=Math.floor;return position&&0<total?_Mathfloor(100*(position/total)):0}function getProgressionLabel(position,total,type,config){var patterns=labels[type]||labels.item,pattern=config.showTotal?patterns.long:patterns.short;return format(pattern,position||"0",total||"0")}function getPositionProgression(position,total,type,config){return{position:position||0,total:total||0,ratio:getRatio(position,total),label:getProgressionLabel(position,total,type,config)}}function getRatioProgression(position,total){var ratio=getRatio(position,total);return{position:position||0,total:total||0,ratio:ratio,label:ratio+"%"}}var defaultConfig={scope:"test",indicator:"percentage",showTotal:!0,categories:[]},labels={item:{long:__("Item %d of %d"),short:__("Item %d")},section:{long:__("Section %d of %d"),short:__("Section %d")}},scopes={test:function(testMap,testContext,config){var stats=getProgressStats(testMap,testContext,config,"test"),item=mapHelper.getItemAt(testMap,testContext.itemPosition);return stats.position=item.position+1,stats},testPart:function(testMap,testContext,config){var stats=getProgressStats(testMap,testContext,config,"testPart"),item=mapHelper.getItemAt(testMap,testContext.itemPosition);return stats.position=item.positionInPart+1,stats},testSection:function(testMap,testContext,config){var stats=getProgressStats(testMap,testContext,config,"testSection"),item=mapHelper.getItemAt(testMap,testContext.itemPosition);return stats.position=item.positionInSection+1,stats}},indicators={percentage:function(stats){return getRatioProgression(stats.answered,stats.questions)},position:function(stats,config){return getPositionProgression(stats.position,stats.total,"item",config)},questions:function(stats,config){return getPositionProgression(stats.questionsViewed,stats.questions,"item",config)},sections:function(stats,config){return getPositionProgression(stats.answerableSections.reached,stats.answerableSections.total,"section",config)},categories:function(stats,config){return getPositionProgression(stats.matchedCategories.position,stats.matchedCategories.total,"item",config)}};return{isMatchedCategories:function(categories,expectedCategories){var categoriesToMatch=getCategoriesToMatch(expectedCategories),matchSize=expectedCategories&&expectedCategories.length;return matchCategories(categories,categoriesToMatch,matchSize)},computeStats:function(testMap,testContext,config){var statsComputer=config.scope&&scopes[config.scope]||scopes.test,stats=statsComputer(testMap,testContext,config||defaultConfig);return stats.overallCompleted=testContext.numberCompleted,stats.overall=testContext.numberItems,stats},computeIndicator:function(stats,type,config){var indicatorComputer=type&&indicators[type]||indicators.percentage;return indicatorComputer(stats||{},config||defaultConfig)},computeProgress:function(testMap,testContext,config){var progressData;return config=_.defaults(config||{},defaultConfig),progressData=this.computeStats(testMap,testContext,config),this.computeIndicator(progressData,config.indicator,config)}}}),define("tpl!taoQtiTest/runner/plugins/controls/progressbar/renderer/percentage",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},"<div class=\"progress-box\">\n    <div data-control=\"progress-bar\" class=\"qti-controls progressbar info\"></div>\n    <div data-control=\"progress-label\" class=\"qti-controls\"></div>\n</div>"})}),define("ui/progressbar",["jquery","lodash","core/pluginifier"],function($,_,Pluginifier){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,Pluginifier=Pluginifier&&Pluginifier.hasOwnProperty("default")?Pluginifier["default"]:Pluginifier;var dataNs="ui.progressbar",defaults={disableClass:"disabled",style:"info",value:0,showProgress:!1},progressBar={init:function(options){return options=_.defaults(options||{},defaults),this.each(function(){var $elt=$(this),$pgElt,percent;$elt.data(dataNs)||(options.value=parseInt(options.value,10),$elt.data(dataNs,options),percent=options.value+"%",$pgElt=$("<span></span>").width(percent).attr("title",percent),options.showProgress&&$pgElt.text(percent),$elt.addClass("progressbar").addClass(options.style).empty().append($pgElt),$elt.trigger("create.progressbar"))})},_update:function($elt,value){var options=$elt.data(dataNs),$pgElt,percent;value=parseInt(value,10),0<=value&&100>=value&&(percent=value+"%",$pgElt=$elt.children("span"),$pgElt.width(value+"%").attr("title",percent),options.showProgress&&$pgElt.text(percent),options.value=value,$elt.data(dataNs,options),$elt.trigger("update.progressbar",value))},_value:function($elt,value){var options=$elt.data(dataNs);return"undefined"==typeof value?options.value:progressBar._update($elt,value)},destroy:function(){return this.each(function(){var $elt=$(this),options=$elt.data(dataNs);options&&($elt.removeClass("progressbar").empty().removeData(dataNs),$elt.trigger("destroy.progressbar"))})}};Pluginifier.register("progressbar",progressBar,{expose:["update","value"]})}),define("taoQtiTest/runner/plugins/controls/progressbar/renderer/percentage",["ui/component","tpl!taoQtiTest/runner/plugins/controls/progressbar/renderer/percentage","ui/progressbar"],function(component,percentageTpl){'use strict';var defaults={showLabel:!0};return function(config,progressData){return component({update:function(data){progressData=data,this.is("rendered")&&this.controls&&(this.controls.$label.text(progressData.label),this.controls.$bar.progressbar("value",progressData.ratio)),this.trigger("update",data)}},defaults).setTemplate(percentageTpl).on("render",function(){this.controls={$label:this.getElement().find("[data-control=\"progress-label\"]"),$bar:this.getElement().find("[data-control=\"progress-bar\"]")},this.config.showLabel||this.controls.$label.hide(),this.controls.$bar.progressbar(),progressData&&this.update(progressData),this.is("hidden")&&this.hide()}).on("destroy",function(){this.controls=null}).init(config)}}),define("tpl!taoQtiTest/runner/plugins/controls/progressbar/renderer/position",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},"<div class=\"progress-box\">\n    <div data-control=\"progress-bar\" class=\"qti-controls progressbar\">\n        <div class=\"progressbar-points\"></div>\n    </div>\n    <div data-control=\"progress-label\" class=\"qti-controls\"></div>\n</div>"})}),define("tpl!taoQtiTest/runner/plugins/controls/progressbar/renderer/position-point",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0){var buffer="";return buffer+="\n<span class=\"progressbar-point\" data-index=\""+escapeExpression("function"===_typeof2(depth0)?depth0.apply(depth0):depth0)+"\"></span>\n",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var escapeExpression=this.escapeExpression,self=this,stack1;return stack1=helpers.each.call(depth0,depth0,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),stack1||0===stack1?stack1:""})}),define("taoQtiTest/runner/plugins/controls/progressbar/renderer/position",["lodash","ui/component","tpl!taoQtiTest/runner/plugins/controls/progressbar/renderer/position","tpl!taoQtiTest/runner/plugins/controls/progressbar/renderer/position-point"],function(_,component,positionTpl,pointTpl){'use strict';var defaults={showLabel:!0};return function(config,progressData){var count=0;return component({update:function(data){progressData=data,this.is("rendered")&&this.controls&&(count!==progressData.total&&(count=progressData.total,this.controls.$bar.empty().append(pointTpl(_.range(count)))),this.controls.$label.text(progressData.label),this.controls.$bar.children().removeClass("reached current").slice(0,progressData.position).addClass("reached").slice(-1).addClass("current")),this.trigger("update",data)}},defaults).setTemplate(positionTpl).on("render",function(){this.controls={$label:this.getElement().find("[data-control=\"progress-label\"]"),$bar:this.getElement().find("[data-control=\"progress-bar\"] .progressbar-points")},this.config.showLabel||this.controls.$label.hide(),progressData&&this.update(progressData),this.is("hidden")&&this.hide()}).on("destroy",function(){this.controls=null}).init(config)}}),define("taoQtiTest/runner/plugins/controls/progressbar/progressbar",["lodash","taoTests/runner/plugin","taoQtiTest/runner/helpers/map","taoQtiTest/runner/plugins/controls/progressbar/progress","taoQtiTest/runner/plugins/controls/progressbar/renderer/percentage","taoQtiTest/runner/plugins/controls/progressbar/renderer/position"],function(_,pluginFactory,mapHelper,progressHelper,percentageRendererFactory,positionRendererFactory){'use strict';var renderers={percentage:percentageRendererFactory,position:positionRendererFactory};return pluginFactory({name:"progressBar",init:function(){var testRunner=this.getTestRunner(),testData=testRunner.getTestData(),config=_.defaults(this.getConfig(),testData.config.progressIndicator||{}),self=this,rendererFactory=renderers[config.renderer]||renderers.percentage,progressConfig={indicator:config.type||"percentage",scope:config.scope||"test",showLabel:config.showLabel,showTotal:config.showTotal,categories:config.categories},hiddenByQuestions=function(item){return item&&item.informational&&"questions"===progressConfig.indicator},hiddenByCategories=function(item){return item&&"categories"===progressConfig.indicator&&!progressHelper.isMatchedCategories(item.categories,progressConfig.categories)},isProgressbarHidden=function(item){return hiddenByQuestions(item)||hiddenByCategories(item)},update=function(){var testContext=testRunner.getTestContext(),testMap=testRunner.getTestMap(),item=mapHelper.getItemAt(testMap,testContext.itemPosition);isProgressbarHidden(item)?self.renderer.hide():(self.renderer.show(),self.renderer.update(progressHelper.computeProgress(testMap,testContext,progressConfig)))};this.renderer=rendererFactory(progressConfig),update(),testRunner.on("ready loaditem",update)},render:function(){var $container=this.getAreaBroker().getControlArea();this.renderer.render($container)},destroy:function(){this.renderer&&this.renderer.destroy(),this.renderer=null},show:function(){this.renderer&&this.renderer.show()},hide:function(){this.renderer&&this.renderer.hide()}})}),define("taoQtiTest/runner/plugins/controls/testState/testState",["lodash","taoTests/runner/plugin"],function(_,pluginFactory){'use strict';return pluginFactory({name:"testState",install:function(){var testRunner=this.getTestRunner();testRunner.getProxy().use(function(req,res,next){var data=res&&res.data;return data&&data.type&&"TestState"===data.type&&!testRunner.getState("closedOrSuspended")?(testRunner.setState("closedOrSuspended",!0),void(testRunner.getState("ready")?(_.isEmpty(data.messages)||!_.find(data.messages,{channel:"teststate"}))&&testRunner.trigger("leave",data):testRunner.trigger("destroy"))):void next()})},init:function(){var testRunner=this.getTestRunner(),isLeaving=!1;testRunner.getProxy().channel("teststate",function(data){isLeaving||!data||"close"!==data.type&&"pause"!==data.type||testRunner.getState("closedOrSuspended")||(isLeaving=!0,testRunner.setState("closedOrSuspended",!0),testRunner.trigger("leave",data))})}})}),define("core/encoder/time",["moment"],function(moment){'use strict';moment=moment&&moment.hasOwnProperty("default")?moment["default"]:moment;return{encode:function(modelValue){var seconds=parseInt(modelValue,10);isNaN(seconds)&&(seconds=0);var time=moment.duration(seconds,"seconds"),h=10<=time.get("hours")?time.get("hours"):"0"+time.get("hours"),m=10<=time.get("minutes")?time.get("minutes"):"0"+time.get("minutes"),s=10<=time.get("seconds")?time.get("seconds"):"0"+time.get("seconds");return h+":"+m+":"+s},decode:function(nodeValue){var time=moment(nodeValue,"HH:mm:ss");return time.seconds()+60*time.minutes()+3600*time.hours()}}}),define("tpl!taoQtiTest/runner/plugins/controls/timer/component/tpl/countdown",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<div class=\"countdown\" data-control=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-type=\"",(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-scope=\"",(helper=helpers.scope)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.scope,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" title=\"",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" disabled>\n    <span class=\"label truncate\">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n    <span class=\"time\"></span>\n</div>",buffer})}),define("ui/tooltip",["jquery","lodash","core/dataattrhandler","lib/popper/tooltip","handlebars","i18n","lib/dompurify/purify"],function($$1,_,DataAttrHandler,Tooltip,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function defaultTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,DataAttrHandler=DataAttrHandler&&DataAttrHandler.hasOwnProperty("default")?DataAttrHandler["default"]:DataAttrHandler,Tooltip=Tooltip&&Tooltip.hasOwnProperty("default")?Tooltip["default"]:Tooltip,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<div class=\"tooltip ",(helper=helpers["class"])?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0["class"],stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" role=\"tooltip\">\n    <div class=\"tooltip-arrow\"></div>\n    <div class=\"tooltip-inner tooltip-body\"></div>\n</div>",buffer}),themes=["dark","default","info","warning","error","success","danger"],themesMap={default:defaultTpl({class:"tooltip-plain"}),dark:defaultTpl({class:"tooltip-dark"}),error:defaultTpl({class:"tooltip-red"}),success:defaultTpl({class:"tooltip-green"}),info:defaultTpl({class:"tooltip-blue"}),warning:defaultTpl({class:"tooltip-orange"}),danger:defaultTpl({class:"tooltip-danger"})},defaultOptions={template:themesMap.default,html:!0,trigger:"hover focus",popperOptions:{positionFixed:!0,placement:"auto",modifiers:{preventOverflow:{escapeWithReference:!1,enabled:!0,padding:6,boundariesElement:"viewport"}}}},checkHTMLInstance=function(el){return el instanceof Element||el instanceof HTMLDocument||el.jquery};return{lookup:function($container){var setTooltip=function(el,inst){$$1(el).data("$tooltip")&&($$1(el).data("$tooltip").dispose(),$$1(el).removeData("$tooltip")),$$1(el).data("$tooltip",inst)},themeName;if($container&&checkHTMLInstance($container))$$1("[data-tooltip]",$container).each(function(){var $content=DataAttrHandler.getTarget("tooltip",$$1(this)),predefinedOptions=_.cloneDeep(defaultOptions),opt;themeName=_.contains(themes,$$1(this).data("tooltip-theme"))?$$1(this).data("tooltip-theme"):"default",opt={template:themesMap[themeName]},opt=$content.length?_.merge(predefinedOptions,opt,{title:$content[0].cloneNode(!0)}):_.merge(predefinedOptions,opt),setTooltip(this,new Tooltip(this,opt))});else throw new TypeError("Tooltip should be connected to DOM Element")},create:function(el,message,options){var predefinedOptions=_.cloneDeep(defaultOptions),calculatedOptions,themeName,template;if(calculatedOptions=options?_.merge(predefinedOptions,options):predefinedOptions,themeName=_.contains(themes,calculatedOptions.theme)?calculatedOptions.theme:"default",template={template:themesMap[themeName]},!el&&!checkHTMLInstance(el))throw new TypeError("Tooltip should be connected to DOM Element");if(!message&&!(checkHTMLInstance(el)||"string"==typeof message))throw new TypeError("Tooltip should have messsage to show");return new Tooltip(el,_.merge(calculatedOptions,template,{title:message}))},error:function(element,message,options){var theme={theme:"error"};return this.create(element,message,options?_.merge(theme,options):theme)},success:function(element,message,options){var theme={theme:"success"};return this.create(element,message,options?_.merge(theme,options):theme)},info:function(element,message,options){var theme={theme:"info"};return this.create(element,message,options?_.merge(theme,options):theme)},warning:function(element,message,options){var theme={theme:"warning"};return this.create(element,message,options?_.merge(theme,options):theme)},danger:function(element,message,options){var theme={theme:"danger"};return this.create(element,message,options?_.merge(theme,options):theme)}}}),define("css!taoQtiTest/runner/plugins/controls/timer/component/css/countdown",[],function(){}),define("taoQtiTest/runner/plugins/controls/timer/component/countdown",["jquery","lodash","core/encoder/time","core/polling","core/timer","ui/component","tpl!taoQtiTest/runner/plugins/controls/timer/component/tpl/countdown","ui/tooltip","css!taoQtiTest/runner/plugins/controls/timer/component/css/countdown.css"],function($,_,timeEncoder,pollingFactory,timerFactory,component,countdownTpl,tooltip){'use strict';var defaults={showBeforeStart:!0,displayWarning:!0,polling:!0,frequency:500},warningTimeout={info:2e3,success:2e3,warning:4e3,danger:4e3,error:8e3};return function($container,config){var countdown=component({update:function(remainingTime){var self=this,encodedTime,warningId,warningMessage;return this.is("completed")||(this.remainingTime=0>=remainingTime?0:parseInt(remainingTime,10),this.is("rendered")&&this.is("running")&&(encodedTime=timeEncoder.encode(this.remainingTime/1000),encodedTime!==this.encodedTime&&(this.encodedTime=encodedTime,$time.text(this.encodedTime)),this.warnings&&(warningId=_.findLastKey(this.warnings,function(warning){return warning&&!warning.shown&&0<warning.threshold&&warning.threshold>=self.remainingTime}),warningId&&(this.warnings[warningId].shown=!0,warningMessage=_.isFunction(this.warnings[warningId].message)?this.warnings[warningId].message(this.remainingTime):this.warnings[warningId].message,this.trigger("warn",warningMessage,this.warnings[warningId].level))),this.trigger("change",this.remainingTime,encodedTime)),0===this.remainingTime&&this.complete()),this},start:function(){return!this.is("rendered")||this.is("running")||this.is("completed")||(this.enable(),this.setState("running",!0),this.polling&&(this.polling.start(),this.is("started")?this.timer.resume():(this.setState("started",!0),this.timer.start())),this.trigger("start")),this},stop:function(){return this.is("rendered")&&this.is("running")&&(this.setState("running",!1),this.polling&&(this.timer.pause(),this.polling.stop()),this.trigger("stop")),this},complete:function(){return this.is("rendered")&&this.is("running")&&!this.is("completed")&&(this.stop(),this.setState("completed",!0),this.trigger("complete end")),this}},defaults).on("init",function(){var self=this;this.remainingTime=this.config.remainingTime,this.config.warnings&&(this.warnings=_.sortBy(this.config.warnings,"threshold")),!0===this.config.polling&&0<this.config.frequency&&(this.timer=timerFactory({autoStart:!1}),this.polling=pollingFactory({action:function(){var elapsed=self.timer.tick();self.update(self.remainingTime-elapsed)},interval:this.config.frequency,autoStart:!1})),this.render($container)}).on("render",function(){$time=$(".time",this.getElement()),!0===this.config.showBeforeStart&&$time.text(timeEncoder.encode(this.remainingTime/1000))}).on("warn",function(message,level){var countdownTooltip;level=level||"warning",this.is("rendered")&&this.is("running")&&_.isString(message)&&!_.isEmpty(message)&&($time.removeClass("txt-success txt-info txt-warning txt-danger txt-error").addClass("txt-"+level),!0===this.config.displayWarning&&(countdownTooltip=tooltip.create(this.getElement(),message,{trigger:"manual",theme:level,placement:"bottom"}),countdownTooltip.show(),setTimeout(function(){countdownTooltip.hide(),countdownTooltip.dispose()},warningTimeout[level]||2e3)))}),$time;return countdown.setTemplate(countdownTpl),_.defer(function(){countdown.init(config)}),countdown}}),define("tpl!taoQtiTest/runner/plugins/controls/timer/component/tpl/timerbox",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",helper,options;return buffer+="\n    <a href=\"#\" class=\"timer-toggler hidden\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Hide timers",options):helperMissing.call(depth0,"__","Hide timers",options)))+"\"><span class=\"icon-clock\"></span></a>\n    ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1;return buffer+="<div class=\"timer-box\">\n    ",stack1=helpers["if"].call(depth0,(stack1=depth0&&depth0.zenMode,null==stack1||!1===stack1?stack1:stack1.enabled),{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    <div class=\"timer-wrapper\">\n\n    </div>\n</div>",buffer})}),define("css!taoQtiTest/runner/plugins/controls/timer/component/css/timerbox",[],function(){}),define("taoQtiTest/runner/plugins/controls/timer/component/timerbox",["jquery","lodash","i18n","core/promise","ui/component","ui/hider","taoQtiTest/runner/plugins/controls/timer/component/countdown","tpl!taoQtiTest/runner/plugins/controls/timer/component/tpl/timerbox","css!taoQtiTest/runner/plugins/controls/timer/component/css/timerbox.css"],function($,_,__,Promise,component,hider,countdownFactory,timerboxTpl){'use strict';var defaults={zenMode:{enabled:!0,startHidden:!1}};return function(config){var timerbox=component({update:function(timers){var self=this,updating=[],timerIdsToRemove=_.difference(_.keys(this.timers),_.keys(timers));return timerIdsToRemove.length&&_.forEach(timerIdsToRemove,function(timerId){updating.push(self.removeTimer(timerId))}),_.forEach(timers,function(timer,id){"undefined"==typeof self.timers[id]?updating.push(self.addTimer(id,timer)):updating.push(self.updateTimer(id,timer))}),Promise.all(updating).then(function(results){return 0<_.size(self.timers)?hider.show($zenModeToggler):hider.hide($zenModeToggler),self.trigger("update",results),results})},getTimers:function(){return this.timers},addTimer:function(id,timer){var self=this;return this.is("rendered")&&"undefined"==typeof this.timers[id]?new Promise(function(resolve){var countdown=countdownFactory($countdownContainer,_.defaults(timer,{displayWarning:self.config.displayWarning})).on("render",function(){self.timers[id]=_.clone(timer),self.timers[id].countdown=this,self.trigger("timerchange","add",self.timers[id]),self.trigger("timeradd",self.timers[id]),resolve(self.timers[id])}).on("start",function(){self.trigger("timerstart",self.timers[id])}).on("stop",function(){self.trigger("timerstop",self.timers[id])}).on("end",function(){self.trigger("timerend",self.timers[id])}).on("change",function(value){self.timers[id]&&(self.timers[id].remainingTime=value)});countdown.spread(self,["error","change","warn"])}):Promise.resolve(!1)},updateTimer:function(id,timer){return this.is("rendered")&&"undefined"!=typeof this.timers[id]?(this.timers[id].remainingTime=timer.remainingTime,this.timers[id].extraTime=timer.extraTime,_.isNumber(timer.remainingWithoutExtraTime)&&(this.timers[id].remainingWithoutExtraTime=timer.remainingWithoutExtraTime),this.timers[id].countdown&&this.timers[id].countdown.update(timer.remainingTime),this.trigger("timerchange","update",this.timers[id]),this.trigger("timerupdate",this.timers[id]),Promise.resolve(this.timers[id])):Promise.resolve(!1)},removeTimer:function(id){var self=this;return this.is("rendered")&&"undefined"!=typeof this.timers[id]?new Promise(function(resolve){var deindex=function(){var removed=_.omit(self.timers[id],"countdown");self.timers=_.omit(self.timers,id),self.trigger("timerchange","remove",removed),self.trigger("timerremove",removed),resolve(removed)};self.timers[id].countdown?self.timers[id].countdown.on("destroy",deindex).destroy():deindex()}):Promise.resolve()},start:function(){return _.forEach(this.timers,function(timer){timer.countdown&&timer.countdown.start()}),this},stop:function(){return _.forEach(this.timers,function(timer){timer.countdown&&timer.countdown.stop()}),this},toggleZenMode:function(){return this.is("rendered")&&this.config.zenMode.enabled&&(this.is("zen")?(this.setState("zen",!1),$zenModeToggler.attr("title",__("Hide timers"))):(this.setState("zen",!0),$zenModeToggler.attr("title",__("Show timers"))),this.trigger("zenchange",this.is("zen"))),this}},defaults).on("init",function(){this.timers={}}).on("render",function(){var self=this,$element=this.getElement();$countdownContainer=$(".timer-wrapper",$element),this.config.zenMode.enabled&&($zenModeToggler=$(".timer-toggler",$element),self.setState("zen",!!self.config.zenMode.startHidden),$zenModeToggler.on("click",function(e){e.preventDefault(),self.toggleZenMode()})),this.config.timers&&this.update(this.config.timers)}),$zenModeToggler,$countdownContainer;return timerbox.setTemplate(timerboxTpl),_.defer(function(){timerbox.init(config)}),timerbox}}),define("taoQtiTest/runner/plugins/controls/timer/strategy/enforcedStay",[],function(){'use strict';return function(testRunner,timer){var testContext=testRunner.getTestContext();return!!(timer&&"min"===timer.type&&"item"===timer.scope&&testContext.isLinear)&&{name:"enforcedStay",setUp:function(){testRunner.on("enablenav.enforcestay",function(){testRunner.trigger("disablenav")}),testRunner.trigger("disablenav")},complete:function(){this.tearDown(),testRunner.trigger("enablenav")},tearDown:function(){testRunner.off("enablenav.enforcestay")}}}}),define("taoQtiTest/runner/plugins/controls/timer/strategy/extraTime",["lodash"],function(_){'use strict';var _Mathmax3=Math.max,lastConsumedExtraTime=0;return function(testRunner,timer){var applyExtraTime=function(){_.isNumber(timer.extraTime)&&0<timer.extraTime&&!timer.extraTimeSetup&&(timer.extraTimeSetup=!0,testRunner.before("move.extra skip.extra exit.extra timeout.extra",function(){var consumedExtraTime=0,testContext=testRunner.getTestContext();timer.remainingTime<timer.extraTime&&(consumedExtraTime=_Mathmax3(timer.extraTime-timer.remainingTime,0)/1000,lastConsumedExtraTime=_Mathmax3(consumedExtraTime,lastConsumedExtraTime,testContext.extraTime.consumed),testRunner.getProxy().addCallActionParams({consumedExtraTime:lastConsumedExtraTime}))}).after("move.extra skip.extra exit.extra timeout.extra",function(){lastConsumedExtraTime=0}))};return!!(timer&&"max"===timer.type)&&{name:"extraTime",setUp:function(){applyExtraTime()},start:function(){applyExtraTime()},tearDown:function(){testRunner.off("move.extra skip.extra exit.extra timeout.extra")}}}}),define("taoQtiTest/runner/plugins/controls/timer/strategy/guidedNavigation",[],function(){'use strict';return function(testRunner,timer){var testData=testRunner.getTestData(),testContext=testRunner.getTestContext(),config=testData&&testData.config;return!!(timer&&"locked"===timer.type&&"item"===timer.scope&&!0===config.guidedNavigation&&!0===testContext.isLinear)&&{name:"guidedNavigation",setUp:function(){testRunner.trigger("hidenav")},complete:function(){testRunner.trigger("disableitem disablenav shownav"),setTimeout(function(){testRunner.trigger("move","next","item")},500)}}}}),define("taoQtiTest/runner/plugins/controls/timer/strategy/timeout",[],function(){'use strict';return function(testRunner,timer){return!!(timer&&"max"===timer.type)&&{name:"timeout",complete:function(){if(timer.qtiClassName&&timer.source)return testRunner.timeout(timer.qtiClassName,timer.source,timer)}}}}),define("taoQtiTest/runner/helpers/currentItem",["lodash"],function(_){'use strict';var responseCardinalities={single:"base",multiple:"list",ordered:"list",record:"record"},interactionMinConstraintProperties={matchInteraction:"minAssociations",choiceInteraction:"minChoices",orderInteraction:"minChoices",associateInteraction:"minAssociations",hottextInteraction:"minChoices",hotspotInteraction:"minChoices",graphicOrderInteraction:"minChoices",graphicAssociateInteraction:"minAssociations",selectPointInteraction:"minChoices"},currentItemHelper={getDeclarations:function(runner){var itemRunner=runner.itemRunner;return itemRunner._item&&itemRunner._item.responses},getResponseDeclaration:function(runner,identifier){var found=null;return _.forEach(currentItemHelper.getDeclarations(runner),function(declaration){var attributes=declaration.attributes||{};if(attributes.identifier===identifier)return found=declaration,!1}),found},toResponse:function(value,baseType,cardinality){var mappedCardinality=responseCardinalities[cardinality],response={};return _.isString(value)&&(value=[value]),value=_.map(value||[],function(v){return"boolean"===baseType?!0===v||"true"===v:v}),mappedCardinality&&("base"===mappedCardinality?0===value.length?response.base=null:(response.base={},response.base[baseType]=value[0]):(response[mappedCardinality]={},response[mappedCardinality][baseType]=value)),response},isQtiValueNull:function(value,baseType,cardinality){var mappedCardinality=responseCardinalities[cardinality];return _.isObject(value)&&null===value[mappedCardinality]&&(value=null),_.isObject(value)&&value[mappedCardinality]&&"undefined"!=typeof value[mappedCardinality][baseType]&&(value=value[mappedCardinality][baseType]),null===value||"string"===baseType&&_.isEmpty(value)||"single"!==cardinality&&_.isEmpty(value)},isQuestionAnswered:function(response,baseType,cardinality,defaultValue,constraintValue){var fullyAnswered=!0,answered,currentCardinality,responses;return defaultValue=defaultValue||null,constraintValue=constraintValue||0,currentItemHelper.isQtiValueNull(response,baseType,cardinality)?answered=!1:(answered=!_.isEqual(response,currentItemHelper.toResponse(defaultValue,baseType,cardinality)),0!==constraintValue&&(currentCardinality=responseCardinalities[cardinality],responses=response[currentCardinality][baseType]||[],fullyAnswered=responses&&responses.length>=constraintValue),answered=answered&&fullyAnswered),answered},guessInteractionConstraintValues:function(runner){var itemRunner=runner.itemRunner,itemBody=itemRunner._item&&itemRunner._item.bdy||{},interactions=itemBody.elements||{},constraintValues={};return _.forEach(interactions,function(interaction){var attributes=interaction.attributes||{},qtiClass=interaction.__proto__.qtiClass,constraintProperty;interactionMinConstraintProperties.hasOwnProperty(qtiClass)&&(constraintProperty=interactionMinConstraintProperties[qtiClass],constraintValues[attributes.responseIdentifier]=attributes[constraintProperty])}),constraintValues},isAnswered:function(runner,partially){var itemRunner=runner.itemRunner,responses=itemRunner&&itemRunner.getResponses(),count=0,empty=0,declarations,constraintValues;return itemRunner&&(declarations=currentItemHelper.getDeclarations(runner),constraintValues=currentItemHelper.guessInteractionConstraintValues(runner),_.forEach(declarations,function(declaration){var attributes=declaration.attributes||{},response=responses[attributes.identifier],baseType=attributes.baseType,cardinality=attributes.cardinality;count++,currentItemHelper.isQuestionAnswered(response,baseType,cardinality,declaration.defaultValue,constraintValues[attributes.identifier])||empty++})),!1===partially?0<count&&0===empty:0<count&&empty<count},getStimuliHrefs:function(runner){var itemRunner=runner.itemRunner,itemBody=itemRunner._item&&itemRunner._item.bdy||{},interactions=itemBody.elements||{};return _(interactions).values().filter(function(element){return"include"===element.qtiClass}).pluck("attributes").pluck("href").value()},getTextStimuliHrefs:function(runner){var stimuli=this.getStimuliHrefs(runner),textStimuli;return 0<stimuli.length?(textStimuli=stimuli.filter(function(stimulusHref){var domNode=document.querySelector(".qti-include[data-href=\""+stimulusHref+"\"]");return _(domNode.childNodes).some(function(child){return child.nodeType===child.TEXT_NODE})}),textStimuli):[]}};return currentItemHelper}),define("taoQtiTest/runner/helpers/stats",["lodash","taoQtiTest/runner/helpers/map","taoQtiTest/runner/helpers/currentItem"],function(_,mapHelper,currentItemHelper){'use strict';return{getInstantStats:function(scope,runner,sync){var map=runner.getTestMap(),context=runner.getTestContext(),stats=_.clone(mapHelper.getScopeStats(map,context.itemPosition,scope)),item=mapHelper.getItemAt(map,context.itemPosition),isItemCurrentlyAnswered;return item.informational||(isItemCurrentlyAnswered=currentItemHelper.isAnswered(runner),!isItemCurrentlyAnswered&&context.itemAnswered?stats.answered--:(isItemCurrentlyAnswered||sync)&&!context.itemAnswered?stats.answered++:sync&&!isItemCurrentlyAnswered&&context.itemAnswered&&context.isLinear&&stats.answered++),stats}}}),define("taoQtiTest/runner/helpers/messages",["lodash","i18n","taoQtiTest/runner/helpers/map","taoQtiTest/runner/helpers/stats"],function(_,__,mapHelper,statsHelper){'use strict';function getUnansweredItemsWarning(scope,runner,sync){var stats=statsHelper.getInstantStats(scope,runner,sync),unansweredCount=stats&&stats.questions-stats.answered,flaggedCount=stats&&stats.flagged,itemsCountMessage="";return"section"===scope||"testSection"===scope?(itemsCountMessage=0===unansweredCount?__("You answered all %s question(s) in this section",stats.questions.toString()):__("You answered only %s of the %s question(s) in this section",stats.answered.toString(),stats.questions.toString()),flaggedCount&&(itemsCountMessage+=", "+__("and flagged %s of them",flaggedCount.toString()))):"test"===scope?(itemsCountMessage=0===unansweredCount?__("You answered all %s question(s) in this test",stats.questions.toString()):__("You have %s unanswered question(s)",unansweredCount.toString()),flaggedCount&&(itemsCountMessage+=" "+__("and you flagged %s item(s) that you can review now",flaggedCount.toString()))):"part"==scope&&(itemsCountMessage=0===unansweredCount?__("You answered all %s question(s)",stats.questions.toString()):__("You have %s unanswered question(s)",unansweredCount.toString()),flaggedCount&&(itemsCountMessage+=" "+__("and you flagged %s item(s) that you can review now",flaggedCount.toString()))),itemsCountMessage&&(itemsCountMessage+="."),itemsCountMessage}return{getExitMessage:function(message,scope,runner,sync){var itemsCountMessage="",testData=runner.getTestData(),testConfig=testData&&testData.config,messageEnabled=!testConfig||testConfig.enableUnansweredItemsWarning;return messageEnabled&&(itemsCountMessage=getUnansweredItemsWarning(scope,runner,sync)),(itemsCountMessage+" "+message).trim()}}}),define("taoQtiTest/runner/helpers/navigation",["lodash","taoQtiTest/runner/helpers/map"],function(_,mapHelper){'use strict';var navigationHelper={isLeavingSection:function(testContext,testMap,direction,scope,position){var section,sectionStats,nbItems,item;if(_.isPlainObject(testContext)&&_.isPlainObject(testMap)&&!_.isEmpty(testContext.sectionId)&&!_.isEmpty(testContext.itemIdentifier))return section=mapHelper.getSection(testMap,testContext.sectionId),sectionStats=mapHelper.getSectionStats(testMap,testContext.sectionId),nbItems=sectionStats&&sectionStats.total,item=mapHelper.getItem(testMap,testContext.itemIdentifier),"section"===scope||"testPart"===scope||"next"===direction&&item.positionInSection+1===nbItems||"previous"===direction&&0===item.positionInSection||"jump"===direction&&0<position&&(position<section.position||position>=section.position+nbItems);throw new TypeError("Invalid test context and test map")},isLeavingTestPart:function(testContext,testMap,direction,scope,position){var testPart,testPartStats,nbItems,item,section,sectionStats;if(_.isPlainObject(testContext)&&_.isPlainObject(testMap)&&!_.isEmpty(testContext.testPartId)&&!_.isEmpty(testContext.sectionId)&&!_.isEmpty(testContext.itemIdentifier))return testPart=mapHelper.getPart(testMap,testContext.testPartId),testPartStats=mapHelper.getPartStats(testMap,testContext.testPartId),nbItems=testPartStats&&testPartStats.total,item=mapHelper.getItem(testMap,testContext.itemIdentifier),"section"===scope&&(section=mapHelper.getSection(testMap,testContext.sectionId),sectionStats=mapHelper.getSectionStats(testMap,testContext.sectionId)),"testPart"===scope||"next"===direction&&"item"===scope&&item.positionInPart+1===nbItems||"next"===direction&&"section"===scope&&section.position+sectionStats.total>=nbItems||"previous"===direction&&"item"===scope&&0===item.positionInPart||"previous"===direction&&"section"===scope&&section.position===testPart.position||"jump"===direction&&0<position&&(position<testPart.position||position>=testPart.position+nbItems);throw new TypeError("Invalid test context and test map")},isLast:function(testMap,itemIdentifier){return this.isLastOf(testMap,itemIdentifier,"test")},isFirst:function(testMap,itemIdentifier){return this.isFirstOf(testMap,itemIdentifier,"test")},isLastOf:function(testMap,itemIdentifier,scope){var item,stats;if(!_.isPlainObject(testMap))throw new TypeError("Invalid test map");if(_.isEmpty(itemIdentifier))throw new TypeError("Invalid item identifier");if(scope=scope||"test",item=mapHelper.getItem(testMap,itemIdentifier),stats=mapHelper.getScopeStats(testMap,item.position,scope),stats&&_.isNumber(stats.total)){if("test"===scope)return item.position+1===stats.total;if("section"===scope||"assessmentSection"===scope||"testSection"===scope)return item.positionInSection+1===stats.total;if("part"===scope||"testPart"===scope)return item.positionInPart+1===stats.total}return!1},isFirstOf:function(testMap,itemIdentifier,scope){var item;if(!_.isPlainObject(testMap))throw new TypeError("Invalid test map");if(_.isEmpty(itemIdentifier))throw new TypeError("Invalid item identifier");return scope=scope||"test",item=mapHelper.getItem(testMap,itemIdentifier),"test"===scope?0===item.position:"section"===scope||"assessmentSection"===scope||"testSection"===scope?0===item.positionInSection:("part"===scope||"testPart"===scope)&&0===item.positionInPart},getSiblingItems:function(testMap,itemPosition,direction,size){var itemId=mapHelper.getItemIdentifier(testMap,itemPosition),previous=null,siblings=[],itemChain=_.reduce(testMap&&testMap.jumps,function(map,jump){var ref=jump.identifier;return previous&&(map[previous].next=ref),map[ref]={identifier:ref,previous:previous,next:null},previous=ref,map},{}),directions;return size=_.isFinite(size)?parseInt(size,10):3,directions=direction&&"both"!==direction?[direction]:["previous","next"],_.forEach(directions,function(link){var id=itemId;_.times(size,function(){return id=itemChain[id]&&itemChain[id][link],!!id&&void siblings.push(mapHelper.getItem(testMap,id))})}),siblings},getNextItem:function(testMap,itemPosition){var siblings=navigationHelper.getSiblingItems(testMap,itemPosition,"next",1);return siblings.length?siblings[0]:null},getPreviousItem:function(testMap,itemPosition){var siblings=navigationHelper.getSiblingItems(testMap,itemPosition,"previous",1);return siblings.length?siblings[0]:null},isMovingToNextItem:function(action,params){return params=params||{},"timeout"===action||"skip"===action||"move"===action&&"next"===params.direction&&"item"===params.scope},isMovingToPreviousItem:function(action,params){return params=params||{},"move"===action&&"previous"===params.direction&&"item"===params.scope},isJumpingToItem:function(action,params){return params=params||{},"move"===action&&"jump"===params.direction&&"item"===params.scope}};return navigationHelper}),define("taoQtiTest/runner/plugins/controls/timer/strategy/warnSectionLeaving",["lodash","i18n","core/promise","taoQtiTest/runner/helpers/messages","taoQtiTest/runner/helpers/navigation"],function(_,__,Promise,messages,navigationHelper){'use strict';var exitMessage=__("Once you close this section, you cannot return to it or change your answers.");return function(testRunner,timer){var leaveTimedSection=function(direction,scope,position){var context=testRunner.getTestContext(),map=testRunner.getTestMap(),testData=testRunner.getTestData();return!(context.isTimeout||context.itemSessionState===testData.itemStates.closed||context.sectionId!==timer.source)&&navigationHelper.isLeavingSection(context,map,direction,scope,position)};return!!(timer&&"section"===timer.scope&&"max"===timer.type)&&{name:"warnSectionLeaving",setUp:function(){testRunner.off("move.warntimedsection skip.warntimedsection").before("move.warntimedsection skip.warntimedsection",function(e,type,scope,position){var context=testRunner.getTestContext(),testDataBeforeMove=testRunner.getTestData(),config=testDataBeforeMove&&testDataBeforeMove.config,timerConfig=config&&config.timer||{},options=context&&context.options||{},movePromise=new Promise(function(resolve,reject){context.isLast&&options.endTestWarning?resolve():!leaveTimedSection(type||"next",scope,position)||options.noExitTimedSectionWarning||timerConfig.keepUpToTimeout?resolve():testRunner.trigger("confirm.exittimed",messages.getExitMessage(exitMessage,"section",testRunner),resolve,reject,{buttons:{labels:{ok:__("Close this Section"),cancel:__("Review my Answers")}}})});return movePromise.catch(function(){_.defer(function(){testRunner.trigger("enableitem enablenav")})}),movePromise})},complete:function(){return this.tearDown()},tearDown:function(){testRunner.off("move.warntimedsection skip.warntimedsection")}}}}),define("taoQtiTest/runner/plugins/controls/timer/strategy/strategyHandler",["lodash","core/promise","taoQtiTest/runner/plugins/controls/timer/strategy/enforcedStay","taoQtiTest/runner/plugins/controls/timer/strategy/extraTime","taoQtiTest/runner/plugins/controls/timer/strategy/guidedNavigation","taoQtiTest/runner/plugins/controls/timer/strategy/timeout","taoQtiTest/runner/plugins/controls/timer/strategy/warnSectionLeaving"],function(_,Promise,extraTimeStrategy,enforcedStayStrategy,guidedNavigationStrategy,timeoutStrategy,warnSectionLeavingStrategy){'use strict';var defaultAvailableStrategies=[extraTimeStrategy,enforcedStayStrategy,guidedNavigationStrategy,timeoutStrategy,warnSectionLeavingStrategy];return function(testRunner,strategies){var actives={},applyToStrategies=function(timerId,action){var api=_.keys(strategyHandler);if(_.isEmpty(timerId)||_.isEmpty(action)||!_.contains(api,action))throw new TypeError("Invalid timer id or unauthorized action");return _.isArray(actives[timerId])?Promise.all(_.map(actives[timerId],function(strategy){if(_.isFunction(strategy[action]))return strategy[action]()})):Promise.resolve()},strategyHandler;if(!testRunner||!_.isFunction(testRunner.on)||!_.isFunction(testRunner.getTestContext))throw new TypeError("The strategy handler needs a valid test runner.");return strategyHandler={setUp:function(timer){return _.forEach(strategies||defaultAvailableStrategies,function(availableStrategy){var strategy=availableStrategy(testRunner,timer);!1!==strategy&&(actives[timer.id]=actives[timer.id]||[],actives[timer.id].push(strategy))}),applyToStrategies(timer.id,"setUp")},getActives:function(timer){return timer&&timer.id&&_.isArray(actives[timer.id])?actives[timer.id]:[]},start:function(timer){return applyToStrategies(timer.id,"start")},stop:function(timer){return applyToStrategies(timer.id,"stop")},complete:function(timer){return applyToStrategies(timer.id,"complete")},tearDown:function(timer){return applyToStrategies(timer.id,"tearDown").then(function(){actives=_.omit(actives,timer.id)})}},strategyHandler}}),define("taoQtiTest/runner/plugins/controls/timer/timers",["lodash","i18n","moment","core/format","core/logger"],function(_,__,moment,format,loggerFactory){'use strict';var logger=loggerFactory("taoQtiTest/runner/plugins/controls/timer/timers"),precision=1e3,scopes=["item","section","testPart","test"],scopeMapping={assessmentTest:"test",assessmentSection:"section",assessmentItemRef:"item"},getScope=function(value){return scopeMapping[value]?scopeMapping[value]:_.contains(scopes,value)?value:null},warningMessages={item:__("Warning \u2013 You have %s remaining to complete this item."),section:__("Warning \u2013 You have %s remaining to complete this section."),testPart:__("Warning \u2013 You have %s remaining to complete this test part."),test:__("Warning \u2013 You have %s remaining to complete this test.")};return function(timeConstraints,isLinear,config){var timers={},constraintsWarnings=_.reduce(config.warnings,function(acc,warnings,qtiScope){var scope=getScope(qtiScope);return acc[scope]=_.map(warnings,function(value,key){return{threshold:parseInt(key,10)*precision,message:function(remainingTime){var displayRemaining=moment.duration(remainingTime/precision,"seconds").humanize();return format(warningMessages[scope],displayRemaining)},level:value,shown:!1}}),acc},{}),buildTimer=function(type,constraintData){var timer=_.pick(constraintData,["label","scope","source","extraTime","qtiClassName"]);return timer.type=type,timer.allowLateSubmission=constraintData.allowLateSubmission,"min"===type?(timer.id=type+"-"+constraintData.scope+"-"+constraintData.source,timer.originalTime=constraintData.minTime*precision,timer.remainingTime=constraintData.minTimeRemaining*precision):(timer.id=constraintData.source,timer.originalTime=constraintData.maxTime*precision,timer.remainingTime=constraintData.maxTimeRemaining*precision),timer.remainingWithoutExtraTime=timer.remainingTime,timer.extraTime&&(timer.extraTime.consumed*=precision,timer.extraTime.remaining*=precision,timer.extraTime.total*=precision,timer.total=timer.originalTime+timer.extraTime.total,timer.remainingTime+=timer.extraTime.remaining),"max"===type&&_.isArray(constraintsWarnings[timer.scope])&&(timer.warnings=constraintsWarnings[timer.scope]),timer};return _.forEach(timeConstraints,function(timeConstraint){var constraintData=_.clone(timeConstraint),newTimer;constraintData.scope=getScope(timeConstraint.scope||timeConstraint.qtiClassName),constraintData.scope?!1===constraintData.minTime&&!1===constraintData.maxTime?logger.warning("Time constraint defined with no time, skipping"):config.guidedNavigation&&isLinear&&constraintData.maxTime&&constraintData.minTime&&constraintData.minTime===constraintData.maxTime&&0<constraintData.maxTime?(newTimer=buildTimer("locked",constraintData),timers[newTimer.id]=newTimer):(isLinear&&constraintData.minTime&&0<constraintData.minTime&&(newTimer=buildTimer("min",constraintData),timers[newTimer.id]=newTimer),constraintData.maxTime&&0<constraintData.maxTime&&(newTimer=buildTimer("max",constraintData),timers[newTimer.id]=newTimer)):logger.warning("Wrong data, a time constraint should apply to a valid scope, skipping")}),logger.debug("Timers built from timeConstraints",timers),timers}}),define("taoQtiTest/runner/plugins/controls/timer/plugin",["jquery","lodash","core/promise","taoTests/runner/plugin","taoQtiTest/runner/plugins/controls/timer/strategy/strategyHandler","taoQtiTest/runner/plugins/controls/timer/component/timerbox","taoQtiTest/runner/plugins/controls/timer/timers"],function($,_,Promise,pluginFactory,getStrategyHandler,timerboxFactory,timersFactory){'use strict';return pluginFactory({name:"timer",install:function(){var testRunner=this.getTestRunner();this.loadTimers=function(timeStore,config){var testContext=testRunner.getTestContext(),timeConstraints=testContext.timeConstraints,isLinear=!!testContext.isLinear,timers=timersFactory(timeConstraints,isLinear,config);return Promise.all(_.map(timers,function(timer){return timeStore.getItem("consumed_"+timer.id).then(function(savedConsumedTime){_.isNumber(savedConsumedTime)&&0<=savedConsumedTime&&config.restoreTimerFromClient&&(timer.remainingTime=timer.originalTime+timer.extraTime.total-savedConsumedTime)})})).then(function(){return timers})},this.saveTimers=function(timeStore,timers){return Promise.all(_.map(timers,function(timer){return timeStore.setItem("consumed_"+timer.id,timer.originalTime+timer.extraTime.total-timer.remainingTime)}))},testRunner.getTestStore().setVolatile(this.getName())},init:function(){var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData(),config=_.merge({},this.getConfig(),{contextualWarnings:!1,warnings:testData&&testData.config&&testData.config.timerWarning||{},guidedNavigation:testData&&testData.config&&testData.config.guidedNavigation,restoreTimerFromClient:testData&&testData.config&&testData.config.timer.restoreTimerFromClient}),strategyHandler=getStrategyHandler(testRunner),handleError=function(err){testRunner.trigger("error",err)};return new Promise(function(resolve){return testRunner.getPluginStore(self.getName()).then(function(timeStore){testRunner.before("renderitem resumeitem",function(){var testContext=testRunner.getTestContext();if(self.timerbox&&testContext.timeConstraints)return self.loadTimers(timeStore,config).then(function(timers){return self.timerbox.update(timers)}).catch(handleError)}).on("enableitem",function(){self.timerbox&&self.timerbox.start()}).after("renderitem",function(){self.timerbox&&self.timerbox.start()}).on("disableitem move skip",function(){self.timerbox&&self.timerbox.stop()}),timeStore.getItem("zen-mode").then(function(startZen){self.timerbox=timerboxFactory({zenMode:{enabled:!0,startHidden:!!startZen},displayWarning:config.contextualWarnings}).on("change",_.throttle(function(){self.saveTimers(timeStore,this.getTimers())},1e3)).on("timeradd",function(timer){strategyHandler.setUp(timer).catch(handleError)}).on("timerremove",function(timer){strategyHandler.tearDown(timer).catch(handleError)}).on("timerstart",function(timer){strategyHandler.start(timer).catch(handleError)}).on("timerstop",function(timer){strategyHandler.stop(timer).catch(handleError)}).on("timerend",function(timer){strategyHandler.complete(timer).catch(handleError)}).on("timerchange",function(action,timer){self.trigger(action+"timer",timer.qtiClassName,timer)}).on("zenchange",function(isZen){timeStore.setItem("zen-mode",!!isZen)}).on("init",resolve).on("error",handleError),config.contextualWarnings||self.timerbox.on("warn",function(message,level){level&&message&&testRunner.trigger(level,message)})}).catch(handleError)})})},render:function(){this.timerbox.render(this.getAreaBroker().getControlArea())},destroy:function(){this.timerbox&&this.timerbox.stop().destroy()},show:function(){this.timerbox&&this.timerbox.show()},hide:function(){this.timerbox&&this.timerbox.hide()}})}),define("tpl!taoQtiTest/runner/plugins/controls/title/title",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="\n        <span data-control=\"",(helper=helpers.control)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.control,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" class=\"qti-controls\" title=\"",(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">",stack1=helpers.unless.call(depth0,null==data||!1===data?data:data.first,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n    ",buffer}function program2(){return" - "}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1;return buffer+="<div class=\"title-box truncate\">\n    ",stack1=helpers.each.call(depth0,depth0&&depth0.titles,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>",buffer})}),define("taoQtiTest/runner/plugins/controls/title/title",["jquery","i18n","taoTests/runner/plugin","tpl!taoQtiTest/runner/plugins/controls/title/title"],function($,__,pluginFactory,titleTpl){'use strict';return pluginFactory({name:"title",init:function(){var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData(),createElement=function(){var context=testRunner.getTestContext(),titles=[{control:"qti-test-title",text:testData.title}];return context.isDeepestSectionVisible&&titles.push({control:"qti-test-position",text:context.sectionTitle}),$(titleTpl({titles:titles}))};this.$element=createElement(),testRunner.after("renderitem",function(){var $element=createElement();self.$element.replaceWith($element),self.$element=$element})},render:function(){var $container=this.getAreaBroker().getControlArea();$container.append(this.$element)}})}),define("taoQtiTest/runner/plugins/controls/trace/itemTraceVariables",["lodash","moment","taoTests/runner/plugin"],function(_,moment,pluginFactory){'use strict';function timestamp(){return Date.now()/1000}return pluginFactory({name:"itemTraceVariables",install:function(){this.getTestRunner().getTestStore().setVolatile("trace")},init:function(){function onError(err){testRunner.trigger("error",err)}var testRunner=this.getTestRunner(),variables={};return testRunner.getPluginStore("trace").then(function(tracesStore){testRunner.after("renderitem enableitem",function(){var context=testRunner.getTestContext();variables={ITEM_START_TIME_CLIENT:timestamp()},tracesStore.getItem(context.itemIdentifier).then(function(data){return data&&_.merge(variables,data),tracesStore.setItem(context.itemIdentifier,variables)}).catch(onError)}).before("move skip exit timeout",function(){var context=testRunner.getTestContext();return variables.ITEM_END_TIME_CLIENT=timestamp(),variables.ITEM_TIMEZONE=moment().utcOffset(moment().utcOffset()).format("Z"),tracesStore.setItem(context.itemIdentifier,variables).catch(onError)}).before("unloaditem",function(){var context=testRunner.getTestContext();return testRunner.getProxy().callItemAction(context.itemIdentifier,"storeTraceData",{traceData:JSON.stringify(variables)},!0)})})}})}),define("taoQtiTest/runner/plugins/navigation/allowSkipping",["lodash","i18n","taoTests/runner/plugin","taoQtiTest/runner/helpers/currentItem"],function(_,__,pluginFactory,currentItemHelper){'use strict';var defaults={allowPartial:!0};return pluginFactory({name:"allowSkipping",init:function(){this.getTestRunner().before("nav-next move",function(){var self=this,testContext=this.getTestContext(),isInteracting=!this.getItemState(testContext.itemIdentifier,"disabled"),testData=this.getTestData()||{},testConfig=testData.config||{},pluginsConfig=testConfig.plugins||{},config=_.defaults(pluginsConfig.allowSkipping||{},defaults),warning=config.allowPartial?__("A response to every question in this item is required."):__("A response to this item is required.");if(isInteracting&&testContext.enableAllowSkipping&&!testContext.allowSkipping)return new Promise(function(resolve,reject){return 0===_.size(currentItemHelper.getDeclarations(self))?resolve():currentItemHelper.isAnswered(self,config.allowPartial)?resolve():void(!self.getState("alerted.notallowed")&&(self.setState("alerted.notallowed",!0),self.trigger("alert.notallowed",warning,function(){self.trigger("resumeitem"),reject(),self.setState("alerted.notallowed",!1)})))})})}})}),define("taoQtiTest/runner/plugins/navigation/next/nextWarningHelper",[],function(){'use strict';var toBoolean=function(value,defaultValue){return"undefined"==typeof value?defaultValue:!0===value||"true"===value};return function(options){function itemCanBeTriedAtWill(){return!1===isLast&&!1===isLinear&&-1===remainingAttempts&&!isNextItemInLinearPart()}function isNextItemInLinearPart(){return nextPart&&"undefined"!=typeof nextPart.isLinear&&isLastOfPart()&&!0===nextPart.isLinear}function shouldWarnOnTestEnd(){return isLast&&(endTestWarning||warnBeforeNext)&&shouldWarnForUnansweredItems()}function shouldWarnForUnansweredItems(){var hasUnanswered=stats&&0!=stats.questions-stats.answered,hasFlagged=stats&&0!==stats.flagged;return!unansweredOnly||hasUnanswered||hasFlagged}function shouldWarnOnPartChange(){return nextPartWarning&&isLastOfPart()&&shouldWarnForUnansweredItems()}function isLastOfPart(){return nextPart&&nextPart.id&&testPartId!==nextPart.id}var endTestWarning=toBoolean(options.endTestWarning,!1),isLast=toBoolean(options.isLast,!1),isLinear=toBoolean(options.isLinear,!1),nextItemWarning=toBoolean(options.nextItemWarning,!1),nextPartWarning=toBoolean(options.nextPartWarning,!1),stats=options.stats,nextPart=options.nextPart||{},remainingAttempts="undefined"==typeof options.remainingAttempts?-1:options.remainingAttempts,testPartId=options.testPartId||"",unansweredOnly=toBoolean(options.unansweredOnly,!1),warnBeforeNext=function(){return nextItemWarning&&!itemCanBeTriedAtWill()}(),warnBeforeEnd=function(){return shouldWarnOnTestEnd()||shouldWarnOnPartChange()}();return{shouldWarnBeforeEnd:function shouldWarnBeforeEnd(){return warnBeforeEnd},shouldWarnBeforeNext:function shouldWarnBeforeNext(){return warnBeforeNext}}}}),define("taoQtiTest/runner/plugins/navigation/next",["jquery","lodash","i18n","ui/hider","taoTests/runner/plugin","taoQtiTest/runner/plugins/navigation/next/nextWarningHelper","taoQtiTest/runner/helpers/messages","taoQtiTest/runner/helpers/map","taoQtiTest/runner/helpers/stats","util/shortcut","util/namespace","tpl!taoQtiTest/runner/plugins/templates/button"],function($,_,__,hider,pluginFactory,nextWarningHelper,messages,mapHelper,statsHelper,shortcut,namespaceHelper,buttonTpl){'use strict';var buttonData={next:{control:"move-forward",title:__("Submit and go to the next item"),icon:"forward",text:__("Next")},end:{control:"move-end",title:__("Submit and go to the end of the test"),icon:"fast-forward",text:__("End test")}},createElement=function(context){var dataType=context.isLast?"end":"next";return $(buttonTpl(buttonData[dataType]))},updateElement=function($element,context){var dataType=context.isLast?"end":"next";$element.attr("data-control")!==buttonData[dataType].control&&($element.attr("data-control",buttonData[dataType].control).attr("title",buttonData[dataType].title).find(".text").text(buttonData[dataType].text),"next"==dataType?$element.find(".icon-"+buttonData.end.icon).removeClass("icon-"+buttonData.end.icon).addClass("icon-"+buttonData.next.icon):$element.find(".icon-"+buttonData.next.icon).removeClass("icon-"+buttonData.next.icon).addClass("icon-"+buttonData.end.icon))};return pluginFactory({name:"next",init:function(){function doNext(nextItemWarning){function enableNav(){testRunner.trigger("enablenav")}var context=testRunner.getTestContext(),testOptions=context.options||{},map=testRunner.getTestMap(),nextItemPosition=context.itemPosition+1,nextPartWarning=testOptions.nextPartWarning||testOptions.unansweredWarning,unansweredOnly=!testOptions.endTestWarning&&testOptions.unansweredWarning,warningScope=nextPartWarning?"part":"test";if(testRunner.trigger("disablenav"),!1!==self.getState("enabled")){var warningHelper=nextWarningHelper({endTestWarning:testOptions.endTestWarning,isLast:context.isLast,isLinear:context.isLinear,nextItemWarning:nextItemWarning,nextPartWarning:nextPartWarning,nextPart:mapHelper.getItemPart(map,nextItemPosition),remainingAttempts:context.remainingAttempts,testPartId:context.testPartId,unansweredWarning:testOptions.unansweredWarning,stats:statsHelper.getInstantStats(warningScope,testRunner),unansweredOnly:unansweredOnly});warningHelper.shouldWarnBeforeEnd()?testRunner.trigger("confirm.endTest",messages.getExitMessage(__("You are about to submit the test. You will not be able to access this test once submitted. Click OK to continue and submit the test."),warningScope,testRunner),_.partial(triggerNextAction,context),enableNav):warningHelper.shouldWarnBeforeNext()?testRunner.trigger("confirm.next",__("You are about to go to the next item. Click OK to continue and go to the next item."),_.partial(triggerNextAction,context),enableNav):triggerNextAction(context)}}function triggerNextAction(context){context.isLast&&self.trigger("end"),testRunner.next()}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData(),testConfig=testData.config||{},pluginShortcuts=(testConfig.shortcuts||{})[this.getName()]||{};this.$element=createElement(testRunner.getTestContext()),this.$element.on("click",function(e){e.preventDefault(),testRunner.trigger("nav-next")}),testConfig.allowShortcuts&&pluginShortcuts.trigger&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.trigger,this.getName(),!0),function(){!0===self.getState("enabled")&&testRunner.trigger("nav-next",!0)},{avoidInput:!0,prevent:!0}),this.disable(),testRunner.on("loaditem",function(){updateElement(self.$element,testRunner.getTestContext())}).on("enablenav",function(){self.enable()}).on("disablenav",function(){self.disable()}).on("hidenav",function(){self.hide()}).on("shownav",function(){self.show()}).on("nav-next",function(nextItemWarning){doNext(nextItemWarning)})},render:function(){var $container=this.getAreaBroker().getNavigationArea();$container.append(this.$element)},destroy:function(){shortcut.remove("."+this.getName()),this.$element.remove()},enable:function(){this.$element.removeProp("disabled").removeClass("disabled")},disable:function(){this.$element.prop("disabled",!0).addClass("disabled")},show:function(){hider.show(this.$element)},hide:function(){hider.hide(this.$element)}})}),define("tpl!taoQtiTest/runner/plugins/navigation/next/tpl/checkbox",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,self=this,stack1,helper;return buffer+="<label for=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <input type=\"checkbox\" id=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" name=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.checked,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"checked"},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+=" />\n    <span class=\"icon-checkbox\"></span>\n    ",(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n</label>",buffer})}),define("taoQtiTest/runner/plugins/navigation/next/dialogConfirmNext",["jquery","lodash","i18n","ui/dialog","tpl!taoQtiTest/runner/plugins/navigation/next/tpl/checkbox"],function($,_,__,dialog,checkboxTpl){'use strict';return function(heading,message,accept,refuse,checkboxParams,dialogOptions){var accepted=!1,content=null,dlg;return checkboxParams&&!0!==checkboxParams.checked&&(content=checkboxTpl({checked:!1,text:"Don't show this again next time",id:"dont-show-again"})),dialogOptions=_.defaults({heading:heading,message:message,content:content,autoRender:!0,autoDestroy:!0,buttons:[{id:"cancel",type:"regular",label:__("Cancel"),close:!0},{id:"ok",type:"info",label:__("Go to next item"),close:!0}],onOkBtn:function(){var $checkbox;accepted=!0,_.isFunction(accept)&&(accept.call(this),checkboxParams&&($checkbox=$("input[name=\"dont-show-again\"]",this),$checkbox.prop("checked")&&_.isFunction(checkboxParams.submitChecked)?checkboxParams.submitChecked():!$checkbox.prop("checked")&&_.isFunction(checkboxParams.submitUnchecked)&&checkboxParams.submitUnchecked()))}},dialogOptions),dlg=dialog(dialogOptions),_.isFunction(refuse)&&dlg.on("closed.modal",function(){accepted||refuse.call(this)}),dlg}}),define("taoQtiTest/runner/plugins/navigation/next/linearNextItemWarning",["jquery","lodash","i18n","taoTests/runner/plugin","taoQtiTest/runner/helpers/map","taoQtiTest/runner/helpers/currentItem","taoQtiTest/runner/plugins/navigation/next/dialogConfirmNext"],function($,_,__,pluginFactory,mapHelper,currentItemHelper,dialogConfirmNext){'use strict';return pluginFactory({name:"linearNextItemWarning",init:function(){function getCustomNextMessage(action){var itemPartiallyAnswered=currentItemHelper.isAnswered(testRunner,!0),customNextMessage;return customNextMessage=itemPartiallyAnswered?"next"===action?__("Are you sure you want to go to the next item? You will not be able to go back and change your answer."):"skip"===action?__("Are you sure you want to clear your answer and go to the next item? You will not be able to go back and provide an answer."):__("Are you sure you want to go to the next item? You will not be able to go back."):__("Are you sure you want to go to the next item? You will not be able to go back and provide an answer."),customNextMessage}function doNextWarning(action){return testRunner.trigger("disablenav"),testStore.getStore(self.getName()).then(function(store){return store.getItem("dontShowLinearNextItemWarning").then(function(checkboxValue){var checkboxParams=null;if(!0!==checkboxValue)return testConfig.enableLinearNextItemWarningCheckbox&&(checkboxParams={checked:checkboxValue,submitChecked:function submitChecked(){store.setItem("dontShowLinearNextItemWarning",!0)},submitUnchecked:function submitUnchecked(){store.setItem("dontShowLinearNextItemWarning",!1)}}),new Promise(function(resolve,reject){dialogConfirmNext(__("Go to the next item?"),getCustomNextMessage(action),resolve,function(){reject({cancel:!0})},checkboxParams)})})}).catch(function(err){if(err&&err instanceof Error)throw err;return err&&!0===err.cancel?(testRunner.trigger("enablenav"),Promise.reject()):void 0})}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData(),testConfig=testData.config||{},testStore=testRunner.getTestStore();testStore.setVolatile(self.getName()),testRunner.on("init",function(){testStore.getStore(self.getName()).then(function(store){store.setItem("dontShowLinearNextItemWarning",null)})}).before("move skip",function(e,type,scope){var context=testRunner.getTestContext(),map=testRunner.getTestMap(),item=mapHelper.getItemAt(map,context.itemPosition);if(context.isLinear){if("section"===scope&&context.options.nextSectionWarning)return;if(context.options.nextPartWarning)return;if(item.informational)return;if("next"===type&&!context.isLast&&testConfig.forceEnableLinearNextItemWarning)return doNextWarning("next");if("skip"===e.name&&!context.isLast&&testConfig.forceEnableLinearNextItemWarning)return doNextWarning("skip")}})}})}),define("taoQtiTest/runner/plugins/navigation/nextSection",["jquery","lodash","i18n","ui/hider","taoTests/runner/plugin","taoQtiTest/runner/helpers/messages","tpl!taoQtiTest/runner/plugins/templates/button"],function($,_,__,hider,pluginFactory,messages,buttonTpl){'use strict';return pluginFactory({name:"nextsection",init:function(){function toggle(){var options=testRunner.getTestContext().options;testConfig.nextSection&&(options.nextSection||options.nextSectionWarning)?self.show():self.hide()}function nextSection(){testRunner.next("section")}var self=this,testRunner=this.getTestRunner(),testConfig=testRunner.getTestData().config;this.$element=$(buttonTpl({control:"next-section",title:__("Skip to the next section"),icon:"fast-forward",text:__("Next Section")})),this.$element.on("click",function(e){var context=testRunner.getTestContext(),enable=_.bind(self.enable,self);e.preventDefault(),!1!==self.getState("enabled")&&(self.disable(),context.options.nextSectionWarning?testRunner.trigger("confirm.nextsection",messages.getExitMessage(__("Once you close this section, you cannot return to it or change your answers."),"section",testRunner),nextSection,enable,{buttons:{labels:{ok:__("Close this Section"),cancel:__("Review my Answers")}}}):nextSection())}),this.disable(),toggle(),testRunner.on("loaditem",toggle).on("enablenav",function(){self.enable()}).on("disablenav",function(){self.disable()}).on("hidenav",function(){self.hide()}).on("shownav",function(){self.show()})},render:function(){var $container=this.getAreaBroker().getNavigationArea();$container.append(this.$element)},destroy:function(){this.$element.remove()},enable:function(){this.$element.removeProp("disabled").removeClass("disabled")},disable:function(){this.$element.prop("disabled",!0).addClass("disabled")},show:function(){hider.show(this.$element)},hide:function(){hider.hide(this.$element)}})}),define("taoQtiTest/runner/plugins/navigation/previous",["jquery","lodash","i18n","ui/hider","taoTests/runner/plugin","util/shortcut","util/namespace","taoQtiTest/runner/helpers/navigation","taoQtiTest/runner/helpers/map","tpl!taoQtiTest/runner/plugins/templates/button"],function($,_,__,hider,pluginFactory,shortcut,namespaceHelper,navigationHelper,mapHelper,buttonTpl){'use strict';return pluginFactory({name:"previous",init:function(){function doPrevious(previousItemWarning){var context=testRunner.getTestContext();testRunner.trigger("disablenav"),!1!==self.getState("enabled")&&(previousItemWarning&&-1!==context.remainingAttempts?testRunner.trigger("confirm.previous",__("You are about to go to the previous item. Click OK to continue and go to the previous item."),testRunner.previous,function(){testRunner.trigger("disablenav")}()):testRunner.previous())}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData(),testConfig=testData.config||{},pluginShortcuts=(testConfig.shortcuts||{})[this.getName()]||{},canDoPrevious=function(){var testMap=testRunner.getTestMap(),context=testRunner.getTestContext(),previousSection,previousPart;if(_.isPlainObject(testMap)&&0===_.size(testMap))return!1;if(navigationHelper.isFirst(testMap,context.itemIdentifier))return!1;if(navigationHelper.isFirstOf(testMap,context.itemIdentifier,"section")){if(context.isCatAdaptive)return!1;if(previousSection=mapHelper.getItemSection(testMap,context.itemPosition-1),previousSection.isCatAdaptive||previousSection.timeConstraint&&!context.options.noExitTimedSectionWarning)return!1}return!(navigationHelper.isFirstOf(testMap,context.itemIdentifier,"part")&&(previousPart=mapHelper.getItemPart(testMap,context.itemPosition-1),previousPart.isLinear))&&!1===context.isLinear&&!0===context.canMoveBackward},toggle=function(){canDoPrevious()?self.show():self.hide()};this.$element=$(buttonTpl({control:"move-backward",title:__("Submit and go to the previous item"),icon:"backward",text:__("Previous")})),this.$element.on("click",function(e){e.preventDefault(),testRunner.trigger("nav-previous")}),testConfig.allowShortcuts&&pluginShortcuts.trigger&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.trigger,this.getName(),!0),function(){canDoPrevious()&&!0===self.getState("enabled")&&testRunner.trigger("nav-previous",[!0])},{avoidInput:!0,prevent:!0}),toggle(),self.disable(),testRunner.on("loaditem",toggle).on("enablenav",function(){self.enable()}).on("disablenav",function(){self.disable()}).on("hidenav",function(){self.hide()}).on("shownav",function(){self.show()}).on("nav-previous",function(previousItemWarning){doPrevious(previousItemWarning)})},render:function(){var $container=this.getAreaBroker().getNavigationArea();$container.append(this.$element)},destroy:function(){shortcut.remove("."+this.getName()),this.$element.remove()},enable:function(){this.$element.removeProp("disabled").removeClass("disabled")},disable:function(){this.$element.prop("disabled",!0).addClass("disabled")},show:function(){hider.show(this.$element)},hide:function(){hider.hide(this.$element)}})}),define("tpl!taoQtiTest/runner/plugins/navigation/review/navigator",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program3(depth0,data){var buffer="",helper,options;return buffer+="\n    <div class=\"qti-navigator-info collapsible\">\n                <span class=\"qti-navigator-label\">\n                    <span class=\"qti-navigator-text\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Test status",options):helperMissing.call(depth0,"__","Test status",options)))+"</span>\n                    <span class=\"icon-up\"></span>\n                    <span class=\"icon-down\"></span>\n                </span>\n        <ul class=\"collapsible-panel plain\">\n            <li class=\"qti-navigator-viewed\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Viewed items",options):helperMissing.call(depth0,"__","Viewed items",options)))+"\">\n                        <span class=\"qti-navigator-label\">\n                            <span class=\"qti-navigator-icon icon-viewed\"></span>\n                            <span class=\"qti-navigator-text\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Viewed",options):helperMissing.call(depth0,"__","Viewed",options)))+"</span>\n                            <span class=\"qti-navigator-counter\">-/-</span>\n                        </span>\n            </li>\n            <li class=\"qti-navigator-answered\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Completed items",options):helperMissing.call(depth0,"__","Completed items",options)))+"\">\n                        <span class=\"qti-navigator-label\">\n                            <span class=\"qti-navigator-icon icon-answered\"></span>\n                            <span class=\"qti-navigator-text\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Answered",options):helperMissing.call(depth0,"__","Answered",options)))+"</span>\n                            <span class=\"qti-navigator-counter\">-/-</span>\n                        </span>\n            </li>\n            <li class=\"qti-navigator-unanswered\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Unanswered items",options):helperMissing.call(depth0,"__","Unanswered items",options)))+"\">\n                        <span class=\"qti-navigator-label\">\n                            <span class=\"qti-navigator-icon icon-unanswered\"></span>\n                            <span class=\"qti-navigator-text\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Unanswered",options):helperMissing.call(depth0,"__","Unanswered",options)))+"</span>\n                            <span class=\"qti-navigator-counter\">-/-</span>\n                        </span>\n            </li>\n            <li class=\"qti-navigator-flagged\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Items marked for later review",options):helperMissing.call(depth0,"__","Items marked for later review",options)))+"\">\n                        <span class=\"qti-navigator-label\">\n                            <span class=\"qti-navigator-icon icon-flagged\"></span>\n                            <span class=\"qti-navigator-text\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Flagged",options):helperMissing.call(depth0,"__","Flagged",options)))+"</span>\n                            <span class=\"qti-navigator-counter\">-/-</span>\n                        </span>\n            </li>\n        </ul>\n    </div>\n    ",buffer}function program9(depth0,data){var buffer="",helper,options;return buffer+=escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Unanswered",options):helperMissing.call(depth0,"__","Unanswered",options)))+" (<span class=\"qti-navigator-counter\">0</span>)",buffer}function program13(depth0,data){var buffer="",helper,options;return buffer+=escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Flagged",options):helperMissing.call(depth0,"__","Flagged",options)))+" (<span class=\"qti-navigator-counter\">0</span>)",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1,helper,options;return buffer+="<div class=\"qti-panel qti-navigator",stack1=helpers["if"].call(depth0,depth0&&depth0.hidden,{hash:{},inverse:self.noop,fn:self.program(1,function(){return" hidden"},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\">\n    <div class=\"qti-navigator-collapsible\">\n        <span class=\"qti-navigator-collapse icon icon-left\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Collapse the review panel",options):helperMissing.call(depth0,"__","Collapse the review panel",options)))+"\"></span>\n        <span class=\"qti-navigator-expand icon icon-right\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Expand the review panel",options):helperMissing.call(depth0,"__","Expand the review panel",options)))+"\"></span>\n    </div>\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.showLegend,{hash:{},inverse:self.noop,fn:self.program(3,program3,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n\n\n    <div class=\"qti-navigator-filters\">\n        <ul class=\"plain clearfix\">\n            <li class=\"qti-navigator-filter active\" data-mode=\"all\">\n                <span title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Reset filters",options):helperMissing.call(depth0,"__","Reset filters",options)))+"\" class=\"qti-navigator-tab\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"All",options):helperMissing.call(depth0,"__","All",options)))+"\n                    ",stack1=helpers.unless.call(depth0,depth0&&depth0.showLegend,{hash:{},inverse:self.noop,fn:self.program(5,function(){return"(<span class=\"qti-navigator-counter\">0</span>)"},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n                </span>\n            </li>\n\n            <li class=\"qti-navigator-filter\" data-mode=\"unanswered\">\n                <span class=\"",stack1=helpers["if"].call(depth0,depth0&&depth0.showLegend,{hash:{},inverse:self.noop,fn:self.program(7,function(){return"icon-unanswered "},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="qti-navigator-tab\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Only display the unanswered items",options):helperMissing.call(depth0,"__","Only display the unanswered items",options)))+"\">\n                    ",stack1=helpers.unless.call(depth0,depth0&&depth0.showLegend,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n                </span>\n            </li>\n\n            <li class=\"qti-navigator-filter\" data-mode=\"flagged\">\n                <span class=\"",stack1=helpers["if"].call(depth0,depth0&&depth0.showLegend,{hash:{},inverse:self.noop,fn:self.program(11,function(){return"icon-flagged "},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="qti-navigator-tab\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Only display the items marked for review",options):helperMissing.call(depth0,"__","Only display the items marked for review",options)))+"\">\n                    ",stack1=helpers.unless.call(depth0,depth0&&depth0.showLegend,{hash:{},inverse:self.noop,fn:self.program(13,program13,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n                </span>\n            </li>\n        </ul>\n    </div>\n\n    <nav class=\"qti-navigator-tree\"></nav>\n\n    <div id=\"qti-navigator-linear\" class=\"qti-navigator-linear\">\n        <span class=\"icon icon-info\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"In this part of the test navigation is not allowed.",options):helperMissing.call(depth0,"__","In this part of the test navigation is not allowed.",options)))+"\"></span>\n        <p class=\"qti-navigator-message\">\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"In this part of the test navigation is not allowed.",options):helperMissing.call(depth0,"__","In this part of the test navigation is not allowed.",options)))+"\n        </p>\n    </div>\n</div>",buffer})}),define("tpl!taoQtiTest/runner/plugins/navigation/review/navigatorTree",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return buffer+="\n    <li class=\"qti-navigator-part collapsible ",stack1=helpers["if"].call(depth0,depth0&&depth0.active,{hash:{},inverse:self.program(4,program4,data),fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-id=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n        <span class=\"qti-navigator-label\" title=\"",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n            <span class=\"qti-navigator-text\">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n            <span class=\"icon-up\"></span>\n            <span class=\"icon-down\"></span>\n        </span>\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.isLinear,{hash:{},inverse:self.program(8,program8,data),fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </li>\n    ",buffer}function program2(){return"active"}function program4(){return"collapsed"}function program6(depth0,data){var buffer="",stack1,helper,options;return buffer+="\n        <div class=\"qti-navigator-linear-part collapsible-panel\">\n            <span class=\"icon icon-info\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"In this part of the test navigation is not allowed.",options):helperMissing.call(depth0,"__","In this part of the test navigation is not allowed.",options)))+"\"></span>\n            <p class=\"qti-navigator-message\">\n                "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"In this part of the test navigation is not allowed.",options):helperMissing.call(depth0,"__","In this part of the test navigation is not allowed.",options)))+"\n            </p>\n            <p class=\"qti-navigator-actions\">\n                <button class=\"btn-info small\" data-position=\"",(helper=helpers.position)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.position,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Start Test-part",options):helperMissing.call(depth0,"__","Start Test-part",options)))+"\">\n                    <span class=\"qti-navigator-text\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Start Test-part",options):helperMissing.call(depth0,"__","Start Test-part",options)))+"</span>\n                    <span class=\"icon-play r\"></span>\n                </button>\n            </p>\n        </div>\n        ",buffer}function program8(depth0,data){var buffer="",stack1;return buffer+="\n        <ul class=\"qti-navigator-sections collapsible-panel plain\">\n            ",stack1=helpers.each.call(depth0,depth0&&depth0.sections,{hash:{},inverse:self.noop,fn:self.program(9,program9,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n        </ul>\n        ",buffer}function program9(depth0,data){var buffer="",stack1,helper;return buffer+="\n            <li class=\"qti-navigator-section collapsible ",stack1=helpers["if"].call(depth0,depth0&&depth0.active,{hash:{},inverse:self.program(4,program4,data),fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-id=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n                <span class=\"qti-navigator-label\" title=\"",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n                    <span class=\"qti-navigator-text\">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n                    <span class=\"qti-navigator-counter\">"+escapeExpression((stack1=(stack1=depth0&&depth0.stats,null==stack1||!1===stack1?stack1:stack1.answered),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"/"+escapeExpression((stack1=(stack1=depth0&&depth0.stats,null==stack1||!1===stack1?stack1:stack1.total),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1))+"</span>\n                </span>\n                <ul class=\"qti-navigator-items collapsible-panel plain\">\n                    ",stack1=helpers.each.call(depth0,depth0&&depth0.items,{hash:{},inverse:self.noop,fn:self.program(10,program10,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n                </ul>\n            </li>\n            ",buffer}function program10(depth0,data){var buffer="",stack1,helper;return buffer+="\n                    <li class=\"qti-navigator-item ",(helper=helpers.cls)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.cls,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-id=\"",(helper=helpers.id)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.id,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-position=\"",(helper=helpers.position)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.position,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n                        <span class=\"qti-navigator-label truncate\" title=\"",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n                            <span class=\"qti-navigator-icon icon-",(helper=helpers.icon)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.icon,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\"></span>\n                            <span class=\"qti-navigator-number\">",(helper=helpers.index)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.index,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n                            ",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\n                        </span>\n                    </li>\n                    ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1;return buffer+="<ul class=\"qti-navigator-parts plain\">\n    ",stack1=helpers.each.call(depth0,depth0&&depth0.parts,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</ul>",buffer})}),define("taoQtiTest/runner/plugins/navigation/review/navigator",["jquery","lodash","i18n","ui/component","ui/autoscroll","taoQtiTest/runner/helpers/map","tpl!taoQtiTest/runner/plugins/navigation/review/navigator","tpl!taoQtiTest/runner/plugins/navigation/review/navigatorTree"],function($,_,__,component,autoscroll,mapHelper,navigatorTpl,navigatorTreeTpl){'use strict';var _defaults={scope:"test",canCollapse:!1,preventsUnseen:!0,hidden:!1},_cssCls={active:"active",collapsed:"collapsed",collapsible:"collapsible",hidden:"hidden",disabled:"disabled",flagged:"flagged",answered:"answered",viewed:"viewed",unseen:"unseen",info:"info",icon:"qti-navigator-icon",scope:{test:"scope-test",testPart:"scope-test-part",testSection:"scope-test-section"}},_iconCls=[_cssCls.info,_cssCls.flagged,_cssCls.answered,_cssCls.viewed],_selectors={component:".qti-navigator",filterBar:".qti-navigator-filters",filter:".qti-navigator-filter",tree:".qti-navigator-tree",collapseHandle:".qti-navigator-collapsible",linearState:".qti-navigator-linear",infoAnswered:".qti-navigator-answered .qti-navigator-counter",infoViewed:".qti-navigator-viewed .qti-navigator-counter",infoUnanswered:".qti-navigator-unanswered .qti-navigator-counter",infoFlagged:".qti-navigator-flagged .qti-navigator-counter",infoPanel:".qti-navigator-info",infoPanelLabels:".qti-navigator-info > .qti-navigator-label",tabInfoAll:"[data-mode=\"all\"] .qti-navigator-counter",tabInfoUnanswered:"[data-mode=\"unanswered\"] .qti-navigator-counter",tabInfoFlagged:"[data-mode=\"flagged\"] .qti-navigator-counter",parts:".qti-navigator-part",partLabels:".qti-navigator-part > .qti-navigator-label",sections:".qti-navigator-section",sectionLabels:".qti-navigator-section > .qti-navigator-label",items:".qti-navigator-item",itemLabels:".qti-navigator-item > .qti-navigator-label",itemIcons:".qti-navigator-item > .qti-navigator-icon",activeItem:".qti-navigator-item.active",icons:".qti-navigator-icon",linearStart:".qti-navigator-linear-part button",counters:".qti-navigator-counter",actives:".active",collapsible:".collapsible",collapsiblePanels:".collapsible-panel",unseen:".unseen",answered:".answered",flagged:".flagged",notFlagged:":not(.flagged)",notAnswered:":not(.answered)",notInformational:":not(.info)",informational:".info",hidden:".hidden",disabled:".disabled"},_filterMap={all:"",unanswered:[_selectors.answered,_selectors.informational].join(","),flagged:_selectors.notFlagged,answered:_selectors.notAnswered,filtered:_selectors.hidden},navigatorApi={updateStats:function(position,flag){var map=this.map,item;map&&(item=mapHelper.getItemAt(map,position),item&&(item.flagged=flag,mapHelper.updateItemStats(map,position)))},getProgressionTotal:function(progression,target){var total;return total="questions"===target?progression.questions:progression.total,total},setItemFlag:function(position,flag){var $item=position&&position.jquery?position:this.controls.$tree.find("[data-position="+position+"]"),progression=this.progression,icon;this.updateStats(position,flag),$item.toggleClass(_cssCls.flagged,flag),icon=_.find(_iconCls,_.bind($item.hasClass,$item))||_cssCls.unseen,$item.find(_selectors.icons).attr("class",_cssCls.icon+" icon-"+icon),progression.flagged=this.controls.$tree.find(_selectors.flagged).length,this.writeCount(this.controls.$infoFlagged,progression.flagged,this.getProgressionTotal(progression,"questions")),this.filter(this.currentFilter)},filter:function(criteria){var self=this,$items=this.controls.$tree.find(_selectors.items).removeClass(_cssCls.hidden),filterCb=_filterMap[criteria];filterCb&&$items.filter(filterCb).addClass(_cssCls.hidden),this.controls.$tree.find(_selectors.sections).each(function(){var $section=$(this),$itemsFound=$section.find(_selectors.items).not(_selectors.hidden),$filtered=$itemsFound.not(_selectors.disabled);self.writeCount($section.find(_selectors.counters),$filtered.length,$itemsFound.length)}),this.currentFilter=criteria},updateConfig:function(config){var $component=this.getElement(),scopeClass=_cssCls.scope[this.config.scope||_defaults.scope];return config=_.merge(this.config,config||{}),$component.toggleClass(_cssCls.collapsible,config.canCollapse),$component.removeClass(scopeClass),scopeClass=_cssCls.scope[this.config.scope||_defaults.scope],$component.addClass(scopeClass),this},autoScroll:function(){autoscroll(this.controls.$tree.find(_selectors.activeItem),this.controls.$tree)},update:function(map,context){var scopedMap=this.getScopedMap(map,context),progression=scopedMap.stats||{questions:0,answered:0,flagged:0,viewed:0,total:0},totalQuestions=this.getProgressionTotal(progression,"questions"),activeItem,isSkipaheadEnabled;return this.map=map,this.progression=progression,this.writeCount(this.controls.$infoAnswered,progression.answered,totalQuestions),this.writeCount(this.controls.$infoUnanswered,totalQuestions-progression.answered,totalQuestions),this.writeCount(this.controls.$infoViewed,progression.viewed,this.getProgressionTotal(progression,"total")),this.writeCount(this.controls.$infoFlagged,progression.flagged,totalQuestions),this.writeCount(this.controls.$infoAll,totalQuestions,null),context.isLinear?(this.controls.$filterBar.hide(),this.controls.$linearState.show(),this.controls.$tree.empty()):(this.controls.$filterBar.show(),this.controls.$linearState.hide(),this.controls.$tree.html(navigatorTreeTpl(scopedMap)),this.autoScroll(),activeItem=mapHelper.getActiveItem(scopedMap),this.setState("prevents-unseen",this.config.preventsUnseen),isSkipaheadEnabled=activeItem&&activeItem.categories&&0<=_.indexOf(activeItem.categories,"x-tao-option-review-skipahead"),this.setState("skipahead-enabled",isSkipaheadEnabled),this.config.preventsUnseen&&!isSkipaheadEnabled&&this.controls.$tree.find(_selectors.unseen).addClass(_cssCls.disabled)),this.filter(this.controls.$filters.filter(_selectors.actives).data("mode")),this.trigger("update"),this},getScopedMap:function(map,context){var scopedMap=mapHelper.getScopeMapFromContext(map,context,this.config.scope),testPart=mapHelper.getPart(scopedMap,context.testPartId)||{},section=mapHelper.getSection(scopedMap,context.sectionId)||{},item=mapHelper.getItem(scopedMap,context.itemIdentifier)||{};return testPart.active=!0,section.active=!0,item.active=!0,mapHelper.each(scopedMap,function(itm){var cls=[],icon="";itm.active&&cls.push("active"),itm.informational&&(cls.push("info"),icon=icon||"info"),itm.flagged&&(cls.push("flagged"),icon=icon||"flagged"),itm.answered&&(cls.push("answered"),icon=icon||"answered"),itm.viewed?(cls.push("viewed"),icon=icon||"viewed"):(cls.push("unseen"),icon=icon||"unseen"),itm.cls=cls.join(" "),itm.icon=icon})},writeCount:function($place,count,total){var display=0;$place.parent().hasClass("qti-navigator-tab")?display=Math.max(count,0):0<total&&(display=Math.min(count,total)+"/"+total),$place.text(display)},select:function(position,open){var $tree=this.controls.$tree,selected=position&&position.jquery?position:$tree.find("[data-position="+position+"]"),hierarchy=selected.parentsUntil($tree),previousPosition=0,$previous=$tree.find(_selectors.activeItem);return $previous.length&&(previousPosition=$previous.data("position")),open&&this.openOnly(hierarchy),$tree.find(_selectors.actives).removeClass(_cssCls.active),hierarchy.add(selected).addClass(_cssCls.active),position=selected.data("position"),this.trigger("selected",position,previousPosition),selected},openSelected:function(){var $tree=this.controls.$tree,selected=$tree.find(_selectors.items+_selectors.actives),hierarchy=selected.parentsUntil($tree);return this.openOnly(hierarchy),selected},openOnly:function(opened,root){(root||this.controls.$tree).find(_selectors.collapsible).addClass(_cssCls.collapsed),opened.removeClass(_cssCls.collapsed)},togglePanel:function(panel,collapseSelector){var collapsed=panel.hasClass(_cssCls.collapsed);return collapseSelector&&this.controls.$tree.find(collapseSelector).addClass(_cssCls.collapsed),collapsed?panel.removeClass(_cssCls.collapsed):panel.addClass(_cssCls.collapsed),collapsed},toggle:function(show){return"undefined"==typeof show&&(show=this.is("hidden")),show?this.show():this.hide(),this}};return function(config,map,context){function flagItem($item){var position=$item.data("position"),flagged=!$item.hasClass(_cssCls.flagged);navigator.setItemFlag(position,flagged),navigator.trigger("flag",position,flagged)}function jump($item){var position=$item.data("position");navigator.trigger("jump",position)}var navigator;return navigator=component(navigatorApi,_defaults).setTemplate(navigatorTpl).on("destroy",function(){this.controls=null}).on("show",function(){this.autoScroll()}).on("render",function(){var self=this,$component=this.getElement(),$filterBar=$component.find(_selectors.filterBar),$filters=$filterBar.find("li"),$tree=$component.find(_selectors.tree);this.controls={$infoAnswered:$component.find(_selectors.infoAnswered),$infoViewed:$component.find(_selectors.infoViewed),$infoAll:$component.find(_selectors.tabInfoAll),$infoUnanswered:this.config.showLegend?$component.find(_selectors.infoUnanswered):$component.find(_selectors.tabInfoUnanswered),$infoFlagged:this.config.showLegend?$component.find(_selectors.infoFlagged):$component.find(_selectors.tabInfoFlagged),$filterBar:$filterBar,$filters:$filters,$tree:$tree,$linearState:$component.find(_selectors.linearState)},this.updateConfig(),$component.on("click"+_selectors.component,_selectors.collapseHandle,function(){self.is("disabled")||($component.toggleClass(_cssCls.collapsed),$component.hasClass(_cssCls.collapsed)&&self.openSelected())}),$component.on("click"+_selectors.component,_selectors.infoPanelLabels,function(){self.is("disabled")||self.togglePanel($(this).closest(_selectors.infoPanel),_selectors.infoPanel)}),$tree.on("click"+_selectors.component,_selectors.partLabels,function(){var $panel;self.is("disabled")||($panel=$(this).closest(_selectors.parts),self.togglePanel($panel,_selectors.parts)&&($panel.hasClass(_cssCls.active)?self.openSelected():self.openOnly($panel.find(_selectors.sections).first(),$panel)))}),$tree.on("click"+_selectors.component,_selectors.sectionLabels,function(){self.is("disabled")||self.togglePanel($(this).closest(_selectors.sections),_selectors.sections)}),$tree.on("click"+_selectors.component,_selectors.itemLabels,function(event){var $item,$target;self.is("disabled")||($item=$(this).closest(_selectors.items),!$item.hasClass(_cssCls.disabled)&&($target=$(event.target),self.config.canFlag&&$target.is(_selectors.icons)&&!$component.hasClass(_cssCls.collapsed)?!$item.hasClass(_cssCls.unseen)&&!$item.hasClass(_cssCls.info)&&flagItem($item):!$item.hasClass(_cssCls.active)&&(self.select($item),jump($item))))}),$tree.on("click"+_selectors.component,_selectors.linearStart,function(){var $btn;self.is("disabled")||($btn=$(this),!$btn.hasClass(_cssCls.disabled)&&($btn.addClass(_cssCls.disabled),jump($btn)))}),$filterBar.on("click"+_selectors.component,_selectors.filter,function(){var $btn,mode;self.is("disabled")||($btn=$(this),mode=$btn.data("mode"),$filters.removeClass(_cssCls.active),$component.removeClass(_cssCls.collapsed),$btn.addClass(_cssCls.active),self.filter(mode),self.autoScroll())}),this.update(map,context)}),navigator.currentFilter="all",navigator.init(config)}}),define("taoQtiTest/runner/plugins/navigation/review/review",["jquery","lodash","i18n","ui/hider","util/shortcut","util/namespace","taoTests/runner/plugin","taoQtiTest/runner/helpers/map","taoQtiTest/runner/plugins/navigation/review/navigator"],function($,_,__,hider,shortcut,namespaceHelper,pluginFactory,mapHelper,navigatorFactory){'use strict';function getFlagItemButtonData(context){var dataType=context.itemFlagged?"unsetFlag":"setFlag";return buttonData[dataType]}function getToggleButtonData(navigator){var dataType=navigator.is("hidden")?"showReview":"hideReview";return buttonData[dataType]}function updateButton(button,data){var $button=button.getElement();button.is("rendered")&&$button.data("control")!==data.control&&($button.data("control",data.control).attr("title",data.title),$button.find(".icon").attr("class","icon icon-"+data.icon),$button.find(".text").text(data.text),_.contains(data.control,"flag")&&(button.is("active")?button.turnOff():button.turnOn()))}function canFlag(testRunner){var context=testRunner.getTestContext(),map=testRunner.getTestMap(),item=mapHelper.getItemAt(map,context.itemPosition);return!(context.isLinear||!context.options.markReview||item&&item.informational)}var buttonData={setFlag:{control:"set-item-flag",title:__("Flag the current item for later review"),icon:"anchor",text:__("Flag for Review")},unsetFlag:{control:"unset-item-flag",title:__("Do not flag the current item for later review"),icon:"anchor",text:__("Unflag for Review")},showReview:{control:"show-review",title:__("Show the review screen"),icon:"right",text:__("Show Review")},hideReview:{control:"hide-review",title:__("Hide the review screen"),icon:"left",text:__("Hide Review")}};return pluginFactory({name:"review",init:function(){function isPluginAllowed(){var context=testRunner.getTestContext();return navigatorConfig.enabled&&context&&context.options&&context.options.reviewScreen}function flagItem(position,flag){return self.disable(),testRunner.getProxy().callTestAction("flagItem",{position:position,flag:flag}).then(function(){var context=testRunner.getTestContext();context.itemPosition===position&&(context.itemFlagged=flag),updateButton(self.flagItemButton,getFlagItemButtonData(context)),self.navigator.setItemFlag(position,flag),self.enable()}).catch(function(){self.navigator.setItemFlag(position,!flag),self.enable()})}function flagCurrentItem(){var context=testRunner.getTestContext();!1!==self.getState("enabled")&&flagItem(context.itemPosition,!context.itemFlagged)}function togglePanel(forcedState){var isHidden=_.isUndefined(forcedState)?self.navigator.is("hidden"):forcedState;isHidden?(self.explicitlyHidden=!1,self.navigator.show()):(self.explicitlyHidden=!0,self.navigator.hide()),updateButton(self.toggleButton,getToggleButtonData(self.navigator))}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData(),testContext=testRunner.getTestContext(),testMap=testRunner.getTestMap(),testConfig=testData.config||{},pluginShortcuts=(testConfig.shortcuts||{})[this.getName()]||{},navigatorConfig=testConfig.review||{},previousItemPosition;this.navigator=navigatorFactory(navigatorConfig,testMap,testContext).on("selected",function(position,previousPosition){previousItemPosition=previousPosition}).on("jump",function(position){!1!==self.getState("enabled")&&(self.disable(),testRunner.jump(position,"item"))}).on("flag",function(position,flag){!1!==self.getState("enabled")&&flagItem(position,flag)}).render(),testRunner.on("alert.notallowed",function(){self.navigator.select(previousItemPosition)}),this.explicitlyHidden=!1,this.toggleButton=this.getAreaBroker().getToolbox().createEntry(getToggleButtonData(this.navigator)),this.toggleButton.on("click",function(e){e.preventDefault(),testRunner.trigger("tool-reviewpanel")}),this.flagItemButton=this.getAreaBroker().getToolbox().createEntry(getFlagItemButtonData(testContext)),this.flagItemButton.on("click",function(e){e.preventDefault(),testRunner.trigger("tool-flagitem")}),testConfig.allowShortcuts&&(pluginShortcuts.flag&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.flag,this.getName(),!0),function(){testRunner.trigger("tool-flagitem")},{avoidInput:!0}),pluginShortcuts.toggle&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle,this.getName(),!0),function(){testRunner.trigger("tool-reviewpanel")},{avoidInput:!0})),isPluginAllowed()||this.hide(),this.disable(),togglePanel(testConfig.review.defaultOpen),testRunner.on("render",function(){isPluginAllowed()?(self.show(),updateButton(self.toggleButton,getToggleButtonData(self.navigator))):self.hide()}).on("loaditem",function(){var context=testRunner.getTestContext(),map=testRunner.getTestMap();isPluginAllowed()?(updateButton(self.flagItemButton,getFlagItemButtonData(context)),self.navigator.update(map,context).updateConfig({canFlag:!context.isLinear&&context.options.markReview}),self.show(),updateButton(self.toggleButton,getToggleButtonData(self.navigator))):self.hide()}).on("enabletools enablenav",function(){isPluginAllowed()&&self.enable()}).on("disabletools disablenav",function(){isPluginAllowed()&&self.disable()}).on("hidenav",function(){self.hide()}).on("shownav",function(){isPluginAllowed()&&self.show()}).on("tool-flagitem",function(){isPluginAllowed()&&canFlag(testRunner)&&flagCurrentItem()}).on("tool-reviewpanel",function(){isPluginAllowed()&&self.getState("enabled")&&togglePanel()})},render:function(){var areaBroker=this.getAreaBroker(),$panelContainer=areaBroker.getPanelArea();$panelContainer.append(this.navigator.getElement())},destroy:function(){shortcut.remove("."+this.getName()),this.navigator.destroy()},enable:function(){var testRunner=this.getTestRunner(),testContext=testRunner.getTestContext();this.flagItemButton.enable(),this.toggleButton.enable(),this.navigator.enable(),testContext.itemFlagged?this.flagItemButton.turnOn():this.flagItemButton.turnOff()},disable:function(){this.flagItemButton.disable(),this.flagItemButton.turnOff(),this.toggleButton.disable(),this.navigator.disable()},show:function(){var testRunner=this.getTestRunner();canFlag(testRunner)?this.flagItemButton.show():this.flagItemButton.hide(),this.toggleButton.show(),this.explicitlyHidden?this.navigator.hide():this.navigator.show()},hide:function(){this.flagItemButton.hide(),this.toggleButton.hide(),this.navigator.hide()}})}),define("taoQtiTest/runner/plugins/navigation/skip",["jquery","lodash","i18n","ui/hider","taoTests/runner/plugin","taoQtiTest/runner/helpers/messages","tpl!taoQtiTest/runner/plugins/templates/button"],function($,_,__,hider,pluginFactory,messages,buttonTpl){'use strict';var buttonData={skip:{control:"skip",title:__("Skip and go to the next item"),icon:"external",text:__("Skip")},end:{control:"skip-end",title:__("Skip and go to the end of the test"),icon:"external",text:__("Skip and end test")}},createElement=function(context){var dataType=context.isLast?"end":"skip";return $(buttonTpl(buttonData[dataType]))},updateElement=function($element,context){var dataType=context.isLast?"end":"skip";$element.attr("data-control")!==buttonData[dataType].control&&$element.attr("data-control",buttonData[dataType].control).attr("title",buttonData[dataType].title).find(".text").text(buttonData[dataType].text)};return pluginFactory({name:"skip",init:function(){function doSkip(){testRunner.skip()}var self=this,testRunner=this.getTestRunner(),toggle=function(){var context=testRunner.getTestContext();return!0===context.options.allowSkipping?(self.show(),!0):(self.hide(),!1)};this.$element=createElement(testRunner.getTestContext()),this.$element.on("click",function(e){var enable=_.bind(self.enable,self),context=testRunner.getTestContext();e.preventDefault(),!1!==self.getState("enabled")&&(self.disable(),context.options.endTestWarning&&context.isLast?testRunner.trigger("confirm.endTest",messages.getExitMessage(__("You are about to submit the test. You will not be able to access this test once submitted. Click OK to continue and submit the test."),"test",testRunner),doSkip,enable):doSkip())}),toggle(),self.disable(),testRunner.on("loaditem",function(){toggle()&&updateElement(self.$element,testRunner.getTestContext())}).on("enablenav",function(){self.enable()}).on("disablenav",function(){self.disable()}).on("hidenav",function(){self.hide()}).on("shownav",function(){self.show()})},render:function(){var $container=this.getAreaBroker().getNavigationArea();$container.append(this.$element)},destroy:function(){this.$element.remove()},enable:function(){this.$element.removeProp("disabled").removeClass("disabled")},disable:function(){this.$element.prop("disabled",!0).addClass("disabled")},show:function(){hider.show(this.$element)},hide:function(){hider.hide(this.$element)}})}),define("taoQtiTest/runner/plugins/navigation/validateResponses",["lodash","i18n","taoTests/runner/plugin","taoQtiTest/runner/helpers/currentItem"],function(_,__,pluginFactory,currentItemHelper){'use strict';return pluginFactory({name:"validateResponses",init:function(){return this.getTestRunner().before("move",function(e,direction){var self=this,testContext=this.getTestContext(),isInteracting=!this.getItemState(testContext.itemIdentifier,"disabled"),testData=this.getTestData()||{},testConfig=testData.config||{},pluginConfig=_.defaults((testConfig.plugins||{}).validateResponses||{});return pluginConfig.validateOnPreviousMove||"previous"!==direction?isInteracting&&testContext.enableValidateResponses&&testContext.validateResponses?new Promise(function(resolve,reject){return 0===_.size(currentItemHelper.getDeclarations(self))?resolve():currentItemHelper.isAnswered(self,!1)?resolve():void(!self.getState("alerted.notallowed")&&(self.setState("alerted.notallowed",!0),self.trigger("alert.notallowed",__("A valid response to this item is required."),function(){self.trigger("resumeitem"),reject(),self.setState("alerted.notallowed",!1)})))}):void 0:Promise.resolve()}),this}})}),define("taoQtiTest/runner/plugins/navigation/warnBeforeLeaving",["i18n","taoTests/runner/plugin"],function(__,pluginFactory){'use strict';var warnMessage=__("Please confirm you want to leave the test."),warnListener=function(e){return e.returnValue=warnMessage,warnMessage};return pluginFactory({name:"warnBeforeLeaving",init:function(){this.enable()},destroy:function(){this.disable()},enable:function(){window.addEventListener("beforeunload",warnListener)},disable:function(){window.removeEventListener("beforeunload",warnListener)}})}),define("taoQtiTest/runner/plugins/security/disableRightClick",["taoTests/runner/plugin"],function(pluginFactory){'use strict';return pluginFactory({name:"disableRightClick",init:function(){["contextmenu","mousedown","mouseup"].forEach(function(eventName){window.document.addEventListener(eventName,function(event){2===event.button&&event.preventDefault()})})}})}),define("taoQtiTest/runner/plugins/tools/answerElimination/eliminator",["jquery","lodash","i18n","ui/hider","util/shortcut","util/namespace","taoTests/runner/plugin"],function($,_,__,hider,shortcut,namespaceHelper,pluginFactory){'use strict';var actionPrefix="tool-eliminator-",defaultConfig={removeEliminationsOnClose:!1,restoreEliminationsOnOpen:!1};return pluginFactory({name:"eliminator",init:function(){function isPluginEnabled(){var context=testRunner.getTestContext()||{},options=context.options||{};return!!options.eliminator}function togglePlugin(){self.$choiceInteractions&&(self.$choiceInteractions.toggleClass("eliminable"),isEliminable()?enableEliminator():disableEliminator())}function isEliminable(){return self.$choiceInteractions?self.$choiceInteractions.hasClass("eliminable"):void 0}function enableEliminator(){var $choices;self.$choiceInteractions&&($choices=self.$choiceInteractions.find(".qti-choice"),self.button.turnOn(),self.trigger("start"),config.restoreEliminationsOnOpen&&$choices.each(function(){var input=this.querySelector(".real-label input");this.dataset.wasEliminated&&(this.dataset.wasEliminated=null,this.classList.add("eliminated"),input.setAttribute("disabled","disabled"),input.checked=!1)}))}function disableEliminator(){var $choices;self.$choiceInteractions&&($choices=self.$choiceInteractions.find(".qti-choice"),self.$choiceInteractions.removeClass("eliminable"),self.button.turnOff(),self.trigger("end"),$choices.each(function(){this.classList.contains("eliminated")&&(this.dataset.wasEliminated=!0,this.classList.remove("eliminated"),this.querySelector(".real-label input").removeAttribute("disabled"))}))}var self=this,testRunner=this.getTestRunner(),$container=testRunner.getAreaBroker().getContentArea().parent(),testConfig=testRunner.getTestData().config||{},pluginShortcuts=(testConfig.shortcuts||{}).eliminator||{},config=_.defaults(_.clone((testConfig.plugins||{}).eliminator)||{},defaultConfig);this.button=this.getAreaBroker().getToolbox().createEntry({control:"eliminator",title:__("Eliminate choices"),icon:"eliminate",text:__("Answer Eliminator")}),this.button.on("click",function(e){e.preventDefault(),testRunner.trigger(actionPrefix+"toggle")}),testConfig.allowShortcuts&&_.forEach(pluginShortcuts,function(command,key){shortcut.add(namespaceHelper.namespaceAll(command,"eliminator",!0),function(){testRunner.trigger(actionPrefix+key)},{avoidInput:!0})}),this.disable(),testRunner.on("loaditem",function(){isPluginEnabled()?self.show():self.hide()}).on("renderitem",function(){return self.$choiceInteractions=$container.find(".qti-choiceInteraction"),self.$choiceInteractions.length?void(isPluginEnabled()&&self.show()):void self.hide()}).on("enabletools renderitem",function(){self.enable()}).on("disabletools unloaditem",function(){self.disable(),disableEliminator()}).on(actionPrefix+"toggle",function(){isPluginEnabled()&&togglePlugin()}).on("tool-answer-masking-toggle",function(){isEliminable()&&disableEliminator()})},destroy:function(){shortcut.remove(".eliminator")},enable:function(){this.button.enable()},disable:function(){this.button.disable()},show:function(){this.button.show()},hide:function(){this.button.hide()}})}),define("core/statifier",["lodash"],function(_){'use strict';function statifierFactory(target){var states={},statesApi={getState:function(name){return!!states[name]},setState:function(name,value){return"undefined"==typeof value&&(value=!0),states[name]=!!value,this},clearStates:function(){return states={},this},getStates:function(){return _.reduce(states,function(result,state,key){return state&&result.push(key),result},[])}};return target=target||{},_(statesApi).functions().forEach(function(method){target[method]=function(){var args=[].slice.call(arguments);return statesApi[method].apply(target,args)}}),target}return _=_&&_.hasOwnProperty("default")?_["default"]:_,statifierFactory}),define("tpl!taoQtiTest/runner/plugins/tools/answerMasking/tpl/mask",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{},"<div class=\"answer-mask\">\n    <span class=\"answer-mask-toggle\"></span>\n</div>"})}),define("taoQtiTest/runner/plugins/tools/answerMasking/answerMasking",["lodash","jquery","core/statifier","ui/component","tpl!taoQtiTest/runner/plugins/tools/answerMasking/tpl/mask"],function(_,$,statifier,componentFactory,maskTpl){'use strict';return function($contentArea){function createMask($container){return componentFactory(maskApi).setTemplate(maskTpl).on("render",function(){var self=this,$component=this.getElement();$component.on("click.answerMasking",function(e){e.stopPropagation(),e.preventDefault(),self.toggle()})}).on("destroy",function(){var $component=this.getElement();$component.off(".answerMasking")}).init().render($container).mask()}var allMasks=[],maskApi={toggle:function(){return this.is("masked")?this.reveal():this.mask()},reveal:function(){var $container=this.getContainer();return $container.removeClass("masked"),$container.find("input").removeAttr("disabled"),this.setState("masked",!1),this},mask:function(){var $container=this.getContainer();return $container.addClass("masked"),$container.find("input").attr("disabled","disabled"),this.setState("masked",!0),this}},answerMasking;return answerMasking={enable:function(){var $choiceInteractions=$contentArea.find(".qti-choiceInteraction"),$qtiChoices=$contentArea.find(".qti-choice");allMasks=[],$choiceInteractions.addClass("maskable"),$qtiChoices.each(function(){var $choice=$(this);allMasks.push(createMask($choice))}),this.setState("enabled",!0)},disable:function(){var $choiceInteractions=$contentArea.find(".qti-choiceInteraction");$choiceInteractions.removeClass("maskable"),allMasks.forEach(function(mask){mask.reveal(),mask.destroy()}),allMasks=[],this.setState("enabled",!1)},getMasksState:function(){var state=allMasks.map(function(mask){return mask.is("masked")});return state},setMasksState:function(state){state=state||[],state.forEach(function(masked,index){var mask=allMasks[index];_.isObject(mask)&&_.isFunction(mask.reveal)&&!masked&&mask.reveal()})}},statifier(answerMasking),answerMasking}}),define("taoQtiTest/runner/plugins/tools/answerMasking/plugin",["jquery","lodash","i18n","taoTests/runner/plugin","ui/hider","util/shortcut","util/namespace","taoQtiTest/runner/plugins/tools/answerMasking/answerMasking"],function($,_,__,pluginFactory,hider,shortcut,namespaceHelper,answerMaskingFactory){'use strict';var actionPrefix="tool-answer-masking-",itemStates={},defaultConfig={restoreStateOnToggle:!0,restoreStateOnMove:!0};return pluginFactory({name:"answer-masking",init:function(){function isPluginEnabled(){var context=testRunner.getTestContext()||{},options=context.options||{};return options.answerMasking&&itemContainsChoiceInteraction()}function itemContainsChoiceInteraction(){var $container=self.getAreaBroker().getContentArea().parent();return $container.find(".qti-choiceInteraction").length}function togglePluginButton(){isPluginEnabled()?self.show():self.hide()}function togglePlugin(){answerMasking.getState("enabled")?disableMasking():enableMasking()}function enableMasking(){var testContext=testRunner.getTestContext(),itemId=testContext.itemIdentifier;answerMasking.enable(),pluginConfig.restoreStateOnToggle&&answerMasking.setMasksState(itemStates[itemId]),self.button.turnOn(),self.trigger("start")}function disableMasking(){var testContext=testRunner.getTestContext(),itemId=testContext.itemIdentifier;answerMasking.getState("enabled")&&(itemStates[itemId]=answerMasking.getMasksState()),answerMasking.disable(),self.button.turnOff(),self.trigger("end")}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginConfig=_.defaults((testConfig.plugins||{})["answer-masking"]||{},defaultConfig),pluginShortcuts=(testConfig.shortcuts||{})["answer-masking"]||{},$contentArea=this.getAreaBroker().getContentArea(),answerMasking=answerMaskingFactory($contentArea);this.button=this.getAreaBroker().getToolbox().createEntry({title:__("Answer Masking"),icon:"result-nok",control:"answer-masking",text:__("Answer Masking")}),this.button.on("click",function(e){e.preventDefault(),testRunner.trigger(actionPrefix+"toggle")}),testConfig.allowShortcuts&&pluginShortcuts.toggle&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle,this.getName(),!0),function(){testRunner.trigger(actionPrefix+"toggle")},{avoidInput:!0,prevent:!0}),this.disable(),testRunner.on("loaditem",function(){var testContext=testRunner.getTestContext(),itemId=testContext.itemIdentifier;pluginConfig.restoreStateOnMove||(itemStates[itemId]=[]),togglePluginButton()}).on("enabletools renderitem",function(){togglePluginButton(),self.enable()}).on("beforeunloaditem",function(){disableMasking()}).on("disabletools unloaditem",function(){self.disable(),disableMasking()}).on(actionPrefix+"toggle",function(){isPluginEnabled()&&togglePlugin()}).on("tool-eliminator-toggle",function(){disableMasking()})},destroy:function(){shortcut.remove("."+this.getName())},enable:function(){this.button.enable()},disable:function(){this.button.disable()},show:function(){this.button.show()},hide:function(){this.button.hide()}})}),define("tpl!taoQtiTest/runner/plugins/tools/areaMasking/mask",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,helper,options;return buffer+="<div class=\"mask\">\n   <div class=\"inner\"></div>\n   <div class=\"controls\">\n        <a href=\"#\" class=\"view\"  title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Preview the covered area",options):helperMissing.call(depth0,"__","Preview the covered area",options)))+"\"><span class=\"icon-preview\"></span></a>\n        <a href=\"#\" class=\"close\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Close the mask",options):helperMissing.call(depth0,"__","Close the mask",options)))+"\"><span class=\"icon-result-nok\"></span></a>\n   </div>\n</div>",buffer})}),define("ui/stacker",["jquery"],function($){'use strict';function isElementValid($element){return $element instanceof $&&$element.length}function initScope(scope){indexes[scope]||(indexes[scope]=1000)}function isHighest($element,scope){var elementIndex=parseInt($element.css("z-index"),10);return elementIndex>=indexes[scope]}function getNext(scope){return indexes[scope]+=10,indexes[scope]}$=$&&$.hasOwnProperty("default")?$["default"]:$;var indexes={};return function(scope){return scope=scope||"global",initScope(scope),{bringToFront:function($element){isElementValid($element)&&!isHighest($element,scope)&&($element.get(0).style.zIndex=getNext(scope))},autoBringToFront:function($element){var self=this;isElementValid($element)&&($element.off("mousedown.stacker"),$element.on("mousedown.stacker",function(){self.bringToFront($element)}))},reset:function($element){isElementValid($element)&&($element.get(0).style.zIndex="auto")},getCurrent:function(){return indexes[scope]}}}}),define("ui/component/stackable",["lodash","ui/stacker"],function(_,stackerFactory){'use strict';function makeStackable(component,config){return _.assign(component,stackableComponent),component.off(".makeStackable").on("init.makeStackable",function(){_.defaults(this.config,config||{},defaultConfig),this._stacker=stackerFactory(this.config.stackingScope)}).on("show.makeStackable",function(){this.bringToFront()}).on("render.makeStackable",function(){var $element=this.getElement();this._stacker.reset($element),this._stacker.autoBringToFront($element),this.bringToFront()})}_=_&&_.hasOwnProperty("default")?_["default"]:_,stackerFactory=stackerFactory&&stackerFactory.hasOwnProperty("default")?stackerFactory["default"]:stackerFactory;var defaultConfig={stackingScope:""},stackableComponent={bringToFront:function(){var $element=this.getElement();this._stacker.bringToFront($element)}};return makeStackable}),define("ui/transformer",["jquery","lodash","lib/unmatrix/unmatrix"],function($,_,_unmatrix){'use strict';function _normalizeTransforms(transforms){for(var xy=["translate","scale"],i=xy.length;i--;)transforms[xy[i]]&&(_.isArray(transforms[xy[i]])&&2===transforms[xy[i]].length?(transforms[xy[i]+"X"]=transforms[xy[i]][0],transforms[xy[i]+"Y"]=transforms[xy[i]][1]):(transforms[xy[i]+"X"]=transforms[xy[i]],transforms[xy[i]+"Y"]=transforms[xy[i]]),delete transforms[xy[i]]);return transforms}function _transform($elem,transforms){var cssObj={},defaults=_unmatrix("none"),classNames=[],oriTrans;transforms=_normalizeTransforms(transforms),$elem.data("oriTrans")||(oriTrans=_getTransformation($elem[0]),oriTrans.origin=_getTransformOrigin($elem[0]),$elem.data("oriTrans",oriTrans)),cssObj[prefix+"transform"]="",_.forIn(transforms,function(value,key){return!!_.isNaN(value)||void(value=parseFloat(value),$elem.data("oriTrans").obj[key]!==defaults[key]&&(-1<key.indexOf("scale")?value*=$elem.data("oriTrans").obj[key]:value+=$elem.data("oriTrans").obj[key]),void 0!==defaults[key]&&value!==defaults[key]&&(-1<key.indexOf("translate")?value+="px":("rotate"===key||-1<key.indexOf("skew"))&&(value+="deg"),cssObj[prefix+"transform"]+=key+"("+value+") ",classNames.push("transform-"+key.replace(/(X|Y)$/i,""))))}),cssObj[prefix+"transform"]=$.trim(cssObj[prefix+"transform"]),$elem.css(cssObj),$elem.removeClass("transform-translate transform-rotate transform-skew transform-scale"),$elem.addClass(_.unique(classNames).join(" ")),$elem.trigger("transform.transformer",transforms)}$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,_unmatrix=_unmatrix&&_unmatrix.hasOwnProperty("default")?_unmatrix["default"]:_unmatrix;var vendorPrefixes=["webkit","ms"],prefix=function(){var i=vendorPrefixes.length,style=window.getComputedStyle(document.body,null);if(style.getPropertyValue("transform"))return"";for(;i--;)if(style[vendorPrefixes[i]+"Transform"]!==void 0)return"-"+vendorPrefixes[i]+"-"}(),_getTransformation=function(elem){var _style=window.getComputedStyle(elem,null),matrix=_style.getPropertyValue("transform")||_style.getPropertyValue("-webkit-transform")||_style.getPropertyValue("-ms-transform")||"none",obj=_unmatrix(matrix);return{matrix:matrix,obj:obj}},_getTransformOrigin=function(elem){var _style=window.getComputedStyle(elem,null);return _style.getPropertyValue("transform-origin")||_style.getPropertyValue("-webkit-transform-origin")||_style.getPropertyValue("-ms-transform-origin")||"50% 50% 0"};return{translate:function($elem,valueX,valueY){valueY=valueY||valueX,_transform($elem,{translateX:valueX,translateY:valueY})},translateXY:function($elem,valueX,valueY){_transform($elem,{translateX:valueX,translateY:valueY})},translateX:function($elem,value){_transform($elem,{translateX:value})},translateY:function($elem,value){_transform($elem,{translateY:value})},rotate:function($elem,value){_transform($elem,{rotate:value})},skew:function($elem,value){_transform($elem,{skew:value})},scale:function($elem,valueX,valueY){valueY=valueY||valueX,_transform($elem,{scaleX:valueX,scaleY:valueY})},scaleX:function($elem,value){_transform($elem,{scaleX:value})},scaleY:function($elem,value){_transform($elem,{scaleY:value})},reset:function($elem){var cssObj={};$elem.data("oriTrans")&&(cssObj[prefix+"transform"]=$elem.data("oriTrans").matrix,cssObj[prefix+"transform-origin"]=$elem.data("oriTrans").origin,$elem.css(cssObj),$elem.removeClass("transform-translate transform-rotate transform-skew transform-scale"),$elem.trigger("reset.transformer",$elem.data("oriTrans")))},getTransformation:function(elem){return elem instanceof $&&(elem=elem[0]),_getTransformation(elem)},setTransformOrigin:function($elem,valueX,valueY){var cssObj={};cssObj[prefix+"transform-origin"]=valueY||0===valueY?valueX+" "+valueY:valueX,$elem.css(cssObj)}}}),define("core/mouseEvent",[],function(){'use strict';function triggerMouseEvent(element,eventName,eventOptions){var event;return-1!==allowedEvents.indexOf(eventName)&&(event=createEvent(eventName,eventOptions),dispatchEvent(element,eventName,event))}var allowedEvents=["click","contextmenu","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","show"],createEvent=function(eventName,eventOptions){var event;try{event=new MouseEvent(eventName,eventOptions)}catch(e){event=document.createEvent("MouseEvents"),event.initMouseEvent(eventName,eventOptions.bubbles||!1,eventOptions.cancelable||!1,eventOptions.view||null,eventOptions.detail||0,eventOptions.screenX||0,eventOptions.screenY||0,eventOptions.clientX||0,eventOptions.clientY||0,eventOptions.ctrlKey||!1,eventOptions.altKey||!1,eventOptions.shiftKey||!1,eventOptions.metaKey||!1,eventOptions.button||0,eventOptions.relatedTarget||null)}return event},dispatchEvent;return dispatchEvent=document.dispatchEvent?function(element,eventName,event){return!!element&&(element.dispatchEvent(event),!0)}:document.fireEvent?function(element,eventName,event){return!!element&&(element.fireEvent("on"+eventName,event),!0)}:function(){return!1},triggerMouseEvent}),define("ui/interactUtils",["jquery","lodash","interact","core/mouseEvent"],function($,_,interact,triggerMouseEvent){'use strict';function iFrameDragFixCb(){_.isFunction(simulateDrop)&&simulateDrop(),interact.stop()}$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,interact=interact&&interact.hasOwnProperty("default")?interact["default"]:interact,triggerMouseEvent=triggerMouseEvent&&triggerMouseEvent.hasOwnProperty("default")?triggerMouseEvent["default"]:triggerMouseEvent;var interactHelper,simulateDrop;interactHelper={iFrameDragFixOn:function(simulateDropCb){simulateDrop=simulateDropCb,document.body.addEventListener("mouseleave",iFrameDragFixCb)},iFrameDragFixOff:function(){document.body.removeEventListener("mouseleave",iFrameDragFixCb)},calculateScale:function(e){var scaleX=e.getBoundingClientRect().width/e.offsetWidth,scaleY=e.getBoundingClientRect().height/e.offsetHeight;return[scaleX,scaleY]},tapOn:function(element,cb,delay){var eventOptions={bubbles:!0},domElement;element&&(domElement=element instanceof $?element.get(0):element,triggerMouseEvent(domElement,"mousedown",eventOptions),triggerMouseEvent(domElement,"mouseup",eventOptions),cb&&_.delay(cb,delay||0))},moveElement:function(element,dx,dy){var domElement=element instanceof $?element.get(0):element,x=(parseFloat(domElement.getAttribute("data-x"))||0)+dx,y=(parseFloat(domElement.getAttribute("data-y"))||0)+dy,transform="translate("+x+"px, "+y+"px) translateZ(0px)";domElement.style.webkitTransform=transform,domElement.style.transform=transform,domElement.setAttribute("data-x",x),domElement.setAttribute("data-y",y)},restoreOriginalPosition:function(element){var domElement=element instanceof $?element.get(0):element;domElement.style.webkitTransform="translate(0px, 0px) translateZ(0px)",domElement.style.transform="translate(0px, 0px) translateZ(0px)",domElement.setAttribute("data-x",0),domElement.setAttribute("data-y",0)}};var interactHelper$1=interactHelper;return interactHelper$1}),define("util/position",[],function(){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}return{isInside:function(container,element){var containerCoords,elementCoords;if(container instanceof HTMLElement&&element instanceof HTMLElement&&(containerCoords=container.getBoundingClientRect(),elementCoords=element.getBoundingClientRect(),"object"===_typeof(containerCoords)&&"object"===_typeof(elementCoords)))return elementCoords.top>=containerCoords.top&&elementCoords.top<=containerCoords.bottom&&elementCoords.left>=containerCoords.left&&elementCoords.left<=containerCoords.right&&elementCoords.bottom<=containerCoords.bottom&&elementCoords.bottom>=containerCoords.top&&elementCoords.right<=containerCoords.right&&elementCoords.right>=containerCoords.left},isOver:function(container,element){var containerCoords,elementCoords;if(container instanceof HTMLElement&&element instanceof HTMLElement&&(containerCoords=container.getBoundingClientRect(),elementCoords=element.getBoundingClientRect(),"object"===_typeof(containerCoords)&&"object"===_typeof(elementCoords)))return elementCoords.top>=containerCoords.top&&elementCoords.top<=containerCoords.bottom&&elementCoords.left>=containerCoords.left&&elementCoords.left<=containerCoords.right}}}),define("css!ui/dynamicComponent/css/dynamicComponent",[],function(){}),define("ui/dynamicComponent",["jquery","lodash","interact","ui/component","ui/component/stackable","ui/transformer","ui/interactUtils","util/position","lib/uuid","handlebars","i18n","lib/dompurify/purify","css!ui/dynamicComponent/css/dynamicComponent.css"],function($$1,_,interact,componentFactory,makeStackable,transformer,interactUtils,position,uuid,Handlebars,__,DOMPurify){'use strict';var _Mathmax4=Math.max;function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function layoutTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,interact=interact&&interact.hasOwnProperty("default")?interact["default"]:interact,componentFactory=componentFactory&&componentFactory.hasOwnProperty("default")?componentFactory["default"]:componentFactory,makeStackable=makeStackable&&makeStackable.hasOwnProperty("default")?makeStackable["default"]:makeStackable,interactUtils=interactUtils&&interactUtils.hasOwnProperty("default")?interactUtils["default"]:interactUtils,position=position&&position.hasOwnProperty("default")?position["default"]:position,uuid=uuid&&uuid.hasOwnProperty("default")?uuid["default"]:uuid,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1,helper,options;return buffer+="<div class=\"dynamic-component-container\">\n    <div class=\"dynamic-component-title-bar\">\n        <i class=\"title-bar-icon\"></i>\n        <a title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Close",options):helperMissing.call(depth0,"__","Close",options)))+"\" class=\"closer\" href=\"#\"></a>\n    </div>\n    <div class=\"dynamic-component-content\">\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.draggableContainer,{hash:{},inverse:self.noop,fn:self.program(1,function(){return"\n        <div class=\"dynamic-component-layer\"></div>\n        "},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </div>\n    ",stack1=helpers["if"].call(depth0,depth0&&depth0.resizable,{hash:{},inverse:self.noop,fn:self.program(3,function(){return"\n    <div class=\"dynamic-component-resize-container\">\n        <div class=\"dynamic-component-resize-wrapper\">\n            <div class=\"dynamic-component-resize\"></div>\n        </div>\n    </div>\n    "},data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n</div>",buffer}),_defaults={resizable:!0,draggable:!0,width:240,height:360,minWidth:150,maxWidth:600,minHeight:100,maxHeight:900,largeWidthThreshold:380,smallWidthThreshold:200,draggableContainer:"parent",preserveAspectRatio:!0,top:0,left:0,proportionalResize:!1},dynamicComponent={reset:function(){return this.is("rendered")&&!this.is("disabled")&&(this.resetPosition(),this.resetSize(),this.trigger("reset")),this},resetPosition:function(){var $element=this.getElement();return this.is("rendered")&&!this.is("disabled")&&(interactUtils.restoreOriginalPosition($element),this.setCoords(),$element.css({left:this.config.left,top:this.config.top}),this.trigger("move",this.position)),this},setCoords:function(){var $element=this.getElement();this.position.x=parseFloat($element.attr("data-x"))+this.config.left,this.position.y=parseFloat($element.attr("data-y"))+this.config.top},setContentSize:function(width,height){var $element,$titleBar;return this.is("rendered")&&!this.is("disabled")&&($element=this.getElement(),$titleBar=$$1(".dynamic-component-title-bar",$element),this.config.width=width+$element.outerWidth()-$element.width(),this.config.height=height+$element.outerHeight()-$element.height()+$titleBar.outerHeight(),this.resetSize()),this},resetSize:function(){var self=this,$element,$content,$titleBar;return this.is("rendered")&&!this.is("disabled")&&($element=this.getElement(),$content=$$1(".dynamic-component-content",$element),$titleBar=$$1(".dynamic-component-title-bar",$element),$element.css({width:this.config.width+"px",height:this.config.height+"px"}),_.defer(function(){self.position.width=self.config.width,self.position.height=self.config.height,self.position.contentWidth=$titleBar.width(),self.position.contentHeight=$element.height()-$titleBar.outerHeight(),$content.css({width:self.position.contentWidth+"px",height:self.position.contentHeight+"px"}),self.trigger("resize",self.position)})),this}},dynComponentFactory=function(specs,defaults){var component;return defaults=_.defaults(defaults||{},_defaults),specs=_.defaults(specs||{},dynamicComponent),component=componentFactory(specs,defaults).setTemplate(layoutTpl).on("init",function(){this.id=uuid()}).on("render",function(){function getRestriction(){var draggableContainer=getDraggableContainer();return draggableContainer?{restriction:draggableContainer,endOnly:!1}:{restriction:"parent",endOnly:!1}}function getDraggableContainer(){var draggableContainer=config.draggableContainer;return draggableContainer instanceof $$1&&draggableContainer.length&&(draggableContainer=draggableContainer[0]),draggableContainer}function _resizeItem(e){var width=e.rect.width,height=e.rect.height,$parent=config.draggableContainer||$element.parent(),elementOffset=$element.offset(),parentOffset=$parent.offset(),dimensions=calculateSize(width,height);width=calculateOverlap(dimensions.width,elementOffset.left,parentOffset.left,$parent.width()),height=calculateOverlap(dimensions.height,elementOffset.top,parentOffset.top,$parent.height()),null!==height&&null!==width&&(width<=config.smallWidthThreshold?$element.addClass("small").removeClass("large"):width>=config.largeWidthThreshold?$element.addClass("large").removeClass("small"):$element.removeClass("small").removeClass("large"),interactUtils.moveElement($element,width>config.minWidth&&width<config.maxWidth?e.deltaRect.left:0,height>config.minHeight&&height<config.maxHeight?e.deltaRect.top:0),self.position.width=width,self.position.height=height,self.setCoords(),$element.css({width:width+"px",height:height+"px"}),_.defer(function(){self.position.contentWidth=$titleBar.width(),self.position.contentHeight=$element.height()-$titleBar.outerHeight(),$content.css({width:self.position.contentWidth+"px",height:self.position.contentHeight+"px"}),self.trigger("resize",self.position)}))}function calculateOverlap(side,elOffset,parentOffset,parentValue){var result=side,fullSizeSide=elOffset+side,fullSizeParent=parentOffset+parentValue;return fullSizeSide>fullSizeParent&&(config.proportionalResize?result=null:result-=fullSizeSide-fullSizeParent),result}function calculateSize(width,height){var scaleRate;return config.proportionalResize&&(scaleRate=_Mathmax4(width/config.minWidth,height/config.minHeight),width=config.minWidth*scaleRate,height=config.minHeight*scaleRate),width<config.minWidth?width=config.minWidth:width>config.maxWidth&&(width=config.maxWidth),height<config.minHeight?height=config.minHeight:height>config.maxHeight&&(height=config.maxHeight),{width:width,height:height}}var self=this,$element=this.getElement(),config=this.config,$content=$$1(".dynamic-component-content",$element),$titleBar=$$1(".dynamic-component-title-bar",$element),$contentOverlay=$$1(".dynamic-component-layer",$element),$resizeControll=$$1(".dynamic-component-resize-wrapper",$element),pixelRatio=window.devicePixelRatio,interactElement;self.position={x:this.config.left,y:this.config.top,width:this.config.width,height:this.config.height},this.resetPosition(),this.resetSize(),$titleBar.on("click touchstart",".closer",function(e){e.preventDefault(),self.hide()}).on("click touchstart",".reset",function(e){e.preventDefault(),self.resetSize()}),this.trigger("rendercontent",$content),interactElement=interact($element[0]),config.draggable&&(interactElement.draggable({inertia:!1,autoScroll:!0,manualStart:!0,restrict:_.merge(getRestriction(),{elementRect:{left:0,right:1,top:0,bottom:1}}),onmove:function(event){interactUtils.moveElement($element,event.dx,event.dy),self.setCoords(),self.trigger("move",self.position)},onend:function(){self.setCoords()}}),interact($titleBar[0]).on("down",function(event){var interaction=event.interaction,handle=event.currentTarget;interaction.start({name:"drag",edges:{top:handle.dataset.top,left:handle.dataset.left,bottom:handle.dataset.bottom,right:handle.dataset.right}},interactElement,$element[0])}),$$1(window).on("resize.dynamic-component-"+self.id,function(){var container;window.devicePixelRatio!==pixelRatio&&(pixelRatio=window.devicePixelRatio,container=getDraggableContainer(),!1===position.isInside(container,$element[0])&&self.resetPosition())})),config.resizable&&interactElement.resizable({preserveAspectRatio:config.preserveAspectRatio,autoScroll:!0,restrict:getRestriction(),edges:{left:!1,right:".dynamic-component-resize-wrapper",bottom:".dynamic-component-resize-wrapper",top:!1},onmove:_resizeItem}),interactElement.on("dragstart resizeinertiastart",function(){$contentOverlay.addClass("dragging-active"),$content.addClass("moving"),$titleBar.addClass("moving")}).on("dragend",function(){$contentOverlay.removeClass("dragging-active"),$content.removeClass("moving"),$titleBar.removeClass("moving")}).on("resizestart",function(){$contentOverlay.addClass("dragging-active"),$resizeControll.addClass("resizing"),$content.addClass("sizing")}).on("resizeend",function(){$contentOverlay.removeClass("dragging-active"),$resizeControll.removeClass("resizing"),$content.removeClass("sizing")}),$element.on("mousedown",function(){/\-resize/.test($$1("html").css("cursor"))&&!$contentOverlay.hasClass("dragging-active")&&$contentOverlay.addClass("dragging-active")})}).on("destroy",function(){$$1(window).off("resize.dynamic-component-"+this.id)}),makeStackable(component,{stackingScope:defaults.stackingScope})};return dynComponentFactory}),define("taoQtiTest/runner/plugins/tools/areaMasking/mask",["lodash","ui/component","tpl!taoQtiTest/runner/plugins/tools/areaMasking/mask","ui/dynamicComponent"],function(_,component,areaMaskingTpl,dynamicComponent){'use strict';var defaultConfig={draggable:!0,resizable:!0,preserveAspectRatio:!1,width:250,minWidth:160,maxWidth:1e3,minHeight:60,height:100,stackingScope:"test-runner",top:50,left:10,previewDelay:3e3};return function(){var dynamicComponentInstance;return dynamicComponentInstance=dynamicComponent({preview:function(){var self=this,delay=this.config.previewDelay||1e3;return!this.is("rendered")||this.is("disabled")||this.is("previewing")||(this.setState("previewing",!0),this.trigger("preview"),_.delay(function(){self.setState("previewing",!1)},delay)),this}},defaultConfig).on("rendercontent",function($content){var self=this,$element=this.getElement();$content.append(areaMaskingTpl({})),$element.addClass("mask-container"),$element.on("click touchstart",".view",function(e){e.preventDefault(),self.preview()}).on("click touchend",".close",function(e){e.preventDefault(),self.destroy()})}).init(),dynamicComponentInstance}}),define("taoQtiTest/runner/plugins/tools/areaMasking/areaMasking",["jquery","lodash","i18n","ui/hider","util/shortcut","util/namespace","taoTests/runner/plugin","taoQtiTest/runner/plugins/tools/areaMasking/mask"],function($,_,__,hider,shortcut,namespaceHelper,pluginFactory,maskComponent){'use strict';var actionPrefix="tool-area-masking-",defaultConfig={max:5,foo:!0};return pluginFactory({name:"area-masking",init:function(){function addMask(){maskComponent().on("render",function(){self.masks.push(this),self.button.turnOn(),self.trigger("maskadd")}).on("destroy",function(){self.masks=_.without(self.masks,this),self.masks.length<config.max&&self.enable(),0===self.masks.length&&(self.button.turnOff(),self.trigger("close")),self.trigger("maskclose")}).init({renderTo:$container,draggableContainer:$container})}function isEnabled(){var context=testRunner.getTestContext(),options=context.options||{};return!!options.areaMasking}var self=this,testRunner=this.getTestRunner(),$container=testRunner.getAreaBroker().getContentArea().parent(),testConfig=testRunner.getTestData().config||{},config=_.defaults(_.clone((testConfig.plugins||{})["area-masking"])||{},defaultConfig),pluginShortcuts=(testConfig.shortcuts||{})["area-masking"]||{};this.masks=[],this.button=this.getAreaBroker().getToolbox().createEntry({control:"area-masking",text:__("Masking"),title:__("Covers parts of the item"),icon:"eye-slash"}),this.button.on("click",function(e){e.preventDefault(),testRunner.trigger(actionPrefix+"toggle")}),testConfig.allowShortcuts&&_.forEach(pluginShortcuts,function(command,key){shortcut.add(namespaceHelper.namespaceAll(command,"area-masking",!0),function(){testRunner.trigger(actionPrefix+key)},{avoidInput:!0})}),this.disable(),testRunner.on("loaditem",function(){isEnabled()?self.show():self.hide()}).on("enabletools renderitem",function(){self.enable()}).on("disabletools unloaditem",function(){self.disable(),_.invoke(self.masks,"destroy")}).on(actionPrefix+"toggle",function(){isEnabled()&&(0===self.masks.length&&self.trigger("open"),self.masks.length<config.max?addMask():1===config.max&&_.invoke(self.masks,"destroy"))})},destroy:function(){shortcut.remove(".area-masking")},enable:function(){this.button.enable()},disable:function(){this.button.disable()},show:function(){this.button.show()},hide:function(){this.button.hide()}})}),define("css!ui/calculator/css/calculator",[],function(){}),define("ui/calculator",["jquery","lodash","i18n","ui/dynamicComponent","lib/calculator/index","css!ui/calculator/css/calculator.css"],function($,_,__,dynamicComponent,calculatorBuild){'use strict';function getFontRatio($element){var $sample=$("<div />").text("0").css({"font-family":$element.css("font-family"),"font-size":"10px","line-height":"10px",position:"absolute",padding:"0",top:-1e3,left:-1e3}).appendTo("body"),fontRatio=$sample.height()/$sample.width();return $sample.remove(),fontRatio}function adjustFontSize($text,fontRatio,fontSize){var width=$text.width(),height=$text.height(),charWidth=fontSize/fontRatio,len;$text.is(":input")?(len=$text.val().length,len*charWidth>=width&&(fontSize=Math.max(height/4,Math.min(width/len*(fontRatio||1.6),fontSize)))):fontSize=computeFontSize(width,height),$text.css("fontSize",fontSize)}function calculatorFactory(config){return config=_.defaults(config||{},_defaults),dynamicComponent(calculator).on("rendercontent",function($content){var self=this,calcConfig={},$input;_.isFunction(config.alternativeTemplate)&&(calcConfig.template=config.alternativeTemplate),this.calc=calculatorBuild.init($content,calcConfig),$input=$content.find("input.calcDisplay").on("change",function(){adjustFontSize($input,self.fontRatio,self.fontSize)}),this.fontSize=parseFloat($input.css("font-size")),this.fontRatio=getFontRatio($input)}).after("show",function(){var self=this;_.defer(function(){var $display=self.getElement().find(".calcDisplay"),strLength=$display.val().length+1;$display.focus(),$display[0].setSelectionRange(strLength,strLength)})}).on("reset",function(){this.calc.press("C")}).on("resize",function(){var $element=this.getElement();$element&&(adjustFontSize($element.find("form"),this.fontRatio,this.fontSize),adjustFontSize($element.find("input.calcDisplay"),this.fontRatio,this.fontSize))}).on("destroy",function(){this.calc&&this.calc.remove()}).init(config)}$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,__=__&&__.hasOwnProperty("default")?__["default"]:__,dynamicComponent=dynamicComponent&&dynamicComponent.hasOwnProperty("default")?dynamicComponent["default"]:dynamicComponent,calculatorBuild=calculatorBuild&&calculatorBuild.hasOwnProperty("default")?calculatorBuild["default"]:calculatorBuild;var _defaults={title:__("Calculator"),preserveAspectRatio:!1,width:240,height:360,minWidth:150,minHeight:220,alternativeTemplate:null},computeFontSize=function(width,height){return(width*(10/240)+height*(10/340))/2},calculator={press:function(key){return this.calc.press(key),this}};return calculatorFactory}),define("core/collections",[],function(){'use strict';var collections={Map:window.Map,Set:window.Set,WeakMap:window.WeakMap,WeakSet:window.WeakSet};return collections}),define("ui/areaBroker",["jquery","lodash"],function($,_){'use strict';function areaBroker(requiredAreas,$container,mapping){var components={},broker,areas;if(("string"==typeof $container||$container instanceof HTMLElement)&&($container=$($container)),!$container||!$container.length)throw new TypeError("Please provide the areaBroker a container");return requiredAreas=requiredAreas||[],broker={defineAreas:function(areasMapping){var keys,required;if(!_.isPlainObject(areasMapping))throw new TypeError("A mapping has the form of a plain object");if(keys=_.keys(areasMapping),required=_.all(requiredAreas,function(val){return _.contains(keys,val)}),!required)throw new TypeError("You have to define a mapping for at least : "+requiredAreas.join(", "));areas=areasMapping},getContainer:function(){return $container},getArea:function(name){if(_.isEmpty(areas))throw new Error("Sorry areas have not been defined yet!");return areas[name]},setComponent:function(areaName,component){if(!areas[areaName])throw new TypeError("There is no areas defined or no area named "+areaName);if(!_.isObject(component))throw new TypeError("A component has to be an object");components[areaName]=component,this["get"+areaName[0].toUpperCase()+areaName.slice(1)]=this.getComponent.bind(this,areaName)},getComponent:function(areaName){return components[areaName]}},broker.defineAreas(mapping),_.forEach(requiredAreas,function(area){var areaIdentifier=area[0].toUpperCase()+area.slice(1);broker["get"+areaIdentifier+"Area"]=_.bind(_.partial(broker.getArea,area),broker)}),broker}return $=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_,areaBroker}),define("ui/maths/calculator/core/areaBroker",["lodash","ui/areaBroker"],function(_,areaBroker$1){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,areaBroker$1=areaBroker$1&&areaBroker$1.hasOwnProperty("default")?areaBroker$1["default"]:areaBroker$1;var areaBroker=_.partial(areaBroker$1,["screen","input","keyboard"]);return areaBroker}),define("ui/maths/calculator/core/labels",["i18n","handlebars","lodash","lib/dompurify/purify"],function(__,Handlebars,_,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}__=__&&__.hasOwnProperty("default")?__["default"]:__,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,_=_&&_.hasOwnProperty("default")?_["default"]:_,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),"<svg class=\"arrow-up\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"32\" height=\"32\" viewBox=\"0 0 32 32\"><path d=\"M16 1l-15 15h9v16h12v-16h9z\"></path></svg>"});Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template$1=Handlebars.template(function(Handlebars,depth0,helpers){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),"<svg class=\"arrow-down\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"32\" height=\"32\" viewBox=\"0 0 32 32\"><path d=\"M16 31l15-15h-9v-16h-12v16h-9z\"></path></svg>"});Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template$2=Handlebars.template(function(Handlebars,depth0,helpers){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),"<svg class=\"backspace-outline\" xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" height=\"32\" viewBox=\"0 0 24 24\"><path d=\"M19 21H9c-1.436 0-3.145-.88-3.977-2.046l-2.619-3.667c-.629-.881-1.157-1.621-1.188-1.661-.246-.344-.249-.894-.008-1.241.018-.025.561-.783 1.204-1.686L5.02 7.046C5.855 5.879 7.566 5 9 5h10c1.654 0 3 1.346 3 3v10c0 1.654-1.346 3-3 3zM3.229 12.999l.806 1.125 2.618 3.667C7.104 18.424 8.223 19 9.001 19h10c.552 0 1-.45 1-1.001V8c0-.551-.448-1-1-1h-10c-.776 0-1.897.576-2.351 1.209l-2.608 3.652-.813 1.138z\"/><path d=\"M13.707 13l2.646-2.646a.502.502 0 0 0 0-.707.502.502 0 0 0-.707 0L13 12.293l-2.646-2.646a.5.5 0 0 0-.707.707L12.293 13l-2.646 2.646a.5.5 0 0 0 .707.708L13 13.707l2.646 2.646a.5.5 0 1 0 .708-.706L13.707 13z\"/></svg>"}),labels={NUM0:"0",NUM1:"1",NUM2:"2",NUM3:"3",NUM4:"4",NUM5:"5",NUM6:"6",NUM7:"7",NUM8:"8",NUM9:"9",DOT:".",EXP10:"\xD710",POW10:"10<sup>x</sup>",LPAR:"(",RPAR:")",COMMA:",",ELLIPSIS:"\u2026",SPACER:"",SUB:"-",ADD:"+",POS:"\u207A",NEG:"\u207B",MUL:"\xD7",DIV:"\xF7",MOD:__("modulo"),POW:"^",POW2:"x<sup>2</sup>",POW3:"x<sup>3</sup>",POWY:"x<sup>y</sup>",POWMINUSONE:"x<sup>\u207B1</sup>",FAC:"!",ASSIGN:"=",ANS:__("Ans"),PI:"\u03C0",E:"e",NAN:__("Error"),INFINITY:__("Infinity"),ERROR:__("Syntax error"),EXP:__("exp"),EXPX:"e<sup>x</sup>",SQRT:"\u221A",CBRT:"<sup>3</sup>\u221A",NTHRT:"<sup>y</sup>\u221Ax",FLOOR:__("floor"),CEIL:__("ceil"),ROUND:__("round"),TRUNC:__("trunc"),SIN:__("sin"),COS:__("cos"),TAN:__("tan"),ASIN:__("sin")+"<sup>\u207B1</sup>",ACOS:__("cos")+"<sup>\u207B1</sup>",ATAN:__("tan")+"<sup>\u207B1</sup>",SINH:__("sinh"),COSH:__("cosh"),TANH:__("tanh"),ASINH:__("sinh")+"<sup>\u207B1</sup>",ACOSH:__("cosh")+"<sup>\u207B1</sup>",ATANH:__("tanh")+"<sup>\u207B1</sup>",LN:__("ln"),LOG:__("log")+"<sub>10</sub>",ABS:__("abs"),RAND:__("random"),CLEAR:__("C"),CLEARALL:__("AC"),EXECUTE:"=",HISTORYUP:function(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}(),HISTORYDOWN:function(data,options,asString){var html=Template$1(data,options);return asString||!0?html:$(html)}(),BACKSPACE:function(data,options,asString){var html=Template$2(data,options);return asString||!0?html:$(html)}(),DEGREE:__("Deg"),RADIAN:__("Rad"),SIGN:"&plusmn;"};return labels}),define("ui/maths/calculator/core/terms",["i18n","ui/maths/calculator/core/labels"],function(__,labels){'use strict';__=__&&__.hasOwnProperty("default")?__["default"]:__,labels=labels&&labels.hasOwnProperty("default")?labels["default"]:labels;var terms={NUM0:{label:labels.NUM0,value:"0",type:"digit",description:__("Digit 0"),exponent:null},NUM1:{label:labels.NUM1,value:"1",type:"digit",description:__("Digit 1"),exponent:null},NUM2:{label:labels.NUM2,value:"2",type:"digit",description:__("Digit 2"),exponent:null},NUM3:{label:labels.NUM3,value:"3",type:"digit",description:__("Digit 3"),exponent:null},NUM4:{label:labels.NUM4,value:"4",type:"digit",description:__("Digit 4"),exponent:null},NUM5:{label:labels.NUM5,value:"5",type:"digit",description:__("Digit 5"),exponent:null},NUM6:{label:labels.NUM6,value:"6",type:"digit",description:__("Digit 6"),exponent:null},NUM7:{label:labels.NUM7,value:"7",type:"digit",description:__("Digit 7"),exponent:null},NUM8:{label:labels.NUM8,value:"8",type:"digit",description:__("Digit 8"),exponent:null},NUM9:{label:labels.NUM9,value:"9",type:"digit",description:__("Digit 9"),exponent:null},DOT:{label:labels.DOT,value:".",type:"digit",description:__("Dot"),exponent:null},EXP10:{label:labels.EXP10,value:"e",type:"digit",description:__("Power of 10"),exponent:"right"},LPAR:{label:labels.LPAR,value:"(",type:"aggregator",description:__("Left parenthesis"),exponent:null},RPAR:{label:labels.RPAR,value:")",type:"aggregator",description:__("Right parenthesis"),exponent:null},COMMA:{label:labels.COMMA,value:",",type:"separator",description:__("Arguments separator"),exponent:null},ELLIPSIS:{label:labels.ELLIPSIS,value:"~",type:"separator",description:__("Value ellipsis"),exponent:null},SUB:{label:labels.SUB,value:"-",type:"operator",description:__("Binary operator -"),exponent:null},NEG:{label:labels.NEG,value:labels.NEG,type:"operator",description:__("Unary operator -"),exponent:null},ADD:{label:labels.ADD,value:"+",type:"operator",description:__("Binary operator +"),exponent:null},POS:{label:labels.POS,value:labels.POS,type:"operator",description:__("Unary operator +"),exponent:null},MUL:{label:labels.MUL,value:"*",type:"operator",description:__("Binary operator *"),exponent:null},DIV:{label:labels.DIV,value:"/",type:"operator",description:__("Binary operator /"),exponent:null},MOD:{label:labels.MOD,value:"%",type:"operator",description:__("Binary operator modulo"),exponent:null},POW:{label:labels.POW,value:"^",type:"operator",description:__("Power of"),exponent:"right"},FAC:{label:labels.FAC,value:"!",type:"operator",description:__("Factorial"),exponent:null},ASSIGN:{label:labels.ASSIGN,value:"=",type:"operator",description:__("Assign"),exponent:null},ANS:{label:labels.ANS,value:"ans",type:"variable",description:__("Last result"),exponent:null},PI:{label:labels.PI,value:"PI",type:"constant",description:__("Value of PI"),exponent:null},E:{label:labels.E,value:"E",type:"constant",description:__("Value of E"),exponent:null},NAN:{label:labels.NAN,value:"NaN",type:"error",description:__("Error in value"),exponent:null},INFINITY:{label:labels.INFINITY,value:"Infinity",type:"error",description:__("Error in result"),exponent:null},ERROR:{label:labels.ERROR,value:"#",type:"error",description:__("Error in syntax"),exponent:null},EXP:{label:labels.EXP,value:"exp",type:"function",description:__("Exponent"),exponent:"right"},SQRT:{label:labels.SQRT,value:"sqrt",type:"function",description:__("Square root"),exponent:null},CBRT:{label:labels.CBRT,value:"cbrt",type:"function",description:__("Cube root"),exponent:null},NTHRT:{label:labels.SQRT,value:"nthrt",type:"function",description:__("Nth root"),exponent:"left"},FLOOR:{label:labels.FLOOR,value:"floor",type:"function",description:__("Round to lower whole number"),exponent:null},CEIL:{label:labels.CEIL,value:"ceil",type:"function",description:__("Round to upper whole number"),exponent:null},ROUND:{label:labels.ROUND,value:"round",type:"function",description:__("Round to closest whole number"),exponent:null},TRUNC:{label:labels.TRUNC,value:"trunc",type:"function",description:__("Whole number part"),exponent:null},SIN:{label:labels.SIN,value:"sin",type:"function",description:__("Sine"),exponent:null},COS:{label:labels.COS,value:"cos",type:"function",description:__("Cosine"),exponent:null},TAN:{label:labels.TAN,value:"tan",type:"function",description:__("Tangent"),exponent:null},ASIN:{label:labels.ASIN,value:"asin",type:"function",description:__("Arc sine"),exponent:null},ACOS:{label:labels.ACOS,value:"acos",type:"function",description:__("Arc cosine"),exponent:null},ATAN:{label:labels.ATAN,value:"atan",type:"function",description:__("Arc tangent"),exponent:null},SINH:{label:labels.SINH,value:"sinh",type:"function",description:__("Hyperbolic sine"),exponent:null},COSH:{label:labels.COSH,value:"cosh",type:"function",description:__("Hyperbolic cosine"),exponent:null},TANH:{label:labels.TANH,value:"tanh",type:"function",description:__("Hyperbolic tangent"),exponent:null},ASINH:{label:labels.ASINH,value:"asinh",type:"function",description:__("Hyperbolic arc sine"),exponent:null},ACOSH:{label:labels.ACOSH,value:"acosh",type:"function",description:__("Hyperbolic arc cosine"),exponent:null},ATANH:{label:labels.ATANH,value:"atanh",type:"function",description:__("Hyperbolic arc tangent"),exponent:null},LN:{label:labels.LN,value:"ln",type:"function",description:__("Natural logarithm"),exponent:null},LOG:{label:labels.LN,value:"log",type:"function",description:__("Natural logarithm"),exponent:null},LG:{label:labels.LOG,value:"lg",type:"function",description:__("Base-10 logarithm"),exponent:null},LOG10:{label:labels.LOG,value:"log10",type:"function",description:__("Base-10 logarithm"),exponent:null},ABS:{label:labels.ABS,value:"abs",type:"function",description:__("Absolute value"),exponent:null},RAND:{label:labels.RAND,value:"random",type:"function",description:__("Random value"),exponent:null}};return terms}),define("ui/maths/calculator/core/tokens",["ui/maths/calculator/core/terms"],function(registeredTerms){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}registeredTerms=registeredTerms&&registeredTerms.hasOwnProperty("default")?registeredTerms["default"]:registeredTerms;var tokensHelper={getType:function(token){var type,term;return"string"==typeof token?token:(type=token&&token.type||null,term=registeredTerms[type],term&&term.type||type)},isDigit:function(type){return"digit"===tokensHelper.getType(type)},isOperator:function(type){return"operator"===tokensHelper.getType(type)},isOperand:function(type){return type=tokensHelper.getType(type),"operator"!==type&&"aggregator"!==type&&"separator"!==type},isValue:function(type){return type=tokensHelper.getType(type),"digit"===type||"constant"===type||"variable"===type||"term"===type||"error"===type},isAggregator:function(type){return"aggregator"===tokensHelper.getType(type)},isError:function(type){return"error"===tokensHelper.getType(type)},isConstant:function(type){return"constant"===tokensHelper.getType(type)},isVariable:function(type){return type=tokensHelper.getType(type),"variable"===type||"term"===type},isFunction:function(type){return"function"===tokensHelper.getType(type)},isIdentifier:function(type){return type=tokensHelper.getType(type),"constant"===type||"variable"===type||"term"===type||"function"===type||"error"===type},isSeparator:function(type){return type=tokensHelper.getType(type),"operator"===type||"aggregator"===type||"separator"===type},isModifier:function(type){return type=tokensHelper.getType(type),"operator"===type||"function"===type},stringValue:function(expression){var type=_typeof(expression);return"string"!==type&&(expression&&"undefined"!=typeof expression.value?expression=expression.value:expression&&"undefined"!=typeof expression.result?expression=expression.result:("object"===type||"undefined"===type||null===expression)&&(expression=""),expression+=""),expression}};return tokensHelper}),define("ui/maths/calculator/core/tokenizer",["lodash","ui/maths/calculator/core/terms","ui/maths/calculator/core/tokens","lib/moo/moo"],function(_,registeredTerms,tokensHelper,moo){'use strict';function filterKeyword(term){return term.value.match(reKeywordOnly)}function filterDigit(term){return tokensHelper.isDigit(term.type)||"-"===term.value||"+"===term.value}function calculatorTokenizerFactory(config){var next=function next(){var term;if(digitContext&&(term=digitLexer.next(),term&&(term.offset+=digitContext.offset)),!term){digitContext=null;do term=lexer.next();while(term&&ignoredTokens[term.type]);term&&"number"===term.type&&(digitContext=term,digitLexer.reset(term.value),term=next())}return term},tokenizer={iterator:function(expression){return lexer.reset(tokensHelper.stringValue(expression)),next},tokenize:function(expression){var iterator=tokenizer.iterator(expression),terms=[],term;do term=iterator(),term&&terms.push(term);while(term);return terms}},keywordsTransform,lexer,digitLexer,digitContext;return config=config||{},config.keywords=_.defaults(_.mapValues(keywords,"value"),config.keywords),config.symbols=_.defaults(_.mapValues(symbols,"value"),config.symbols),keywordsTransform=moo.keywords(config.keywords),lexer=moo.compile(_.defaults({},ignoredTokens,{number:reNumber,prefixed:{match:rePrefixedKeyword,type:function(token){return keywordsTransform(token.substring(1))}},term:{match:reKeyword,type:keywordsTransform},syntaxError:moo.error},config.symbols)),digitLexer=moo.compile(_.mapValues(digits,"value")),tokenizer}_=_&&_.hasOwnProperty("default")?_["default"]:_,registeredTerms=registeredTerms&&registeredTerms.hasOwnProperty("default")?registeredTerms["default"]:registeredTerms,tokensHelper=tokensHelper&&tokensHelper.hasOwnProperty("default")?tokensHelper["default"]:tokensHelper,moo=moo&&moo.hasOwnProperty("default")?moo["default"]:moo;var ignoredTokens={SPACE:{match:/\s+/,lineBreaks:!0}},reKeyword=/[a-zA-Z_]\w*/,reNumber=/[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?/,rePrefixedKeyword=new RegExp("@"+reKeyword.source),reKeywordOnly=new RegExp("^"+reKeyword.source+"$"),keywords=_.pick(registeredTerms,filterKeyword),symbols=_.omit(registeredTerms,filterKeyword),digits=_.pick(registeredTerms,filterDigit);return calculatorTokenizerFactory}),define("ui/maths/calculator/core/expression",["lodash","ui/maths/calculator/core/terms","ui/maths/calculator/core/tokens","ui/maths/calculator/core/tokenizer","handlebars","i18n","lib/dompurify/purify"],function(_,registeredTerms,tokensHelper,tokenizerFactory,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function termsTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function exponentOnTheLeft(index,terms){function nextTerm(){next=term,term=terms[--index]}var parenthesis=0,next=terms[index],term=terms[--index];if(term&&(tokensHelper.isOperand(term.type)||"RPAR"===term.token)){if(term.endExponent.push(term.endExponent.length),"RPAR"===term.token){for(parenthesis++;0<index&&0<parenthesis;)nextTerm(),"RPAR"===term.token?parenthesis++:"LPAR"===term.token&&parenthesis--;0<index&&tokensHelper.isFunction(terms[index-1])&&!terms[index-1].prefixed&&nextTerm()}else if(tokensHelper.isDigit(term.type)){for(;index&&tokensHelper.isDigit(term.type);)nextTerm();tokensHelper.isDigit(term.type)||(term=next)}term.startExponent.push(term.startExponent.length)}}function exponentOnTheRight(index,terms){function nextTerm(){previous=term,term=terms[++index]}function previousTerm(){term=previous,previous=terms[--index]}var last=terms.length-1,parenthesis=0,startAt=index,previous=terms[index],term=terms[++index],shouldContinue;if(term&&(tokensHelper.isOperand(term.type)||"LPAR"===term.token||0<=signOperators.indexOf(term.token))){term.startExponent.push(term.startExponent.length);do{for(shouldContinue=!1;index<last&&(tokensHelper.isFunction(term.type)||0<=signOperators.indexOf(term.token));)nextTerm();if(term||previousTerm(),"LPAR"===term.token)for(parenthesis++;index<last&&0<parenthesis;)nextTerm(),"LPAR"===term.token?parenthesis++:"RPAR"===term.token&&parenthesis--;else if(tokensHelper.isDigit(term.type)){for(;index<last&&tokensHelper.isDigit(term.type);)nextTerm();term&&tokensHelper.isDigit(term.type)||previousTerm()}for(;index<last&&"FAC"===terms[index+1].token;)nextTerm();index<last&&0<=continueExponent.indexOf(terms[index+1].token)&&(nextTerm(),nextTerm(),shouldContinue=!0)}while(shouldContinue);term.endExponent.push(term.endExponent.length),0<startAt&&startAt<last&&"POW"===terms[startAt].token&&terms[startAt+1].startExponent.length&&(terms[startAt].elide=!0)}}_=_&&_.hasOwnProperty("default")?_["default"]:_,registeredTerms=registeredTerms&&registeredTerms.hasOwnProperty("default")?registeredTerms["default"]:registeredTerms,tokensHelper=tokensHelper&&tokensHelper.hasOwnProperty("default")?tokensHelper["default"]:tokensHelper,tokenizerFactory=tokenizerFactory&&tokenizerFactory.hasOwnProperty("default")?tokenizerFactory["default"]:tokenizerFactory,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",stack1,helper;return stack1=helpers.each.call(depth0,depth0&&depth0.startExponent,{hash:{},inverse:self.noop,fn:self.program(2,program2,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="<span class=\"term term-",(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1),stack1=helpers["if"].call(depth0,depth0&&depth0.elide,{hash:{},inverse:self.noop,fn:self.program(4,program4,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\" data-value=\"",(helper=helpers.value)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.value,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-token=\"",(helper=helpers.token)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.token,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-type=\"",(helper=helpers.type)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.type,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">",(helper=helpers.label)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.label,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span>",stack1=helpers.each.call(depth0,depth0&&depth0.endExponent,{hash:{},inverse:self.noop,fn:self.program(6,program6,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer}function program2(){return"<sup>"}function program4(){return" term-elide"}function program6(){return"</sup>"}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var self=this,escapeExpression=this.escapeExpression,stack1;return stack1=helpers.each.call(depth0,depth0,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),stack1||0===stack1?stack1:""}),lastResultVariableName=registeredTerms.ANS.value,rePrefixedTerm=/^@[a-zA-Z_]\w*$/,reErrorValue=/(NaN|[+-]?Infinity)/,reAnsVar=new RegExp("\\b"+lastResultVariableName+"\\b","g"),signOperators=["NEG","POS","SUB","ADD"],continueExponent=["POW","NTHRT"],expressionHelper={containsError:function(expression){return reErrorValue.test(tokensHelper.stringValue(expression))},replaceLastResult:function(expression,value){return tokensHelper.stringValue(expression).replace(reAnsVar,tokensHelper.stringValue(value||"0"))},roundVariable:function(variable,decimalDigits){var resultString=tokensHelper.stringValue(variable),fullString=resultString,value=variable&&variable.result;return decimalDigits=decimalDigits||5,"undefined"!=typeof value&&(value.toExponential&&0<resultString.indexOf(registeredTerms.EXP10.value)?resultString=value.toExponential(decimalDigits).toString():value.toDecimalPlaces&&0<resultString.indexOf(registeredTerms.DOT.value)&&(resultString=value.toDecimalPlaces(decimalDigits).toString()),resultString.length<fullString.length?resultString+=registeredTerms.ELLIPSIS.value:resultString=fullString),resultString},roundLastResultVariable:function(variables,decimalDigits){return variables&&"undefined"!=typeof variables[lastResultVariableName]&&(variables[lastResultVariableName]=expressionHelper.roundVariable(variables[lastResultVariableName],decimalDigits)),variables},renderSign:function(expression){return tokensHelper.stringValue(expression).replace(registeredTerms.SUB.value,registeredTerms.NEG.label).replace(registeredTerms.ADD.value,registeredTerms.POS.label)},render:function(expression,variables,tokenizer){function toSignOperator(term,token){(!previous||tokensHelper.isModifier(previous.type)||"LPAR"===previous.token||"EXP10"===previous.token)&&(term.label=registeredTerms[token].label,term.token=token)}var tokens=expression,exponents=[],terms=[],previous;return _.isArray(expression)||((!tokenizer||!tokenizer.tokenize)&&(tokenizer=tokenizerFactory()),tokens=tokenizer.tokenize(expression)),variables=variables||{},_.forEach(tokens,function(token,index){var registeredTerm=registeredTerms[token.type],term={type:token.type,token:token.type,value:token.value,label:token.value,description:token.value,exponent:null,startExponent:[],endExponent:[],prefixed:rePrefixedTerm.test(token.value),elide:!1};registeredTerm?(_.merge(term,registeredTerm),term.value===lastResultVariableName&&"undefined"!=typeof variables[term.value]&&(term.label=expressionHelper.render(variables[term.value],variables,tokenizer))):"term"===term.token&&("undefined"==typeof variables[term.value]?term.type="unknown":term.type="variable"),"SUB"===term.token?toSignOperator(term,"NEG"):"ADD"===term.token&&toSignOperator(term,"POS"),terms.push(term),term.exponent&&exponents.push(index),previous=term}),_.forEach(exponents,function(index){var term=terms[index];"left"===term.exponent&&0<index?exponentOnTheLeft(index,terms):"right"===term.exponent&&index<terms.length-1&&exponentOnTheRight(index,terms)}),termsTpl(terms)}};return expressionHelper}),define("util/mathsEvaluator",["lodash","lib/decimal/decimal","lib/expr-eval/expr-eval"],function(_,Decimal,exprEval){'use strict';function toPrecisionNumber(number,precision){var dot=number.indexOf(".");return 0<dot&&(number=number.substr(0,dot+precision+1)),number}function mathsEvaluatorFactory(config){function checkZero(number){return number.absoluteValue().lessThan(EPSILON)?new ConfiguredDecimal(0):number}function native(number){return Decimal.isDecimal(number)?number.toNumber():"true"===number||!0===number||"false"!==number&&!1!==number&&number}function useOrigin(){var args=[].slice.call(arguments),origin=args.pop();return origin.apply(this,args.map(native))}function decimalNumber(number){return Decimal.isDecimal(number)||(number=new ConfiguredDecimal(number)),number}function degreeToRadian(value){return decimalNumber(value).mul(PI).div(180)}function radianToDegree(value){return decimalNumber(value).mul(180).div(PI)}function unaryOperator(operator,operand){if(operand=decimalNumber(operand),!_.isFunction(operand[operator]))throw new TypeError(operator+" is not a valid operator!");return operand[operator]()}function binaryOperator(operator,left,right){if(left=decimalNumber(left),!_.isFunction(left[operator]))throw new TypeError(operator+" is not a valid operator!");return left[operator](decimalNumber(right))}function functionOperator(operator){var operands=[].slice.call(arguments,1);if(!_.isFunction(ConfiguredDecimal[operator]))throw new TypeError(operator+" is not a valid function!");return ConfiguredDecimal[operator].apply(ConfiguredDecimal,operands.map(decimalNumber))}function trigoOperator(operator,operand){if(!_.isFunction(Decimal[operator]))throw new TypeError(operator+" is not a valid operator!");return operand=localConfig.degree?degreeToRadian(operand):decimalNumber(operand),"tan"===operator&&operand.equals(PI.div(2))?new ConfiguredDecimal(NaN):checkZero(ConfiguredDecimal[operator](operand))}function inverseTrigoOperator(operator,operand){var result=checkZero(unaryOperator(operator,operand));return localConfig.degree?radianToDegree(result):result}function mapping(wrapper,origin,api){var fn;fn=api.value?api.value:api.action?_.partialRight(api.action,origin[api.entry]):_.partial(wrapper,api.mapTo),origin[api.entry]=fn}function evaluate(expression,variables){var parsedExpression,result,value;return _.isPlainObject(expression)&&(variables=variables||expression.variables,expression=expression.expression),parsedExpression=parser.parse(expression),result=parsedExpression.evaluate(variables),value=native(result),{expression:expression,variables:variables,result:result,value:value}}var localConfig=_.defaults({},config,defaultConfig),decimalConfig=_.pick(localConfig,decimalConfigEntries),parserConfig=_.pick(localConfig,parserConfigEntries),parser=new Parser(parserConfig),ConfiguredDecimal=Decimal.set(_.isEmpty(decimalConfig)?defaultDecimalConfig:decimalConfig),EPSILON=new ConfiguredDecimal(2).pow(-52),PI=new ConfiguredDecimal(toPrecisionNumber("3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989",localConfig.internalPrecision)),E=new ConfiguredDecimal(toPrecisionNumber("2.7182818284590452353602874713526624977572470936999595749669676277240766303535475945713821785251664274274663919320030599218174135966290435729003342952605956307381323286279434907632338298807531952510190115738341879307021540891499348841675092447614606680822648001684774118537423454424371075390777449920695517027618386062613313845830007520449338265602976067371132007093287091274437470472306969772093101416928368190255151086574637721112523897844250569536967707854499699679468644549059879316368892300987931277361782154249992295763514822082698951936680331825288693984964651058209392398294887933203625094431173012381970684161403970198376793206832823764648042953118023287825098194558153017567173613320698112509961818815930416903515988885193458072738667385894228792284998920868058257492796104841984443634632449684875602336248270419786232090021609902353043699418491463140934317381436405462531520961836908887070167683964243781405927145635490613031072085103837505101157477041718986106873969655212671546889570350354",localConfig.internalPrecision)),mapAPI={unary:[{entry:"sin",action:function(a){return trigoOperator("sin",a)}},{entry:"cos",action:function(a){return trigoOperator("cos",a)}},{entry:"tan",action:function(a){return trigoOperator("tan",a)}},{entry:"asin",action:function(a){return inverseTrigoOperator("asin",a)}},{entry:"acos",action:function(a){return inverseTrigoOperator("acos",a)}},{entry:"atan",action:function(a){return inverseTrigoOperator("atan",a)}},{entry:"sinh",mapTo:"sinh"},{entry:"cosh",mapTo:"cosh"},{entry:"tanh",mapTo:"tanh"},{entry:"asinh",mapTo:"asinh"},{entry:"acosh",mapTo:"acosh"},{entry:"atanh",mapTo:"atanh"},{entry:"sqrt",mapTo:"sqrt"},{entry:"cbrt",mapTo:"cbrt"},{entry:"log",mapTo:"log"},{entry:"ln",mapTo:"ln"},{entry:"lg",mapTo:"log"},{entry:"log10",mapTo:"log"},{entry:"abs",mapTo:"abs"},{entry:"ceil",mapTo:"ceil"},{entry:"floor",mapTo:"floor"},{entry:"round",mapTo:"round"},{entry:"trunc",mapTo:"trunc"},{entry:"-",mapTo:"neg"},{entry:"+",action:decimalNumber},{entry:"exp",mapTo:"exp"},{entry:"not",action:function(a){return!native(a)}},{entry:"!",action:useOrigin}],binary:[{entry:"+",mapTo:"add"},{entry:"-",mapTo:"sub"},{entry:"*",mapTo:"mul"},{entry:"/",mapTo:"div"},{entry:"%",mapTo:"mod"},{entry:"^",mapTo:"pow"},{entry:"==",mapTo:"equals"},{entry:"!=",action:function(a,b){return!binaryOperator("equals",a,b)}},{entry:">",mapTo:"gt"},{entry:"<",mapTo:"lt"},{entry:">=",mapTo:"gte"},{entry:"<=",mapTo:"lte"},{entry:"and",action:function(a,b){return!!(native(a)&&native(b))}},{entry:"or",action:function(a,b){return!!(native(a)||native(b))}},{entry:"in",action:function(array,obj){return obj=native(obj),"undefined"!=typeof _.find(array,function(el){return native(el)===obj})}}],ternaryOps:[{entry:"?",action:useOrigin}],functions:[{entry:"random",action:function(dp){return ConfiguredDecimal.random(dp)}},{entry:"fac",action:useOrigin},{entry:"min",mapTo:"min"},{entry:"max",mapTo:"max"},{entry:"hypot",action:useOrigin},{entry:"pyt",action:useOrigin},{entry:"pow",mapTo:"pow"},{entry:"atan2",action:function(y,x){var result=functionOperator("atan2",y,x);return localConfig.degree?radianToDegree(result):result}},{entry:"if",action:useOrigin},{entry:"gamma",action:useOrigin},{entry:"roundTo",action:useOrigin},{entry:"nthrt",action:function(n,x){return x=decimalNumber(x),n=parseInt(n,10),x.isNeg()&&1!=n%2?decimalNumber(NaN):x.abs().pow(decimalNumber(1).div(n)).mul(Decimal.sign(x))}}],consts:[{entry:"PI",value:PI},{entry:"E",value:E},{entry:"EPSILON",value:EPSILON}]};return _.forEach(mapAPI.unary,_.partial(mapping,unaryOperator,parser.unaryOps)),_.forEach(mapAPI.binary,_.partial(mapping,binaryOperator,parser.binaryOps)),_.forEach(mapAPI.ternaryOps,_.partial(mapping,functionOperator,parser.ternaryOps)),_.forEach(mapAPI.functions,_.partial(mapping,functionOperator,parser.functions)),_.forEach(mapAPI.consts,_.partial(mapping,null,parser.consts)),evaluate}_=_&&_.hasOwnProperty("default")?_["default"]:_,Decimal=Decimal&&Decimal.hasOwnProperty("default")?Decimal["default"]:Decimal,exprEval=exprEval&&exprEval.hasOwnProperty("default")?exprEval["default"]:exprEval;var Parser=exprEval.Parser,defaultConfig={internalPrecision:100,degree:!1},defaultDecimalConfig={defaults:!0},decimalConfigEntries=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],parserConfigEntries=["operators"];return mathsEvaluatorFactory}),define("ui/maths/calculator/core/board",["lodash","i18n","core/collections","ui/component","ui/maths/calculator/core/areaBroker","ui/maths/calculator/core/terms","ui/maths/calculator/core/tokens","ui/maths/calculator/core/expression","ui/maths/calculator/core/tokenizer","util/mathsEvaluator","handlebars","lib/dompurify/purify"],function(_,__,collections,componentFactory,areaBrokerFactory,registeredTerms,tokensHelper,expressionHelper,tokenizerFactory,mathsEvaluatorFactory,Handlebars,DOMPurify){'use strict';var _Mathmin2=Math.min,_Mathmax5=Math.max;function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function boardTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function calculatorBoardFactory($container,pluginFactories,config){var plugins={},expression="",variables=new collections.Map,commands=new collections.Map,position=0,tokenizer=tokenizerFactory(),tokens=null,calculator=componentFactory({getExpression:function(){return expression},setExpression:function(expr){return expression=(expr||"")+"",tokens=null,this.trigger("expressionchange",expression),this},getPosition:function(){return position},setPosition:function(pos){return position=_Mathmax5(0,_Mathmin2(parseInt(pos,10)||0,expression.length)),this.trigger("positionchange",position),this},getTokens:function(){return null===tokens&&(tokens=tokenizer.tokenize(expression)),tokens},getToken:function(){var tokensList=this.getTokens(),index=this.getTokenIndex();return tokensList[index]||null},getTokenIndex:function(){var index=0;return _.forEach(this.getTokens(),function(token,idx){position>=token.offset&&(index=idx)}),index},getTokenizer:function(){return tokenizer},getVariable:function(name){return variables.get(name)},hasVariable:function(name){return variables.has(name)},setVariable:function(name,value){var errValue;try{value=mathsEvaluator(value)}catch(err){errValue=value&&value.expression||value,value=mathsEvaluator("0"),value.expression=errValue}return variables.set(name,value),this.trigger("variableadd",name,value),this},deleteVariable:function(name){return variables.delete(name),this.trigger("variabledelete",name),this},getVariables:function(){var defs={};return variables.forEach(function(value,name){defs[name]=value}),defs},setVariables:function(defs){var self=this;return _.forEach(defs,function(value,name){self.setVariable(name,value)}),this},deleteVariables:function(){return variables.clear(),this.trigger("variabledelete",null),this.setLastResult("0"),this},setLastResult:function(result){return(!result||expressionHelper.containsError(result))&&(result="0"),this.setVariable(lastResultVariableName,result),this},getLastResult:function(){return this.getVariable(lastResultVariableName)},setCommand:function(name,label,description){return commands.set(name,{name:name,label:label,description:description}),this.trigger("commandadd",name),this},getCommand:function(name){return commands.get(name)},getCommands:function(){var defs={};return commands.forEach(function(value,name){defs[name]=value}),defs},hasCommand:function(name){return commands.has(name)},deleteCommand:function(name){return commands.delete(name),this.trigger("commanddelete",name),this},addTerm:function(name,term){function tokenNeedsSpace(token){return tokensHelper.isIdentifier(token)||isIdentifier&&!tokensHelper.isSeparator(token)}var tokensList=this.getTokens(),index=this.getTokenIndex(),currentToken=tokensList[index],nextToken=tokensList[index+1],isIdentifier,needsSpace,value;return _.isPlainObject(term)&&"undefined"!=typeof term.value?(value=term.value,tokensHelper.isOperator(term.type)||rePrefixedTerm.test(term.value)||1!==tokensList.length||("NUM0"!==currentToken.type||"DOT"===name)&&"ANS"!==currentToken.type?(expression&&!tokensHelper.isSeparator(term.type)&&(isIdentifier=tokensHelper.isIdentifier(term.type),needsSpace=tokenNeedsSpace(currentToken),position&&needsSpace&&(value=" "+value),(!position&&needsSpace||position<expression.length&&tokenNeedsSpace(nextToken))&&(value+=" ")),this.insert(value)):this.replace(value),this.trigger("termadd",name,term),this.trigger("termadd-"+name,term),this):this.trigger("termerror",new TypeError("Invalid term: "+name))},useTerm:function(name){var term;return rePrefixedTerm.test(name)?(name=name.substring(1),term=_.clone(registeredTerms[name]),term.value="@"+term.value):term=registeredTerms[name],"undefined"==typeof term?this.trigger("termerror",new TypeError("Invalid term: "+name)):this.addTerm(name,term)},useTerms:function(names){return"string"==typeof names&&(names=names.split(/\s+/)),_.forEach(names,this.useTerm.bind(this)),this},useVariable:function(name){return variables.has(name)?this.addTerm("VAR_"+name.toUpperCase(),{label:name,value:name,type:"variable",description:__("Variable %s",name)}):this.trigger("termerror",new TypeError("Invalid variable: "+name))},useCommand:function(name){return commands.has(name)?(this.trigger.apply(this,["command"].concat([].slice.call(arguments))),this.trigger.apply(this,["command-"+name].concat([].slice.call(arguments,1))),this):this.trigger("commanderror",new TypeError("Invalid command: "+name))},replace:function(newExpression,newPosition){var oldExpression=expression,oldPosition=position;return this.setExpression(newExpression).setPosition("undefined"==typeof newPosition?expression.length:newPosition),this.trigger("replace",oldExpression,oldPosition),this},insert:function(subExpression){var oldExpression=expression,oldPosition=position;return this.setExpression(expression.substr(0,position)+subExpression+expression.substr(position)).setPosition(position+subExpression.length),this.trigger("insert",oldExpression,oldPosition),this},clear:function(){return this.setExpression("").setPosition(0),this.trigger("clear"),this},evaluate:function(){var result=null;try{result=expression.trim()?mathsEvaluator(expression,_.mapValues(this.getVariables(),"result")):mathsEvaluator("0"),this.trigger("evaluate",result)}catch(e){this.trigger("syntaxerror",e)}return result},runPlugins:function(method){var execStack=[];return _.forEach(plugins,function(plugin){_.isFunction(plugin[method])&&execStack.push(plugin[method]())}),Promise.all(execStack)},getPlugins:function(){return _.toArray(plugins)},getPlugin:function(name){return plugins[name]},getAreaBroker:function(){return areaBroker},setupMathsEvaluator:function(){return mathsEvaluator=mathsEvaluatorFactory(this.getConfig().maths),this},getMathsEvaluator:function(){return mathsEvaluator}},defaultConfig).setTemplate(boardTpl).before("init",function(){this.setupMathsEvaluator(),this.setLastResult("0"),this.config.expression&&this.setExpression(this.config.expression),this.config.position&&this.setPosition(this.config.position),this.setCommand("clear",__("Clear"),__("Clear expression")).setCommand("clearAll",__("Clear All"),__("Clear all data")).setCommand("execute",__("Execute"),__("Compute the expression")).setCommand("var",__("Variable"),__("Use a variable")).setCommand("term",__("Term"),__("Use a term")).on("command-term",this.useTerms.bind(this)).on("command-var",this.useVariable.bind(this)).on("command-execute",this.evaluate.bind(this)).on("command-clearAll",this.deleteVariables.bind(this)).on("command-clear command-clearAll",this.clear.bind(this))}).after("evaluate",function(result){this.setLastResult(result)}).after("init",function(){this.render($container)}).before("render",function(){var self=this,pluginsConfig=this.getConfig().plugins||{},$element=this.getElement();return areaBroker=areaBrokerFactory($element,{screen:$element.find(".screen"),input:$element.find(".input"),keyboard:$element.find(".keyboard")}),_.forEach(pluginFactories,function(pluginFactory){var plugin=pluginFactory(self,self.getAreaBroker()),pluginName=plugin.getName();pluginsConfig[pluginName]&&plugin.setConfig(pluginsConfig[pluginName]),plugins[plugin.getName()]=plugin}),this.runPlugins("install").then(function(){return self.runPlugins("init")}).then(function(){return self.runPlugins("render")}).then(function(){self.trigger("ready")}).catch(function(err){self.trigger("error",err)})}).on("destroy",function(){var self=this;return this.runPlugins("destroy").then(function(){self.off(".calculator"),tokenizer=null,areaBroker=null,mathsEvaluator=null,variables.clear(),plugins={}})}),mathsEvaluator,areaBroker;return _.defer(function(){calculator.init(config)}),calculator}_=_&&_.hasOwnProperty("default")?_["default"]:_,__=__&&__.hasOwnProperty("default")?__["default"]:__,collections=collections&&collections.hasOwnProperty("default")?collections["default"]:collections,componentFactory=componentFactory&&componentFactory.hasOwnProperty("default")?componentFactory["default"]:componentFactory,areaBrokerFactory=areaBrokerFactory&&areaBrokerFactory.hasOwnProperty("default")?areaBrokerFactory["default"]:areaBrokerFactory,registeredTerms=registeredTerms&&registeredTerms.hasOwnProperty("default")?registeredTerms["default"]:registeredTerms,tokensHelper=tokensHelper&&tokensHelper.hasOwnProperty("default")?tokensHelper["default"]:tokensHelper,expressionHelper=expressionHelper&&expressionHelper.hasOwnProperty("default")?expressionHelper["default"]:expressionHelper,tokenizerFactory=tokenizerFactory&&tokenizerFactory.hasOwnProperty("default")?tokenizerFactory["default"]:tokenizerFactory,mathsEvaluatorFactory=mathsEvaluatorFactory&&mathsEvaluatorFactory.hasOwnProperty("default")?mathsEvaluatorFactory["default"]:mathsEvaluatorFactory,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),"<div class=\"calculator\">\n    <div class=\"screen\"></div>\n    <div class=\"input\"></div>\n    <div class=\"keyboard\"></div>\n</div>"}),defaultConfig={expression:"",position:0},lastResultVariableName=registeredTerms.ANS.value,rePrefixedTerm=/^@[a-zA-Z_]\w*$/;return calculatorBoardFactory}),define("core/moduleLoader",["lodash","core/promise"],function(_,Promise){'use strict';function moduleLoaderFactory(requiredModules,validate,specs){var loaded={},modules={},excludes=[],bundles=[],loader={addList:function(moduleList){return _.forEach(moduleList,this.add,this),this},add:function(def){if(!_.isPlainObject(def))throw new TypeError("The module definition module must be an object");if(_.isEmpty(def.module)||!_.isString(def.module))throw new TypeError("An AMD module must be defined");if(_.isEmpty(def.category)||!_.isString(def.category)){var identifyProvider=def.id||def.name||def.module;throw new TypeError("The provider '".concat(identifyProvider,"' must belong to a category"))}return modules[def.category]=modules[def.category]||[],_.isNumber(def.position)?modules[def.category][def.position]=def.module:"prepend"===def.position||"before"===def.position?modules[def.category].unshift(def.module):modules[def.category].push(def.module),def.bundle&&!_.contains(bundles,def.bundle)&&bundles.push(def.bundle),this},append:function(def){return this.add(_.merge({position:"append"},def))},prepend:function(def){return this.add(_.merge({position:"prepend"},def))},remove:function(module){return excludes.push(module),this},load:function(loadBundles){var self=this,dependencies=_(modules).values().flatten().uniq().difference(excludes).value(),loadModules=function(){var amdModules=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return _.isArray(amdModules)&&amdModules.length?new Promise(function(resolve,reject){require(amdModules,function(){for(var _len=arguments.length,loadedModules=Array(_len),_key=0;_key<_len;_key++)loadedModules[_key]=arguments[_key];return resolve(loadedModules)},function(err){reject(err)})}):Promise.resolve()};return loadModules(loadBundles?bundles:[]).then(function(){return loadModules(dependencies)}).then(function(loadedModules){return _.forEach(dependencies,function(dependency,index){var module=loadedModules[index],category=_.findKey(modules,function(val){return _.contains(val,dependency)});if("function"==typeof validate&&!validate(module))throw new TypeError("The module '".concat(dependency,"' is not valid"));_.isString(category)&&(loaded[category]=loaded[category]||[],loaded[category].push(module))}),self.getModules()})},getModules:function(category){return _.isString(category)?loaded[category]||[]:_(loaded).values().flatten().uniq().value()},getCategories:function(){return _.keys(loaded)}};return validate=_.isFunction(validate)?validate:_.isPlainObject,_.forEach(requiredModules,function(moduleList,category){if(_.isEmpty(category)||!_.isString(category))throw new TypeError("Modules must belong to a category");if(!_.isArray(moduleList))throw new TypeError("A list of modules must be an array");if(!_.all(moduleList,validate))throw new TypeError("The list does not contain valid modules");loaded[category]=loaded[category]?loaded[category].concat(moduleList):moduleList}),specs&&_(specs).functions().forEach(function(method){loader[method]=function(){return specs[method].apply(loader,[].slice.call(arguments))}}),loader}return _=_&&_.hasOwnProperty("default")?_["default"]:_,Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,moduleLoaderFactory}),define("core/pluginLoader",["lodash","core/moduleLoader"],function(_,moduleLoaderFactory){'use strict';function pluginLoaderFactory(requiredPlugins){return moduleLoaderFactory(requiredPlugins,_.isFunction,{getPlugins:function(category){return this.getModules(category)}})}return _=_&&_.hasOwnProperty("default")?_["default"]:_,moduleLoaderFactory=moduleLoaderFactory&&moduleLoaderFactory.hasOwnProperty("default")?moduleLoaderFactory["default"]:moduleLoaderFactory,pluginLoaderFactory}),define("ui/maths/calculator/core/plugin",["lodash","core/plugin"],function(_,pluginFactory){'use strict';function calculatorPluginFactory(provider,defaultConfig){return pluginFactory(provider,_.defaults({hostName:"calculator"},defaultConfig))}return _=_&&_.hasOwnProperty("default")?_["default"]:_,pluginFactory=pluginFactory&&pluginFactory.hasOwnProperty("default")?pluginFactory["default"]:pluginFactory,calculatorPluginFactory}),define("ui/maths/calculator/plugins/core/degrad",["i18n","util/namespace","ui/maths/calculator/core/plugin"],function(__,nsHelper,pluginFactory){'use strict';__=__&&__.hasOwnProperty("default")?__["default"]:__,nsHelper=nsHelper&&nsHelper.hasOwnProperty("default")?nsHelper["default"]:nsHelper,pluginFactory=pluginFactory&&pluginFactory.hasOwnProperty("default")?pluginFactory["default"]:pluginFactory;var degrad=pluginFactory({name:"degrad",install:function(){var calculator=this.getCalculator();calculator.setCommand("degree",__("Degree"),__("Set the trigonometric function to work in degrees")).setCommand("radian",__("Radian"),__("Set the trigonometric function to work in radians"))},init:function(){function getMathsConfig(){var config=calculator.getConfig();return config.maths||(config.maths={}),config.maths}function setupMathsEvaluator(){var config=calculator.getConfig(),degree=config.maths&&config.maths.degree;calculator.setState("degree",degree).setState("radian",!degree).setupMathsEvaluator()}var calculator=this.getCalculator();setupMathsEvaluator(),calculator.on(nsHelper.namespaceAll("command-degree","degrad"),function(){getMathsConfig().degree=!0,setupMathsEvaluator()}).on(nsHelper.namespaceAll("command-radian","degrad"),function(){getMathsConfig().degree=!1,setupMathsEvaluator()})},destroy:function(){var calculator=this.getCalculator();calculator.deleteCommand("degree").deleteCommand("radian").setState("degree",!1).setState("radian",!1).off(".degrad")}});return degrad}),define("ui/maths/calculator/plugins/core/history",["lodash","i18n","util/namespace","ui/maths/calculator/core/plugin"],function(_,__,nsHelper,pluginFactory){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,__=__&&__.hasOwnProperty("default")?__["default"]:__,nsHelper=nsHelper&&nsHelper.hasOwnProperty("default")?nsHelper["default"]:nsHelper,pluginFactory=pluginFactory&&pluginFactory.hasOwnProperty("default")?pluginFactory["default"]:pluginFactory;var history=pluginFactory({name:"history",install:function(){var calculator=this.getCalculator();calculator.setCommand("historyClear",__("Clear History"),__("Clear history")).setCommand("historyGet",__("Get History"),__("Get the history list")).setCommand("historyUp",__("Previous"),__("Remind the previous expression in the history")).setCommand("historyDown",__("Next"),__("Remind the next expression in the history"))},init:function(){function getCurrentState(){return{expression:calculator.getExpression(),variables:calculator.getVariables(),current:null}}function reset(){current=getCurrentState(),history=[],cursor=0}function getMemoryAt(position){if(0<=position&&position<history.length)return history[position];return position===history.length?current:null}function remind(position){var memory=getMemoryAt(position);cursor===history.length&&position!==cursor?current=getCurrentState():history[cursor].current=calculator.getExpression(),memory&&(cursor=position,memory.variables&&calculator.setVariables(memory.variables),calculator.replace(memory.current||memory.expression),memory.current=null)}function push(){var last=getMemoryAt(history.length-1),memory=getMemoryAt(cursor);last&&calculator.getExpression()===last.expression||history.push(getCurrentState()),memory&&(memory.current=null),cursor=history.length}var calculator=this.getCalculator(),history,cursor,current;reset(),calculator.on(nsHelper.namespaceAll("evaluate","history"),push).on(nsHelper.namespaceAll("command-historyClear command-clearAll destroy","history"),reset).on(nsHelper.namespaceAll("command-historyUp","history"),function(){remind(cursor-1)}).on(nsHelper.namespaceAll("command-historyDown","history"),function(){remind(cursor+1)}).on(nsHelper.namespaceAll("command-historyGet","history"),function(){calculator.trigger("history",_.map(history,"expression"))})},destroy:function(){var calculator=this.getCalculator();calculator.deleteCommand("historyClear").deleteCommand("historyUp").deleteCommand("historyDown").deleteCommand("historyGet").off(".history")}});return history}),define("ui/maths/calculator/plugins/core/remind",["i18n","util/namespace","ui/maths/calculator/core/plugin"],function(__,nsHelper,pluginFactory){'use strict';__=__&&__.hasOwnProperty("default")?__["default"]:__,nsHelper=nsHelper&&nsHelper.hasOwnProperty("default")?nsHelper["default"]:nsHelper,pluginFactory=pluginFactory&&pluginFactory.hasOwnProperty("default")?pluginFactory["default"]:pluginFactory;var varRemindName="mem",varLastName="last",remind=pluginFactory({name:"remind",install:function(){var calculator=this.getCalculator();calculator.setCommand("remind",__("Remind"),__("Remind the recorded value")).setCommand("remindLast",__("Remind Last"),__("Remind the last value")).setCommand("remindStore",__("Store"),__("Store the value a variable")).setCommand("remindClear",__("Clear"),__("Clear the stored variables"))},init:function(){var calculator=this.getCalculator();calculator.on(nsHelper.namespaceAll("evaluate","remind"),function(result){calculator.setVariable(varLastName,result)}).on(nsHelper.namespaceAll("command-remind","remind"),function(){calculator.hasVariable(varRemindName)&&calculator.useVariable(varRemindName)}).on(nsHelper.namespaceAll("command-remindLast","remind"),function(){calculator.hasVariable(varLastName)&&calculator.useVariable(varLastName)}).on(nsHelper.namespaceAll("command-remindStore","remind"),function(){calculator.hasVariable(varLastName)&&calculator.setVariable(varRemindName,calculator.getVariable(varLastName))}).on(nsHelper.namespaceAll("command-remindClear command-clearAll destroy","remind"),function(){calculator.hasVariable(varRemindName)&&calculator.deleteVariable(varRemindName)}).on(nsHelper.namespaceAll("destroy","remind"),function(){calculator.hasVariable(varLastName)&&calculator.deleteVariable(varLastName)})},destroy:function(){var calculator=this.getCalculator();calculator.deleteCommand("remind").deleteCommand("remindLast").deleteCommand("remindStore").deleteCommand("remindClear").off(".remind")}});return remind}),define("ui/maths/calculator/plugins/core/stepNavigation",["i18n","util/namespace","ui/maths/calculator/core/plugin"],function(__,nsHelper,pluginFactory){'use strict';__=__&&__.hasOwnProperty("default")?__["default"]:__,nsHelper=nsHelper&&nsHelper.hasOwnProperty("default")?nsHelper["default"]:nsHelper,pluginFactory=pluginFactory&&pluginFactory.hasOwnProperty("default")?pluginFactory["default"]:pluginFactory;var stepNavigation=pluginFactory({name:"stepNavigation",install:function(){var calculator=this.getCalculator();calculator.setCommand("stepMoveLeft",__("Move Left"),__("Move the cursor one step on the left")).setCommand("stepMoveRight",__("Move Right"),__("Move the cursor one step on the right")).setCommand("stepDeleteLeft",__("Delete Left"),__("Delete the term on the left side of the cursor")).setCommand("stepDeleteRight",__("Delete Right"),__("Delete the term on the right side of the cursor"))},init:function(){function remove(expression,position,length){length&&(expression=calculator.getExpression(),calculator.setExpression(expression.substr(0,position)+expression.substr(position+length)).setPosition(position))}function removeToken(expression,token){var from,length;if(token){for(expression=calculator.getExpression(),from=token.offset,length=token.value.length;from+length<expression.length&&" "===expression.charAt(from+length);)length++;remove(expression,from,length)}}var calculator=this.getCalculator();calculator.on(nsHelper.namespaceAll("command-stepMoveLeft","stepNavigation"),function(){var position=calculator.getPosition(),tokens=calculator.getTokens(),index=calculator.getTokenIndex(),token=calculator.getToken(),offset=position;token&&0<position?position===token.offset&&(0<index?token=tokens[index-1]:token=null):token=null,offset=token?token.offset:0,offset!==position&&calculator.setPosition(offset)}).on(nsHelper.namespaceAll("command-stepMoveRight","stepNavigation"),function(){var expression=calculator.getExpression(),position=calculator.getPosition(),tokens=calculator.getTokens(),index=calculator.getTokenIndex(),token=calculator.getToken(),offset=expression.length;token&&index<tokens.length-1&&(token=tokens[index+1],token&&(offset=token.offset)),offset!==position&&calculator.setPosition(offset)}).on(nsHelper.namespaceAll("command-stepDeleteLeft","stepNavigation"),function(){var expression=calculator.getExpression(),position=calculator.getPosition(),tokens=calculator.getTokens(),index=calculator.getTokenIndex(),token=calculator.getToken();token&&(position>token.offset?removeToken(expression,token):0<index?removeToken(expression,tokens[index-1]):0<position&&remove(expression,0,token.offset))}).on(nsHelper.namespaceAll("command-stepDeleteRight","stepNavigation"),function(){var expression=calculator.getExpression(),position=calculator.getPosition(),token=calculator.getToken();token&&position>=token.offset&&position<token.offset+token.value.length&&removeToken(expression,token)})},destroy:function(){var calculator=this.getCalculator();calculator.deleteCommand("stepMoveLeft").deleteCommand("stepMoveRight").deleteCommand("stepDeleteLeft").deleteCommand("stepDeleteRight").off(".stepNavigation")}});return stepNavigation}),define("ui/maths/calculator/pluginsLoader",["context","core/pluginLoader","ui/maths/calculator/plugins/core/degrad","ui/maths/calculator/plugins/core/history","ui/maths/calculator/plugins/core/remind","ui/maths/calculator/plugins/core/stepNavigation","lodash"],function(context,pluginLoaderFactory,pluginDegradFactory,pluginHistoryFactory,pluginRemindFactory,pluginStepNavigationFactory,_){'use strict';function loadPlugins(loadedPlugins,dynamicPlugins){var defaultPlugins={core:[pluginDegradFactory,pluginHistoryFactory,pluginRemindFactory,pluginStepNavigationFactory]};return pluginLoaderFactory(_.merge({},defaultPlugins,loadedPlugins)).addList(dynamicPlugins).load(context.bundle)}return context=context&&context.hasOwnProperty("default")?context["default"]:context,pluginLoaderFactory=pluginLoaderFactory&&pluginLoaderFactory.hasOwnProperty("default")?pluginLoaderFactory["default"]:pluginLoaderFactory,pluginDegradFactory=pluginDegradFactory&&pluginDegradFactory.hasOwnProperty("default")?pluginDegradFactory["default"]:pluginDegradFactory,pluginHistoryFactory=pluginHistoryFactory&&pluginHistoryFactory.hasOwnProperty("default")?pluginHistoryFactory["default"]:pluginHistoryFactory,pluginRemindFactory=pluginRemindFactory&&pluginRemindFactory.hasOwnProperty("default")?pluginRemindFactory["default"]:pluginRemindFactory,pluginStepNavigationFactory=pluginStepNavigationFactory&&pluginStepNavigationFactory.hasOwnProperty("default")?pluginStepNavigationFactory["default"]:pluginStepNavigationFactory,_=_&&_.hasOwnProperty("default")?_["default"]:_,loadPlugins}),define("css!ui/maths/calculator/css/calculator",[],function(){}),define("ui/maths/calculator/calculatorComponent",["lodash","ui/dynamicComponent","ui/maths/calculator/core/board","ui/maths/calculator/pluginsLoader","css!ui/maths/calculator/css/calculator.css"],function(_,dynamicComponent,calculatorBoardFactory,pluginsLoader){'use strict';var _Mathmin3=Math.min;function calculatorComponentFactory(config){var calculator,calculatorComponent;return calculatorComponent=dynamicComponent({getCalculator:function(){return calculator}},defaultConfig).on("rendercontent",function($content){var self=this;return pluginsLoader(this.getConfig().loadedPlugins,this.getConfig().dynamicPlugins).then(function(loadedPlugins){return new Promise(function(resolve){calculator=calculatorBoardFactory($content,loadedPlugins,self.getConfig().calculator).on("ready",function(){var initialWidth=self.getElement().width(),initialHeight=self.getElement().height(),initialFontSize=parseInt(self.getCalculator().getElement().css("fontSize"),10)||10;self.on("resize",function(){self.getElement()&&self.getCalculator().getElement().css("fontSize",initialFontSize*_Mathmin3(self.getElement().width()/initialWidth,self.getElement().height()/initialHeight))}).setContentSize(calculator.getElement().outerWidth(),calculator.getElement().outerHeight()).setState("ready").trigger("ready"),resolve()})})})}).on("destroy",function(){return new Promise(function(resolve){calculator?calculator.after("destroy",function(){calculator=null,resolve()}).destroy():resolve()})}),_.defer(function(){calculatorComponent.init(config)}),calculatorComponent}_=_&&_.hasOwnProperty("default")?_["default"]:_,dynamicComponent=dynamicComponent&&dynamicComponent.hasOwnProperty("default")?dynamicComponent["default"]:dynamicComponent,calculatorBoardFactory=calculatorBoardFactory&&calculatorBoardFactory.hasOwnProperty("default")?calculatorBoardFactory["default"]:calculatorBoardFactory,pluginsLoader=pluginsLoader&&pluginsLoader.hasOwnProperty("default")?pluginsLoader["default"]:pluginsLoader;var defaultConfig={preserveAspectRatio:!1,width:240,height:360,minWidth:190,minHeight:240,alternativeTemplate:null};return calculatorComponentFactory}),define("ui/maths/calculator/plugins/keyboard/templateKeyboard/templateKeyboard",["jquery","lodash","util/namespace","ui/maths/calculator/core/plugin","ui/maths/calculator/core/labels","handlebars","i18n","lib/dompurify/purify"],function($$1,_,nsHelper,pluginFactory,labels,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,nsHelper=nsHelper&&nsHelper.hasOwnProperty("default")?nsHelper["default"]:nsHelper,pluginFactory=pluginFactory&&pluginFactory.hasOwnProperty("default")?pluginFactory["default"]:pluginFactory,labels=labels&&labels.hasOwnProperty("default")?labels["default"]:labels,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers);var buffer="",stack1;return buffer+="<div class=\"calculator-keyboard\">\n    <div class=\"row\">\n        <button class=\"key operator\" data-command=\"term\" data-param=\"SQRT\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.SQRT),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"LPAR\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.LPAR),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"RPAR\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.RPAR),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key command\" data-command=\"clear\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.CLEAR),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key command\" data-command=\"clearAll\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.CLEARALL),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n    </div>\n    <div class=\"row\">\n        <button class=\"key operator\" data-command=\"term\" data-param=\"CBRT\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.CBRT),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM7\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM7),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM8\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM8),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM9\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM9),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"DIV\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.DIV),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n    </div>\n    <div class=\"row\">\n        <button class=\"key operator\" data-command=\"term\" data-param=\"POW NUM2\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.POW2),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM4\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM4),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM5\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM5),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM6\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM6),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"MUL\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.MUL),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n    </div>\n    <div class=\"row\">\n        <button class=\"key operator\" data-command=\"term\" data-param=\"POW NUM3\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.POW3),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM1\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM1),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM2\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM2),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM3\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM3),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"SUB\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.SUB),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n    </div>\n    <div class=\"row\">\n        <button class=\"key operator\" data-command=\"term\" data-param=\"POW\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.POWY),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM0\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM0),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"DOT\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.DOT),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key execute\" data-command=\"execute\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.EXECUTE),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"ADD\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.SUB),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n    </div>\n</div>",buffer}),pluginName="templateKeyboard",templateKeyboard=pluginFactory({name:pluginName,init:function(){},render:function(){var calculator=this.getCalculator(),areaBroker=calculator.getAreaBroker(),pluginConfig=this.getConfig(),templateConfig=_.merge({labels:labels},pluginConfig);if(!_.isFunction(pluginConfig.layout))throw new TypeError("The keyboard plugin requires a template to render!");this.$layout=$$1(pluginConfig.layout(templateConfig)).on(nsHelper.namespaceAll("click",pluginName),".key",function(){var $key=$$1(this).closest(".key"),command=$key.data("command"),param=$key.data("param");command&&calculator.useCommand(command,param)}),areaBroker.getKeyboardArea().append(this.$layout)},destroy:function(){var calculator=this.getCalculator();this.$layout&&(this.$layout.off("."+pluginName).remove(),this.$layout=null),calculator.off("."+pluginName)}},{layout:function(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}});return templateKeyboard}),define("ui/scroller",["jquery","util/shortcut"],function($,shortcuts){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,shortcuts=shortcuts&&shortcuts.hasOwnProperty("default")?shortcuts["default"]:shortcuts;var ns=".scroller",scrollHelper;scrollHelper={scrollTo:function(element,container,scrollSpeed){return new Promise(function(resolve){var $element=$(element),$container=$(container||$element.parent()),currentScrollTop,scrollTop;$element.length&&$container.length?(currentScrollTop=$container.scrollTop(),scrollTop=$element.offset().top-$container.offset().top+currentScrollTop,scrollTop===currentScrollTop?resolve():$container.animate({scrollTop:scrollTop},scrollSpeed).promise().done(resolve)):resolve()})},disableScrolling:function(){["MouseScrollUp","MouseScrollDown","ArrowUp","ArrowDown"].forEach(function(shortcutName){shortcuts.add(shortcutName+ns,function(e){e.preventDefault()},{prevent:!1})})},enableScrolling:function(){shortcuts.remove(ns)}};var scrollHelper$1=scrollHelper;return scrollHelper$1}),define("ui/maths/calculator/plugins/screen/simpleScreen/simpleScreen",["jquery","lodash","i18n","util/namespace","ui/scroller","ui/maths/calculator/core/terms","ui/maths/calculator/core/expression","ui/maths/calculator/core/plugin","handlebars","lib/dompurify/purify"],function($$1,_,__,nsHelper,scrollHelper,registeredTerms,expressionHelper,pluginFactory,Handlebars,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function historyTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,__=__&&__.hasOwnProperty("default")?__["default"]:__,nsHelper=nsHelper&&nsHelper.hasOwnProperty("default")?nsHelper["default"]:nsHelper,scrollHelper=scrollHelper&&scrollHelper.hasOwnProperty("default")?scrollHelper["default"]:scrollHelper,registeredTerms=registeredTerms&&registeredTerms.hasOwnProperty("default")?registeredTerms["default"]:registeredTerms,expressionHelper=expressionHelper&&expressionHelper.hasOwnProperty("default")?expressionHelper["default"]:expressionHelper,pluginFactory=pluginFactory&&pluginFactory.hasOwnProperty("default")?pluginFactory["default"]:pluginFactory,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",stack1,helper;return buffer+="<div class=\"history-line\">\n    <div class=\"history-expression\">",(helper=helpers.expression)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.expression,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n    <div class=\"history-result\">",(helper=helpers.result)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.result,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>",buffer});Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template$1=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",stack1,helper;return buffer+="<div class=\"calculator-screen simple-screen\">\n    <div class=\"screen-panel history\">",(helper=helpers.history)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.history,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n    <div class=\"screen-panel expression\">",(helper=helpers.expression)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.expression,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>",buffer}),pluginName="simpleScreen",simpleScreen=pluginFactory({name:pluginName,init:function(){function reset(){calculator.replace(calculator.getConfig().expression||"0")}var calculator=this.getCalculator();reset(),calculator.after(nsHelper.namespaceAll("expressionchange",pluginName),function(expression){expression.trim()||_.defer(reset)}).after(nsHelper.namespaceAll("evaluate",pluginName),function(){calculator.replace(registeredTerms.ANS.value)}).on(nsHelper.namespaceAll("clear",pluginName),reset)},render:function(){function autoScroll($container,sel){scrollHelper.scrollTo($container.find(":last-child "+(sel||"")),$container)}function renderExpression(expression){var variables=expressionHelper.roundLastResultVariable(calculator.getVariables(),pluginConfig.decimalDigits);return expressionHelper.render(expression,variables,tokenizer)}function showExpression(tokens){self.controls.$expression.html(renderExpression(tokens)),autoScroll(self.controls.$expression)}var self=this,calculator=this.getCalculator(),areaBroker=calculator.getAreaBroker(),pluginConfig=this.getConfig(),tokenizer=calculator.getTokenizer();if(!_.isFunction(pluginConfig.layout))throw new TypeError("The screen plugin requires a template to render!");this.$layout=$$1(pluginConfig.layout(_.defaults({expression:renderExpression(calculator.getTokens())},pluginConfig))),this.controls={$history:this.$layout.find(".history"),$expression:this.$layout.find(".expression")},calculator.on(nsHelper.namespaceAll("command-clearAll",pluginName),function(){self.controls.$history.empty()}).on(nsHelper.namespaceAll("expressionchange",pluginName),function(){calculator.setState("error",!1),showExpression(calculator.getTokens())}).on(nsHelper.namespaceAll("evaluate",pluginName),function(result){self.controls.$history.html(historyTpl({expression:renderExpression(calculator.getTokens()),result:renderExpression(result)})),autoScroll(self.controls.$history,".history-result")}).after(nsHelper.namespaceAll("evaluate",pluginName),function(result){expressionHelper.containsError(result.value)&&showExpression(result)}).on(nsHelper.namespaceAll("syntaxerror",pluginName),function(){calculator.setState("error",!0),showExpression(calculator.getExpression()+registeredTerms.ERROR.value)}),areaBroker.getScreenArea().append(this.$layout)},destroy:function(){var calculator=this.getCalculator();this.$layout&&(this.$layout.off("."+pluginName).remove(),this.$layout=null),this.controls=null,calculator.off("."+pluginName)}},{layout:function(data,options,asString){var html=Template$1(data,options);return asString||!0?html:$(html)},decimalDigits:5});return simpleScreen}),define("ui/maths/calculator/defaultCalculator",["lodash","ui/maths/calculator/calculatorComponent","ui/maths/calculator/plugins/keyboard/templateKeyboard/templateKeyboard","ui/maths/calculator/plugins/screen/simpleScreen/simpleScreen"],function(_,calculatorComponent,pluginKeyboardFactory,pluginScreenFactory){'use strict';function defaultCalculatorFactory(config){var defaultPluginsConfig={};return config&&config.keyboardLayout&&(defaultPluginsConfig.templateKeyboard={layout:config.keyboardLayout}),config&&config.screenLayout&&(defaultPluginsConfig.simpleScreen={layout:config.screenLayout}),config=_.merge({loadedPlugins:{keyboard:[pluginKeyboardFactory],screen:[pluginScreenFactory]},calculator:{plugins:defaultPluginsConfig}},_.omit(config,["keyboardLayout","screenLayout"])),calculatorComponent(config)}return _=_&&_.hasOwnProperty("default")?_["default"]:_,calculatorComponent=calculatorComponent&&calculatorComponent.hasOwnProperty("default")?calculatorComponent["default"]:calculatorComponent,pluginKeyboardFactory=pluginKeyboardFactory&&pluginKeyboardFactory.hasOwnProperty("default")?pluginKeyboardFactory["default"]:pluginKeyboardFactory,pluginScreenFactory=pluginScreenFactory&&pluginScreenFactory.hasOwnProperty("default")?pluginScreenFactory["default"]:pluginScreenFactory,defaultCalculatorFactory}),define("ui/maths/calculator/basicCalculator",["lodash","ui/maths/calculator/defaultCalculator","handlebars","i18n","lib/dompurify/purify"],function(_,defaultCalculatorFactory,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function keyboardTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function screenTpl(data,options,asString){var html=Template$1(data,options);return asString||!0?html:$(html)}function basicCalculatorFactory(config){return defaultCalculatorFactory(_.merge({calculator:{plugins:{templateKeyboard:{layout:keyboardTpl},simpleScreen:{layout:screenTpl}}}},config))}_=_&&_.hasOwnProperty("default")?_["default"]:_,defaultCalculatorFactory=defaultCalculatorFactory&&defaultCalculatorFactory.hasOwnProperty("default")?defaultCalculatorFactory["default"]:defaultCalculatorFactory,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers);var buffer="",stack1;return buffer+="<div class=\"calculator-keyboard\">\n    <div class=\"row\">\n        <button class=\"key command\" data-command=\"historyUp\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.HISTORYUP),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key command\" data-command=\"historyDown\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.HISTORYDOWN),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key command\" data-command=\"stepDeleteLeft\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.BACKSPACE),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key command\" data-command=\"clear\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.CLEARALL),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n    </div>\n    <div class=\"row\">\n        <button class=\"key operator\" data-command=\"term\" data-param=\"LPAR\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.LPAR),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"RPAR\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.RPAR),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"POW\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.POWY),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"SQRT\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.SQRT),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n    </div>\n    <div class=\"row\">\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM7\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM7),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM8\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM8),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM9\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM9),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"DIV\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.DIV),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n    </div>\n    <div class=\"row\">\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM4\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM4),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM5\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM5),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM6\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM6),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"MUL\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.MUL),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n    </div>\n    <div class=\"row\">\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM1\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM1),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM2\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM2),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM3\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM3),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"SUB\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.SUB),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n    </div>\n    <div class=\"row\">\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM0\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM0),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"DOT\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.DOT),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key execute\" data-command=\"execute\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.EXECUTE),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"ADD\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.ADD),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n    </div>\n</div>",buffer});Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template$1=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",stack1,helper;return buffer+="<div class=\"calculator-screen simple-screen\">\n    <div class=\"screen-panel expression\">",(helper=helpers.expression)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.expression,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>",buffer});return basicCalculatorFactory}),define("ui/maths/calculator/plugins/modifiers/sign",["lodash","i18n","util/namespace","ui/maths/calculator/core/plugin","ui/maths/calculator/core/tokens","ui/maths/calculator/core/terms"],function(_,__,nsHelper,pluginFactory,tokensHelper,registeredTerms){'use strict';function applyStrategies(index,tokens){var result=null;return _.forEach(strategies,function(strategy){return result=strategy(index,tokens),!result}),result}function applySignChange(index,tokens){var token=tokens[index]||null,nextToken=tokens[index+1]||null,type=tokensHelper.getType(token),result=null;return token&&(tokensHelper.isOperator(type)?"SUB"===token.type?result=replaceByPositiveSign(token,index,tokens):"ADD"===token.type?result=replaceByNegativeSign(token):nextToken&&(result=insertNegativeSign(nextToken)):nextToken&&(tokensHelper.isFunction(type)||"LPAR"===token.type)&&(result=insertNegativeSign(nextToken))),result}function acceptExplicitPositive(token){return!token||-1===refuseExplicitPositive.indexOf(token.type)&&!tokensHelper.isFunction(tokensHelper.getType(token))}function insertNegativeSign(token){return{offset:token.offset,length:0,sign:registeredTerms.SUB.value,move:registeredTerms.SUB.value.length}}function replaceByNegativeSign(token){return{offset:token.offset,length:token.value.length,sign:registeredTerms.SUB.value,move:registeredTerms.SUB.value.length-token.value.length}}function replaceByPositiveSign(token,index,tokens){var allowExplicit=index&&acceptExplicitPositive(tokens[index-1]);return{offset:token.offset,length:token.value.length,sign:allowExplicit?registeredTerms.ADD.value:"",move:(allowExplicit?registeredTerms.ADD.value.length:0)-token.value.length}}function splice(str,index,length,sub){return str.substring(0,index)+sub+str.substring(index+length)}_=_&&_.hasOwnProperty("default")?_["default"]:_,__=__&&__.hasOwnProperty("default")?__["default"]:__,nsHelper=nsHelper&&nsHelper.hasOwnProperty("default")?nsHelper["default"]:nsHelper,pluginFactory=pluginFactory&&pluginFactory.hasOwnProperty("default")?pluginFactory["default"]:pluginFactory,tokensHelper=tokensHelper&&tokensHelper.hasOwnProperty("default")?tokensHelper["default"]:tokensHelper,registeredTerms=registeredTerms&&registeredTerms.hasOwnProperty("default")?registeredTerms["default"]:registeredTerms;var refuseExplicitPositive=["LPAR","SUB","ADD","MUL","DIV","MOD","POW","ASSIGN"],strategies=[function(index,tokens){var token=tokens[index]||null,type=tokensHelper.getType(token),result=null;if(tokensHelper.isDigit(type)&&0<=index){for(;index&&tokensHelper.isDigit(type);)index--,token=tokens[index]||null,type=tokensHelper.getType(token);result=tokensHelper.isDigit(type)&&0===index?insertNegativeSign(token):applySignChange(index,tokens)}return result},function(index,tokens){var token=tokens[index]||null,type=tokensHelper.getType(token),result=null;return tokensHelper.isOperator(type)&&0<=index&&("SUB"===token.type?result=replaceByPositiveSign(token,index,tokens):"ADD"===token.type?result=replaceByNegativeSign(token):"FAC"===token.type&&0<index&&(result=applyStrategies(index-1,tokens))),result},function(index,tokens){var token=tokens[index]||null,type=tokensHelper.getType(token),result=null;return tokensHelper.isIdentifier(type)&&0<=index&&(0===index?result=insertNegativeSign(token):result=applySignChange(index-1,tokens)),result},function(index,tokens){var token=tokens[index]||null,type=tokensHelper.getType(token),result=null,count=0;if(tokensHelper.isAggregator(type)&&0<=index){for("RPAR"===token.type&&count++;index&&("LPAR"!==token.type||count);)index--,token=tokens[index]||null,"RPAR"===token.type&&count++,"LPAR"===token.type&&count--;count||"LPAR"!==token.type||(0===index?result=insertNegativeSign(token):result=applySignChange(index-1,tokens))}return result}],sign=pluginFactory({name:"sign",install:function(){var calculator=this.getCalculator();calculator.setCommand("sign",__("Sign change"),__("Change the sign of the current operand"))},init:function(){var calculator=this.getCalculator();calculator.on(nsHelper.namespaceAll("command-sign","sign"),function(){var tokens=calculator.getTokens(),index=calculator.getTokenIndex(),expression=calculator.getExpression(),result;"0"!==expression&&(result=applyStrategies(index,tokens),result&&(expression=splice(expression,result.offset,result.length,result.sign),calculator.replace(expression,calculator.getPosition()+result.move)))})},destroy:function(){var calculator=this.getCalculator();calculator.deleteCommand("sign").off(".sign")}});return sign}),define("ui/maths/calculator/plugins/modifiers/pow10",["i18n","util/namespace","ui/maths/calculator/core/plugin","ui/maths/calculator/core/tokens"],function(__,nsHelper,pluginFactory,tokensHelper){'use strict';__=__&&__.hasOwnProperty("default")?__["default"]:__,nsHelper=nsHelper&&nsHelper.hasOwnProperty("default")?nsHelper["default"]:nsHelper,pluginFactory=pluginFactory&&pluginFactory.hasOwnProperty("default")?pluginFactory["default"]:pluginFactory,tokensHelper=tokensHelper&&tokensHelper.hasOwnProperty("default")?tokensHelper["default"]:tokensHelper;var termsPow10="10^",pow10=pluginFactory({name:"pow10",install:function(){this.getCalculator().setCommand("pow10",__("Power of 10"),__("Multiply the value by 10^x"))},init:function(){function spaceBefore(){return" "===calculator.getExpression().charAt(calculator.getPosition()-1)}function isSeparator(token){return tokensHelper.isFunction(token)||tokensHelper.isSeparator(token)&&"RPAR"!==token.type}var calculator=this.getCalculator();calculator.on(nsHelper.namespaceAll("command-pow10","pow10"),function(){var position=calculator.getPosition(),tokens=calculator.getTokens(),index=calculator.getTokenIndex(),token=tokens[index]||null,prevToken=tokens[index-1]||null,nextToken=tokens[index+1]||null,aligned=!1,expr="*"+termsPow10;token&&(aligned=token.offset===position,"MUL"===token.type?aligned&&(calculator.setPosition(position+token.value.length),aligned=!1):!aligned&&(nextToken||position<token.offset+token.value.length)&&(calculator.setPosition(token.offset),aligned=!0)),1>=tokens.length&&!token||"NUM0"===token.type?calculator.replace(termsPow10):(aligned?(0===index||isSeparator(prevToken))&&(expr=termsPow10):isSeparator(token)&&(expr=termsPow10,tokensHelper.isFunction(token)&&!spaceBefore()&&(expr=" "+expr)),calculator.insert(expr))})},destroy:function(){this.getCalculator().deleteCommand("pow10").off(".pow10")}});return pow10}),define("ui/maths/calculator/scientificCalculator",["lodash","i18n","ui/maths/calculator/defaultCalculator","ui/maths/calculator/plugins/modifiers/sign","ui/maths/calculator/plugins/modifiers/pow10","handlebars","lib/dompurify/purify"],function(_,__,defaultCalculatorFactory,pluginSign,pluginPow10,Handlebars,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function keyboardTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function screenTpl(data,options,asString){var html=Template$1(data,options);return asString||!0?html:$(html)}function scientificCalculator(config){return defaultCalculatorFactory(_.merge({loadedPlugins:{modifiers:[pluginSign,pluginPow10]},calculator:{plugins:{templateKeyboard:{layout:keyboardTpl},simpleScreen:{layout:screenTpl}}}},defaultConfig,config))}_=_&&_.hasOwnProperty("default")?_["default"]:_,__=__&&__.hasOwnProperty("default")?__["default"]:__,defaultCalculatorFactory=defaultCalculatorFactory&&defaultCalculatorFactory.hasOwnProperty("default")?defaultCalculatorFactory["default"]:defaultCalculatorFactory,pluginSign=pluginSign&&pluginSign.hasOwnProperty("default")?pluginSign["default"]:pluginSign,pluginPow10=pluginPow10&&pluginPow10.hasOwnProperty("default")?pluginPow10["default"]:pluginPow10,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers);var buffer="",stack1;return buffer+="<div class=\"calculator-keyboard\">\n    <div class=\"row\">\n        <button class=\"key switch first\" data-command=\"degree\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.DEGREE),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key switch last\" data-command=\"radian\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.RADIAN),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <span class=\"spacer\">",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.SPACER),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span>\n        <span class=\"spacer\">",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.SPACER),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span>\n        <button class=\"key command\" data-command=\"historyUp\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.HISTORYUP),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key command\" data-command=\"historyDown\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.HISTORYDOWN),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key command\" data-command=\"stepDeleteLeft\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.BACKSPACE),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key command\" data-command=\"clear\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.CLEARALL),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n    </div>\n    <div class=\"row\">\n        <button class=\"key operator\" data-command=\"term\" data-param=\"SIN\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.SIN),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"COS\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.COS),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"TAN\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.TAN),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key constant\" data-command=\"term\" data-param=\"PI\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.PI),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"LPAR\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.LPAR),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"RPAR\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.RPAR),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key variable\" data-command=\"var\" data-param=\"ans\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.ANS),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"DIV\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.DIV),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n    </div>\n    <div class=\"row\">\n        <button class=\"key operator\" data-command=\"term\" data-param=\"ASIN\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.ASIN),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"ACOS\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.ACOS),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"ATAN\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.ATAN),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"FAC\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.FAC),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM7\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM7),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM8\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM8),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM9\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM9),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"MUL\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.MUL),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n    </div>\n    <div class=\"row\">\n        <button class=\"key operator\" data-command=\"term\" data-param=\"POW NUM2\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.POW2),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"POW NUM3\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.POW3),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"POW\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.POWY),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"POW SUB NUM1\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.POWMINUSONE),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM4\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM4),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM5\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM5),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM6\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM6),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"SUB\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.SUB),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n    </div>\n    <div class=\"row\">\n        <button class=\"key operator\" data-command=\"term\" data-param=\"SQRT\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.SQRT),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"CBRT\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.CBRT),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"@NTHRT\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NTHRT),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"pow10\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.POW10),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM1\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM1),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM2\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM2),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM3\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM3),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"ADD\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.ADD),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n    </div>\n    <div class=\"row\">\n        <button class=\"key operator\" data-command=\"term\" data-param=\"LOG10\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.LOG),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"LN\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.LN),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"term\" data-param=\"EXP\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.EXPX),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key constant\" data-command=\"term\" data-param=\"E\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.E),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operator\" data-command=\"sign\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.SIGN),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"NUM0\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.NUM0),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key operand\" data-command=\"term\" data-param=\"DOT\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.DOT),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n        <button class=\"key execute\" data-command=\"execute\"><span>",stack1=(stack1=(stack1=depth0&&depth0.labels,null==stack1||!1===stack1?stack1:stack1.EXECUTE),"function"===_typeof2(stack1)?stack1.apply(depth0):stack1),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</span></button>\n    </div>\n</div>",buffer});Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template$1=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",stack1,helper;return buffer+="<div class=\"calculator-screen simple-screen\">\n    <div class=\"screen-panel history\">",(helper=helpers.history)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.history,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n    <div class=\"screen-panel expression\">",(helper=helpers.expression)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.expression,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n</div>",buffer}),defaultConfig={title:__("Scientific Calculator"),width:450,height:400,minWidth:250,minHeight:220};return scientificCalculator}),define("taoQtiTest/runner/plugins/tools/calculator",["jquery","lodash","i18n","ui/hider","ui/calculator","ui/maths/calculator/basicCalculator","ui/maths/calculator/scientificCalculator","util/shortcut","util/namespace","taoTests/runner/plugin"],function($,_,__,hider,calculatorFactory,basicCalculatorFactory,scientificCalculatorFactory,shortcut,namespaceHelper,pluginFactory){'use strict';var defaultCalcConfig={height:380,width:280,top:50,left:10,stackingScope:"test-runner",proportionalResize:!0},bodmasCalcConfig=_.defaults({height:380,width:280},defaultCalcConfig),scientificCalcConfig=_.defaults({width:490,height:420,calculator:{maths:{degree:!0}}},defaultCalcConfig);return pluginFactory({name:"calculator",init:function(){function isEnabled(){var context=testRunner.getTestContext()||{},options=context.options||{};return!!options.calculator||!!options.calculatorBodmas||!!options.calculatorScientific}function togglePlugin(){isEnabled()?self.show():self.hide()}function buildCalculator(calcTpl){var context=testRunner.getTestContext()||{},options=context.options||{},factory,calcConfig;options.calculatorScientific?(factory=scientificCalculatorFactory,calcConfig=scientificCalcConfig,calcConfig.calculator.maths.degree=_.isUndefined(config.degree)?scientificCalcConfig.calculator.maths.degree:config.degree):options.calculatorBodmas?(factory=basicCalculatorFactory,calcConfig=bodmasCalcConfig):(factory=calculatorFactory,calcConfig=defaultCalcConfig),self.calculator=factory(_.defaults({renderTo:self.$calculatorContainer,replace:!0,draggableContainer:areaBroker.getContainer(),alternativeTemplate:calcTpl||null},calcConfig)).on("show",function(){self.trigger("open"),self.button.turnOn()}).on("hide",function(){self.trigger("close"),self.button.turnOff()}).after("render",function(){this.show()})}function toggleCalculator(){!1!==self.getState("enabled")&&(self.calculator?self.calculator.is("hidden")?self.calculator.show():self.calculator.hide():config.template?require(["tpl!"+config.template.replace(/\.tpl$/,"")],function(calcTpl){buildCalculator(calcTpl)},function(){buildCalculator()}):buildCalculator())}var self=this,testRunner=this.getTestRunner(),areaBroker=this.getAreaBroker(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginsConfig=testConfig.plugins||{},config=pluginsConfig.calculator||{},pluginShortcuts=(testConfig.shortcuts||{})[this.getName()]||{};this.button=this.getAreaBroker().getToolbox().createEntry({control:"calculator",title:__("Open Calculator"),icon:"table",text:__("Calculator")}),this.$calculatorContainer=$("<div class=\"widget-calculator\">"),this.calculator=null,this.button.on("click",function(e){$(e.target).closest(".widget-calculator").length||(e.preventDefault(),testRunner.trigger("tool-calculator"))}),testConfig.allowShortcuts&&pluginShortcuts.toggle&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle,this.getName(),!0),function(){testRunner.trigger("tool-calculator")},{avoidInput:!0,allowIn:".widget-calculator"}),togglePlugin(),this.disable(),testRunner.on("loaditem",togglePlugin).on("enabletools renderitem",function(){self.enable()}).on("disabletools unloaditem",function(){self.disable(),self.calculator&&(self.calculator.destroy(),self.calculator=null)}).on("tool-calculator",function(){isEnabled()&&toggleCalculator()})},render:function(){var areaBroker=this.getAreaBroker();areaBroker.getContainer().append(this.$calculatorContainer)},destroy:function(){shortcut.remove("."+this.getName()),this.$calculatorContainer.remove(),this.calculator&&this.calculator.destroy()},enable:function(){this.button.enable()},disable:function(){this.button.disable(),this.calculator&&this.calculator.hide()},show:function(){this.button.show()},hide:function(){this.button.hide(),this.calculator&&this.calculator.hide()}})}),define("tpl!taoQtiTest/runner/plugins/tools/comment/comment",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,helper,options;return buffer+="<div data-control=\"qti-comment\" class=\"hidden\">\n    <textarea data-control=\"qti-comment-text\" placeholder=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Your comment\u2026",options):helperMissing.call(depth0,"__","Your comment\u2026",options)))+"\"></textarea>\n    <button data-control=\"qti-comment-cancel\" class=\"btn-info small\"></span>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Cancel",options):helperMissing.call(depth0,"__","Cancel",options)))+"</button>\n    <button data-control=\"qti-comment-send\" class=\"btn-info small\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Send",options):helperMissing.call(depth0,"__","Send",options)))+"</button>\n</div>",buffer})}),define("taoQtiTest/runner/plugins/tools/comment/comment",["jquery","i18n","taoTests/runner/plugin","ui/hider","ui/stacker","util/shortcut","util/namespace","tpl!taoQtiTest/runner/plugins/tools/comment/comment"],function($,__,pluginFactory,hider,stackerFactory,shortcut,namespaceHelper,commentTpl){'use strict';return pluginFactory({name:"comment",init:function(){function isEnabled(){var context=testRunner.getTestContext();return!!context.options.allowComment}function togglePlugin(){isEnabled()?self.show():self.hide()}function toggleComment(){!1!==self.getState("enabled")&&(hider.toggle(self.$form),hider.isHidden(self.$form)?self.button.turnOff():(self.$input.val("").focus(),self.button.turnOn(),stacker.bringToFront(self.$form)))}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginShortcuts=(testConfig.shortcuts||{})[this.getName()]||{},stacker=stackerFactory("test-runner");this.button=this.getAreaBroker().getToolbox().createEntry({control:"comment",title:__("Leave a comment"),icon:"tag",text:__("Comment")}),this.button.on("render",function(){self.$button=self.button.getElement(),self.$form=$(commentTpl()).appendTo(self.$button),self.$input=self.$button.find("[data-control=\"qti-comment-text\"]"),self.$cancel=self.$button.find("[data-control=\"qti-comment-cancel\"]"),self.$submit=self.$button.find("[data-control=\"qti-comment-send\"]"),stacker.autoBringToFront(self.$form),self.$cancel.on("click",function(){hider.hide(self.$form),self.button.turnOff()}),self.$submit.on("click",function(){var comment=self.$input.val();comment&&(self.disable(),self.button.turnOff(),testRunner.getProxy().callTestAction("comment",{comment:comment}).then(function(){hider.hide(self.$form),self.enable()}).catch(function(){hider.hide(self.$form),self.enable()}))})}),this.button.on("click",function(e){$(e.target).closest("[data-control=\"qti-comment\"]").length||(e.preventDefault(),testRunner.trigger("tool-comment"))}),testConfig.allowShortcuts&&pluginShortcuts.toggle&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle,this.getName(),!0),function(){testRunner.trigger("tool-comment")},{avoidInput:!0}),togglePlugin(),this.disable(),testRunner.on("loaditem",togglePlugin).on("renderitem enabletools",function(){self.enable()}).on("unloaditem disabletools",function(){self.disable()}).on("tool-comment",function(){isEnabled()&&toggleComment()})},destroy:function(){shortcut.remove("."+this.getName())},enable:function(){this.button.enable()},disable:function(){this.$form&&hider.hide(this.$form),this.button.disable(),this.button.turnOff()},show:function(){this.button.show()},hide:function(){this.$form&&hider.hide(this.$form),this.button.hide()}})}),define("core/providerRegistry",["lodash"],function(_){'use strict';return _=_&&_.hasOwnProperty("default")?_["default"]:_,function(target,validator){function registerProvider(name,provider){var valid=!0;if(!_.isString(name)||0>=name.length)throw new TypeError("It is required to give a name to your provider.");if(!_.isPlainObject(provider)||!_.isFunction(provider.init))throw new TypeError("A provider is an object that contains at least an init function.");return valid=validator&&_.isFunction(validator)?validator(provider):valid,valid&&(_providers[name]=provider),this}function getProvider(providerName){var provider;if(!_providers||0===_.size(_providers))throw new Error("No provider registered");if(_.isString(providerName)&&0<providerName.length?provider=_providers[providerName]:1===_.size(_providers)&&(providerName=_.keys(_providers)[0],provider=_providers[providerName]),!provider)throw new Error("No candidate found for the provider");return provider}function getAvailableProviders(){return _.keys(_providers)}var _providers={};return target=target||{},target.registerProvider=registerProvider,target.getProvider=getProvider,target.getAvailableProviders=getAvailableProviders,target.clearProviders=function(){return _providers={},this},target}}),define("ui/documentViewer/viewerFactory",["lodash","core/providerRegistry","core/delegator","ui/component"],function(_,providerRegistry,delegator,component){'use strict';function viewerFactory(documentType,config){var viewer=viewerFactory.getProvider(documentType),documentViewer=component({getType:function(){return this.config.type},getUrl:function(){return this.config.url}},defaults),delegate=delegator(documentViewer,viewer,{name:documentType+"Viewer",eventifier:!1,wrapper:function(response){return Promise.resolve(response)}});return _.isFunction(viewer.getTemplate)&&documentViewer.setTemplate(viewer.getTemplate()),documentViewer.on("init",function(){var self=this;delegate("init").then(function(){self.trigger("initialized")}).catch(function(err){self.trigger("error",err)})}).on("destroy",function(){var self=this;delegate("unload").then(function(){self.trigger("unloaded")}).catch(function(err){self.trigger("error",err)})}).on("render",function(){var self=this;delegate("load").then(function(){self.trigger("loaded")}).catch(function(err){self.trigger("error",err)})}).on("setsize",function(width,height){var self=this;delegate("setSize",width,height).then(function(){self.trigger("resized",width,height)}).catch(function(err){self.trigger("error",err)})}).init(config)}_=_&&_.hasOwnProperty("default")?_["default"]:_,providerRegistry=providerRegistry&&providerRegistry.hasOwnProperty("default")?providerRegistry["default"]:providerRegistry,delegator=delegator&&delegator.hasOwnProperty("default")?delegator["default"]:delegator,component=component&&component.hasOwnProperty("default")?component["default"]:component;var defaults={width:"auto",height:"auto",fitToWidth:!1,allowSearch:!1,caseSensitiveSearch:!1,highlightAllMatches:!1},mandatory=["load"],viewerFactory$1=providerRegistry(viewerFactory,function(provider){return _.each(mandatory,function(name){if(!_.isFunction(provider[name]))throw new TypeError("The viewer provider MUST implement the "+name+"() method!")}),!0});return viewerFactory$1}),define("css!ui/documentViewer/css/documentViewer",[],function(){}),define("ui/documentViewer",["lodash","ui/component","ui/documentViewer/viewerFactory","handlebars","i18n","lib/dompurify/purify","css!ui/documentViewer/css/documentViewer.css"],function(_,component,viewerFactory,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function documentViewerTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function documentViewerFactory(config){var documentType,documentUrl,viewer;return component({getType:function(){return documentType||null},getUrl:function(){return documentUrl||null},getViewer:function(){return viewer||null},load:function(url,type){var self=this;if(_.isEmpty(url)||!_.isString(url))throw new TypeError("You must provide the URL of the document!");if(_.isEmpty(type)||!_.isString(type))throw new TypeError("You must provide a document type!");return viewer&&viewer.destroy(),documentType=type,documentUrl=url,viewer=viewerFactory(documentType,_.merge({type:documentType,url:documentUrl,replace:!0},_.pick(this.config,_.keys(defaults)))).on("loaded",function(){self.trigger("loaded",documentUrl,documentType)}).on("unloaded",function(){self.trigger("unloaded",documentUrl,documentType)}).on("resized",function(width,height){self.trigger("resized",width,height)}).on("error",function(err){self.trigger("error",err)}),this.trigger("load",documentUrl,documentType),this.is("rendered")&&viewer.render(this.getElement()),this},unload:function(){return viewer&&viewer.destroy(),this.trigger("unload",documentUrl,documentType),viewer=null,documentType=null,documentUrl=null,this}},defaults).setTemplate(documentViewerTpl).on("init",function(){viewer=null,documentType=null,documentUrl=null}).on("destroy",function(){this.unload()}).on("render",function(){viewer&&viewer.render(this.getElement())}).on("setsize",function(width,height){viewer&&viewer.setSize(width,height)}).init(config)}_=_&&_.hasOwnProperty("default")?_["default"]:_,component=component&&component.hasOwnProperty("default")?component["default"]:component,viewerFactory=viewerFactory&&viewerFactory.hasOwnProperty("default")?viewerFactory["default"]:viewerFactory,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),"<div class=\"document-viewer\"></div>"}),defaults={width:"auto",height:"auto",fitToWidth:!1,allowSearch:!1,caseSensitiveSearch:!1,highlightAllMatches:!1};return documentViewerFactory.registerProvider=function(type,provider){return viewerFactory.registerProvider(type,provider),this},documentViewerFactory.clearProviders=function(){return viewerFactory.clearProviders(),this},documentViewerFactory}),define("core/requireIfExists",["core/promise"],function(Promise){'use strict';function requireIfExists(uri){return new Promise(function(resolve){require([uri],resolve,function(err){var failedId=err.requireModules&&err.requireModules[0];if(failedId===uri)requirejs.undef(failedId),define(failedId,function(){return null}),require([failedId],resolve);else throw err})})}return Promise=Promise&&Promise.hasOwnProperty("default")?Promise["default"]:Promise,requireIfExists}),define("ui/documentViewer/providers/pdfViewer/fallback/viewer",["handlebars","i18n","lodash","lib/dompurify/purify"],function(Handlebars,__,_,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function viewerTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,_=_&&_.hasOwnProperty("default")?_["default"]:_,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),"<iframe ></iframe>"});return function($container){var template=viewerTpl(),$viewer=null;return{load:function(url){return new Promise(function(resolve){$viewer=$container.html(template).find("iframe"),$viewer.one("load.provider",resolve).attr("src",url)})},unload:function(){$container.empty(),$viewer=null},setSize:function(width,height){$viewer&&$viewer.width(width).height(height)}}}}),define("ui/documentViewer/providers/pdfViewer/pdfjs/areaBroker",["lodash","ui/areaBroker"],function(_,areaBroker$1){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,areaBroker$1=areaBroker$1&&areaBroker$1.hasOwnProperty("default")?areaBroker$1["default"]:areaBroker$1;var areaBroker=_.partial(areaBroker$1,["bar","actions","info","content"]);return areaBroker}),define("ui/documentViewer/providers/pdfViewer/pdfjs/searchEngine",["lodash","handlebars","i18n","lib/dompurify/purify"],function(_,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function matchTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function normalizeSpecialChars(text){return text.replace(normalizationRegex,function(ch){return charactersToNormalize[ch]})}function findInText(query,text){var queryLen=query.length,end=0,matches=[],index;if(queryLen)do index=text.indexOf(query,end),end=index+queryLen,-1!==index&&matches.push([index,end]);while(-1!==index);return matches}function findInDocument(query,contentText,config){var normalizedQuery=normalizeSpecialChars(query);return config.caseSensitive||(normalizedQuery=normalizedQuery.toLowerCase()),_.times(contentText.length,function(pageIndex){var pageContent=normalizeSpecialChars(contentText[pageIndex]);return config.caseSensitive||(pageContent=pageContent.toLowerCase()),findInText(normalizedQuery,pageContent)})}function highlight(text,index,cls){return matchTpl({text:text,index:index,cls:cls}).trim()}function highlightInText(text,start,end,index,cls){return text.substring(0,start)+highlight(text.substring(start,end),index,cls)+text.substring(end)}function refineMatches(matches,pageContent){var refinedMatches=[],textItems=pageContent.content.items,count=textItems.length,cursor=0,strPos=0;return _.forEach(matches,function(match,index){for(var matchStart=match[0],matchEnd=match[1],position={index:index};cursor<count&&matchStart>=strPos+textItems[cursor].str.length;)strPos+=textItems[cursor].str.length,cursor++;for(position.begin={node:cursor,offset:matchStart-strPos};cursor<count&&matchEnd>strPos+textItems[cursor].str.length;)strPos+=textItems[cursor].str.length,cursor++;position.end={node:cursor,offset:matchEnd-strPos},refinedMatches.push(position)}),refinedMatches}function renderMatches(matches,pageContent,selectedMatch){var positions=refineMatches(matches,pageContent),matchIndex=positions.length-1,nodes=pageContent.nodes,selected=matchIndex===selectedMatch;_.forEachRight(nodes,function(node,nodeIndex){for(var nodeText=pageContent.content.items[nodeIndex].str,match,startInNode,endInNode,nodeInMatch,cls;0<=matchIndex;){if(match=positions[matchIndex],startInNode=match.begin.node===nodeIndex,endInNode=match.end.node===nodeIndex,nodeInMatch=nodeIndex>match.begin.node&&nodeIndex<match.end.node,cls=selected?" selected":"",startInNode&&endInNode)nodeText=highlightInText(nodeText,match.begin.offset,match.end.offset,match.index,cls),matchIndex--;else if(startInNode)nodeText=highlightInText(nodeText,match.begin.offset,nodeText.length,match.index,"begin"+cls),matchIndex--;else if(endInNode){nodeText=highlightInText(nodeText,0,match.end.offset,match.index,"end"+cls);break}else if(nodeInMatch){nodeText=highlight(nodeText,match.index,"middle"+cls);break}else break;selected=matchIndex===selectedMatch}node.innerHTML=nodeText})}function pdfjsSearchFactory(config){var textManager=null,currentQuery=null,currentMatch=null,matches=[],pages=[],count=0;if(config=config||{},textManager=config.textManager,!_.isPlainObject(textManager))throw new TypeError("You must provide a textManager to give access to the PDF text content! [config.textManager is missing]");return{getPages:function(){return pages},getMatches:function(){return matches},getMatchCount:function(){return count},clearMatches:function(){currentMatch=null,matches=[],pages=[],count=0},setTextManager:function(manager){textManager=manager},getTextManager:function(){return textManager},getQuery:function(){return currentQuery},getCurrentMatch:function(){return currentMatch},previousMatch:function(){var loop=!1,pageIndex;return currentMatch&&(currentMatch.index?currentMatch.index--:(pageIndex=_.indexOf(pages,currentMatch.page),loop=!pageIndex,currentMatch.page=pages[(pageIndex+pages.length-1)%pages.length],currentMatch.index=matches[currentMatch.page-1].length-1),currentMatch.overall=(currentMatch.overall+count-2)%count+1),loop},nextMatch:function(){var loop=!1,pageIndex;return currentMatch&&(currentMatch.index+1<matches[currentMatch.page-1].length?currentMatch.index++:(pageIndex=_.indexOf(pages,currentMatch.page),loop=pageIndex===pages.length-1,currentMatch.page=pages[(pageIndex+1)%pages.length],currentMatch.index=0),currentMatch.overall=currentMatch.overall%count+1),loop},search:function(query,pageNum){return matches=null,textManager.getContents().then(function(pageContents){var contentText=_.map(pageContents,"text"),firstPage=0,firstMatch=0;return matches=findInDocument(query,contentText,config),currentQuery=query,currentMatch=null,pages=[],count=0,_.forEach(matches,function(pageMatches,pageIndex){var page=pageIndex+1;0<pageMatches.length&&(pages.push(page),!firstPage&&page>=pageNum&&(firstPage=page,firstMatch=count)),count+=pageMatches.length}),firstPage||(firstPage=pages[0]||0),firstPage&&(currentMatch={overall:firstMatch+1,page:firstPage,index:0}),firstPage})},updateMatches:function(pageNum){return textManager.getPageContent(pageNum).then(function(pageContent){var selectedMatch;return currentMatch&&currentMatch.page===pageNum&&(selectedMatch=currentMatch.index),pageContent&&renderMatches(matches[pageNum-1],pageContent,selectedMatch),pageNum})},destroy:function(){textManager=null,currentQuery=null,currentMatch=null,matches=null,pages=null,config=null}}}_=_&&_.hasOwnProperty("default")?_["default"]:_,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<span class=\"highlight ",(helper=helpers.cls)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.cls,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\" data-match=\"",(helper=helpers.index)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.index,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">",(helper=helpers.text)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.text,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n",buffer}),charactersToNormalize={"‘":"'","’":"'","‚":"'","‛":"'","“":"\"","”":"\"","„":"\"","‟":"\"","¼":"1/4","½":"1/2","¾":"3/4"},normalizationRegex=new RegExp("["+Object.keys(charactersToNormalize).join("")+"]","g");return pdfjsSearchFactory}),define("ui/documentViewer/providers/pdfViewer/pdfjs/findBar",["jquery","lodash","ui/autoscroll","ui/hider","ui/documentViewer/providers/pdfViewer/pdfjs/searchEngine","handlebars","i18n","lib/dompurify/purify"],function($$1,_,autoscroll,hider,searchEngineFactory,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function findBarTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function toggleState($element,enabled){enabled?$element.removeAttr("disabled"):$element.attr("disabled",!0)}function pdfjsFindBarFactory(config){function doSearch(){loopBegin=!1,loopEnd=!1,query?searchEngine&&(events.trigger("searching",query),searchEngine.search(query,pageNum).then(function(page){events.trigger("searchdone",query,page),page?jumpTo(page):refresh()}).catch(function(err){events.trigger("error",err)})):(searchEngine&&searchEngine.clearMatches(),refresh()),updateControls()}function updateMatches(page){var textManager=searchEngine&&searchEngine.getTextManager();if(textManager&&textManager.getDocument())return events.trigger("matchesupdating",page),searchEngine.updateMatches(page).then(matchUpdated)}function jumpTo(page){events.trigger("setpage",page)}function refresh(){events.trigger("refresh")}function matchUpdated(page){navigating&&(navigating=!1,focusOnMatch()),updateControls(),events.trigger("matchesupdated",page)}function jumpToMatch(){var match;searchEngine&&(match=searchEngine.getCurrentMatch(),match&&(navigating=!0,pageNum===match.page?updateSelection():jumpTo(match.page)))}function moveBy(direction){loopBegin=!1,loopEnd=!1,searchEngine&&(0>direction?loopEnd=searchEngine.previousMatch():loopBegin=searchEngine.nextMatch(),jumpToMatch()),updateControls(),focusOnInput()}function getSelectectMatchElement(){return broker.getContentArea().find(".highlight.selected")}function getCurrentMatchElement(){var match=searchEngine.getCurrentMatch();return broker.getContentArea().find("[data-match=\""+match.index+"\"]")}function updateSelection(){broker&&searchEngine&&(getSelectectMatchElement().removeClass("selected"),getCurrentMatchElement().addClass("selected"),matchUpdated(pageNum))}function focusOnMatch(){broker&&searchEngine&&autoscroll(getSelectectMatchElement(),broker.getContentArea())}function focusOnInput(){controls.$searchQuery.focus()}function readCaseSensitiveOption(){config.caseSensitive=controls.$caseSensitive.is(":checked")}function applyHighlightAllOption(){broker&&broker.getContentArea().toggleClass("highlight-all",controls.$highlightAll.is(":checked"))}function checkQuery(){var typedQuery=controls.$searchQuery.val();typedQuery!==query&&(query=typedQuery,navigating=!0,doSearch())}function fetchControls($container){return{$searchBar:$$1(".pdf-find-bar",$container),$searchButton:$$1("[data-control=\"pdf-search\"]",$container),$searchQuery:$$1("[data-control=\"pdf-search-query\"]",$container),$prevMatch:$$1("[data-control=\"pdf-search-prev\"]",$container),$nextMatch:$$1("[data-control=\"pdf-search-next\"]",$container),$caseSensitive:$$1("[data-control=\"case-sensitive-search\"]",$container),$highlightAll:$$1("[data-control=\"highlight-all\"]",$container),$matchIndex:$$1("[data-control=\"pdf-search-index\"]",$container),$matchCount:$$1("[data-control=\"pdf-search-count\"]",$container),$searchPosition:$$1("[data-control=\"pdf-search-position\"]",$container),$searchLoopBegin:$$1("[data-control=\"pdf-search-loop-begin\"]",$container),$searchLoopEnd:$$1("[data-control=\"pdf-search-loop-end\"]",$container)}}function updateControls(){var matchCount=0,matchIndex=0,match;searchEngine&&(matchCount=searchEngine.getMatchCount(),match=searchEngine.getCurrentMatch(),matchIndex=match&&match.overall),enabled||hider.isHidden(controls.$searchBar)||hider.hide(controls.$searchBar),toggleState(controls.$searchButton,enabled),toggleState(controls.$searchQuery,enabled),toggleState(controls.$caseSensitive,enabled),toggleState(controls.$highlightAll,enabled),toggleState(controls.$prevMatch,enabled&&1<matchCount),toggleState(controls.$nextMatch,enabled&&1<matchCount),controls.$matchIndex.text(matchIndex),controls.$matchCount.text(matchCount),hider.toggle(controls.$searchPosition,enabled&&0<matchCount),hider.toggle(controls.$searchLoopBegin,enabled&&loopBegin),hider.toggle(controls.$searchLoopEnd,enabled&&loopEnd)}var throttledSearchStart=_.throttle(checkQuery,250),events=null,broker=null,searchEngine=null,query=null,pageNum=0,enabled=!0,loopBegin=!1,loopEnd=!1,navigating=!1,controls;if(config=config||{},!_.isPlainObject(config.events))throw new TypeError("You must provide an events hub! [config.events is missing]");if(!_.isPlainObject(config.areaBroker))throw new TypeError("You must provide an areaBroker to give access to the UI! [config.areaBroker is missing]");if(!_.isPlainObject(config.textManager))throw new TypeError("You must provide a textManager to give access to the PDF text content! [config.textManager is missing]");return searchEngine=searchEngineFactory(config),broker=config.areaBroker,events=config.events,broker.getActionsArea().prepend(findBarTpl(config)),controls=fetchControls(broker.getBarArea()),readCaseSensitiveOption(),applyHighlightAllOption(),controls.$searchButton.on("click",function(){hider.toggle(controls.$searchBar),hider.isHidden(controls.$searchBar)||focusOnInput()}),controls.$prevMatch.on("click",function(){moveBy(-1)}),controls.$nextMatch.on("click",function(){moveBy(1)}),controls.$caseSensitive.on("change",function(){navigating=!0,readCaseSensitiveOption(),doSearch(),focusOnInput()}),controls.$highlightAll.on("change",function(){applyHighlightAllOption(),focusOnInput()}),controls.$searchQuery.on("keypress",function(event){switch(event.keyCode){case 27:hider.hide(controls.$searchBar);break;default:throttledSearchStart();}}),events.on("enable.findbar",function(){enabled=!0,updateControls()}).on("disable.findbar",function(){enabled=!1,updateControls()}).on("pagechange.findbar",function(page){pageNum=page,updateControls()}).on("allrendered.findbar",function(page){pageNum=page,updateMatches(page),updateControls()}).trigger("init.findbar"),{getSearchEngine:function(){return searchEngine},destroy:function(){searchEngine&&searchEngine.destroy(),controls.$searchButton&&controls.$searchButton.remove(),controls.$searchBar&&controls.$searchBar.remove(),controls={},config=null,searchEngine=null,broker=null,events.trigger("destroy.findbar"),events.off(".findbar"),events=null}}}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,autoscroll=autoscroll&&autoscroll.hasOwnProperty("default")?autoscroll["default"]:autoscroll,hider=hider&&hider.hasOwnProperty("default")?hider["default"]:hider,searchEngineFactory=searchEngineFactory&&searchEngineFactory.hasOwnProperty("default")?searchEngineFactory["default"]:searchEngineFactory,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(){return"checked "}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1,helper,options;return buffer+="<button class=\"small search\" data-control=\"pdf-search\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Search",options):helperMissing.call(depth0,"__","Search",options)))+"\"><span class=\"icon icon-find\"></span></button>\n<div class=\"pdf-find-bar hidden\">\n    <label for=\"pdf-search-query\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Search",options):helperMissing.call(depth0,"__","Search",options)))+":</label>\n    <input type=\"text\" id=\"pdf-search-query\" data-control=\"pdf-search-query\" placeholder=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Type your search",options):helperMissing.call(depth0,"__","Type your search",options)))+"\"/>\n    <button class=\"small search\" data-control=\"pdf-search-prev\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Previous match",options):helperMissing.call(depth0,"__","Previous match",options)))+"\"><span class=\"icon icon-left\"></span></button>\n    <button class=\"small search\" data-control=\"pdf-search-next\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Next match",options):helperMissing.call(depth0,"__","Next match",options)))+"\"><span class=\"icon icon-right\"></span></button>\n    <input type=\"checkbox\" id=\"highlight-all\" data-control=\"highlight-all\" value=\"1\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.highlightAll,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/><label for=\"highlight-all\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Highlight all",options):helperMissing.call(depth0,"__","Highlight all",options)))+"</label>\n    <input type=\"checkbox\" id=\"case-sensitive-search\" data-control=\"case-sensitive-search\" value=\"1\" ",stack1=helpers["if"].call(depth0,depth0&&depth0.caseSensitive,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="/><label for=\"case-sensitive-search\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Case sensitive",options):helperMissing.call(depth0,"__","Case sensitive",options)))+"</label>\n    <span class=\"pdf-search-info\" data-control=\"pdf-search-info\">\n        <span class=\"pdf-search-position hidden\" data-control=\"pdf-search-position\">\n            <span class=\"pdf-search-index\" data-control=\"pdf-search-index\"></span>/<span class=\"pdf-search-count\" data-control=\"pdf-search-count\"></span>\n        </span>\n        <span class=\"pdf-search-loop hidden\" data-control=\"pdf-search-loop-begin\">\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"End of document reached. Continuing from the beginning.",options):helperMissing.call(depth0,"__","End of document reached. Continuing from the beginning.",options)))+"\n        </span>\n        <span class=\"pdf-search-loop hidden\" data-control=\"pdf-search-loop-end\">\n            "+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Start of document reached. Continuing from the end.",options):helperMissing.call(depth0,"__","Start of document reached. Continuing from the end.",options)))+"\n        </span>\n    </span>\n</div>\n",buffer});return pdfjsFindBarFactory}),define("ui/documentViewer/providers/pdfViewer/pdfjs/pageView",["jquery","ui/hider","handlebars","i18n","lodash","lib/dompurify/purify"],function($$1,hider,Handlebars,__,_,DOMPurify){'use strict';var _Mathmin4=Math.min,_Mathmax6=Math.max;function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function pageTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function getOutputScale(context){var devicePixelRatio=window.devicePixelRatio||1,backingStoreRatio=context.backingStorePixelRatio||context.webkitBackingStorePixelRatio||context.mozBackingStorePixelRatio||context.msBackingStorePixelRatio||context.oBackingStorePixelRatio||1;return devicePixelRatio/backingStoreRatio}function normalizeScale(scale){return _Mathmin4(_Mathmax6(MIN_SCALE,parseInt(scale,10)||1),10)}function pageViewFactory($container,config){function adjustSize(viewport,fitToWidth){function setSize(w,h){$pageView.width(w).height(h).offset({left:parentOffset.left+_Mathmax6(0,(parentWidth-w)/2)}),$drawLayer.width(w).height(h),$textLayer.width(w).height(h)}var ratio=viewport.width/(viewport.height||1)||1,parentWidth=$container.width(),parentHeight=$container.height(),parentOffset=$container.offset(),width,height;fitToWidth?(width=parentWidth,height=width/ratio,height>parentHeight&&(setSize(_Mathmax6(1,parentWidth/2),height),parentWidth=$container.prop("scrollWidth"),width=parentWidth,height=width/ratio)):1<=ratio?(height=_Mathmin4(parentHeight,parentWidth/ratio),width=_Mathmin4(parentWidth,height*ratio)):(width=_Mathmin4(parentWidth,parentHeight*ratio),height=_Mathmin4(parentHeight,width/ratio)),setSize(width,height),canvas.width=viewport.width,canvas.height=viewport.height}var textManager=null,rendered=!1,view={get pageNum(){return pageNum},set pageNum(num){pageNum=parseInt(num,10),$pageView.attr("data-page",num)},isRendered:function(){return rendered},getContainer:function(){return $container},getElement:function(){return $pageView},getDrawLayerElement:function(){return $drawLayer},getTextLayerElement:function(){return $textLayer},getCanvas:function(){return canvas},getRenderingContext:function(){return context},setTextManager:function(manager){textManager=manager},getTextManager:function(){return textManager},render:function(page,fitToWidth){var promises=[],renderScale=scale*CSS_UNITS,viewport,textViewport,renderContext;return rendered=!1,viewport=page.getViewport(renderScale),renderContext={canvasContext:view.getRenderingContext(),viewport:viewport},adjustSize(viewport,fitToWidth),promises.push(page.render(renderContext).promise),textManager&&($textLayer.empty(),textViewport=viewport.clone({scale:renderScale*$textLayer.width()/viewport.width}),promises.push(textManager.renderPage(page.pageIndex+1,textViewport).then(function(renderedContent){$textLayer&&$textLayer.append(renderedContent)}))),Promise.all(promises).then(function(){rendered=!0})},show:function(){hider.show($pageView)},hide:function(){hider.hide($pageView)},destroy:function(){$pageView.remove(),$container=null,$pageView=null,$textLayer=null,$drawLayer=null,canvas=null,context=null,textManager=null,config=null}},$pageView,$textLayer,$drawLayer,canvas,context,scale,pageNum;return config=config||{},textManager=config.textManager,pageNum=config.pageNum,$pageView=$$1(pageTpl({page:pageNum})),$textLayer=$pageView.find(".pdf-text"),$drawLayer=$pageView.find("canvas"),canvas=$drawLayer.get(0),context=canvas.getContext("2d"),scale=normalizeScale(1*getOutputScale(context)),$container.append($pageView),view}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,hider=hider&&hider.hasOwnProperty("default")?hider["default"]:hider,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,_=_&&_.hasOwnProperty("default")?_["default"]:_,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<div class=\"pdf-page hidden\" data-page=\"",(helper=helpers.page)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.page,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"\">\n    <canvas class=\"pdf-content\"></canvas>\n    <div class=\"pdf-text\"></div>\n</div>\n",buffer}),MIN_SCALE=.25,CSS_UNITS=96/72;return pageViewFactory}),define("ui/documentViewer/providers/pdfViewer/pdfjs/pagesManager",["lodash","ui/documentViewer/providers/pdfViewer/pdfjs/pageView"],function(_,pageViewFactory){'use strict';var _Mathmin5=Math.min,_Mathmax7=Math.max;return _=_&&_.hasOwnProperty("default")?_["default"]:_,pageViewFactory=pageViewFactory&&pageViewFactory.hasOwnProperty("default")?pageViewFactory["default"]:pageViewFactory,function($container,config){var activeView=null,textManager=null,views=null,pagesManager={get pageCount(){return pageCount},getContainer:function(){return $container},setTextManager:function(manager){textManager=manager,_.forEach(views,function(view){view&&view.setTextManager(manager)})},getTextManager:function(){return textManager},getView:function(pageNum){var index,view;return pageNum=_Mathmin5(_Mathmax7(1,parseInt(pageNum,10)||1),pageCount),index=pageNum-1,view=views[index],view||(views[index]=view=pageViewFactory($container,{pageNum:pageNum,textManager:textManager})),view},getActiveView:function(){return activeView},setActiveView:function(page){var oldActiveView=activeView;activeView=pagesManager.getView(page),oldActiveView&&oldActiveView!==activeView&&oldActiveView.hide(),activeView&&(activeView.pageNum=page,activeView.show())},renderPage:function(page,fitToWidth){return activeView?activeView.render(page,fitToWidth):Promise.resolve()},destroy:function(){_.forEach(views,function(view){view&&view.destroy()}),$container=null,activeView=null,textManager=null,views=null,config=null}},pageCount;return config=config||{},textManager=config.textManager,pageCount=_Mathmax7(1,parseInt(config.pageCount,10)||1),views=Array(pageCount),pagesManager}}),define("ui/documentViewer/providers/pdfViewer/pdfjs/textManager",["lodash"],function(_){'use strict';var _Mathmin6=Math.min,_Mathmax8=Math.max;function textManagerFactory(config){function cancelRenderingTask(pageIndex){textRenderTasks&&textRenderTasks[pageIndex]&&(textRenderTasks[pageIndex].cancel(),textRenderTasks[pageIndex]=null)}function cancelAllRenderingTasks(){var pageIndex;if(textRenderTasks)for(pageIndex=textRenderTasks.length;pageIndex--;)cancelRenderingTask(pageIndex)}function getPageTextContent(pageNum){return pdfDoc.getPage(pageNum).then(function(page){return page.getTextContent({normalizeWhitespace:!0})})}function getTextContent(){var numPages=pdfDoc.numPages,promises=[];return _.times(numPages,function(pageIndex){promises.push(getPageTextContent(pageIndex+1).then(function(textContent){var strings=_.map(textContent.items,"str");return{content:textContent,strings:strings,text:strings.join(""),nodes:[]}}))}),Promise.all(promises)}function getPageContents(){var numPages=pdfDoc.numPages,contentPromise;return contentPromise=pageContents?Promise.resolve(pageContents):getTextContent().then(function(content){return textRenderTasks=Array(numPages),pageContents=content,pageContents}),contentPromise}var pdfDoc=null,PDFJS=null,pageContents=null,textRenderTasks=null;if(config=config||{},PDFJS=config.PDFJS,!_.isPlainObject(PDFJS))throw new TypeError("You must provide the entry point to the PDF.js library! [config.PDFJS is missing]");return{setDocument:function(doc){cancelAllRenderingTasks(),pdfDoc=doc,pageContents=null},getDocument:function(){return pdfDoc},getContents:function(){return pdfDoc?getPageContents():Promise.reject(new Error("You must assign a document to get the content from!"))},getText:function(){return this.getContents().then(function(content){return _.map(content,"text")})},getFullText:function(){return this.getContents().then(function(content){return _.map(content,"text").join(" ")})},getPageContent:function(pageNum){return this.getContents().then(function(content){var pageIndex=_Mathmin6(_Mathmax8(0,pageNum-1),content.length-1);return content[pageIndex]})},getPageText:function(pageNum){return this.getContents().then(function(content){var pageIndex=_Mathmin6(_Mathmax8(0,pageNum-1),content.length-1);return content[pageIndex].text})},renderPage:function(pageNum,viewport,timeout){return this.getContents().then(function(content){var pageIndex=_Mathmin6(_Mathmax8(0,pageNum-1),content.length-1),pageContent=content[pageIndex],textLayerFrag=document.createDocumentFragment();return cancelRenderingTask(pageIndex),pageContent.nodes=[],textRenderTasks[pageIndex]=PDFJS.renderTextLayer({textContent:pageContent.content,textDivs:pageContent.nodes,container:textLayerFrag,viewport:viewport,timeout:timeout}),textRenderTasks[pageIndex].promise.then(function(){return textRenderTasks[pageIndex]=null,textLayerFrag},function(){textRenderTasks[pageIndex]=null})})},destroy:function(){cancelAllRenderingTasks(),pdfDoc=null,PDFJS=null,pageContents=null,config=null}}}return _=_&&_.hasOwnProperty("default")?_["default"]:_,textManagerFactory}),define("ui/documentViewer/providers/pdfViewer/pdfjs/wrapper",["lodash","ui/documentViewer/providers/pdfViewer/pdfjs/pagesManager","ui/documentViewer/providers/pdfViewer/pdfjs/textManager"],function(_,pagesManagerFactory,textManagerFactory){'use strict';var _Mathmin7=Math.min,_Mathmax9=Math.max;function base64toBytes(data){for(var raw=window.atob(data),rawLength=raw.length,array=new Uint8Array(new ArrayBuffer(rawLength));rawLength--;)array[rawLength]=raw.charCodeAt(rawLength);return array}function processUri(uri){var base64Index;return uri+="",base64Index=uri.indexOf(";base64,"),0<=base64Index?base64toBytes(uri.substring(base64Index+8)):uri}function pdfjsWrapperFactory($container,config){var pdfDoc=null,pageNum=1,pageCount=1,pageNumPending=null,pageRendering=null,pagesManager=null,textManager=null,states={},PDFJS=null,events=null,wrapper={get wrapped(){return PDFJS},load:function(url){return pdfDoc=null,states={},events.trigger("loading",url),PDFJS.getDocument(processUri(url)).then(function(doc){states.destroyed||(pdfDoc=doc,pageNum=1,pageCount=pdfDoc.numPages,textManager.setDocument(pdfDoc),states.loaded=!0,events.trigger("loaded",url))})},renderPage:function(num){return pdfDoc?(pageRendering?pageNumPending=num:(events.trigger("rendering",num),states.rendered=!1,states.rendering=!0,pageRendering=pdfDoc.getPage(num).then(function(page){if(pagesManager)return pagesManager.renderPage(page,config.fitToWidth).then(function(){var nextPage=pageNumPending;if(pageNumPending=null,pageRendering=null,!states.destroyed){if(states.rendered=!0,states.rendering=!1,events.trigger("rendered",num),null!==nextPage)return wrapper.renderPage(nextPage);events.trigger("allrendered",num)}})})),pageRendering):Promise.resolve(num)},getState:function(name){return!!states[name]},getDocument:function(){return pdfDoc},getPageCount:function(){return pageCount},getPage:function(){return pageNum},setPage:function(page){return pageNum=_Mathmin7(_Mathmax9(1,page||0),pageCount),pagesManager.setActiveView(pageNum),events.trigger("pagechange",pageNum),wrapper.renderPage(pageNum)},getTextManager:function(){return textManager},getPagesManager:function(){return pagesManager},refresh:function(){return events.trigger("refreshing",pageNum),pagesManager.setActiveView(pageNum),wrapper.renderPage(pageNum)},destroy:function(){pagesManager&&pagesManager.destroy(),textManager&&textManager.destroy(),pdfDoc&&pdfDoc.destroy(),states={destroyed:!0},pdfDoc=null,pageNumPending=null,pageRendering=null,pagesManager=null,$container=null,PDFJS=null,config=null,events.trigger("destroy.wrapper"),events=null}};if(config=config||{},PDFJS=config.PDFJS,events=config.events,!_.isPlainObject(PDFJS))throw new TypeError("You must provide the entry point to the PDF.js library! [config.PDFJS is missing]");if(!_.isPlainObject(events))throw new TypeError("You must provide an events hub! [config.events is missing]");return textManager=textManagerFactory({PDFJS:PDFJS}),pagesManager=pagesManagerFactory($container,{pageCount:1,textManager:textManager}),events.on("setpage.wrapper",function(page){wrapper.setPage(page)}).on("refresh.wrapper",function(){wrapper.refresh()}).trigger("init.wrapper"),wrapper}_=_&&_.hasOwnProperty("default")?_["default"]:_,pagesManagerFactory=pagesManagerFactory&&pagesManagerFactory.hasOwnProperty("default")?pagesManagerFactory["default"]:pagesManagerFactory,textManagerFactory=textManagerFactory&&textManagerFactory.hasOwnProperty("default")?textManagerFactory["default"]:textManagerFactory;return pdfjsWrapperFactory}),define("ui/documentViewer/providers/pdfViewer/pdfjs/viewer",["jquery","lodash","core/eventifier","ui/documentViewer/providers/pdfViewer/pdfjs/areaBroker","ui/documentViewer/providers/pdfViewer/pdfjs/findBar","ui/documentViewer/providers/pdfViewer/pdfjs/wrapper","handlebars","i18n","lib/dompurify/purify"],function($$1,_,eventifier,areaBroker,findBarFactory,wrapperFactory,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function viewerTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}function toggleState($element,enabled){enabled?$element.removeAttr("disabled"):$element.attr("disabled",!0)}function pdfjsViewerFactory($container,config){function updateControls(){var page=pdf.getPage(),pageCount=pdf.getPageCount();page!==parseInt(controls.$pageNum.val(),10)&&controls.$pageNum.val(page),toggleState(controls.$pagePrev,enabled&&1<page),toggleState(controls.$pageNext,enabled&&page<pageCount),toggleState(controls.$pageNum,enabled&&1<pageCount)}function enable(){events.trigger("enable")}function disable(){events.trigger("disable")}function refresh(){events.trigger("refresh")}function jumpPage(page){events.trigger("setpage",page)}function movePage(step){jumpPage(pdf.getPage()+step)}var template=viewerTpl(config),events=eventifier(),controls={},broker=null,findBar=null,pdfConfig=null,pdf=null,PDFJS=null,enabled=!0;if(config=config||{},PDFJS=config.PDFJS,pdfConfig=_.merge({events:events},_.pick(config,["PDFJS","fitToWidth"])),!_.isPlainObject(PDFJS))throw new TypeError("You must provide the entry point to the PDF.js library! [config.PDFJS is missing]");return{load:function(url){return $container.html(template),PDFJS.PDFJS.disableRange=!0,events.on("enable",function(){enabled=!0,updateControls()}).on("disable",function(){enabled=!1,updateControls()}).on("loaded",function(){controls.$pageCount.html(pdf.getPageCount()),enable()}).on("pagechange rendered",function(){updateControls()}),broker=areaBroker($container,{bar:$$1(".pdf-bar",$container),actions:$$1(".pdf-actions",$container),info:$$1(".pdf-info",$container),content:$$1(".pdf-container",$container)}),controls={$navigation:$container.find(".navigation"),$pagePrev:$container.find("[data-control=\"pdf-page-prev\"]"),$pageNext:$container.find("[data-control=\"pdf-page-next\"]"),$pageNum:$container.find("[data-control=\"pdf-page-num\"]"),$pageCount:$container.find("[data-control=\"pdf-page-count\"]"),$fitToWidth:$container.find("[data-control=\"fit-to-width\"]")},pdf=wrapperFactory(broker.getContentArea(),pdfConfig),config.allowSearch&&(findBar=findBarFactory({events:events,areaBroker:broker,textManager:pdf.getTextManager(),caseSensitive:config.caseSensitiveSearch,highlightAll:config.highlightAllMatches})),this.setSize($container.width(),$container.height()),controls.$fitToWidth.on("change",function(){pdfConfig.fitToWidth=controls.$fitToWidth.is(":checked"),refresh()}),controls.$navigation.on("click",function(){movePage(parseInt($$1(this).data("direction"),10)||1)}),controls.$pageNum.on("change",function(){jumpPage(parseInt(controls.$pageNum.val(),10)||pdf.getPage())}).on("keydown",function(event){switch(event.keyCode){case 38:movePage(1),event.stopPropagation(),event.preventDefault();break;case 40:movePage(-1),event.stopPropagation(),event.preventDefault();}}),disable(),pdf.load(url)},unload:function(){disable(),findBar&&findBar.destroy(),pdf&&pdf.destroy(),events.removeAllListeners(),$container.empty(),controls={},pdfConfig=null,pdf=null,findBar=null,broker=null},setSize:function(width,height){var contentHeight,$bar,$content;if(pdf)return $bar=broker.getBarArea(),$content=broker.getContentArea(),contentHeight=height-$bar.outerHeight(),$bar.width(width),$content.width(width).height(contentHeight),events.trigger("resized",width,height,contentHeight),pdf.refresh()}}}$$1=$$1&&$$1.hasOwnProperty("default")?$$1["default"]:$$1,_=_&&_.hasOwnProperty("default")?_["default"]:_,eventifier=eventifier&&eventifier.hasOwnProperty("default")?eventifier["default"]:eventifier,areaBroker=areaBroker&&areaBroker.hasOwnProperty("default")?areaBroker["default"]:areaBroker,findBarFactory=findBarFactory&&findBarFactory.hasOwnProperty("default")?findBarFactory["default"]:findBarFactory,wrapperFactory=wrapperFactory&&wrapperFactory.hasOwnProperty("default")?wrapperFactory["default"]:wrapperFactory,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers,partials,data){function program1(depth0,data){var buffer="",helper,options;return buffer+="\n        <input type=\"checkbox\" id=\"fit-to-width\" data-control=\"fit-to-width\" value=\"1\" checked /> <label for=\"fit-to-width\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Fit to width",options):helperMissing.call(depth0,"__","Fit to width",options)))+"</label>\n        ",buffer}this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",helperMissing=helpers.helperMissing,escapeExpression=this.escapeExpression,self=this,stack1,helper,options;return buffer+="<div class=\"pdf-bar\">\n    <div class=\"pdf-actions\">\n        <button class=\"small navigation\" data-control=\"pdf-page-prev\" data-direction=\"-1\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Previous page",options):helperMissing.call(depth0,"__","Previous page",options)))+"\"><span class=\"icon icon-step-backward\"></span><span class=\"text\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Previous",options):helperMissing.call(depth0,"__","Previous",options)))+"</span></button>\n        <button class=\"small navigation\" data-control=\"pdf-page-next\" data-direction=\"1\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Next page",options):helperMissing.call(depth0,"__","Next page",options)))+"\"><span class=\"icon icon-step-forward\"></span><span class=\"text\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Next",options):helperMissing.call(depth0,"__","Next",options)))+"</span></button>\n        ",stack1=helpers["if"].call(depth0,depth0&&depth0.fitToWidth,{hash:{},inverse:self.noop,fn:self.program(1,program1,data),data:data}),(stack1||0===stack1)&&(buffer+=stack1),buffer+="\n    </div>\n    <div class=\"pdf-info\">\n        <label for=\"pdf-page-num\">"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Page",options):helperMissing.call(depth0,"__","Page",options)))+":</label>\n        <input class=\"info\" id=\"pdf-page-num\" data-control=\"pdf-page-num\" value=\"1\" />\n        <label>"+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"of",options):helperMissing.call(depth0,"__","of",options)))+"</label>\n        <span class=\"info\" data-control=\"pdf-page-count\">1</span>\n    </div>\n</div>\n<div class=\"pdf-container\"></div>\n",buffer});return pdfjsViewerFactory}),define("ui/documentViewer/providers/pdfViewer",["lodash","core/requireIfExists","ui/documentViewer/providers/pdfViewer/fallback/viewer","ui/documentViewer/providers/pdfViewer/pdfjs/viewer","handlebars","i18n","lib/dompurify/purify"],function(_,requireIfExists,fallbackFactory,pdfjsFactory,Handlebars,__,DOMPurify){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function Helpers0(hb){hb.registerHelper("__",function(key){return __(key)}),hb.registerHelper("dompurify",function(context){return DOMPurify.sanitize(context)}),hb.registerHelper("join",function(arr,keyValueGlue,fragmentGlue,wrapper){var fragments=[];return keyValueGlue="string"==typeof keyValueGlue?keyValueGlue:void 0,fragmentGlue="string"==typeof fragmentGlue?fragmentGlue:" ",wrapper="string"==typeof wrapper?wrapper:"\"",_.forIn(arr,function(value,key){var fragment="";null!==value||void 0!==value?"boolean"==typeof value?value=value?"true":"false":"object"===_typeof(value)&&(value=_.values(value).join(" ")):value="",void 0!==keyValueGlue&&(fragment+=key+keyValueGlue),fragment+=wrapper+value+wrapper,fragments.push(fragment)}),fragments.join(fragmentGlue)}),hb.registerHelper("for",function(startIndex,stopIndex,increment,options){var ret="";startIndex=parseInt(startIndex),stopIndex=parseInt(stopIndex),increment=parseInt(increment);for(var i=startIndex;i<stopIndex;i+=increment)ret+=options.fn(_.extend({},this,{i:i}));return ret}),hb.registerHelper("equal",function(var1,var2,options){return var1==var2?options.fn(this):options.inverse(this)}),hb.registerHelper("property",function(name,context){return context[name]||""}),hb.registerHelper("includes",function(haystack,needle,options){if(_.contains(haystack,needle))return options.fn(this)})}function viewerTpl(data,options,asString){var html=Template(data,options);return asString||!0?html:$(html)}_=_&&_.hasOwnProperty("default")?_["default"]:_,requireIfExists=requireIfExists&&requireIfExists.hasOwnProperty("default")?requireIfExists["default"]:requireIfExists,fallbackFactory=fallbackFactory&&fallbackFactory.hasOwnProperty("default")?fallbackFactory["default"]:fallbackFactory,pdfjsFactory=pdfjsFactory&&pdfjsFactory.hasOwnProperty("default")?pdfjsFactory["default"]:pdfjsFactory,Handlebars=Handlebars&&Handlebars.hasOwnProperty("default")?Handlebars["default"]:Handlebars,__=__&&__.hasOwnProperty("default")?__["default"]:__,DOMPurify=DOMPurify&&DOMPurify.hasOwnProperty("default")?DOMPurify["default"]:DOMPurify,Helpers0.__initialized||(Helpers0(Handlebars),Helpers0.__initialized=!0);var Template=Handlebars.template(function(Handlebars,depth0,helpers){return this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),"<div class=\"pdf-viewer\"></div>"});return{getTemplate:function(){return viewerTpl},init:function(){this.pdf=null},load:function(){var self=this,$element=this.getElement();return requireIfExists("pdfjs-dist/build/pdf").then(function(pdfjs){var config=_.clone(self.config);return pdfjs?(config.PDFJS=pdfjs,self.pdf=pdfjsFactory($element,config)):self.pdf=fallbackFactory($element,config),self.pdf.load(self.getUrl())}).then(function(){self.setSize($element.width(),$element.height())})},unload:function(){this.pdf&&this.pdf.unload(),this.is("rendered")&&this.getElement().empty(),this.pdf=null},setSize:function(width,height){this.pdf&&this.pdf.setSize(width,height)}}}),define("tpl!taoQtiTest/runner/plugins/tools/documentViewer/panel",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,stack1,helper;return buffer+="<div class=\"document-viewer-plugin hidden\">\n    <div class=\"viewer-overlay\"></div>\n    <div class=\"viewer-panel\">\n        <div class=\"viewer-header\">\n            <span class=\"viewer-title\">",(helper=helpers.title)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.title,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</span>\n            <span class=\"icon icon-close\"></span>\n        </div>\n        <div class=\"viewer-content\">",(helper=helpers.content)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.content,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),(stack1||0===stack1)&&(buffer+=stack1),buffer+="</div>\n        <div class=\"viewer-footer\"></div>\n    </div>\n</div>",buffer})}),define("taoQtiTest/runner/plugins/tools/documentViewer/documentViewer",["jquery","lodash","ui/hider","ui/documentViewer","ui/documentViewer/providers/pdfViewer","taoTests/runner/plugin","tpl!taoQtiTest/runner/plugins/tools/documentViewer/panel"],function($,_,hider,viewerFactory,pdfViewer,pluginFactory,panelTpl){'use strict';function showPanel(plugin){hider.show(plugin.controls.$panel),plugin.trigger("panelshow"),$(window).on("resize."+plugin.getName(),_.debounce(_.partial(resizeViewer,plugin),50))}function hidePanel(plugin){hider.hide(plugin.controls.$panel),plugin.trigger("panelhide"),$(window).off("resize."+plugin.getName())}function hideIfVisible(plugin){var isVisible=!hider.isHidden(plugin.controls.$panel,!0);return isVisible&&hidePanel(plugin),isVisible}function initPanelEvents(plugin){function stopPropagation(e){e.stopImmediatePropagation(),e.stopPropagation()}var namespace="."+plugin.getName(),stopEvents=["click","mousedown","mouseup","touchstart","touchend","keyup","keydow","keypress","scroll","drop"].join(namespace+" ")+namespace,hideViewer=_.partial(hidePanel,plugin);plugin.controls.$overlay.off(namespace).on("click"+namespace,hideViewer).on(stopEvents,stopPropagation),plugin.controls.$panel.off(namespace).on("click"+namespace,".icon-close",hideViewer).on(stopEvents,stopPropagation)}function resizeViewer(plugin){var $content=plugin.controls.$content;plugin.viewer.setSize($content.width(),$content.height())}return viewerFactory.registerProvider("pdf",pdfViewer),pluginFactory({name:"documentViewer",init:function(){function displayViewer(data){!1!==self.getState("enabled")&&(showPanel(self),self.controls.$title.text(data.label),resizeViewer(self),self.viewer.load(data.document,"pdf"))}var self=this,testRunner=this.getTestRunner(),$panel=$(panelTpl());this.controls={$panel:$panel,$overlay:$panel.find(".viewer-overlay"),$title:$panel.find(".viewer-title"),$content:$panel.find(".viewer-content")},this.viewer=viewerFactory({renderTo:this.controls.$content,replace:!0,fitToWidth:!0,allowSearch:!0}),testRunner.on("renderitem enabletools",function(){self.enable()}).on("renderitem",function(){self.getAreaBroker().getContentArea().append(self.controls.$panel).off("."+self.getName()).on("viewDocument."+self.getName(),function(event){var data=event.originalEvent.detail;displayViewer(data)}),initPanelEvents(self)}).on("move",function(){hideIfVisible(self)}).on("skip",function(){hideIfVisible(self)}).on("unloaditem disabletools",function(){self.disable()}).on("tool-documentViewer",function(data){displayViewer(data)})},render:function(){},destroy:function(){this.getAreaBroker().getContentArea().off("."+this.getName()),this.viewer&&this.viewer.destroy(),this.controls.$panel&&this.controls.$panel.remove(),this.viewer=null,this.controls={}},enable:function(){},disable:function(){hideIfVisible(this)},show:function(){},hide:function(){hideIfVisible(this)}})}),define("ui/highlighter",["lodash","jquery"],function(_,$){'use strict';function _typeof(obj){return _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return _typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":_typeof2(obj)},_typeof(obj)}function highlighter(options){function getContainer(){return $(containerSelector).get(0)}function highlightRanges(ranges){ranges.forEach(function(range){var rangeInfos;isRangeValid(range)&&(currentGroupId=getAvailableGroupId(),isWrappable(range.commonAncestorContainer)&&!isWrappingNode(range.commonAncestorContainer.parentNode)?range.surroundContents(getWrapper(currentGroupId)):(rangeInfos={startNode:isElement(range.startContainer)?range.startContainer.childNodes[range.startOffset]:range.startContainer,startNodeContainer:range.startContainer,startOffset:range.startOffset,endNode:isElement(range.endContainer)?range.endContainer.childNodes[range.endOffset-1]:range.endContainer,endNodeContainer:range.endContainer,endOffset:range.endOffset},isWrapping=!1,hasWrapped=!1,wrapTextNodesInRange(range.commonAncestorContainer,rangeInfos))),range.commonAncestorContainer.normalize(),currentGroupId=0,isWrapping=!1,reindexGroups(getContainer()),mergeAdjacentWrappingNodes(getContainer())}),options.clearOnClick&&$(containerSelector+" ."+className).off("click").on("click",clearSingleHighlight)}function isRangeValid(range){var rangeInContainer;try{return rangeInContainer=$.contains(getContainer(),range.commonAncestorContainer)||getContainer().isSameNode(range.commonAncestorContainer),rangeInContainer&&!range.collapsed}catch(e){return!1}}function wrapTextNodesInRange(rootNode,rangeInfos){var childNodes=rootNode.childNodes,currentNode,i;for(i=0;i<childNodes.length&&!hasWrapped;i++)if(currentNode=childNodes[i],currentNode.isSameNode(rangeInfos.startNode)&&(isText(rangeInfos.startNodeContainer)&&0!==rangeInfos.startOffset?(rangeInfos.startNode=currentNode.splitText(rangeInfos.startOffset),rangeInfos.startOffset=0):isWrapping=!0),currentNode.isSameNode(rangeInfos.endNode)&&isText(rangeInfos.endNodeContainer)&&(0===rangeInfos.endOffset?isWrapping=!1:currentNode.splitText(rangeInfos.endOffset)),isText(currentNode)?wrapTextNode(currentNode,currentGroupId):isElement(currentNode)&&wrapTextNodesInRange(currentNode,rangeInfos),currentNode.isSameNode(rangeInfos.endNode)){isWrapping=!1,hasWrapped=!0;break}}function wrapTextNode(node,groupId){isWrapping&&!isWrappingNode(node.parentNode)&&isWrappable(node)&&$(node).wrap($(getWrapper(groupId)))}function reindexGroups(rootNode){var childNodes=rootNode.childNodes,i,currentNode,parent;for(i=0;i<childNodes.length;i++)currentNode=childNodes[i],isWrappable(currentNode)?(parent=currentNode.parentNode,isWrappingNode(parent)?(!1==isWrapping&&currentGroupId++,isWrapping=!0,parent.setAttribute("data-hl-group",currentGroupId)):isWrapping=!1):isElement(currentNode)&&reindexGroups(currentNode)}function mergeAdjacentWrappingNodes(rootNode){var childNodes=rootNode.childNodes,i,currentNode;for(i=0;i<childNodes.length;i++)if(currentNode=childNodes[i],isWrappingNode(currentNode))for(;isWrappingNode(currentNode.nextSibling);)currentNode.firstChild.textContent+=currentNode.nextSibling.firstChild.textContent,currentNode.parentNode.removeChild(currentNode.nextSibling);else isElement(currentNode)&&mergeAdjacentWrappingNodes(currentNode)}function clearHighlights(){$(getContainer()).find("."+className).each(function(){var $wrapped=$(this);$wrapped.replaceWith($wrapped.text())})}function clearSingleHighlight(e){var target=e.target,$wrapped=$(target);$wrapped.replaceWith($wrapped.text())}function buildHighlightIndex(rootNode,highlightIndex){var childNodes=rootNode.childNodes,i,currentNode,nodeInfos,inlineRange,inlineOffset,nodesToSkip;for(i=0;i<childNodes.length;i++)if(currentNode=childNodes[i],isBlacklisted(currentNode))continue;else if(isWrappable(currentNode)&&!isWrappingNode(currentNode.nextSibling))highlightIndex[textNodesIndex]={highlighted:!1},textNodesIndex++;else if(isWrappingNode(currentNode)&&!isWrappable(currentNode.nextSibling))highlightIndex[textNodesIndex]={highlighted:!0,groupId:currentNode.getAttribute("data-hl-group")},textNodesIndex++;else if(isHotNode(currentNode)&&isHotNode(currentNode.nextSibling)){for(nodeInfos={highlighted:!0,inlineRanges:[]},nodesToSkip=-1,inlineOffset=0;currentNode;)isWrappingNode(currentNode)&&(inlineRange={groupId:currentNode.getAttribute("data-hl-group")},isText(currentNode.previousSibling)&&(inlineRange.startOffset=inlineOffset),isText(currentNode.nextSibling)&&(inlineRange.endOffset=inlineOffset+currentNode.textContent.length),nodeInfos.inlineRanges.push(inlineRange)),inlineOffset+=currentNode.textContent.length,currentNode=isHotNode(currentNode.nextSibling)?currentNode.nextSibling:null,nodesToSkip++;i+=nodesToSkip,highlightIndex[textNodesIndex]=nodeInfos,textNodesIndex++}else isElement(currentNode)&&buildHighlightIndex(currentNode,highlightIndex)}function restoreHighlight(rootNode,highlightIndex){var childNodes=rootNode.childNodes,i,currentNode,parent,nodeInfos,nodesToSkip,range,initialChildCount;for(i=0;i<childNodes.length;i++)if(currentNode=childNodes[i],isBlacklisted(currentNode))continue;else isWrappable(currentNode)?(parent=currentNode.parentNode,initialChildCount=parent.childNodes.length,nodeInfos=highlightIndex[textNodesIndex],!0===nodeInfos.highlighted&&(_.isArray(nodeInfos.inlineRanges)?(nodeInfos.inlineRanges.reverse(),nodeInfos.inlineRanges.forEach(function(inlineRange){range=document.createRange(),range.setStart(currentNode,inlineRange.startOffset||0),range.setEnd(currentNode,inlineRange.endOffset||currentNode.textContent.length),range.surroundContents(getWrapper(inlineRange.groupId))})):(range=document.createRange(),range.selectNodeContents(currentNode),range.surroundContents(getWrapper(nodeInfos.groupId))),nodesToSkip=parent.childNodes.length-initialChildCount,i+=nodesToSkip),textNodesIndex++):isElement(currentNode)&&restoreHighlight(currentNode,highlightIndex)}function isWrappingNode(node){return isElement(node)&&"span"===node.tagName.toLowerCase()&&node.className===className}function isWrappable(node){return isText(node)&&!isBlacklisted(node)&&0<node.textContent.trim().length}function isBlacklisted(node){var closestBlackListed=$(node).closest(containersBlackList.join(","));return 0<closestBlackListed.length}function getWrapper(groupId){var wrapper=document.createElement("span");return wrapper.className=className,wrapper.setAttribute("data-hl-group",groupId+""),wrapper}function getAvailableGroupId(){for(var id=currentGroupId||1;0!==$(getContainer()).find("[data-hl-group="+id+"]").length;)id++;return id}function isElement(node){return node&&"object"===_typeof(node)&&node.nodeType===window.Node.ELEMENT_NODE}function isText(node){return node&&"object"===_typeof(node)&&node.nodeType===window.Node.TEXT_NODE}function isHotNode(node){return isWrappingNode(node)||isWrappable(node)}var className=options.className,containerSelector=options.containerSelector,containersBlackList=_.union(defaultBlackList,options.containersBlackList),isWrapping=!1,hasWrapped=!1,currentGroupId,textNodesIndex;return{highlightRanges:highlightRanges,highlightFromIndex:function(highlightIndex){var rootNode=getContainer();rootNode&&(rootNode.normalize(),textNodesIndex=0,restoreHighlight(rootNode,highlightIndex))},getHighlightIndex:function(){var highlightIndex=[],rootNode=getContainer();return rootNode&&(rootNode.normalize(),textNodesIndex=0,buildHighlightIndex(rootNode,highlightIndex)),highlightIndex},clearHighlights:clearHighlights}}_=_&&_.hasOwnProperty("default")?_["default"]:_,$=$&&$.hasOwnProperty("default")?$["default"]:$;var defaultBlackList=["textarea","math","script",".select2-container"];return highlighter}),define("taoQtiTest/runner/plugins/tools/highlighter/highlighter",["lodash","jquery","core/eventifier","ui/highlighter"],function(_,$,eventifier,highlighterFactory){'use strict';function getAllRanges(){var allRanges=[],i;for(i=0;i<selection.rangeCount;i++)allRanges.push(selection.getRangeAt(i));return allRanges}function discardSelection(){setTimeout(function(){selection.removeAllRanges()},250)}var prevSelection=[],selection;if(!window.getSelection)throw new Error("Browser does not support getSelection()");return selection=window.getSelection(),function(options){var enabled=!0,isHighlighting=!1,highlightHelper=highlighterFactory({className:options.className||"txt-user-highlight",containerSelector:options.containerSelector||".qti-itemBody",containersBlackList:options.containersBlackList||[],clearOnClick:!0});return $(document).on("mouseup.highlighter",function(){isHighlighting&&!selection.isCollapsed&&(highlightHelper.highlightRanges(getAllRanges()),discardSelection())}),$(document).on("touchend.highlighter",function(){isHighlighting&&!selection.isCollapsed&&highlightHelper.highlightRanges(getAllRanges())}),/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&$(document).on("selectionchange",function(){isHighlighting||(prevSelection=_.clone(getAllRanges(),!0))}),eventifier({enable:function(){enabled=!0},disable:function(){enabled=!1},isEnabled:function(){return enabled},toggleHighlighting:function(bool){return isHighlighting=bool,isHighlighting?(this.trigger("start"),$(".qti-itemBody").toggleClass("highlighter-cursor",!0)):(this.trigger("end"),$(".qti-itemBody").toggleClass("highlighter-cursor",!1)),this},highlight:function(){isHighlighting?this.toggleHighlighting(!1):selection.isCollapsed?prevSelection[0]&&!prevSelection[0].collapsed?(this.toggleHighlighting(!0),highlightHelper.highlightRanges(prevSelection),this.toggleHighlighting(!1),discardSelection()):this.toggleHighlighting(!0):(this.toggleHighlighting(!0),highlightHelper.highlightRanges(getAllRanges()),this.toggleHighlighting(!1),discardSelection())},restoreIndex:function(index){index&&0<index.length&&highlightHelper.highlightFromIndex(index)},getIndex:function(){return highlightHelper.getHighlightIndex()},clearHighlights:function(){highlightHelper.clearHighlights(),selection.removeAllRanges()},getId:function(){return options.id}})}}),define("taoQtiTest/runner/plugins/tools/highlighter/collection",["lodash","taoQtiTest/runner/plugins/tools/highlighter/highlighter"],function(_,highlighterFactory){'use strict';var highlighters=[];return function(){return{addHighlighter:function(options){var hl=highlighterFactory(options);return highlighters.push(hl),hl},getHighlighterById:function(id){return highlighters.find(function(hl){return hl.getId()===id})},getAllHighlighters:function(){return highlighters},getItemHighlighter:function(){return highlighters[0]},getNonItemHighlighters:function(){return highlighters.slice(1)},getLength:function(){return highlighters.length},empty:function(){return highlighters=[],this}}}}),define("taoQtiTest/runner/plugins/tools/highlighter/plugin",["jquery","lodash","i18n","core/logger","core/promise","taoTests/runner/plugin","util/shortcut","util/namespace","taoQtiTest/runner/helpers/currentItem","taoQtiTest/runner/plugins/tools/highlighter/collection"],function($,_,__,loggerFactory,Promise,pluginFactory,shortcut,namespaceHelper,itemHelper,highlighterCollection){'use strict';return pluginFactory({name:"highlighter",install:function(){var testRunner=this.getTestRunner();testRunner.getTestStore().setVolatile(this.getName())},init:function(){function isPluginEnabled(){var context=testRunner.getTestContext()||{},options=context.options||{};return!!options.highlighter}function togglePlugin(){isPluginEnabled()?self.show():self.hide()}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginShortcuts=(testConfig.shortcuts||{})[this.getName()]||{},hasHighlights=!1,logger=loggerFactory("highlighterPlugin"),highlighters=highlighterCollection();return highlighters.addHighlighter({className:"txt-user-highlight",containerSelector:".qti-itemBody",containersBlackList:[".qti-include"],id:"item-highlighter"}),this.buttonMain=this.getAreaBroker().getToolbox().createEntry({title:__("Highlight Text"),icon:"text-marker",control:"highlight-trigger",text:__("Highlight")}),this.buttonRemove=this.getAreaBroker().getToolbox().createEntry({title:__("Clear all active highlights"),icon:"result-nok",control:"highlight-clear",text:__("Clear Highlights")}),this.buttonMain.on("mousedown",function(e){e.preventDefault(),isPluginEnabled()&&_.forEach(highlighters.getAllHighlighters(),function(instance){instance.isEnabled()&&instance.highlight()})}),this.buttonRemove.on("click",function(e){e.preventDefault(),isPluginEnabled()&&(_.forEach(highlighters.getAllHighlighters(),function(instance){instance.isEnabled()&&instance.clearHighlights()}),testRunner.trigger("clear"))}),testConfig.allowShortcuts&&pluginShortcuts.toggle&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle,this.getName(),!0),function(){isPluginEnabled()&&_.forEach(highlighters.getAllHighlighters(),function(instance){instance.isEnabled()&&instance.highlight()})},{avoidInput:!0,prevent:!0}),this.disable(),function(){return testRunner.getTestStore().getStore(self.getName())}().then(function(highlighterStore){function saveHighlight(itemId,key){var instance,highlightsIndex;return(itemId?(key=itemId,instance=highlighters.getItemHighlighter()):instance=highlighters.getHighlighterById(key),!instance)?Promise.resolve(!1):(highlightsIndex=instance.getIndex(),!!(isPluginEnabled()&&hasHighlights&&key)&&(logger.debug("Saving "+highlightsIndex.length+" highlights for id "+key),highlighterStore.setItem(key,highlightsIndex)))}function saveAll(){var nonItemHighlighters=highlighters.getNonItemHighlighters();return Promise.all(_(nonItemHighlighters).filter(function(instance){return instance.isEnabled()}).map(function(instance){var key=instance.getId();return saveHighlight(null,key)}).value()).then(function(results){var itemId=testRunner.getTestContext().itemIdentifier;return saveHighlight(itemId)&&_.every(results)})}function loadHighlight(itemId,key){var instance;return itemId?(key=itemId,instance=highlighters.getItemHighlighter()):instance=highlighters.getHighlighterById(key),instance?highlighterStore.getItem(key).then(function(index){index&&(logger.debug("Loading "+index.length+" highlights for key "+key),hasHighlights=!0,instance.restoreIndex(index))}).then(function(){instance.on("end.save",function(){return saveHighlight(itemId,key)})}):Promise.resolve(!1)}testRunner.on("loaditem",togglePlugin).on("enabletools renderitem",function(){self.enable()}).on("renderitem",function(){var itemId=testRunner.getTestContext().itemIdentifier,textStimuli;itemId&&isPluginEnabled()&&(hasHighlights=!1,highlighters.getItemHighlighter().enable(),loadHighlight(itemId),textStimuli=itemHelper.getTextStimuliHrefs(testRunner),_.forEach(textStimuli,function(textStimulusHref){var stimHighlighter=highlighters.getHighlighterById(textStimulusHref);stimHighlighter||(stimHighlighter=highlighters.addHighlighter({className:"txt-user-highlight",containerSelector:".qti-include[data-href=\""+textStimulusHref+"\"]",id:textStimulusHref})),stimHighlighter.enable(),loadHighlight(null,textStimulusHref)}))}).after("renderitem",function(){_.forEach(highlighters.getAllHighlighters(),function(instance){instance.isEnabled()&&instance.on("start",function(){self.buttonMain.turnOn(),self.trigger("start"),hasHighlights=!0}).on("end",function(){self.buttonMain.turnOff(),self.trigger("end")})})}).after("clear.highlighter",function(){saveAll()}).before("skip move timeout",function(){return saveAll()}).on("disabletools unloaditem",function(){self.disable(),isPluginEnabled()&&_.forEach(highlighters.getAllHighlighters(),function(instance){instance.isEnabled()&&instance.off("end.save").toggleHighlighting(!1).disable()})})})},destroy:function(){shortcut.remove("."+this.getName()),$(document).off(".highlighter")},enable:function(){this.buttonMain.enable(),this.buttonRemove.enable()},disable:function(){this.buttonMain.disable(),this.buttonRemove.disable()},show:function(){this.buttonMain.show(),this.buttonRemove.show()},hide:function(){this.buttonMain.hide(),this.buttonRemove.hide()}})}),define("ui/themes",["lodash","module"],function(_,module){'use strict';_=_&&_.hasOwnProperty("default")?_["default"]:_,module=module&&module.hasOwnProperty("default")?module["default"]:module;var themesConfig;return{getConfig:function(){var initialConfig;return themesConfig||(initialConfig=module.config(),themesConfig=_.cloneDeep(initialConfig)),themesConfig},getDefaultNamespacePrefix:function(){return"items"},get:function(what,ns){var config=this.getConfig();if(ns?what+="_"+ns:config.activeNamespace&&config[what+"_"+config.activeNamespace]&&(what+="_"+config.activeNamespace),_.isPlainObject(config[what]))return config[what]},getAvailable:function(what,ns){var available=[],themes=this.get(what,ns);return themes&&_.isArray(themes.available)&&(available=themes.available),available},getActiveNamespace:function(){return this.getConfig().activeNamespace},setActiveNamespace:function(ns){this.getConfig().activeNamespace=ns},getCurrentThemeData:function(what){var themeNamespace=this.getActiveNamespace();return what||(what=this.getDefaultNamespacePrefix()),this.get(what,themeNamespace)}}}),define("ui/themeLoader",["jquery","lodash"],function($,_){'use strict';$=$&&$.hasOwnProperty("default")?$["default"]:$,_=_&&_.hasOwnProperty("default")?_["default"]:_;var $container=$("head").length?$("head"):$("body"),triggerThemeChange=function(themeId){_.delay(function(){$(document).trigger("themechange."+"themeloader",[themeId])},200)},createStyleSheet=function(theme){var type="base"===theme.id?"custom-theme-base":"custom-theme-theme";return $("<link>").attr({rel:"stylesheet",type:"text/css",href:theme.path,"data-type":type,"data-name":theme.name||theme.id,"data-id":theme.id})},getLink=function(id){return $("link[data-id=\""+id+"\"][data-type^=\""+"custom-theme-"+"\"]",$container)},isAttached=function(id){return 0<getLink(id).length},enable=function($nodes){$nodes.prop("disabled",!1).removeProp("disabled").removeAttr("disabled")},disable=function($nodes){return $nodes.prop("disabled",!0).attr("disabled",!0)},themeLoader=function(config){var styles={},defaultTheme,activeTheme,themes,i;if(!_.isPlainObject(config))throw new TypeError("Theme loader configuration is required");if(!_.isString(config.base))throw new TypeError("Theme loader configuration is an object with a base property configuration");if(!_.isArray(config.available)||!config.available.length)throw new TypeError("No theme declared in the configuration");for(i in config.available)if(!_.isPlainObject(config.available[i])||_.isEmpty(config.available[i].id)||_.isEmpty(config.available[i].path))throw new TypeError("There is a theme that does not contain an id or a path");return defaultTheme=config.default||_.first(_.pluck(config.available,"id")),activeTheme=defaultTheme,themes=[{id:"base",path:config.base,name:"TAO"}],themes=themes.concat(config.available),_.forEach(themes,function(theme){styles[theme.id]=isAttached(theme.id)?getLink(theme.id):createStyleSheet(theme)}),{load:function(preload){return _.forEach(styles,function($link,id){isAttached(id)||(!preload&&id===activeTheme&&$link.on("load",function(){triggerThemeChange(id)}),disable($link),$container.append($link)),preload||("base"!==id&&id!==defaultTheme?disable($link):(enable($link),activeTheme=id,triggerThemeChange(activeTheme)))}),this},unload:function(){return disable($("link[data-type^=\"custom-theme-\"]",$container)),this},change:function(id){return _.contains(["base","default"],id)&&!isAttached(id)&&(id=defaultTheme),isAttached(id)&&(disable($("link[data-type=\"custom-theme-theme\"]",$container)),enable(getLink(id)),activeTheme=id,triggerThemeChange(activeTheme)),this},getActiveTheme:function(){return activeTheme}}};return themeLoader}),define("taoQtiTest/runner/plugins/tools/itemThemeSwitcher/itemThemeSwitcher",["jquery","lodash","i18n","taoTests/runner/plugin","ui/hider","ui/themes","util/shortcut","util/namespace","ui/themeLoader"],function($,_,__,pluginFactory,hider,themeHandler,shortcut,namespaceHelper,themeLoader){'use strict';return pluginFactory({name:"itemThemeSwitcher",install:function(){this.getTestRunner().getTestStore().setVolatile(this.getName())},init:function(){function isPluginAllowed(){return themesConfig&&1<_.size(themesConfig.available)}function changeTheme(themeId){var $qtiItem=$(".qti-item"),previousTheme=state.selectedTheme;state.selectedTheme=themeId,$qtiItem&&_.defer(function(){$qtiItem.trigger("themechange",[state.selectedTheme])}),self.storage&&self.storage.setItem("itemThemeId",themeId),previousTheme!==state.selectedTheme&&testRunner.trigger("themechange",state.selectedTheme,previousTheme),allMenuEntries.forEach(function(menuEntry){menuEntry.getId()===themeId?menuEntry.turnOn():menuEntry.turnOff()})}var self=this,pluginName=this.getName(),testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginShortcuts=(testConfig.shortcuts||{})[this.getName()]||{},pluginConfig=self.getConfig(),oldNamespace=themeHandler.getActiveNamespace(),themesConfig={},state={availableThemes:[],defaultTheme:"",selectedTheme:""},allMenuEntries=[];return pluginConfig.activeNamespace&&themeHandler.setActiveNamespace(pluginConfig.activeNamespace),themesConfig=themeHandler.get("items")||{},pluginConfig.activeNamespace===oldNamespace||_.isEmpty(themesConfig)||function(){var themeConfig=themeHandler.get("items");themeLoader(themeConfig).load(),state.selectedTheme?changeTheme(state.selectedTheme):changeTheme(themeConfig.default)}(),themesConfig&&(themesConfig.default&&(state.defaultTheme=themesConfig.default,state.selectedTheme=themesConfig.default),themesConfig.available&&_.forEach(themesConfig.available,function(theme){state.availableThemes.push({id:theme.id,label:theme.name})})),this.menuButton=this.getAreaBroker().getToolbox().createMenu({control:"color-contrast",title:__("Change the current color preset"),icon:"contrast",text:__("Contrast")}).on("click",function(e){e.preventDefault(),testRunner.trigger("tool-themeswitcher-toggle")}).on("openmenu",function(){testRunner.trigger("plugin-open."+pluginName,state.selectedTheme)}).on("closemenu",function(){testRunner.trigger("plugin-close."+pluginName,state.selectedTheme)}),state.availableThemes.forEach(function(theme){var themeEntry=self.getAreaBroker().getToolbox().createEntry({control:theme.id,title:theme.label,icon:"preview",text:__(theme.label)});themeEntry.setMenuId("color-contrast"),themeEntry.on("click",function(e){var themeId=this.config.control;e.preventDefault(),self.menuButton.turnOffAll(),this.turnOn(),changeTheme(themeId)}),state.defaultTheme===theme.id&&themeEntry.on("render",function(){this.turnOn()}),allMenuEntries.push(themeEntry)}),testConfig.allowShortcuts&&pluginShortcuts.toggle&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle,this.getName(),!0),function(){testRunner.trigger("tool-themeswitcher-toggle")},{avoidInput:!0}),isPluginAllowed()||this.hide(),this.disable(),testRunner.on("loaditem",function(){isPluginAllowed()?self.show():self.hide()}).on("renderitem",function(){self.enable(),changeTheme(state.selectedTheme)}).on("enabletools",function(){self.enable()}).on("disabletools unloaditem",function(){self.disable()}).on("tool-themeswitcher-toggle",function(){!1!==self.getState("enabled")&&self.menuButton.toggleMenu()}),testRunner.getPluginStore(this.getName()).then(function(itemThemesStore){self.storage=itemThemesStore,self.storage.getItem("itemThemeId").then(function(itemThemeId){itemThemeId&&state.selectedTheme!==itemThemeId&&changeTheme(itemThemeId)})})},destroy:function(){shortcut.remove("."+this.getName())},enable:function(){this.menuButton.enable()},disable:function(){this.menuButton.disable()},show:function(){this.menuButton.show()},hide:function(){this.menuButton.hide()}})}),define("ui/component/placeable",["lodash","ui/transformer"],function(_,transformer){'use strict';function makePlaceable(component,config){return _.assign(component,placeableComponent),component.off(".makePlaceable").on("init.makePlaceable",function(){_.defaults(this.config,config||{},defaultConfig)}).on("render.makePlaceable",function(){var $element=this.getElement();$element.css({position:"absolute"}),this.resetPosition()})}_=_&&_.hasOwnProperty("default")?_["default"]:_,transformer=transformer&&transformer.hasOwnProperty("default")?transformer["default"]:transformer;var defaultConfig={initialX:0,initialY:0},placeableComponent={_translate:function(xOffsetAbsolute,yOffsetAbsolute){var $element=this.getElement();transformer.translateXY($element,xOffsetAbsolute,yOffsetAbsolute),this._translateX=xOffsetAbsolute,this._translateY=yOffsetAbsolute,this._x=xOffsetAbsolute+this.config.initialX,this._y=yOffsetAbsolute+this.config.initialY,this.trigger("move",this._x,this._y)},center:function(){var $container=this.getContainer(),$element=this.getElement(),centerX,centerY;return this.is("rendered")&&!this.is("disabled")&&$container.length&&(centerX=$container.width()/2-$element.width()/2,centerY=$container.height()/2-$element.height()/2,this.moveTo(centerX,centerY),this.trigger("center",centerX,centerY)),this},moveBy:function(xOffsetRelative,yOffsetRelative){var xOffsetAbsolute,yOffsetAbsolute;return this.is("rendered")&&!this.is("disabled")&&(xOffsetAbsolute=this._translateX+xOffsetRelative,yOffsetAbsolute=this._translateY+yOffsetRelative,this._translate(xOffsetAbsolute,yOffsetAbsolute)),this},moveTo:function(x,y){var xOffsetAbsolute,yOffsetAbsolute;return this.is("rendered")&&!this.is("disabled")&&(xOffsetAbsolute=x-this.config.initialX,yOffsetAbsolute=y-this.config.initialY,this._translate(xOffsetAbsolute,yOffsetAbsolute)),this},moveToX:function(x){return this.moveTo(x,this._y)},moveToY:function(y){return this.moveTo(this._x,y)},resetPosition:function(){var $element=this.getElement();return this.is("rendered")&&($element.css({left:this.config.initialX,top:this.config.initialY}),this._translate(0,0)),this},getPosition:function(){var position;return this.is("rendered")&&(position={x:this._x||0,y:this._y||0}),position}};return makePlaceable.isPlaceable=function(component){return Object.keys(placeableComponent).every(function(method){return"function"==typeof component[method]})},makePlaceable}),define("ui/component/draggable",["lodash","interact","ui/component/placeable"],function(_,interact,makePlaceable){'use strict';var _Mathround2=Math.round;function makeDraggable(component,config){return makePlaceable.isPlaceable(component)||makePlaceable(component),component.off(".makeDraggable").on("init.makeDraggable",function(){_.defaults(this.config,config||{})}).on("render.makeDraggable",function(){var self=this,$element=this.getElement(),element=$element[0],rootNode=document.querySelector("html");this.config.dragRestriction||(this.config.dragRestriction=this.getContainer()[0]),interact(element).draggable({autoScroll:!0,restrict:{restriction:this.config.dragRestriction,elementRect:{left:0,right:1,top:0,bottom:1}},onmove:function(event){var xOffset=_Mathround2(event.dx),yOffset=_Mathround2(event.dy);self.moveBy(xOffset,yOffset),self.trigger("dragmove",xOffset,yOffset)}}).on("dragstart",function(){self.setState("moving",!0),self.trigger("dragstart")}).on("dragend",function(){self.setState("moving",!1),self.trigger("dragend")}),$element.off(".makeDraggable").on("click.makeDraggable",function(){_.delay(function(){self.is("sizing")||self.is("moving")||!rootNode||(rootNode.style.cursor="default")},25)})})}return _=_&&_.hasOwnProperty("default")?_["default"]:_,interact=interact&&interact.hasOwnProperty("default")?interact["default"]:interact,makePlaceable=makePlaceable&&makePlaceable.hasOwnProperty("default")?makePlaceable["default"]:makePlaceable,makeDraggable}),define("ui/component/resizable",["lodash","interact","ui/component/placeable"],function(_,interact,makePlaceable){'use strict';var _Mathmin8=Math.min,_Mathmax10=Math.max;function makeResizable(component,config){return _.assign(component,resizableComponent),makePlaceable.isPlaceable(component)||makePlaceable(component),component.off(".makeResizable").on("init.makeResizable",function(){_.defaults(this.config,config||{},defaultConfig)}).on("render.makeResizable",function(){var self=this,$element=this.getElement(),element=$element[0];this.config.resizeRestriction||(this.config.resizeRestriction=this.getContainer()[0]),interact(element).resizable({autoScroll:!0,restrict:{restriction:this.config.resizeRestriction},edges:this.config.edges}).on("resizemove",function(event){self.resizeTo(event.rect.width,event.rect.height,event.edges.left,event.edges.top)}).on("resizestart",function(){self.setState("sizing",!0),self.trigger("resizestart")}).on("resizeend",function(){self.setState("sizing",!1),self.trigger("resizeend")})})}_=_&&_.hasOwnProperty("default")?_["default"]:_,interact=interact&&interact.hasOwnProperty("default")?interact["default"]:interact,makePlaceable=makePlaceable&&makePlaceable.hasOwnProperty("default")?makePlaceable["default"]:makePlaceable;var defaultConfig={minWidth:50,minHeight:50,edges:{left:!0,right:!0,bottom:!0,top:!0}},resizableComponent={_getCappedValue:function(value,min,max){var capped=value;return _.isUndefined(max)||_.isNull(max)||(capped=_Mathmin8(capped,max)),_.isUndefined(min)||_.isNull(min)||(capped=_Mathmax10(capped,min)),capped},resizeTo:function(newWidth,newHeight,resizeFromLeft,resizeFromTop){var shouldMove=!1,currentSize,newX,newY,rightX,bottomY,position;return this.is("rendered")&&!this.is("disabled")&&(this.trigger("beforeresize",newWidth,newHeight,resizeFromLeft,resizeFromTop),currentSize=this.getSize(),newWidth=this._getCappedValue(newWidth,this.config.minWidth,this.config.maxWidth),newHeight=this._getCappedValue(newHeight,this.config.minHeight,this.config.maxHeight),position=this.getPosition(),resizeFromLeft&&newWidth!==currentSize.width&&(rightX=position.x+currentSize.width,newX=rightX-newWidth,shouldMove=!0),resizeFromTop&&newHeight!==currentSize.height&&(bottomY=position.y+currentSize.height,newY=bottomY-newHeight,shouldMove=!0),shouldMove&&this.moveTo(newX||position.x,newY||position.y),this.setSize(newWidth,newHeight),position=this.getPosition(),this.trigger("resize",newWidth,newHeight,resizeFromLeft,resizeFromTop,position.x,position.y)),this}};return makeResizable}),define("taoQtiTest/runner/plugins/tools/lineReader/compoundMask",["jquery","lodash","core/statifier","core/eventifier","ui/component","ui/component/placeable","ui/component/draggable","ui/component/resizable","ui/component/stackable"],function($,_,statifier,eventifier,componentFactory,makePlaceable,makeDraggable,makeResizable,makeStackable){'use strict';var defaultDimensions={outerWidth:600,outerHeight:400,innerWidth:500,innerHeight:20},defaultPosition={outerX:0,outerY:0,innerX:50,innerY:50},defaultOptions={dragMinWidth:10,dragMinHeight:10,resizeHandleSize:10,innerDragHeight:20},stackingOptions={stackingScope:"test-runner"},constrains;return function(options,dimensions,position){function createMask(maskConfig){var maskAPI={place:maskConfig.place,placeOverlay:maskConfig.placeOverlay,styleResizableEdges:function(){var $element=this.getElement();_.forOwn(this.config.edgesBorders,function(isResizable,edgeId){isResizable&&$element.addClass("border-"+edgeId)})},addResizeControll:function(){var $element=this.getElement(),$resizeControll=$("<div>",{class:"resize-control"});$element.append($resizeControll)}},mask;return mask=componentFactory(maskAPI,maskConfig),makeResizable(mask),makeStackable(mask,stackingOptions),mask.on("render",function(){var $element=this.getElement();this.styleResizableEdges(),this.config.resizeControll&&this.addResizeControll(),$element.addClass("line-reader-mask "+maskConfig.id).on("mousedown touchstart",function(){bringAllToFront()})}).on("resizestart",function(){innerDrag.hide(),closer.hide(),invokeOnOverlays("hide"),invokeOnMasks("setState",["resizing",!0]),this.setState("resizer",!0)}).on("beforeresize",maskConfig.beforeResize||_.noop).on("resize",maskConfig.onResize||_.noop).on("resizeend",function(){applyTransformsToOverlays(),applyTransformsToInnerDrag(),applyTransformsToCloser(),invokeOnMasks("setState",["resizing",!1]),invokeOnOverlays("show"),innerDrag.show(),closer.show(),this.setState("resizer",!1)}).init()}function createOverlay(overlayConfig){var overlay;return overlay=componentFactory({transformOverlay:function(){var $element=this.getElement();this._sizeBackup=this.getSize(),this._posBackup=this.getPosition(),this.setSize(dimensions.outerWidth,dimensions.outerHeight).moveTo(position.outerX,position.outerY),$element.addClass("moving"),this.setState("transformed",!0)},restoreOverlay:function(){var $element=this.getElement();this.is("transformed")&&(this.setSize(this._sizeBackup.width,this._sizeBackup.height).moveTo(this._posBackup.x,this._posBackup.y),$element.removeClass("moving"),this._sizeBackup=null,this._posBackup=null,this.setState("transformed",!1))},appendVisualGuides:function(){var $element=this.getElement();$element.append(visualGuides.$maskBg),$element.append(visualGuides.$innerWindow),visualGuides.$maskBg.css({width:dimensions.outerWidth-2,height:dimensions.outerHeight-2,"border-top-width":dimensions.topHeight-2,"border-right-width":dimensions.rightWidth-2,"border-bottom-width":dimensions.bottomHeight-2,"border-left-width":dimensions.leftWidth-2}),visualGuides.$innerWindow.css({width:dimensions.innerWidth,height:dimensions.innerHeight,left:dimensions.leftWidth-2,top:dimensions.topHeight-2})},removeVisualGuides:function(){visualGuides.$maskBg.remove(),visualGuides.$innerWindow.remove()}},overlayConfig),makeDraggable(overlay),makeStackable(overlay,stackingOptions),overlay.on("render",function(){var self=this,$element=this.getElement(),pointerEventsPrefix=window.PointerEvent?"pointer":"mouse",$moveIcon=$("<div>",{class:"icon icon-mobile-menu"});$element.addClass("line-reader-overlay "+overlayConfig.id).on(pointerEventsPrefix+"down touchstart",function(){bringAllToFront(),self.transformOverlay()}).on(pointerEventsPrefix+"up touchend",function(){self.restoreOverlay()}).prepend($moveIcon)}).on("dragstart",function(){innerDrag.hide(),closer.hide(),invokeOnMasks("hide"),this.appendVisualGuides()}).on("dragmove",function(xOffsetRelative,yOffsetRelative){position.outerX+=xOffsetRelative,position.outerY+=yOffsetRelative,position.innerX+=xOffsetRelative,position.innerY+=yOffsetRelative}).on("dragend",function(){this.removeVisualGuides(),invokeOnAll("show"),innerDrag.show(),closer.show(),applyTransforms()}).init()}function createInnerDragHandle(){innerDrag=componentFactory(),makeStackable(innerDrag,stackingOptions),makeDraggable(innerDrag,{dragRestriction:function(){var fixedXY=allParts.nw.mask.getElement().offset(),rect;return rect={x:fixedXY.left+constrains.minWidth,y:fixedXY.top+(constrains.minTopHeight+dimensions.innerHeight+options.resizeHandleSize),width:dimensions.outerWidth-2*constrains.minWidth,height:dimensions.outerHeight-(dimensions.innerHeight+constrains.minTopHeight+constrains.minBottomHeight-options.innerDragHeight)},rect}}).on("render",function(){var $element=this.getElement(),$dragIcon=$("<div>",{class:"icon icon-move"});$element.addClass("line-reader-inner-drag"),$element.css({background:"none"}),$element.append($dragIcon),$element.on("mousedown touchstart",function(e){e.stopPropagation(),bringAllToFront()})}).on("dragstart",function(){closer.hide(),invokeOnMasks("setState",["resizing",!0])}).on("dragmove",function(xOffsetRelative,yOffsetRelative){position.innerX+=xOffsetRelative,position.innerY+=yOffsetRelative,dimensions.leftWidth+=xOffsetRelative,dimensions.topHeight+=yOffsetRelative,dimensions.rightWidth-=xOffsetRelative,dimensions.bottomHeight-=yOffsetRelative,applyTransformsToMasks()}).on("dragend",function(){innerDrag.bringToFront(),closer.show(),invokeOnMasks("setState",["resizing",!1]),applyTransformsToOverlays()}).init()}function createCloser(){closer=componentFactory(),makeStackable(closer,stackingOptions),makePlaceable(closer).on("render",function(){var self=this,$element=this.getElement(),$closeIcon=$("<div>",{class:"icon icon-result-nok"});$element.append($closeIcon),$element.addClass("line-reader-closer"),$element.on("mousedown touchstart",function(){bringAllToFront()}),$element.on("click",function(e){e.stopPropagation(),self.trigger("click")})}).init()}function bringAllToFront(){invokeOnAll("bringToFront"),innerDrag.bringToFront(),closer.bringToFront()}function invokeOnAll(fn,args){invokeOnMasks(fn,args),invokeOnOverlays(fn,args)}function invokeOnMasks(fn,args){invokeOn("mask",fn,args)}function invokeOnOverlays(fn,args){invokeOn("overlay",fn,args)}function invokeOn(target,fn,args){_.forOwn(allParts,function(part){_.isObject(part[target])&&_.isFunction(part[target][fn])&&part[target][fn].apply(part[target],args)})}function applyTransforms(){applyTransformsToMasks(),applyTransformsToOverlays(),applyTransformsToInnerDrag(),applyTransformsToCloser()}function applyTransformsToMasks(){invokeOnMasks("place")}function applyTransformsToOverlays(){_.forOwn(allParts,function(part){part.overlay&&part.mask.placeOverlay(part.overlay)})}function applyTransformsToInnerDrag(){innerDrag&&innerDrag.setSize(dimensions.innerWidth-20,options.innerDragHeight).moveTo(position.innerX+10,position.innerY+dimensions.innerHeight+options.resizeHandleSize)}function applyTransformsToCloser(){closer&&closer.setSize(constrains.minWidth-options.resizeHandleSize,constrains.minHeight-options.resizeHandleSize).moveTo(position.outerX+dimensions.outerWidth-constrains.minWidth-5,position.outerY+options.resizeHandleSize-4)}function correctTransforms(){dimensions.topHeight<constrains.minTopHeight&&(dimensions.topHeight=constrains.minTopHeight,position.innerY=position.outerY+constrains.minTopHeight),dimensions.innerHeight<constrains.minHeight&&(dimensions.innerHeight=constrains.minHeight),dimensions.bottomHeight<constrains.minBottomHeight&&(dimensions.bottomHeight=constrains.minBottomHeight),dimensions.outerHeight=dimensions.topHeight+dimensions.innerHeight+dimensions.bottomHeight,dimensions.leftWidth<constrains.minWidth&&(dimensions.leftWidth=constrains.minWidth,position.innerX=position.outerX+constrains.minWidth),dimensions.innerWidth<constrains.minWidth&&(dimensions.innerWidth=constrains.minWidth),dimensions.rightWidth<constrains.minWidth&&(dimensions.rightWidth=constrains.minWidth),dimensions.outerWidth=dimensions.leftWidth+dimensions.innerWidth+dimensions.rightWidth}function setTopHeight(newHeight,newY,fromTop){dimensions.topHeight=newHeight,fromTop?(dimensions.outerHeight=newHeight+dimensions.innerHeight+dimensions.bottomHeight,position.outerY=newY):(dimensions.innerHeight=dimensions.outerHeight-newHeight-dimensions.bottomHeight,position.innerY=position.outerY+newHeight)}function setRightWidth(newWidth,newX,fromLeft){dimensions.rightWidth=newWidth,fromLeft?dimensions.innerWidth=newX-position.innerX:dimensions.outerWidth=dimensions.leftWidth+dimensions.innerWidth+newWidth}function setBottomHeight(newHeight,newY,fromTop){dimensions.bottomHeight=newHeight,fromTop?(dimensions.innerHeight=newY-position.innerY,dimensions.bottomHeight=newHeight):dimensions.outerHeight=dimensions.topHeight+dimensions.innerHeight+newHeight}function setLeftWidth(newWidth,newX,fromLeft){dimensions.leftWidth=newWidth,fromLeft?(dimensions.outerWidth=newWidth+dimensions.innerWidth+dimensions.rightWidth,position.outerX=newX):(dimensions.innerWidth=dimensions.outerWidth-newWidth-dimensions.rightWidth,position.innerX=position.outerX+newWidth)}function createCompoundMask(){createPart({id:"n",edges:{top:!1,right:!1,bottom:!1,left:!1},edgesBorders:{top:!0,right:!1,bottom:!0,left:!1},addOverlay:!0,minHeight:constrains.minTopHeight,place:function(){this.moveTo(position.innerX,position.outerY).setSize(dimensions.innerWidth,dimensions.topHeight)},placeOverlay:function(overlay){var pos=this.getPosition(),size=this.getSize();overlay.moveTo(position.outerX,pos.y).setSize(dimensions.outerWidth,size.height)},beforeResize:function(width,height,fromLeft,fromTop){this.config.maxHeight=fromTop?null:dimensions.topHeight+(dimensions.innerHeight-constrains.minHeight)},onResize:function(width,height,fromLeft,fromTop,x,y){setTopHeight(height,y,fromTop),applyTransformsToMasks()}}),createPart({id:"ne",edges:{top:!1,right:!1,bottom:!1,left:!1},edgesBorders:{top:!0,right:!0,bottom:!1,left:!1},minHeight:constrains.minTopHeight,place:function(){this.moveTo(position.innerX+dimensions.innerWidth,position.outerY).setSize(dimensions.rightWidth,dimensions.topHeight)},placeOverlay:function(overlay){var pos=this.getPosition(),size=this.getSize();overlay.moveTo(pos.x,pos.y+options.resizeHandleSize).setSize(size.width-options.resizeHandleSize,size.height-2*options.resizeHandleSize)},onResize:function(width,height,fromLeft,fromTop,x,y){setTopHeight(height,y,fromTop),setRightWidth(width,x,fromLeft),applyTransformsToMasks()}}),createPart({id:"se",edges:{top:!1,right:".resize-control",bottom:".resize-control",left:!1},edgesBorders:{top:!1,right:!0,bottom:!0,left:!1},minHeight:constrains.minBottomHeight,resizeControll:!0,place:function(){this.moveTo(position.innerX+dimensions.innerWidth,position.innerY+dimensions.innerHeight).setSize(dimensions.rightWidth,dimensions.bottomHeight)},placeOverlay:function(overlay){var pos=this.getPosition(),size=this.getSize();overlay.moveTo(pos.x,pos.y+options.resizeHandleSize).setSize(size.width-options.resizeHandleSize,size.height-2*options.resizeHandleSize)},onResize:function(width,height,fromLeft,fromTop,x,y){setRightWidth(width,x,fromLeft),setBottomHeight(height,y,fromTop),applyTransformsToMasks()}}),createPart({id:"e",edges:{top:!1,right:!1,bottom:!1,left:".resize-control"},edgesBorders:{top:!1,right:!0,bottom:!1,left:!0},resizeControll:!0,place:function(){this.moveTo(position.innerX+dimensions.innerWidth,position.innerY).setSize(dimensions.rightWidth,dimensions.innerHeight)},placeOverlay:function(overlay){var pos=this.getPosition(),size=this.getSize();overlay.moveTo(pos.x+options.resizeHandleSize,pos.y-options.resizeHandleSize).setSize(size.width-2*options.resizeHandleSize,size.height+2*options.resizeHandleSize)},beforeResize:function(width,height,fromLeft){this.config.maxWidth=fromLeft?dimensions.rightWidth+(dimensions.innerWidth-constrains.minWidth):null},onResize:function(width,height,fromLeft,fromTop,x){setRightWidth(width,x,fromLeft),applyTransformsToMasks()}}),createPart({id:"s",edges:{top:".resize-control",right:!1,bottom:!1,left:!1},edgesBorders:{top:!0,right:!1,bottom:!0,left:!1},minHeight:constrains.minBottomHeight,resizeControll:!0,place:function(){this.moveTo(position.innerX,position.innerY+dimensions.innerHeight).setSize(dimensions.innerWidth,dimensions.bottomHeight)},placeOverlay:function(overlay){var pos=this.getPosition(),size=this.getSize();overlay.moveTo(pos.x,pos.y+options.resizeHandleSize).setSize(size.width,size.height-2*options.resizeHandleSize)},beforeResize:function(width,height,fromLeft,fromTop){this.config.maxHeight=fromTop?dimensions.bottomHeight+(dimensions.innerHeight-constrains.minHeight):null},onResize:function(width,height,fromLeft,fromTop,x,y){setBottomHeight(height,y,fromTop),applyTransformsToMasks()}}),createPart({id:"sw",edges:{top:!1,right:!1,bottom:!1,left:!1},edgesBorders:{top:!1,right:!1,bottom:!0,left:!0},minHeight:constrains.minBottomHeight,place:function(){this.moveTo(position.outerX,position.innerY+dimensions.innerHeight).setSize(dimensions.leftWidth,dimensions.bottomHeight)},placeOverlay:function(overlay){var pos=this.getPosition(),size=this.getSize();overlay.moveTo(pos.x+options.resizeHandleSize,pos.y+options.resizeHandleSize).setSize(size.width-options.resizeHandleSize,size.height-2*options.resizeHandleSize)},onResize:function(width,height,fromLeft,fromTop,x,y){setBottomHeight(height,y,fromTop),setLeftWidth(width,x,fromLeft),applyTransformsToMasks()}}),createPart({id:"w",edges:{top:!1,right:!1,bottom:!1,left:!1},edgesBorders:{top:!1,right:!0,bottom:!1,left:!0},place:function(){this.moveTo(position.outerX,position.innerY).setSize(dimensions.leftWidth,dimensions.innerHeight)},placeOverlay:function(overlay){var pos=this.getPosition(),size=this.getSize();overlay.moveTo(pos.x+options.resizeHandleSize,pos.y-options.resizeHandleSize).setSize(size.width-2*options.resizeHandleSize,size.height+2*options.resizeHandleSize)},beforeResize:function(width,height,fromLeft){this.config.maxWidth=fromLeft?null:dimensions.leftWidth+(dimensions.innerWidth-constrains.minWidth)},onResize:function(width,height,fromLeft,fromTop,x){setLeftWidth(width,x,fromLeft),applyTransformsToMasks()}}),createPart({id:"nw",edges:{top:!1,right:!1,bottom:!1,left:!1},edgesBorders:{top:!0,right:!1,bottom:!1,left:!0},minHeight:constrains.minTopHeight,place:function(){this.moveTo(position.outerX,position.outerY).setSize(dimensions.leftWidth,dimensions.topHeight)},placeOverlay:function(overlay){var pos=this.getPosition(),size=this.getSize();overlay.moveTo(pos.x+options.resizeHandleSize,pos.y+options.resizeHandleSize).setSize(size.width-options.resizeHandleSize,size.height-2*options.resizeHandleSize)},onResize:function(width,height,fromLeft,fromTop,x,y){setTopHeight(height,y,fromTop),setLeftWidth(width,x,fromLeft),applyTransformsToMasks()}})}function createPart(partConfig){allParts[partConfig.id]={mask:createMask(_.assign({},constrains,partConfig)),overlay:partConfig.addOverlay?createOverlay(partConfig):null}}function createVisualGuides(){visualGuides.$maskBg=$("<div>",{class:"mask-bg"}),visualGuides.$innerWindow=$("<div>",{class:"inner-window"})}var allParts={},visualGuides={},compoundMask,innerDrag,closer;return dimensions=_.defaults(dimensions||{},defaultDimensions),position=_.defaults(position||{},defaultPosition),options=_.defaults(options||{},defaultOptions),constrains={minWidth:2*options.resizeHandleSize+options.dragMinWidth,minHeight:2*options.resizeHandleSize+options.dragMinHeight,minBottomHeight:2*options.resizeHandleSize+options.innerDragHeight,minTopHeight:2*options.resizeHandleSize+30},compoundMask={init:function(){var self=this;return this.setTransforms(dimensions,position),createCompoundMask(),createVisualGuides(),createInnerDragHandle(),createCloser(),closer.on("click",function(){self.hide(),self.trigger("close")}),this},render:function($container){return invokeOnAll("render",[$container]),innerDrag.render($container),closer.render($container),applyTransforms(),this},destroy:function(){return invokeOnAll("destroy"),visualGuides=null,innerDrag=null,closer=null,this},show:function(){return invokeOnAll("show"),innerDrag.show(),closer.show(),this.setState("hidden",!1),this},hide:function(){return invokeOnAll("hide"),innerDrag.hide(),closer.hide(),this.setState("hidden",!0),this},setTransforms:function(dim,pos){dimensions=_.defaults(dim||{},dimensions),position=_.defaults(pos||{},position),dimensions.topHeight=pos.innerY-pos.outerY,dimensions.rightWidth=dim.outerWidth-(pos.innerX-pos.outerX)-dim.innerWidth,dimensions.bottomHeight=dim.outerHeight-(pos.innerY-pos.outerY)-dim.innerHeight,dimensions.leftWidth=pos.innerX-pos.outerX,correctTransforms(),applyTransforms()},getDimensions:function(){return dimensions},getPosition:function(){return position},getParts:function(){return allParts}},statifier(compoundMask),eventifier(compoundMask),compoundMask}}),define("taoQtiTest/runner/plugins/tools/lineReader/plugin",["jquery","lodash","i18n","taoTests/runner/plugin","ui/hider","util/shortcut","util/namespace","taoQtiTest/runner/plugins/tools/lineReader/compoundMask"],function($,_,__,pluginFactory,hider,shortcut,namespaceHelper,compoundMaskFactory){'use strict';function getDimensions($container){var $qtiContent=$container.find("#qti-content"),$qtiItem=$qtiContent.find(".qti-item"),lineHeight=Math.ceil(parseFloat($qtiContent.css("line-height")))||20;return{outerWidth:$qtiItem.width()+4*maskOptions.resizeHandleSize+2*maskOptions.dragMinWidth,outerHeight:175,innerWidth:$qtiItem.width(),innerHeight:lineHeight}}function getPosition($container){var $qtiContent=$container.find("#qti-content"),$qtiItem=$qtiContent.find(".qti-item"),itemPosition=$qtiItem.position()||{},paddingLeft=parseInt($qtiItem.css("padding-left"),10),paddingTop=parseInt($qtiItem.css("padding-top"),10),innerX=parseInt(itemPosition.left,10)+paddingLeft-3,innerY=parseInt(itemPosition.top,10)+paddingTop-3;return{outerX:innerX-2*maskOptions.resizeHandleSize-maskOptions.dragMinWidth,outerY:0,innerX:innerX,innerY:innerY}}function containerWidthHasChanged($container){var newDimensions=getDimensions($container);return newDimensions.outerWidth!==dimensions.outerWidth}var actionPrefix="tool-line-reader-",maskOptions={dragMinWidth:17,dragMinHeight:7,resizeHandleSize:7,innerDragHeight:20},dimensions,position;return pluginFactory({name:"line-reader",init:function(){function isEnabled(){var context=testRunner.getTestContext()||{},options=context.options||{};return!!options.lineReader}function toggleMask(){self.compoundMask.getState("hidden")?(containerWidthHasChanged($container)&&transformMask($container),openMask()):closeMask()}function openMask(){self.compoundMask.show(),self.trigger("start"),self.button.turnOn()}function closeMask(){self.compoundMask.getState("hidden")||self.compoundMask.hide(),self.trigger("end"),self.button.turnOff()}function transformMask($maskContainer){dimensions=getDimensions($maskContainer),position=getPosition($maskContainer),self.compoundMask.setTransforms(_.clone(dimensions),_.clone(position))}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginShortcuts=(testConfig.shortcuts||{})["line-reader"]||{},$container=testRunner.getAreaBroker().getContentArea().parent();this.compoundMask=compoundMaskFactory(maskOptions).init().render($container).on("close",function(){closeMask()}).hide(),this.button=this.getAreaBroker().getToolbox().createEntry({title:__("Line Reader"),icon:"insert-horizontal-line",control:"line-reader",text:__("Line Reader")}),this.button.on("click",function(e){e.preventDefault(),testRunner.trigger(actionPrefix+"toggle")}),testConfig.allowShortcuts&&pluginShortcuts.toggle&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.toggle,this.getName(),!0),function(){testRunner.trigger(actionPrefix+"toggle")},{avoidInput:!0,prevent:!0}),this.disable(),testRunner.on("loaditem",function(){isEnabled()?self.show():self.hide()}).on("renderitem",function(){transformMask($container)}).on("enabletools renderitem",function(){self.enable()}).on("disabletools unloaditem",function(){self.disable(),closeMask()}).on(actionPrefix+"toggle",function(){isEnabled()&&toggleMask()})},destroy:function(){this.compoundMask.destroy(),shortcut.remove("."+this.getName())},enable:function(){this.button.enable()},disable:function(){this.button.disable()},show:function(){this.button.show()},hide:function(){this.button.hide()}})}),define("tpl!taoQtiTest/runner/plugins/tools/magnifier/magnifierPanel",["handlebars"],function(hb){return hb.template(function(Handlebars,depth0,helpers,partials,data){this.compilerInfo=[4,">= 1.0.0"],helpers=this.merge(helpers,Handlebars.helpers),data=data||{};var buffer="",escapeExpression=this.escapeExpression,helperMissing=helpers.helperMissing,stack1,helper,options;return buffer+="<div class=\"magnifier\">\n    <div class=\"level\">",(helper=helpers.level)?stack1=helper.call(depth0,{hash:{},data:data}):(helper=depth0&&depth0.level,stack1="function"===_typeof2(helper)?helper.call(depth0,{hash:{},data:data}):helper),buffer+=escapeExpression(stack1)+"</div>\n    <div class=\"overlay\"></div>\n    <div class=\"inner\"></div>\n    <div class=\"controls close\">\n        <a href=\"#\" class=\"control\" data-control=\"zoomIn\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Magnify more",options):helperMissing.call(depth0,"__","Magnify more",options)))+"\"><span class=\"icon-add\"></span></a>\n        <a href=\"#\" class=\"control\"  data-control=\"zoomOut\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Magnify less",options):helperMissing.call(depth0,"__","Magnify less",options)))+"\"><span class=\"icon-remove\"></span></a>\n        <a href=\"#\" class=\"closeMagnifier\" data-control=\"closeMagnifier\" title=\""+escapeExpression((helper=helpers.__||depth0&&depth0.__,options={hash:{},data:data},helper?helper.call(depth0,"Close Magnifier",options):helperMissing.call(depth0,"__","Close Magnifier",options)))+"\"><span class=\"icon-result-nok\"></span></a>\n    </div>\n</div>",buffer})}),define("taoQtiTest/runner/plugins/tools/magnifier/magnifierPanel",["jquery","lodash","ui/component","tpl!taoQtiTest/runner/plugins/tools/magnifier/magnifierPanel","ui/dynamicComponent"],function($,_,component,magnifierPanelTpl,dynamicComponent){'use strict';var _Mathmin9=Math.min,_Mathmax11=Math.max,screenRatio=window.screen.width/window.screen.height,defaultBaseSize=116,defaultLevelMin=2,defaultLevel=defaultLevelMin,defaultConfig={level:defaultLevel,levelMin:defaultLevelMin,levelMax:8,levelStep:.5,baseSize:defaultBaseSize,maxRatio:.5},dynamicComponentDefaultConfig={draggable:!0,resizable:!0,preserveAspectRatio:!1,width:defaultBaseSize*defaultLevel,height:defaultBaseSize*defaultLevel/screenRatio,minWidth:defaultBaseSize*defaultLevelMin,minHeight:defaultBaseSize*defaultLevelMin/screenRatio,stackingScope:"test-runner",top:50,left:10};return function(config){function scrollInClone(scrollData){var $clonedTarget;controls&&controls.$clone&&scrollData&&scrollData.id&&($clonedTarget=controls.$clone.find("[data-magnifier-scroll="+scrollData.id+"]"),$clonedTarget.length&&(_.isNumber(scrollData.scrollTop)&&($clonedTarget[0].scrollTop=scrollData.scrollTop),_.isNumber(scrollData.scrollLeft)&&($clonedTarget[0].scrollLeft=scrollData.scrollLeft)))}function setScrollingListener(){window.addEventListener("scroll",scrollingListenerCallback,!0)}function removeScrollingListener(){window.removeEventListener("scroll",scrollingListenerCallback,!0)}function applyScrolling(){_.forEach(scrolling,scrollInClone)}function adjustZoomLevel(level){return _Mathmax11(zoomLevelMin,_Mathmin9(parseFloat(level),zoomLevelMax))}function applyZoomLevel(){controls&&controls.$inner.css({transform:"scale("+zoomLevel+")"})}function showZoomLevel(){var $newZoomLevel;controls&&($newZoomLevel=controls.$zoomLevel.clone(!0).html(zoomLevel),controls.$zoomLevel.before($newZoomLevel).remove(),controls.$zoomLevel=$newZoomLevel)}function updateMaxSize(){if(dynamicComponentInstance){var $window=$(window);dynamicComponentInstance.config.maxWidth=$window.width()*maxRatio,dynamicComponentInstance.config.maxHeight=$window.height()*maxRatio}}function applySize(){controls&&controls.$clone&&(targetWidth=controls.$target.width(),targetHeight=controls.$target.height(),controls.$clone.width(targetWidth).height(targetHeight))}function updateZoom(){var position;controls&&controls.$target&&(position=dynamicComponentInstance.position,position.x+=dx+controls.$target.scrollLeft(),position.y+=dy+controls.$target.scrollTop(),magnifierPanel.zoomAt(position.x,position.y))}function createObserver(){observer=new window.MutationObserver(updateMagnifier)}function startObserver(){controls&&controls.$target&&observer.observe(controls.$target.get(0),{childList:!0,attributes:!0,characterData:!0,subtree:!0}),setScrollingListener()}function stopObserver(){observer.disconnect(),removeScrollingListener()}function translateMagnifier(coordinate,actualSize,magnifierSize){var delta=0,ratio=zoomLevel;return actualSize&&(delta=actualSize*(zoomLevel-1)/2,ratio=(actualSize*zoomLevel-magnifierSize)/(actualSize-magnifierSize)),coordinate*ratio-delta}function getElementFromPoint(x,y){var el;return x=x||0,y=y||0,controls&&controls.$overlay.addClass("hidden"),el=document.elementFromPoint(x,y),controls&&controls.$overlay.removeClass("hidden"),el}function findSourceNode(node,root,target){var $node=$(node),$root=$(root),$target=$(target),indexes=[$node.index()];return $node.parents().each(function(){var $this=$(this);return!$this.is($root)&&void indexes.push($this.index())}),indexes.pop(),indexes.length?($node=$target,_.forEachRight(indexes,function(index){if($node=$node.children().eq(index),!$node.length)return!1})):$node=$(),$node}var initConfig=_.defaults(config||{},defaultConfig),zoomLevelMin=parseFloat(initConfig.levelMin),zoomLevelMax=parseFloat(initConfig.levelMax),zoomLevelStep=parseFloat(initConfig.levelStep),zoomLevel=adjustZoomLevel(initConfig.level),maxRatio=parseFloat(initConfig.maxRatio),$initTarget=null,controls=null,observer=null,scrolling=[],dynamicComponentConfig=_.defaults(config?config.component||{}:{},dynamicComponentDefaultConfig),magnifierPanel=component({getZoomLevel:function(){return zoomLevel},getTarget:function(){return controls&&controls.$target},setTarget:function($newTarget){return controls?(controls.$target=$newTarget,controls.$viewTarget=null,setScrollingListener(),this.trigger("targetchange",controls.$target),this.update()):$initTarget=$newTarget,this},zoomTo:function(level){return level&&_.isFinite(level)&&(zoomLevel=adjustZoomLevel(level)),applyZoomLevel(),showZoomLevel(),updateMaxSize(),updateZoom(),this.trigger("zoom",zoomLevel),this},zoomBy:function(step){return step&&_.isFinite(step)&&this.zoomTo(zoomLevel+parseFloat(step)),this},zoomIn:function(){return this.zoomBy(zoomLevelStep)},zoomOut:function(){return this.zoomBy(-zoomLevelStep)},zoomAt:function(x,y){var position;controls&&(position=this.translate(x,y),controls.$inner.css({top:-position.top,left:-position.left}))},translate:function(x,y){return{top:translateMagnifier(y,targetHeight,dynamicComponentInstance.config.height),left:translateMagnifier(x,targetWidth,dynamicComponentInstance.config.width)}},update:function(){return controls&&controls.$target&&(controls.$clone=controls.$target.clone().removeAttr("id"),controls.$clone.find("iframe").remove(),controls.$clone.find("[name],[id],[data-serial]").removeAttr("name id data-serial"),controls.$inner.empty().append(controls.$clone),applySize(),applyZoomLevel(),updateZoom(),updateMaxSize(),applyScrolling(),this.trigger("update")),this}},defaultConfig),updateMagnifier=_.debounce(_.bind(magnifierPanel.update,magnifierPanel),50),scrollingListenerCallback=_.throttle(function(event){var $target=$(event.target),scrollingTop=event.target.scrollTop,scrollLeft=event.target.scrollLeft,scrollId,scrollData;controls&&controls.$clone&&$target.data("magnifier-scroll")?(scrollId=$target.data("magnifier-scroll"),scrollData=_.find(scrolling,{id:scrollId}),scrollData.scrollTop=scrollingTop,scrollData.scrollLeft=scrollLeft,scrollInClone(scrollData)):(scrollId=_.uniqueId("scrolling_"),$target.attr("data-magnifier-scroll",scrollId),scrolling.push({id:scrollId,scrollTop:scrollingTop,scrollLeft:scrollLeft}),magnifierPanel.update())},20),targetWidth,targetHeight,dx,dy,dynamicComponentInstance;return dynamicComponentInstance=dynamicComponent({}).on("rendercontent",function($content){var dynamicComponentContext=this,$element=this.getElement();$element.addClass("magnifier-container"),magnifierPanel.setTemplate(magnifierPanelTpl).on("render",function(){var self=this,$component=this.getElement();this.setState("hidden",!0),dx=($component.outerWidth()-$component.width())/2,dy=($component.outerHeight()-$component.height())/2,controls={$target:$initTarget,$inner:$(".inner",$component),$zoomLevel:$(".level",$component),$overlay:$(".overlay",$component)},$initTarget=null,$component.on("click touchstart",".control[data-control=\"zoomOut\"]",function(event){event.preventDefault(),self.zoomOut()}),$component.on("click touchstart",".control[data-control=\"zoomIn\"]",function(event){event.preventDefault(),self.zoomIn()}),$component.on("click touchstart",".closeMagnifier",function(event){event.preventDefault(),self.hide(),self.trigger("close")}),$component.on("click touchstart",".overlay",function(event){findSourceNode(getElementFromPoint(event.pageX,event.pageY),controls.$inner,controls.$target).click().focus()}),createObserver(),updateMaxSize(),applyZoomLevel()}).on("show",function(){updateMagnifier(),startObserver(),dynamicComponentContext.show()}).on("hide",function(){stopObserver(),dynamicComponentContext.hide()}).on("destroy",function(){stopObserver(),$initTarget=null,controls=null,observer=null,dynamicComponentContext.destroy()}).init(initConfig).render($content)}).on("down move resize",function(){updateZoom()}).on("resize",function(){updateMaxSize()}).init(dynamicComponentConfig),magnifierPanel}}),define("taoQtiTest/runner/plugins/tools/magnifier/magnifier",["jquery","lodash","i18n","taoTests/runner/plugin","ui/hider","util/shortcut","util/namespace","taoQtiTest/runner/plugins/tools/magnifier/magnifierPanel"],function($,_,__,pluginFactory,hider,shortcut,namespaceHelper,magnifierPanelFactory){'use strict';var actionPrefix="tool-magnifier-",defaultOptions={zoomMin:2,zoomMax:8,zoomStep:.5};return pluginFactory({name:"magnifier",init:function(){function getMagnifierPanel(){var $container;return magnifierPanel||($container=testRunner.getAreaBroker().getContainer(),magnifierPanel=magnifierPanelFactory({levelMin:pluginConfig.zoomMin,levelMax:pluginConfig.zoomMax,levelStep:pluginConfig.zoomStep,component:{renderTo:$container.parent(),draggableContainer:$container.parent()}}).on("show",function(){self.trigger("magnifier-show")}).on("hide",function(){self.trigger("magnifier-hide")}).on("zoom",function(level){self.trigger("magnifier-zoom",level)}).on("close",function(){hideMagnifier()}).setTarget($container),self.trigger("magnifier-create")),magnifierPanel}function isEnabled(){var context=testRunner.getTestContext()||{},options=context.options||{};return!!options.magnifier}function togglePlugin(){isEnabled()?self.show():self.hide()}function toggleMagnifier(){self.getState("enabled")&&(self.getState("active")?hideMagnifier():showMagnifier())}function showMagnifier(){getMagnifierPanel(),magnifierPanel.is("hidden")&&magnifierPanel.show(),self.button.turnOn(),testRunner.trigger("plugin-open.magnifier"),self.setState("active",!0)}function hideMagnifier(){self.setState("active",!1),self.button.turnOff(),testRunner.trigger("plugin-close.magnifier"),magnifierPanel&&!magnifierPanel.is("hidden")&&magnifierPanel.hide()}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginConfig=_.defaults((testConfig.plugins||{}).magnifier||{},defaultOptions),pluginShortcuts=(testConfig.shortcuts||{}).magnifier||{},magnifierPanel=null;this.button=this.getAreaBroker().getToolbox().createEntry({control:"magnify",title:__("Displays a customisable magnifier"),text:__("Magnifying Glass"),icon:"find"}),this.button.on("click",function(event){event.preventDefault(),testRunner.trigger(actionPrefix+"toggle")}),testConfig.allowShortcuts&&_.forEach(pluginShortcuts,function(command,key){shortcut.add(namespaceHelper.namespaceAll(command,"magnifier",!0),function(){testRunner.trigger(actionPrefix+key)},{avoidInput:!0})}),togglePlugin(),this.disable(),testRunner.on("loaditem",function(){togglePlugin(),self.disable()}).on("renderitem",function(){magnifierPanel&&magnifierPanel.update().zoomTo(pluginConfig.zoomMin)}).on("enabletools renderitem",function(){self.enable()}).on("disabletools unloaditem",function(){self.getState("active")&&hideMagnifier(),self.disable()}).on("destroy",function(){magnifierPanel&&magnifierPanel.destroy(),magnifierPanel=null}).on(actionPrefix+"toggle",function(){isEnabled()&&toggleMagnifier()}).on(actionPrefix+"in",function(){isEnabled()&&self.getState("enabled")&&self.getState("active")&&getMagnifierPanel().zoomIn()}).on(actionPrefix+"out",function(){isEnabled()&&self.getState("enabled")&&self.getState("active")&&getMagnifierPanel().zoomOut()}).on(actionPrefix+"close",function(){self.getState("active")&&hideMagnifier()})},destroy:function(){shortcut.remove(".magnifier")},enable:function(){this.button.enable()},disable:function(){this.button.disable()},show:function(){this.button.show()},hide:function(){this.button.hide()}})}),define("taoQtiTest/runner/plugins/tools/zoom",["jquery","i18n","ui/hider","ui/transformer","util/shortcut","util/namespace","taoTests/runner/plugin"],function($,__,hider,transformer,shortcut,namespaceHelper,pluginFactory){'use strict';var _Mathmax12=Math.max,threshold={lower:10,upper:200},_setZoomLevel=function($target,level){var $parent=$target.parent(),newScale=level/100,isOverZoom=$parent.outerWidth(!0)<$target.width()*newScale;isOverZoom?(transformer.setTransformOrigin($target,"0 0"),$parent.css("margin-left","0")):(transformer.setTransformOrigin($target,"50% 0"),$parent.css("margin-left","")),transformer.scale($target,newScale)},_resetZoom=function($target){transformer.reset($target)},forceRepaint=function($target){var sel=$target[0];sel&&(sel.style.display="none",sel.offsetHeight,sel.style.display="")};return pluginFactory({name:"zoom",init:function(){function isConfigured(){var context=testRunner.getTestContext()||{},options=context.options||{};return!!options.zoom}function togglePlugin(){isConfigured()?self.show():self.hide()}function zoomAction(dir){var el,sx,sy,before,after;self.$zoomTarget&&(el=self.$zoomTarget[0],before=el.getBoundingClientRect(),sx=self.$container.scrollLeft(),sy=self.$container.scrollTop(),self.zoom=_Mathmax12(threshold.lower,Math.min(threshold.upper,self.zoom+10*dir)),self.zoom===100?_resetZoom(self.$zoomTarget):_setZoomLevel(self.$zoomTarget,self.zoom),forceRepaint(self.$zoomTarget),after=el.getBoundingClientRect(),sx=_Mathmax12(0,sx+(after.width-before.width)/2),sy=_Mathmax12(0,sy+(after.height-before.height)/2),self.$container.scrollLeft(sx).scrollTop(sy))}var self=this,testRunner=this.getTestRunner(),testData=testRunner.getTestData()||{},testConfig=testData.config||{},pluginShortcuts=(testConfig.shortcuts||{})[this.getName()]||{};this.buttonZoomOut=this.getAreaBroker().getToolbox().createEntry({control:"zoomOut",title:__("Zoom out"),icon:"remove"}),this.buttonZoomIn=this.getAreaBroker().getToolbox().createEntry({control:"zoomIn",title:__("Zoom in"),icon:"add"}),this.buttonZoomIn.on("click",function(e){e.preventDefault(),testRunner.trigger("tool-zoomin")}),this.buttonZoomOut.on("click",function(e){e.preventDefault(),testRunner.trigger("tool-zoomout")}),testConfig.allowShortcuts&&(pluginShortcuts.in&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.in,this.getName(),!0),function(){testRunner.trigger("tool-zoomin")},{avoidInput:!0}),pluginShortcuts.out&&shortcut.add(namespaceHelper.namespaceAll(pluginShortcuts.out,this.getName(),!0),function(){testRunner.trigger("tool-zoomout")},{avoidInput:!0})),togglePlugin(),this.disable(),testRunner.on("loaditem",function(){self.zoom=100,togglePlugin(),self.disable()}).on("renderitem",function(){self.$container=$("#qti-content"),self.$zoomTarget=$(".qti-item"),self.enable()}).on("enabletools",function(){self.enable()}).on("disabletools unloaditem",function(){self.disable()}).on("tool-zoomin",function(){!1!==self.getState("enabled")&&zoomAction(1)}).on("tool-zoomout",function(){!1!==self.getState("enabled")&&zoomAction(-1)})},destroy:function(){shortcut.remove("."+this.getName())},enable:function(){this.buttonZoomIn.enable(),this.buttonZoomOut.enable()},disable:function(){this.buttonZoomIn.disable(),this.buttonZoomOut.disable()},show:function(){this.buttonZoomIn.show(),this.buttonZoomOut.show()},hide:function(){this.buttonZoomIn.hide(),this.buttonZoomOut.hide()}})}),function(c){var d=document,s=d.createElement("style");s.type="text/css",d.getElementsByTagName("head")[0].appendChild(s),s.styleSheet?s.styleSheet.cssText=c:s.appendChild(d.createTextNode(c))}(".test-runner-scope .content-wrapper p.key-navigation-group,.test-runner-scope .content-wrapper div.key-navigation-group{padding:5px !important}.test-runner-scope .content-wrapper .key-navigation-group:not(.qti-extendedTextInteraction):not(.qti-textEntryInteraction){border-width:1px !important;border-style:solid;border-color:transparent}.test-runner-scope .content-wrapper .key-navigation-group:not(.qti-extendedTextInteraction):not(.qti-textEntryInteraction).focusin{border-color:#0e5d91 !important;outline:none}.test-runner-scope .content-wrapper .key-navigation-group:not(.qti-extendedTextInteraction):not(.qti-textEntryInteraction).qti-interaction .qti-choice.key-navigation-highlight{background:#e7eff4 !important}.test-runner-scope .content-wrapper span.key-navigation-group{border:none !important}.test-runner-scope .content-wrapper span.key-navigation-group.focusin{outline:solid #0e5d91 1px !important;outline-offset:1px}.test-runner-scope .test-sidebar .key-navigation-group.focusin{background:#e7eff4}.test-runner-scope .test-sidebar .key-navigation-group .qti-navigator-filters .key-navigation-highlight .qti-navigator-tab{border-width:2px}.test-runner-scope .test-sidebar .key-navigation-group .qti-navigator-filters .key-navigation-highlight:focus{outline:none}.test-runner-scope .test-sidebar .key-navigation-group .qti-navigator-filters .key-navigation-highlight:focus .qti-navigator-tab{border-top-color:#222 !important;border-left-color:#222 !important;border-right-color:#222 !important}.test-runner-scope .test-sidebar .key-navigation-group li.qti-navigator-item.key-navigation-highlight{padding-left:8px;border-left:solid 2px #222}.test-runner-scope .test-sidebar .key-navigation-group li.qti-navigator-item.key-navigation-highlight .key-navigation-highlight:focus{outline:none}.test-runner-scope .bottom-action-bar.content-action-bar.key-navigation-group.focusin{-webkit-box-shadow:0 0 6px 2px #3e7da7;-moz-box-shadow:0 0 6px 2px #3e7da7;-ms-box-shadow:0 0 6px 2px #3e7da7;-o-box-shadow:0 0 6px 2px #3e7da7;box-shadow:0 0 6px 2px #3e7da7}.test-runner-scope .bottom-action-bar.content-action-bar.key-navigation-group .key-navigation-highlight:focus{margin-bottom:0;border-bottom-color:#e7eff4 !important;outline:none}.test-runner-scope .bottom-action-bar.content-action-bar.key-navigation-group .key-navigation-highlight:focus.active{border-bottom-color:transparent !important;background:#e7eff4 !important}.test-runner-scope .bottom-action-bar.content-action-bar.key-navigation-group .key-navigation-highlight:focus:not(.active):not(:active) .li-inner{color:#e7eff4}header .settings-menu .key-navigation-group{padding-right:5px}header .settings-menu .key-navigation-group.focusin{background-color:rgba(14,93,145,0.5);padding-bottom:10px}header .settings-menu .key-navigation-highlight:focus{height:54px;color:white !important;border-bottom:solid 2px white !important}\n\n/*# sourceMappingURL=key-navigation.css.map *//*\nUsage:\n- linear-gradient((color1, color2, color3)) - returns linear-gradient with evenly distributed colors,\n   if 3 colors used then the position of each will be 33,33%\n- linear-gradient((color1 0%, color2 30%, color3 80%)) - returns linear-gradient with manually distributed colors,\n   first param - color, second - position. Also you can use px or other valid units for set position.\n*/\n/* Do not edit */\n/* Style of advanced components */\n/* toggler */\n.toggler:after {\n    margin-left: 3px;\n    position: relative;\n    top: 2px;\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\e611\";\n}\n\n.toggler.opened:after {\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\e610\";\n}\n\n.toggled {\n    display: none;\n}\n\n/* Adder */\n.adder:before {\n    margin-right: 5px;\n    font-size: 10.5px;\n    font-size: 1.05rem;\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\e636\";\n}\n\n/* Closer / Deleter */\n.closer:before, .deleter:before {\n    margin-right: 5px;\n    font-size: 10.5px;\n    font-size: 1.05rem;\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\e637\";\n}\n\n.undobox {\n    display: block;\n    position: fixed;\n    top: 50px;\n    left: 50%;\n    margin-left: -200px;\n    width: 400px;\n    z-index: 100005;\n}\n\n/* Incrementer and duration */\ninput[data-increment], input.duration-ctrl {\n    width: 40px !important;\n    min-width: 40px !important;\n    text-align: right;\n}\n\n.duration-ctrl-wrapper, .incrementer-ctrl-wrapper {\n    position: relative;\n    display: inline-block;\n    border: 1px solid #ddd;\n    border-radius: 2px;\n    border-radius: 2px;\n}\n\n.duration-ctrl-wrapper .incrementer, .incrementer-ctrl-wrapper .incrementer {\n    text-align: right;\n    border: none;\n    padding-right: 18px;\n}\n\n.duration-ctrl-wrapper .incrementer ~ .incrementer-ctrl, .incrementer-ctrl-wrapper .incrementer ~ .incrementer-ctrl {\n    border-left: 1px #ddd solid;\n    display: inline-block;\n    height: 100%;\n    position: absolute;\n    right: 0;\n    top: 0;\n}\n\n.duration-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a, .incrementer-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a {\n    outline: 0 !important;\n    cursor: pointer;\n    display: inline-block;\n    line-height: 13px;\n    color: #222;\n    background: #f3f1ef;\n    padding: 0 4px 0 4px;\n    font-size: 10.5px;\n    font-size: 1.05rem;\n    position: absolute;\n    right: 0;\n    height: 50%;\n    text-align: center;\n}\n\n.duration-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a.inc, .incrementer-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a.inc {\n    top: 0;\n    border-top-right-radius: 2px;\n}\n\n.duration-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a.dec, .incrementer-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a.dec {\n    top: 50%;\n    border-bottom-right-radius: 2px;\n}\n\n.duration-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a.inc:before, .incrementer-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a.inc:before {\n    position: relative;\n    bottom: 0px;\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\e610\";\n}\n\n.duration-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a.dec:before, .incrementer-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a.dec:before {\n    position: relative;\n    top: 0px;\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\e611\";\n}\n\n.duration-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a:hover, .incrementer-ctrl-wrapper .incrementer ~ .incrementer-ctrl > a:hover {\n    background-color: #3e7da7;\n    color: white;\n}\n\n.duration-ctrl-wrapper ~ .separator {\n    padding: 0 3px;\n    text-align: center;\n    opacity: .7;\n}\n\n/* InPlacer */\n[data-in-place], .inplace {\n    cursor: pointer;\n    min-height: 1em;\n}\n\n[data-in-place] input, .inplace input {\n    cursor: auto;\n}\n\n[data-in-place]:hover, .inplace:hover {\n    border: dotted 1px #3e7da7;\n}\n\n/* ListBox  */\nul.listbox {\n    margin: .1em 0;\n    padding: 0;\n    list-style-type: none;\n    display: block;\n}\n\nul.listbox > li {\n    white-space: no-wrap;\n    position: relative;\n    min-width: 75%;\n    border: solid 1px #ddd;\n    border-bottom-width: 0;\n    vertical-align: top;\n    margin: 0;\n    padding: .3em 2em .3em .2em;\n    background-color: #f3f1ef;\n    min-height: 1.5em;\n}\n\nul.listbox > li > .closer, ul.listbox > li > .deleter {\n    position: absolute;\n    right: 5px;\n    top: 0;\n}\n\nul.listbox > li:first-child {\n    border-radius: 2px 2px 0 0;\n}\n\nul.listbox > li:last-child {\n    border-radius: 0 0 2px 2px;\n    border-bottom-width: 1px;\n}\n\nul.listbox > li.placeholder {\n    background: none;\n    margin: .5em;\n    opacity: 0.6;\n}\n\n/* Modal styles */\n.modal {\n    background-color: white;\n    border: 1px solid #ddd;\n    box-shadow: 3px 3px 5px #666666;\n    height: auto;\n    opacity: 0;\n    top: -1000px;\n    padding: 40px;\n    position: fixed;\n    z-index: 105002;\n    margin: auto;\n    left: 0;\n    right: 0;\n    overflow: hidden;\n}\n\n.modal .modal-close {\n    position: absolute;\n    right: 12px;\n    top: 10px;\n    cursor: pointer;\n    font-weight: bold;\n    color: #222;\n    font-size: 20px;\n    font-size: 2rem;\n}\n\n.modal .modal-close:hover {\n    opacity: 0.6;\n}\n\n.modal .modal-body h4 {\n    font-size: 16px;\n    font-size: 1.6rem;\n    margin-top: 0;\n    margin-bottom: 8px;\n}\n\n.modal .modal-body .content, .modal .modal-body .message {\n    margin-bottom: 8px;\n}\n\n.modal .modal-body .buttons {\n    top: 16px;\n    position: relative;\n}\n\n.modal .modal-body .buttons button {\n    border-radius: 2px;\n    margin-left: 8px;\n    height: 36px;\n    text-shadow: none;\n    text-transform: uppercase;\n    color: #0e5d91 !important;\n    background: none;\n}\n\n.modal .modal-body .buttons button:focus, .modal .modal-body .buttons button:hover {\n    background: #dbe7ef;\n}\n\n.modal[class^=\"icon-\"]:before, .modal[class*=\" icon-\"]:before {\n    font-size: 44px;\n    font-size: 4.4rem;\n    color: #0e5d91;\n    position: absolute;\n}\n\n.modal[class^=\"icon-\"].icon-result-nok:before, .modal[class*=\" icon-\"].icon-result-nok:before {\n    color: #ba122b;\n}\n\n.modal[class^=\"icon-\"].icon-warning:before, .modal[class*=\" icon-\"].icon-warning:before {\n    color: #c96043;\n}\n\n.modal[class^=\"icon-\"].icon-result-ok:before, .modal[class*=\" icon-\"].icon-result-ok:before {\n    color: #0e914b;\n}\n\n.modal[class^=\"icon-\"].error:before, .modal[class*=\" icon-\"].error:before {\n    color: #ba122b;\n}\n\n.modal[class^=\"icon-\"].danger:before, .modal[class*=\" icon-\"].danger:before {\n    color: #c96043;\n}\n\n.modal[class^=\"icon-\"].warning:before, .modal[class*=\" icon-\"].warning:before {\n    color: #d8ae5b;\n}\n\n.modal[class^=\"icon-\"].info:before, .modal[class*=\" icon-\"].info:before {\n    color: #0e5d91;\n}\n\n.modal[class^=\"icon-\"].success:before, .modal[class*=\" icon-\"].success:before {\n    color: #0e914b;\n}\n\n.modal[class^=\"icon-\"] .modal-body, .modal[class*=\" icon-\"] .modal-body {\n    font-family: \"Source Sans Pro\", sans-serif !important;\n    line-height: 1.4;\n    margin-left: 8.5rem;\n}\n\n.modal-bg {\n    background: none repeat scroll 0 0 black;\n    opacity: 0.45;\n    -ms-filter: \"progid:DXImageTransform.Microsoft.Alpha(Opacity=45)\";\n    filter: alpha(opacity=45);\n    display: none;\n    position: fixed;\n    height: 100%;\n    width: 100%;\n    left: 0;\n    top: 0;\n    z-index: 100001;\n    overflow: hidden;\n}\n\n/* Button groups */\nul[data-button-group], ul.button-group {\n    list-style-type: none;\n    padding: 0;\n    background-color: white;\n    border: 1px solid #ddd;\n    border-radius: 1px;\n    margin: 0 2px 2px 0;\n    display: inline-block;\n    border-radius: 2px;\n    font-size: 12px;\n    font-size: 1.2rem;\n}\n\nul[data-button-group] > li, ul.button-group > li {\n    border: 0 none;\n    color: #222;\n    cursor: pointer;\n    display: inline-block;\n    float: left;\n    min-width: 26px;\n    padding: 4px 6px;\n    text-align: center;\n    text-decoration: none !important;\n}\n\nul[data-button-group] > li.active, ul.button-group > li.active {\n    color: white;\n    background-color: #0e5d91;\n    transition: all 0.4s ease;\n}\n\nul[data-button-group] > li:hover, ul.button-group > li:hover {\n    color: white;\n    background-color: #3e7da7;\n    transition: all 0.4s ease;\n}\n\nul[data-button-group] > li.separator, ul.button-group > li.separator {\n    background-color: #ddd;\n    float: left;\n    height: 18px;\n    margin: 5px 2px 0 2px;\n    width: 1px;\n    min-width: 1px;\n    padding: 0;\n}\n\nul[data-button-group] > li[class^=\"icon-\"], ul[data-button-group] > li[class*=\" icon-\"], ul.button-group > li[class^=\"icon-\"], ul.button-group > li[class*=\" icon-\"] {\n    height: 16px;\n    margin-top: 1px;\n    width: 16px;\n    padding-top: 2px;\n}\n\n/* Media Preview */\n.previewer {\n    background-color: white;\n    margin: 5px;\n    min-width: 280px;\n    min-height: 200px;\n    text-align: center;\n}\n\n.previewer .nopreview {\n    color: #ddd;\n    text-align: center;\n    font-size: 20px;\n    font-size: 2rem;\n}\n\n.previewer .nopreview:before {\n    font-size: 60px;\n    font-size: 6rem;\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\e670\";\n    display: block !important;\n}\n\n/* Progress bar */\n.progressbar {\n    height: 2em;\n    text-align: left;\n    border: none;\n    height: 0.8em;\n    background-color: white;\n    border: 1px solid #ddd;\n}\n\n.progressbar > span {\n    height: 100%;\n    border: none;\n    background-color: #3e7da7;\n    display: block;\n    color: white;\n    transition: width 0.4s ease 0s;\n}\n\n.progressbar.info > span {\n    background-color: #0e5d91;\n}\n\n.progressbar.success > span {\n    background-color: #0e914b;\n}\n\n.progressbar.warning > span {\n    background-color: #d8ae5b;\n}\n\n.progressbar.error > span {\n    background-color: #ba122b;\n}\n\n/*# sourceMappingURL=components.css.map *//*\nUsage:\n- linear-gradient((color1, color2, color3)) - returns linear-gradient with evenly distributed colors,\n   if 3 colors used then the position of each will be 33,33%\n- linear-gradient((color1 0%, color2 30%, color3 80%)) - returns linear-gradient with manually distributed colors,\n   first param - color, second - position. Also you can use px or other valid units for set position.\n*/\n/* Do not edit */\n.modal.has-secondary .message {\n    font-weight: bold;\n}\n\n.modal.has-secondary .buttons {\n    width: 100%;\n    text-align: center;\n}\n\n.modal.has-secondary .buttons button.waiting:disabled {\n    background-color: transparent !important;\n    color: #222 !important;\n    opacity: 1 !important;\n    font-size: 1.6rem !important;\n    text-shadow: none !important;\n    text-transform: none;\n}\n\n.modal.has-secondary .buttons .between-buttons-text {\n    color: #7a7a7a;\n    padding: 0 1rem;\n    font-size: 12px;\n    font-size: 1.2rem;\n}\n\n.modal.has-secondary .button-subtext {\n    font-size: 11px;\n    font-size: 1.1rem;\n    color: #7a7a7a;\n    text-align: center;\n    margin-top: 1.5rem;\n}\n\n/*# sourceMappingURL=waitingDialog.css.map */.countdown{opacity:0;position:relative;display:inline-block;overflow:hidden;text-align:center;vertical-align:top;line-height:1.2;padding:0 20px;margin-top:-1px;height:100%}.countdown.rendered{opacity:1;-webkit-transition:opacity, 300ms, linear, 0s;-moz-transition:opacity, 300ms, linear, 0s;-ms-transition:opacity, 300ms, linear, 0s;-o-transition:opacity, 300ms, linear, 0s;transition:opacity, 300ms, linear, 0s}.countdown .label{max-width:130px;display:block;font-size:12px;font-size:1.2rem}\n\n/*# sourceMappingURL=countdown.css.map */.timer-box{opacity:0;padding-top:0;white-space:nowrap;-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-flex-wrap:nowrap;-ms-flex-wrap:nowrap;flex-wrap:nowrap;-webkit-justify-content:flex-end;-ms-flex-pack:end;justify-content:flex-end}.timer-box.rendered{opacity:1;-webkit-transition:opacity, 300ms, linear, 0s;-moz-transition:opacity, 300ms, linear, 0s;-ms-transition:opacity, 300ms, linear, 0s;-o-transition:opacity, 300ms, linear, 0s;transition:opacity, 300ms, linear, 0s}.timer-box .timer-toggler{text-decoration:none;color:#fff;line-height:1.3;opacity:.68;padding:8px 20px;position:relative;top:-1px;left:20px;z-index:2;-webkit-transition:opacity, .5s, ease-out, 0s;-moz-transition:opacity, .5s, ease-out, 0s;-ms-transition:opacity, .5s, ease-out, 0s;-o-transition:opacity, .5s, ease-out, 0s;transition:opacity, .5s, ease-out, 0s}.timer-box .timer-toggler:hover,.timer-box .timer-toggler:active,.timer-box .timer-toggler:focus{outline:unset}.timer-box .timer-toggler:hover{opacity:.93;-webkit-transition:opacity, .5s, ease-out, 0s;-moz-transition:opacity, .5s, ease-out, 0s;-ms-transition:opacity, .5s, ease-out, 0s;-o-transition:opacity, .5s, ease-out, 0s;transition:opacity, .5s, ease-out, 0s}.timer-box.zen .timer-toggler{opacity:.93;-webkit-transition:opacity, .5s, ease-out, 0s;-moz-transition:opacity, .5s, ease-out, 0s;-ms-transition:opacity, .5s, ease-out, 0s;-o-transition:opacity, .5s, ease-out, 0s;transition:opacity, .5s, ease-out, 0s}.timer-box.zen .countdown .time{opacity:0;-webkit-transition:opacity, 1s, ease-out, 0s;-moz-transition:opacity, 1s, ease-out, 0s;-ms-transition:opacity, 1s, ease-out, 0s;-o-transition:opacity, 1s, ease-out, 0s;transition:opacity, 1s, ease-out, 0s}.timer-box .countdown::before{content:' ';background:rgba(255,255,255,0.3);width:1px;height:20px;position:absolute;left:0;top:5px}.timer-box .countdown:first-child::before{content:none}.timer-box .countdown[data-scope=test][data-type=min]{-ms-flex-order:5;-webkit-order:5;order:5}.timer-box .countdown[data-scope=test]{-ms-flex-order:10;-webkit-order:10;order:10}.timer-box .countdown[data-scope=testPart][data-type=min]{-ms-flex-order:15;-webkit-order:15;order:15}.timer-box .countdown[data-scope=testPart]{-ms-flex-order:20;-webkit-order:20;order:20}.timer-box .countdown[data-scope=section][data-type=min]{-ms-flex-order:25;-webkit-order:25;order:25}.timer-box .countdown[data-scope=section]{-ms-flex-order:30;-webkit-order:30;order:30}.timer-box .countdown[data-scope=item][data-type=min]{-ms-flex-order:35;-webkit-order:35;order:35}.timer-box .countdown[data-scope=item]{-ms-flex-order:40;-webkit-order:40;order:40}\n\n/*# sourceMappingURL=timerbox.css.map *//*\nUsage:\n- linear-gradient((color1, color2, color3)) - returns linear-gradient with evenly distributed colors,\n   if 3 colors used then the position of each will be 33,33%\n- linear-gradient((color1 0%, color2 30%, color3 80%)) - returns linear-gradient with manually distributed colors,\n   first param - color, second - position. Also you can use px or other valid units for set position.\n*/\n/* Do not edit */\n.dynamic-component-container {\n    display: inline-block;\n    background: #f3f1ef;\n    padding: 5px;\n    position: absolute;\n    left: 0;\n    top: 0;\n    box-shadow: 0 0 2px 2px rgba(141, 148, 158, 0.75);\n    z-index: 15000;\n}\n\n.dynamic-component-container .dynamic-component-title-bar {\n    position: relative;\n    color: #e6e6e6;\n    background: #333333;\n    cursor: move;\n    text-shadow: none;\n    line-height: 1.4;\n    min-height: 23px;\n    font-size: 14px;\n    font-size: 1.4rem;\n}\n\n.dynamic-component-container .dynamic-component-title-bar .reset {\n    color: #e6e6e6;\n    position: absolute;\n    top: 0;\n    right: 24px;\n    text-decoration: none;\n    padding: 2px 0 3px 5px;\n}\n\n.dynamic-component-container .dynamic-component-title-bar .reset:before {\n    /* use !important to prevent issues with browser extensions that change fonts */\n    font-family: 'tao' !important;\n    speak: none;\n    font-style: normal;\n    font-weight: normal;\n    font-variant: normal;\n    text-transform: none;\n    line-height: 1;\n    /* Better Font Rendering =========== */\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n    content: \"\\f066\";\n    margin: 0;\n    padding-right: 5px;\n    top: 1px;\n    position: relative;\n    font-size: 14px;\n    font-size: 1.4rem;\n}\n\n.dynamic-component-container .dynamic-component-title-bar .closer {\n    color: #e6e6e6;\n    position: absolute;\n    top: 0;\n    right: 0;\n    text-decoration: none;\n    padding: 2px 2px 2px 4px;\n}\n\n.dynamic-component-container .dynamic-component-title-bar .closer:before {\n    margin: 0;\n    padding-right: 1px;\n    top: 1px;\n    position: relative;\n    font-size: 16px;\n    font-size: 1.6rem;\n}\n\n.dynamic-component-container .dynamic-component-title-bar h3 {\n    padding: 0 5px;\n    margin: 0;\n    text-align: left;\n}\n\n.dynamic-component-container .dynamic-component-content {\n    position: relative;\n}\n\n.dynamic-component-container .dynamic-component-content .dynamic-component-layer {\n    position: absolute;\n    opacity: 0;\n    top: 0;\n    left: 0;\n}\n\n.dynamic-component-container .dynamic-component-content .dynamic-component-layer.dragging-active {\n    width: 100%;\n    height: 100%;\n}\n\n/*# sourceMappingURL=dynamicComponent.css.map *//*\nUsage:\n- linear-gradient((color1, color2, color3)) - returns linear-gradient with evenly distributed colors,\n   if 3 colors used then the position of each will be 33,33%\n- linear-gradient((color1 0%, color2 30%, color3 80%)) - returns linear-gradient with manually distributed colors,\n   first param - color, second - position. Also you can use px or other valid units for set position.\n*/\n/* Do not edit */\n/* Style for the calculator component */\n/* font size mixin specific to calculator to use em instead of rem unit */\n.dynamic-component-container .calcContainer {\n    width: 100%;\n    height: 100%;\n    background: none;\n    border: none;\n    bottom: auto;\n    clear: none;\n    color: #222;\n    display: block;\n    float: none;\n    font-family: sans-serif;\n    left: auto;\n    line-height: normal;\n    margin: 0;\n    max-height: none;\n    max-width: none;\n    min-height: 0;\n    min-width: 0;\n    overflow: visible;\n    padding: 0;\n    position: static;\n    right: auto;\n    text-align: left;\n    text-decoration: none;\n    top: auto;\n    visibility: visible;\n}\n\n.dynamic-component-container .calcContainer:after {\n    clear: both;\n    content: \".\";\n    display: block;\n    height: 0;\n    visibility: hidden;\n}\n\n.dynamic-component-container .calcContainer form {\n    height: 100%;\n    width: 100%;\n    /*\n            * the font-size of the parent element of the calculator will serve as the reference for the children.\n            * the children must use em unit for font-sizing to ensure proportional increase when resized.\n            */\n    font-size: 10px;\n}\n\n.dynamic-component-container .calcContainer form input, .dynamic-component-container .calcContainer form button {\n    background-color: #f3f1ef;\n    border-radius: 0;\n    padding: 0;\n    border: none;\n    color: #222 !important;\n    float: left;\n    height: 14%;\n    text-align: center;\n    text-shadow: none;\n    width: 25%;\n    min-width: 0;\n    cursor: pointer;\n}\n\n.dynamic-component-container .calcContainer form input.div-1, .dynamic-component-container .calcContainer form button.div-1 {\n    width: 100%;\n}\n\n.dynamic-component-container .calcContainer form input.div-2, .dynamic-component-container .calcContainer form button.div-2 {\n    width: 50%;\n}\n\n.dynamic-component-container .calcContainer form input.div-3, .dynamic-component-container .calcContainer form button.div-3 {\n    width: 33.33%;\n}\n\n.dynamic-component-container .calcContainer form input.div-4, .dynamic-component-container .calcContainer form button.div-4 {\n    width: 25%;\n}\n\n.dynamic-component-container .calcContainer form input.div-5, .dynamic-component-container .calcContainer form button.div-5 {\n    width: 20%;\n}\n\n.dynamic-component-container .calcContainer form input.calcFirst, .dynamic-component-container .calcContainer form button.calcFirst {\n    clear: left;\n}\n\n.dynamic-component-container .calcContainer form input.calcClear, .dynamic-component-container .calcContainer form button.calcClear {\n    color: #0e5d91 !important;\n    font-size: 1.8em !important;\n}\n\n.dynamic-component-container .calcContainer form input.calcFunction, .dynamic-component-container .calcContainer form button.calcFunction {\n    font-size: 1.8em !important;\n}\n\n.dynamic-component-container .calcContainer form input.calcFunction sup, .dynamic-component-container .calcContainer form button.calcFunction sup {\n    top: -0.5em;\n    padding-right: 1px;\n    font-size: 0.8em !important;\n}\n\n.dynamic-component-container .calcContainer form input.calcFunction sub, .dynamic-component-container .calcContainer form button.calcFunction sub {\n    padding-left: 1px;\n    font-size: 1em !important;\n}\n\n.dynamic-component-container .calcContainer form input.calcFunction.calcDivision, .dynamic-component-container .calcContainer form input.calcFunction.calcMultiplication, .dynamic-component-container .calcContainer form input.calcFunction.calcSubtraction, .dynamic-component-container .calcContainer form input.calcFunction.calcSum, .dynamic-component-container .calcContainer form button.calcFunction.calcDivision, .dynamic-component-container .calcContainer form button.calcFunction.calcMultiplication, .dynamic-component-container .calcContainer form button.calcFunction.calcSubtraction, .dynamic-component-container .calcContainer form button.calcFunction.calcSum {\n    font-size: 2.2em !important;\n}\n\n.dynamic-component-container .calcContainer form input.calcDisplay, .dynamic-component-container .calcContainer form button.calcDisplay {\n    cursor: text;\n    opacity: 1 !important;\n    background: #fbfbfa;\n    font-family: monospace;\n    text-align: right;\n    width: 100%;\n    max-width: none;\n    padding: 0 0.2em;\n    height: 16%;\n    font-size: 2.8em;\n}\n\n.dynamic-component-container .calcContainer form input.calcDisplay:hover, .dynamic-component-container .calcContainer form button.calcDisplay:hover {\n    background: #fefefd;\n}\n\n.dynamic-component-container .calcContainer form input.calcInput, .dynamic-component-container .calcContainer form button.calcInput {\n    font-weight: bold;\n    font-size: 1.8em !important;\n}\n\n.dynamic-component-container .calcContainer form input.calcSubmit, .dynamic-component-container .calcContainer form button.calcSubmit {\n    font-weight: bold;\n    color: #222 !important;\n    background-color: #ddd;\n    text-shadow: none;\n    line-height: normal;\n}\n\n.dynamic-component-container .calcContainer form input:hover, .dynamic-component-container .calcContainer form button:hover {\n    background: #a4a9b1;\n}\n\n.dynamic-component-container .calcContainer form input.triggered, .dynamic-component-container .calcContainer form button.triggered {\n    background: #6597b9;\n}\n\n/*# sourceMappingURL=calculator.css.map *//* Style for the calculator component */\n/*\nUsage:\n- linear-gradient((color1, color2, color3)) - returns linear-gradient with evenly distributed colors,\n   if 3 colors used then the position of each will be 33,33%\n- linear-gradient((color1 0%, color2 30%, color3 80%)) - returns linear-gradient with manually distributed colors,\n   first param - color, second - position. Also you can use px or other valid units for set position.\n*/\n/* Do not edit */\n/* font size mixin specific to calculator to use em instead of rem unit */\n.calculator {\n    position: relative;\n    font-family: monospace, sans-serif;\n    font-size: 12px;\n    width: 100%;\n    height: 100%;\n    display: -ms-flex;\n    display: flex;\n    flex-direction: column;\n    -ms-align-content: stretch;\n    align-content: stretch;\n}\n\n.calculator sup,\n.calculator sub {\n    font-size: 0.75em;\n}\n\n.calculator sup {\n    top: -0.5em;\n}\n\n.calculator sub {\n    bottom: -0.5em;\n}\n\n.calculator .screen,\n.calculator .input {\n    position: relative;\n    flex: 0 0 auto;\n}\n\n.calculator .focus {\n    outline: 2px solid #0e5d91;\n}\n\n.calculator .keyboard {\n    padding: 0 20px 20px;\n    position: relative;\n    display: -ms-flex;\n    display: flex;\n    flex: 1 1;\n}\n\n.calculator .calculator-keyboard {\n    position: relative;\n    display: -ms-flex;\n    display: flex;\n    flex-direction: column;\n    -ms-align-content: stretch;\n    align-content: stretch;\n    background: #f3f1ef;\n    color: #222;\n    width: 100%;\n    height: auto;\n    padding-top: 8px;\n}\n\n.calculator .calculator-keyboard .row {\n    position: relative;\n    display: -ms-flex;\n    display: flex;\n    flex-direction: row;\n    -ms-align-content: stretch;\n    align-content: stretch;\n    flex: 1 1 auto;\n    width: 100%;\n    height: 100%;\n}\n\n.calculator .calculator-keyboard .spacer {\n    flex: 1 1 auto;\n    width: 3.2em;\n    height: 100%;\n}\n\n.calculator .calculator-keyboard span {\n    position: relative;\n    display: inline-block;\n    z-index: 1;\n    font-size: 1.3em !important;\n}\n\n.calculator .calculator-keyboard button {\n    position: relative;\n    background-color: #f3f1ef;\n    color: #222 !important;\n    display: inline-block;\n    border-radius: 0;\n    border: none;\n    padding: 0;\n    text-align: center;\n    text-shadow: none;\n    cursor: pointer;\n    flex: 1 1 auto;\n    width: 3.2em;\n    height: 100%;\n    font-size: 1em !important;\n}\n\n.calculator .calculator-keyboard button:not(.switch):before {\n    content: ' ';\n    border-radius: 50%;\n    display: inline-block;\n    position: absolute;\n    z-index: 0;\n    top: calc(50% - 1.6em + 2px);\n    left: calc(50% - 1.6em + 2px);\n    width: calc(3.2em - 4px);\n    height: calc(3.2em - 4px);\n}\n\n.calculator .calculator-keyboard button:hover:before {\n    background: #a4a9b1;\n}\n\n.calculator .calculator-keyboard button.disabled {\n    visibility: hidden;\n}\n\n.calculator .calculator-keyboard button.switch span {\n    color: #222 !important;\n    border-color: #919191 !important;\n    border-top: 1px solid;\n    border-bottom: 1px solid;\n    height: auto;\n    width: 100%;\n    padding: 4px 0.5em;\n    font-size: 1em !important;\n}\n\n.calculator .calculator-keyboard button.switch.first span {\n    border-left: 1px solid;\n    border-top-left-radius: 2px;\n    border-bottom-left-radius: 2px;\n}\n\n.calculator .calculator-keyboard button.switch.last span {\n    border-right: 1px solid;\n    border-top-right-radius: 2px;\n    border-bottom-right-radius: 2px;\n}\n\n.calculator .calculator-keyboard button.switch:before {\n    content: ' ';\n    border-radius: 2px;\n    display: inline-block;\n    position: absolute;\n    z-index: 0;\n    top: calc(50% - 0.5em - 4px);\n    bottom: calc(50% - 0.5em - 4px);\n    left: 3px;\n    right: 3px;\n}\n\n.calculator .calculator-keyboard button.operand span {\n    font-weight: bold;\n    font-size: 1.7em !important;\n}\n\n.calculator .calculator-keyboard button.command span {\n    color: #0e5d91 !important;\n}\n\n.calculator .calculator-keyboard button.execute:before {\n    background: #3e7da7;\n}\n\n.calculator .calculator-keyboard button.execute span {\n    font-weight: bold;\n    color: white !important;\n    font-size: 1.7em !important;\n}\n\n.calculator .calculator-keyboard button svg {\n    display: inline-block;\n    width: 1em;\n    height: 1em;\n    stroke-width: 0;\n    stroke: currentColor;\n    fill: currentColor;\n}\n\n.calculator .calculator-keyboard button svg.backspace-outline {\n    width: 1.2em;\n    height: 1.2em;\n}\n\n.calculator.degree .calculator-keyboard button.switch[data-command='degree']:before {\n    background: #3e7da7;\n}\n\n.calculator.degree .calculator-keyboard button.switch[data-command='degree'] span {\n    color: white !important;\n}\n\n.calculator.radian .calculator-keyboard button.switch[data-command='radian']:before {\n    background: #3e7da7;\n}\n\n.calculator.radian .calculator-keyboard button.switch[data-command='radian'] span {\n    color: white !important;\n}\n\n.calculator .simple-screen {\n    position: relative;\n    width: 100%;\n    font-size: 1.3em !important;\n    color: #222;\n    font-family: monospace;\n}\n\n.calculator .simple-screen .screen-panel {\n    position: relative;\n    width: 100%;\n    overflow: auto;\n    word-break: break-all;\n    text-align: left;\n    padding: 8px 8px;\n}\n\n.calculator .simple-screen .history {\n    font-size: 1em !important;\n    border: 1px solid #ddd;\n    color: #4e4e4e;\n    height: calc(16px + 3.9em);\n    line-height: 1.3em;\n}\n\n.calculator .simple-screen .history .history-line .history-expression {\n    text-align: left;\n}\n\n.calculator .simple-screen .history .history-line .history-expression,\n.calculator .simple-screen .history .history-line .history-expression .term {\n    font-weight: lighter;\n}\n\n.calculator .simple-screen .history .history-line .history-result {\n    text-align: right;\n    font-weight: bolder;\n}\n\n.calculator .simple-screen .history .history-line .history-result:before {\n    content: '=';\n    display: inline-block;\n    font-weight: lighter;\n    padding-right: 0.2em;\n}\n\n.calculator .simple-screen .expression {\n    font-size: 1.3em !important;\n    background: white;\n    color: #222;\n    height: calc(16px + 3.2em);\n    line-height: 1.6em;\n}\n\n.calculator .simple-screen .term {\n    padding: 0;\n}\n\n.calculator .simple-screen .term.term-operator:not([data-token='POW']):not([data-token='FAC']):not([data-token='NEG']) {\n    padding: 0 0.2em;\n}\n\n.calculator .simple-screen .term.term-operator[data-token='FAC'], .calculator .simple-screen .term.term-operator[data-token='NEG'] {\n    margin-left: -0.1em;\n    margin-right: -0.1em;\n}\n\n.calculator .simple-screen .term.term-operator[data-token='POS'] {\n    display: none;\n}\n\n.calculator .simple-screen .term.term-function:not([data-token='SQRT']):not([data-token='CBRT']) {\n    padding-right: 0.2em;\n}\n\n.calculator .simple-screen .term.term-operand {\n    font-weight: bold;\n}\n\n.calculator .simple-screen .term.term-modificator {\n    font-weight: lighter;\n}\n\n.calculator .simple-screen .term.term-constant {\n    font-style: italic;\n    font-weight: bold;\n}\n\n.calculator .simple-screen .term.term-variable {\n    font-weight: bold;\n    color: #3e7da7;\n}\n\n.calculator .simple-screen .term.term-variable[data-token='ANS'] {\n    background: #ecf2f6;\n    padding: 0;\n    margin: 0 0.4em;\n    position: relative;\n}\n\n.calculator .simple-screen .term.term-variable[data-token='ANS']::before, .calculator .simple-screen .term.term-variable[data-token='ANS']::after {\n    background: #ecf2f6;\n    content: '';\n    border-radius: 50%;\n    border: 2px none;\n    position: absolute;\n    z-index: 0;\n    top: 0;\n    bottom: 0;\n    width: 0.4em;\n}\n\n.calculator .simple-screen .term.term-variable[data-token='ANS']::before {\n    border-left-style: solid;\n    border-left-color: #3e7da7;\n    left: -0.2em;\n}\n\n.calculator .simple-screen .term.term-variable[data-token='ANS']::after {\n    border-right-style: solid;\n    border-right-color: #3e7da7;\n    right: -0.2em;\n}\n\n.calculator .simple-screen .term.term-variable[data-token='ANS'] * {\n    position: relative;\n    z-index: 1;\n}\n\n.calculator .simple-screen .term.term-unknown {\n    color: #d8ae5b;\n    -webkit-text-decoration: underline wavy #ba122b;\n            text-decoration: underline wavy #ba122b;\n}\n\n.calculator .simple-screen .term.term-elide {\n    display: none;\n}\n\n.calculator .simple-screen .term.term-error {\n    color: #ba122b;\n}\n\n.calculator .simple-screen .term.term-syntaxError {\n    color: #ba122b;\n    -webkit-text-decoration: underline wavy #ba122b;\n            text-decoration: underline wavy #ba122b;\n}\n\n.calculator.error .screen .expression {\n    background: #f1d0d5;\n}\n\n/*# sourceMappingURL=calculator.css.map *//*\nUsage:\n- linear-gradient((color1, color2, color3)) - returns linear-gradient with evenly distributed colors,\n   if 3 colors used then the position of each will be 33,33%\n- linear-gradient((color1 0%, color2 30%, color3 80%)) - returns linear-gradient with manually distributed colors,\n   first param - color, second - position. Also you can use px or other valid units for set position.\n*/\n/* Do not edit */\n.document-viewer .pdf-viewer {\n    position: relative;\n    background-color: #f9f8f7;\n}\n\n.document-viewer .pdf-viewer .pdf-bar {\n    position: relative;\n    display: box;\n    display: -webkit-flexbox;\n    display: flexbox;\n    display: -ms-flex;\n    display: flex;\n    flex-direction: row;\n    flex-wrap: nowrap;\n    flex-pack: start;\n    justify-content: flex-start;\n    flex-line-pack: start;\n    align-content: flex-start;\n    flex-align: stretch;\n    align-items: stretch;\n    -moz-flex-direction: row;\n    -o-flex-direction: row;\n    flex-direction: row;\n    justify-content: space-between;\n    align-items: baseline;\n    background-color: #f3f1ef;\n    color: #222;\n    padding: 2px;\n}\n\n.document-viewer .pdf-viewer .pdf-bar label {\n    font-size: 12px;\n    font-size: 1.2rem;\n    padding: 0;\n    margin: 0;\n}\n\n.document-viewer .pdf-viewer .pdf-info {\n    padding: 0 2px;\n    margin-right: 2px;\n}\n\n.document-viewer .pdf-viewer .pdf-info .info {\n    display: inline-block;\n}\n\n.document-viewer .pdf-viewer .pdf-info .info[data-control=\"pdf-page-num\"] {\n    width: 3rem;\n    margin: 0 2px;\n    text-align: right;\n    font-size: 12px;\n    font-size: 1.2rem;\n    background-color: #f9f8f7;\n    border: 1px solid #c2c1bf;\n}\n\n.document-viewer .pdf-viewer .pdf-info .info[data-control=\"pdf-page-count\"] {\n    font-weight: bold;\n}\n\n.document-viewer .pdf-viewer [data-control=\"pdf-search\"] .icon, .document-viewer .pdf-viewer .pdf-find-bar .icon {\n    padding: 0;\n    margin: 0;\n}\n\n.document-viewer .pdf-viewer .pdf-find-bar {\n    position: absolute;\n    z-index: 1;\n    top: 35px;\n    left: 8px;\n    padding: 4px 8px;\n    background-color: #f9f8f7;\n    border: 1px solid #c2c1bf;\n    border-radius: 4px;\n    -ms-box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.2);\n    -o-box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.2);\n    box-shadow: 0 1px 4px 0 rgba(0, 0, 0, 0.2);\n}\n\n.document-viewer .pdf-viewer .pdf-find-bar::before, .document-viewer .pdf-viewer .pdf-find-bar::after {\n    bottom: 100%;\n    border: solid transparent;\n    content: \" \";\n    height: 0;\n    width: 0;\n    position: absolute;\n    pointer-events: none;\n}\n\n.document-viewer .pdf-viewer .pdf-find-bar::before {\n    left: 13px;\n    margin-left: -9px;\n    border-bottom-color: #c2c1bf;\n    border-width: 9px;\n}\n\n.document-viewer .pdf-viewer .pdf-find-bar::after {\n    left: 13px;\n    margin-left: -8px;\n    border-bottom-color: #f9f8f7;\n    border-width: 8px;\n}\n\n.document-viewer .pdf-viewer .pdf-search-info .pdf-search-position {\n    padding: 4px 8px;\n    font-family: \"Source Sans Pro\", sans-serif;\n    font-size: 12px;\n    font-size: 1.2rem;\n    border-radius: 4px;\n    background-color: #cfdfe9;\n    color: #0e5d91;\n}\n\n.document-viewer .pdf-viewer .pdf-search-info .pdf-search-loop {\n    padding-left: 10px;\n    font-size: 10px;\n    font-size: 1rem;\n    font-style: italic;\n    color: #4e4e4e;\n}\n\n.document-viewer .pdf-viewer .pdf-container {\n    position: relative;\n    overflow-y: auto;\n}\n\n.document-viewer .pdf-viewer .pdf-container.highlight-all .highlight {\n    background-color: #0e5d91;\n}\n\n.document-viewer .pdf-viewer .pdf-page {\n    position: relative;\n    margin: 0 auto;\n}\n\n.document-viewer .pdf-viewer .pdf-content {\n    margin: 0;\n    padding: 0;\n    display: block;\n}\n\n.document-viewer .pdf-viewer .pdf-text {\n    position: absolute;\n    top: 0;\n    left: 0;\n    bottom: 0;\n    right: 0;\n    overflow: hidden;\n    opacity: 0.2;\n    line-height: 1.0;\n}\n\n.document-viewer .pdf-viewer .pdf-text > div {\n    color: transparent;\n    position: absolute;\n    white-space: pre;\n    cursor: text;\n    transform-origin: 0% 0%;\n}\n\n.document-viewer .pdf-viewer .pdf-text .highlight {\n    margin: -1px;\n    padding: 1px;\n    border-radius: 4px;\n}\n\n.document-viewer .pdf-viewer .pdf-text .highlight.begin {\n    -webkit-border-top-right-radius: 0px;\n    -webkit-border-bottom-right-radius: 0px;\n    -moz-border-radius-topright: 0px;\n    -moz-border-radius-bottomright: 0px;\n    border-top-right-radius: 0px;\n    border-bottom-right-radius: 0px;\n    -webkit-border-bottom-right-radius: 0px;\n    -webkit-border-bottom-left-radius: 0px;\n    -moz-border-radius-bottomright: 0px;\n    -moz-border-radius-bottomleft: 0px;\n    border-bottom-right-radius: 0px;\n    border-bottom-left-radius: 0px;\n}\n\n.document-viewer .pdf-viewer .pdf-text .highlight.end {\n    -webkit-border-top-left-radius: 0px;\n    -webkit-border-top-right-radius: 0px;\n    -moz-border-radius-topleft: 0px;\n    -moz-border-radius-topright: 0px;\n    border-top-left-radius: 0px;\n    border-top-right-radius: 0px;\n    -webkit-border-top-left-radius: 0px;\n    -webkit-border-bottom-left-radius: 0px;\n    -moz-border-radius-topleft: 0px;\n    -moz-border-radius-bottomleft: 0px;\n    border-top-left-radius: 0px;\n    border-bottom-left-radius: 0px;\n}\n\n.document-viewer .pdf-viewer .pdf-text .highlight.middle {\n    border-radius: 0px;\n}\n\n.document-viewer .pdf-viewer .pdf-text .highlight.selected {\n    background-color: #0e914b;\n}\n\n/*# sourceMappingURL=documentViewer.css.map */"),define("taoQtiTest/loader/testPlugins.bundle",function(){});
//# sourceMappingURL=testPlugins.min.js.map